var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});var __defProp2=Object.defineProperty,__typeError=__name(msg=>{throw TypeError(msg)},"__typeError"),__defNormalProp=__name((obj,key,value)=>key in obj?__defProp2(obj,key,{enumerable:!0,configurable:!0,writable:!0,value}):obj[key]=value,"__defNormalProp"),__name2=__name((target,value)=>__defProp2(target,"name",{value,configurable:!0}),"__name"),__publicField=__name((obj,key,value)=>__defNormalProp(obj,typeof key!="symbol"?key+"":key,value),"__publicField"),__accessCheck=__name((obj,member,msg)=>member.has(obj)||__typeError("Cannot "+msg),"__accessCheck"),__privateGet=__name((obj,member,getter)=>(__accessCheck(obj,member,"read from private field"),getter?getter.call(obj):member.get(obj)),"__privateGet"),__privateAdd=__name((obj,member,value)=>member.has(obj)?__typeError("Cannot add the same private member more than once"):member instanceof WeakSet?member.add(obj):member.set(obj,value),"__privateAdd"),__privateSet=__name((obj,member,value,setter)=>(__accessCheck(obj,member,"write to private field"),setter?setter.call(obj,value):member.set(obj,value),value),"__privateSet"),__privateMethod=__name((obj,member,method)=>(__accessCheck(obj,member,"access private method"),method),"__privateMethod"),__privateWrapper=__name((obj,member,setter,getter)=>({set _(value){__privateSet(obj,member,value,setter)},get _(){return __privateGet(obj,member,getter)}}),"__privateWrapper"),_Util_static,getExtremumOnCurve_fn,getExtremum_fn,_enableHWA,_baseUrl,__cache,__defs,_docId,_document,__hcmCache,_id,_DOMFilterFactory_instances,cache_get,hcmCache_get,defs_get,createTables_fn,createUrl_fn,addLuminosityConversion_fn,addGrayConversion_fn,createFilter_fn,appendFeFunc_fn,addTransferMapConversion_fn,addTransferMapAlphaConversion_fn,getRGB_fn,_toolbar,_colorPicker,_editor,_buttons,_EditorToolbar_static,pointerDown_fn,_EditorToolbar_instances,focusIn_fn,focusOut_fn,addListenersToElement_fn,addDeleteButton_fn,divider_get,_buttons2,_toolbar2,_uiManager,_HighlightToolbar_instances,render_fn,getLastPoint_fn,addHighlightButton_fn,_id2,_baseId,_id3,_cache,_ImageManager_instances,get_fn,_commands,_locked,_maxSize,_position,_KeyboardManager_instances,serialize_fn,_abortController,_activeEditor,_allEditors,_allLayers,_altTextManager,_annotationStorage,_changedExistingAnnotations,_commandManager,_currentPageIndex,_deletedAnnotationsElementIds,_draggingEditors,_editorTypes,_editorsToRescale,_enableHighlightFloatingButton,_enableUpdatedAddImage,_filterFactory,_focusMainContainerTimeoutId,_highlightColors,_highlightWhenShiftUp,_highlightToolbar,_idManager,_isEnabled,_isWaiting,_lastActiveElement,_mainHighlightColorPicker,_mlManager,_mode,_selectedEditors,_selectedTextNode,_pageColors,_showAllStates,_boundBlur,_boundFocus,_boundCopy,_boundCut,_boundPaste,_boundKeydown,_boundKeyup,_boundOnEditingAction,_boundOnPageChanging,_boundOnScaleChanging,_boundOnRotationChanging,_previousStates,_translation,_translationTimeoutId,_container,_viewer,_AnnotationEditorUIManager_instances,getAnchorElementForSelection_fn,getLayerForTextLayer_fn,displayHighlightToolbar_fn,selectionChange_fn,onSelectEnd_fn,addSelectionListener_fn,addFocusManager_fn,removeFocusManager_fn,addKeyboardManager_fn,removeKeyboardManager_fn,addCopyPasteListeners_fn,removeCopyPasteListeners_fn,addDragAndDropListeners_fn,dispatchUpdateStates_fn,dispatchUpdateUI_fn,enableAll_fn,disableAll_fn,addEditorToLayer_fn,lastSelectedEditor_get,isEmpty_fn,selectEditors_fn,_altText,_altTextDecorative,_altTextButton,_altTextTooltip,_altTextTooltipTimeout,_altTextWasFromKeyBoard,_editor2,_AltText_instances,setState_fn,_accessibilityData,_allResizerDivs,_altText2,_disabled,_keepAspectRatio,_resizersDiv,_savedDimensions,_boundFocusin,_boundFocusout,_editToolbar,_focusedResizerName,_hasBeenClicked,_initialPosition,_isEditing,_isInEditMode,_isResizerEnabledForKeyboard,_moveInDOMTimeout,_prevDragX,_prevDragY,_telemetryTimeouts,_isDraggable,_zIndex,_AnnotationEditor_instances,translate_fn,_AnnotationEditor_static,rotatePoint_fn,getRotationMatrix_fn,createResizers_fn,resizerPointerdown_fn,addResizeToUndoStack_fn,resizerPointermove_fn,selectOnPointerEvent_fn,setUpDragSession_fn,resizerKeydown_fn,resizerBlur_fn,resizerFocus_fn,setResizerTabIndex_fn,stopResizing_fn,_modified,_modifiedIds,_storage,_AnnotationStorage_instances,setModified_fn,_serializable,_systemFonts,_CanvasGraphics_instances,restoreInitialState_fn,drawFilter_fn,_port,_src,_MessageHandler_instances,createStreamSink_fn,processStreamMessage_fn,deleteStreamController_fn,_metadataMap,_data,_isDisplay,_isPrint,_userSet,_visible,_cachedGetHash,_groups,_initialHash,_order,_OptionalContentConfig_instances,evaluateVisibilityExpression_fn,_a,_capability,_container2,_disableProcessItems,_fontInspectorEnabled,_lang,_layoutTextParams,_pageHeight,_pageWidth,_reader,_rootContainer,_rotation,_scale,_styleCache,_textContentItemsStr,_textContentSource,_textDivs,_textDivProperties,_transform,_ascentCache,_canvasContexts,_minFontSize,_pendingTextLayers,_TextLayer_instances,processItems_fn,appendText_fn,layout_fn,_TextLayer_static,getCtx_fn,ensureMinFontSizeComputed_fn,getAscent_fn,_docId2,_delayedCleanupTimeout,_pendingCleanup,_PDFPageProxy_instances,tryCleanup_fn,abortDelayedCleanup_fn,_listeners,_deferred,_workerPorts,_PDFWorker_instances,resolve_fn,_PDFWorker_static,mainThreadWorkerMessageHandler_get,_methodPromises,_pageCache,_pagePromises,_pageRefCache,_passwordCapability,_WorkerTransport_instances,cacheSimpleMethod_fn,_objs,_PDFObjects_instances,ensureObj_fn,_internalRenderTask,_rAF,_canvasInUse,_updates,_hasBorder,_popupElement,_AnnotationElement_instances,setRectEdited_fn,_LinkAnnotationElement_instances,setInternalLink_fn,bindAttachment_fn,bindSetOCGState_fn,_boundKeyDown,_boundHide,_boundShow,_boundToggle,_color,_container3,_contentsObj,_dateObj,_elements,_parent,_parentRect,_pinned,_popup,_position2,_rect,_richText,_titleObj,_updates2,_wasVisible,_PopupElement_instances,html_get,fontSize_get,fontColor_get,makePopupContent_fn,keyDown_fn,setPosition_fn,toggle_fn,show_fn,hide_fn,_line,_square,_circle,_polyline,_polylines,_trigger,_FileAttachmentAnnotationElement_instances,download_fn,_accessibilityManager,_annotationCanvasMap,_editableAnnotations,_AnnotationLayer_instances,appendElement_fn,setAnnotationCanvasMap_fn,_boundEditorDivBlur,_boundEditorDivFocus,_boundEditorDivInput,_boundEditorDivKeydown,_boundEditorDivPaste,_color2,_content,_editorDivId,_fontSize,_initialData,_FreeTextEditor_instances,updateFontSize_fn,updateColor_fn,extractText_fn,setEditorDimensions_fn,_FreeTextEditor_static,getNodeContent_fn,setContent_fn,serializeContent_fn,deserializeContent_fn,hasElementChanged_fn,_box,_verticalEdges,_intervals,_Outliner_instances,getOutlines_fn,binarySearch_fn,insert_fn,remove_fn,breakEdge_fn,_box2,_outlines,_box3,_bottom,_innerMargin,_isLTR,_top,_last,_lastX,_lastY,_min,_min_dist,_scaleFactor,_thickness,_points,_MIN_DIST,_MIN_DIFF,_MIN,_FreeOutliner_instances,getLastCoords_fn,_box4,_bbox,_innerMargin2,_isLTR2,_points2,_scaleFactor2,_outline,_FreeHighlightOutline_instances,rescale_fn,rescaleAndSwap_fn,computeMinMax_fn,_boundKeyDown2,_boundPointerDown,_button,_buttonSwatch,_defaultColor,_dropdown,_dropdownWasFromKeyboard,_isMainColorPicker,_editor3,_eventBus,_uiManager2,_type,_ColorPicker_instances,getDropdownRoot_fn,colorSelect_fn,keyDown_fn2,openDropdown_fn,pointerDown_fn2,isDropdownVisible_get,_anchorNode,_anchorOffset,_boxes,_clipPathId,_colorPicker2,_focusOutlines,_focusNode,_focusOffset,_highlightDiv,_highlightOutlines,_id4,_isFreeHighlight,_boundKeydown2,_lastPoint,_opacity,_outlineId,_text,_thickness2,_methodOfCreation,_HighlightEditor_instances,createOutlines_fn,createFreeOutlines_fn,updateColor_fn2,updateThickness_fn,changeThickness_fn,cleanDrawLayer_fn,addToDrawLayer_fn,_HighlightEditor_static,rotateBbox_fn,keydown_fn,setCaret_fn,getRotation_fn,serializeBoxes_fn,serializeOutlines_fn,highlightMove_fn,endHighlight_fn,_baseHeight,_baseWidth,_boundCanvasPointermove,_boundCanvasPointerleave,_boundCanvasPointerup,_boundCanvasPointerdown,_canvasContextMenuTimeoutId,_currentPath2D,_disableEditing,_hasSomethingToDraw,_isCanvasInitialized,_observer,_realWidth,_realHeight,_requestFrameCallback,_InkEditor_instances,updateThickness_fn2,updateColor_fn3,updateOpacity_fn,getInitialBBox_fn,setStroke_fn,startDrawing_fn,draw_fn,endPath_fn,stopDrawing_fn,drawPoints_fn,makeBezierCurve_fn,generateBezierPoints_fn,redraw_fn,endDrawing_fn,createCanvas_fn,createObserver_fn,setCanvasDims_fn,setScaleFactor_fn,updateTransform_fn,_InkEditor_static,buildPath2D_fn,toPDFCoordinates_fn,fromPDFCoordinates_fn,serializePaths_fn,getBbox_fn,getPadding_fn,fitToContent_fn,_bitmap,_bitmapId,_bitmapPromise,_bitmapUrl,_bitmapFile,_bitmapFileName,_canvas,_hasMLBeenQueried,_observer2,_resizeTimeoutId,_isSvg,_hasBeenAddedInUndoStack,_StampEditor_instances,getBitmapFetched_fn,getBitmapDone_fn,getBitmap_fn,createCanvas_fn2,setDimensions_fn,scaleBitmap_fn,mlGuessAltText_fn,drawBitmap_fn,serializeBitmap_fn,createObserver_fn2,_accessibilityManager2,_allowClick,_annotationLayer,_boundPointerup,_boundPointerdown,_boundTextLayerPointerDown,_editorFocusTimeoutId,_editors,_hadPointerDown,_isCleaningUp,_isDisabling,_textLayer,_uiManager3,_editorTypes2,_AnnotationEditorLayer_instances,textLayerPointerDown_fn,currentEditorType_get,createNewEditor_fn,getCenterPoint_fn,cleanup_fn,_parent2,_id5,_mapping,_toUpdate,_DrawLayer_static,setBox_fn,_DrawLayer_instances,createSVG_fn,createClipPath_fn,_b;const semver=/^[v^~<>=]*?(\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+)(?:\.([x*]|\d+))?(?:-([\da-z\-]+(?:\.[\da-z\-]+)*))?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i,validateAndParse=__name2(version2=>{if(typeof version2!="string")throw new TypeError("Invalid argument expected string");const match=version2.match(semver);if(!match)throw new Error(`Invalid argument not valid semver ('${version2}' received)`);return match.shift(),match},"validateAndParse"),isWildcard=__name2(s=>s==="*"||s==="x"||s==="X","isWildcard"),tryParse=__name2(v=>{const n=parseInt(v,10);return isNaN(n)?v:n},"tryParse"),forceType=__name2((a,b)=>typeof a!=typeof b?[String(a),String(b)]:[a,b],"forceType"),compareStrings=__name2((a,b)=>{if(isWildcard(a)||isWildcard(b))return 0;const[ap,bp]=forceType(tryParse(a),tryParse(b));return ap>bp?1:ap<bp?-1:0},"compareStrings"),compareSegments=__name2((a,b)=>{for(let i=0;i<Math.max(a.length,b.length);i++){const r=compareStrings(a[i]||"0",b[i]||"0");if(r!==0)return r}return 0},"compareSegments"),compareVersions=__name2((v1,v2)=>{const n1=validateAndParse(v1),n2=validateAndParse(v2),p1=n1.pop(),p2=n2.pop(),r=compareSegments(n1,n2);return r!==0?r:p1&&p2?compareSegments(p1.split("."),p2.split(".")):p1||p2?p1?-1:1:0},"compareVersions"),compare=__name2((v1,v2,operator)=>{assertValidOperator(operator);const res=compareVersions(v1,v2);return operatorResMap[operator].includes(res)},"compare"),operatorResMap={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1],"!=":[-1,1]},allowedOperators=Object.keys(operatorResMap),assertValidOperator=__name2(op=>{if(allowedOperators.indexOf(op)===-1)throw new Error(`Invalid operator, expected one of ${allowedOperators.join("|")}`)},"assertValidOperator");var createCanvas=__name2(function(width,height){return Object.assign(document.createElement("canvas"),{width,height})},"createCanvas"),loadImage=__name2(function(src,options){return new Promise(function(resolve,reject){const image=Object.assign(document.createElement("img"),options);function cleanup(){image.onload=null,image.onerror=null}__name(cleanup,"cleanup"),__name2(cleanup,"cleanup"),image.onload=function(){cleanup(),resolve(image)},image.onerror=function(){cleanup(),reject(new Error('Failed to load the image "'+src+'"'))},image.src=src})},"loadImage"),__webpack_modules__={9306:(module,__unused_webpack_exports,__webpack_require__2)=>{var isCallable=__webpack_require__2(4901),tryToString=__webpack_require__2(6823),$TypeError=TypeError;module.exports=function(argument){if(isCallable(argument))return argument;throw new $TypeError(tryToString(argument)+" is not a function")}},3506:(module,__unused_webpack_exports,__webpack_require__2)=>{var isPossiblePrototype=__webpack_require__2(3925),$String=String,$TypeError=TypeError;module.exports=function(argument){if(isPossiblePrototype(argument))return argument;throw new $TypeError("Can't set "+$String(argument)+" as a prototype")}},7080:(module,__unused_webpack_exports,__webpack_require__2)=>{var has=__webpack_require__2(4402).has;module.exports=function(it){return has(it),it}},679:(module,__unused_webpack_exports,__webpack_require__2)=>{var isPrototypeOf=__webpack_require__2(1625),$TypeError=TypeError;module.exports=function(it,Prototype){if(isPrototypeOf(Prototype,it))return it;throw new $TypeError("Incorrect invocation")}},8551:(module,__unused_webpack_exports,__webpack_require__2)=>{var isObject=__webpack_require__2(34),$String=String,$TypeError=TypeError;module.exports=function(argument){if(isObject(argument))return argument;throw new $TypeError($String(argument)+" is not an object")}},7811:module=>{module.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7394:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThisAccessor=__webpack_require__2(6706),classof=__webpack_require__2(4576),$TypeError=TypeError;module.exports=uncurryThisAccessor(ArrayBuffer.prototype,"byteLength","get")||function(O){if(classof(O)!=="ArrayBuffer")throw new $TypeError("ArrayBuffer expected");return O.byteLength}},3238:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),arrayBufferByteLength=__webpack_require__2(7394),slice=uncurryThis(ArrayBuffer.prototype.slice);module.exports=function(O){if(arrayBufferByteLength(O)!==0)return!1;try{return slice(O,0,0),!1}catch{return!0}}},5636:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),uncurryThis=__webpack_require__2(9504),uncurryThisAccessor=__webpack_require__2(6706),toIndex=__webpack_require__2(7696),isDetached=__webpack_require__2(3238),arrayBufferByteLength=__webpack_require__2(7394),detachTransferable=__webpack_require__2(4483),PROPER_STRUCTURED_CLONE_TRANSFER=__webpack_require__2(1548),structuredClone2=global2.structuredClone,ArrayBuffer2=global2.ArrayBuffer,DataView2=global2.DataView,TypeError2=global2.TypeError,min=Math.min,ArrayBufferPrototype=ArrayBuffer2.prototype,DataViewPrototype=DataView2.prototype,slice=uncurryThis(ArrayBufferPrototype.slice),isResizable=uncurryThisAccessor(ArrayBufferPrototype,"resizable","get"),maxByteLength=uncurryThisAccessor(ArrayBufferPrototype,"maxByteLength","get"),getInt8=uncurryThis(DataViewPrototype.getInt8),setInt8=uncurryThis(DataViewPrototype.setInt8);module.exports=(PROPER_STRUCTURED_CLONE_TRANSFER||detachTransferable)&&function(arrayBuffer,newLength,preserveResizability){var byteLength=arrayBufferByteLength(arrayBuffer),newByteLength=newLength===void 0?byteLength:toIndex(newLength),fixedLength=!isResizable||!isResizable(arrayBuffer),newBuffer;if(isDetached(arrayBuffer))throw new TypeError2("ArrayBuffer is detached");if(PROPER_STRUCTURED_CLONE_TRANSFER&&(arrayBuffer=structuredClone2(arrayBuffer,{transfer:[arrayBuffer]}),byteLength===newByteLength&&(preserveResizability||fixedLength)))return arrayBuffer;if(byteLength>=newByteLength&&(!preserveResizability||fixedLength))newBuffer=slice(arrayBuffer,0,newByteLength);else{var options=preserveResizability&&!fixedLength&&maxByteLength?{maxByteLength:maxByteLength(arrayBuffer)}:void 0;newBuffer=new ArrayBuffer2(newByteLength,options);for(var a=new DataView2(arrayBuffer),b=new DataView2(newBuffer),copyLength=min(newByteLength,byteLength),i=0;i<copyLength;i++)setInt8(b,i,getInt8(a,i))}return PROPER_STRUCTURED_CLONE_TRANSFER||detachTransferable(arrayBuffer),newBuffer}},4644:(module,__unused_webpack_exports,__webpack_require__2)=>{var NATIVE_ARRAY_BUFFER=__webpack_require__2(7811),DESCRIPTORS=__webpack_require__2(3724),global2=__webpack_require__2(4475),isCallable=__webpack_require__2(4901),isObject=__webpack_require__2(34),hasOwn=__webpack_require__2(9297),classof=__webpack_require__2(6955),tryToString=__webpack_require__2(6823),createNonEnumerableProperty=__webpack_require__2(6699),defineBuiltIn=__webpack_require__2(6840),defineBuiltInAccessor=__webpack_require__2(2106),isPrototypeOf=__webpack_require__2(1625),getPrototypeOf=__webpack_require__2(2787),setPrototypeOf=__webpack_require__2(2967),wellKnownSymbol=__webpack_require__2(8227),uid=__webpack_require__2(3392),InternalStateModule=__webpack_require__2(1181),enforceInternalState=InternalStateModule.enforce,getInternalState=InternalStateModule.get,Int8Array2=global2.Int8Array,Int8ArrayPrototype=Int8Array2&&Int8Array2.prototype,Uint8ClampedArray=global2.Uint8ClampedArray,Uint8ClampedArrayPrototype=Uint8ClampedArray&&Uint8ClampedArray.prototype,TypedArray=Int8Array2&&getPrototypeOf(Int8Array2),TypedArrayPrototype=Int8ArrayPrototype&&getPrototypeOf(Int8ArrayPrototype),ObjectPrototype=Object.prototype,TypeError2=global2.TypeError,TO_STRING_TAG=wellKnownSymbol("toStringTag"),TYPED_ARRAY_TAG=uid("TYPED_ARRAY_TAG"),TYPED_ARRAY_CONSTRUCTOR="TypedArrayConstructor",NATIVE_ARRAY_BUFFER_VIEWS=NATIVE_ARRAY_BUFFER&&!!setPrototypeOf&&classof(global2.opera)!=="Opera",TYPED_ARRAY_TAG_REQUIRED=!1,NAME,Constructor,Prototype,TypedArrayConstructorsList={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},BigIntArrayConstructorsList={BigInt64Array:8,BigUint64Array:8},isView=__name2(__name(function(it){if(!isObject(it))return!1;var klass=classof(it);return klass==="DataView"||hasOwn(TypedArrayConstructorsList,klass)||hasOwn(BigIntArrayConstructorsList,klass)},"isView2"),"isView"),getTypedArrayConstructor=__name2(function(it){var proto=getPrototypeOf(it);if(isObject(proto)){var state=getInternalState(proto);return state&&hasOwn(state,TYPED_ARRAY_CONSTRUCTOR)?state[TYPED_ARRAY_CONSTRUCTOR]:getTypedArrayConstructor(proto)}},"getTypedArrayConstructor"),isTypedArray=__name2(function(it){if(!isObject(it))return!1;var klass=classof(it);return hasOwn(TypedArrayConstructorsList,klass)||hasOwn(BigIntArrayConstructorsList,klass)},"isTypedArray"),aTypedArray=__name2(function(it){if(isTypedArray(it))return it;throw new TypeError2("Target is not a typed array")},"aTypedArray"),aTypedArrayConstructor=__name2(function(C){if(isCallable(C)&&(!setPrototypeOf||isPrototypeOf(TypedArray,C)))return C;throw new TypeError2(tryToString(C)+" is not a typed array constructor")},"aTypedArrayConstructor"),exportTypedArrayMethod=__name2(function(KEY,property,forced,options){if(DESCRIPTORS){if(forced)for(var ARRAY in TypedArrayConstructorsList){var TypedArrayConstructor=global2[ARRAY];if(TypedArrayConstructor&&hasOwn(TypedArrayConstructor.prototype,KEY))try{delete TypedArrayConstructor.prototype[KEY]}catch{try{TypedArrayConstructor.prototype[KEY]=property}catch{}}}(!TypedArrayPrototype[KEY]||forced)&&defineBuiltIn(TypedArrayPrototype,KEY,forced?property:NATIVE_ARRAY_BUFFER_VIEWS&&Int8ArrayPrototype[KEY]||property,options)}},"exportTypedArrayMethod"),exportTypedArrayStaticMethod=__name2(function(KEY,property,forced){var ARRAY,TypedArrayConstructor;if(DESCRIPTORS){if(setPrototypeOf){if(forced){for(ARRAY in TypedArrayConstructorsList)if(TypedArrayConstructor=global2[ARRAY],TypedArrayConstructor&&hasOwn(TypedArrayConstructor,KEY))try{delete TypedArrayConstructor[KEY]}catch{}}if(!TypedArray[KEY]||forced)try{return defineBuiltIn(TypedArray,KEY,forced?property:NATIVE_ARRAY_BUFFER_VIEWS&&TypedArray[KEY]||property)}catch{}else return}for(ARRAY in TypedArrayConstructorsList)TypedArrayConstructor=global2[ARRAY],TypedArrayConstructor&&(!TypedArrayConstructor[KEY]||forced)&&defineBuiltIn(TypedArrayConstructor,KEY,property)}},"exportTypedArrayStaticMethod");for(NAME in TypedArrayConstructorsList)Constructor=global2[NAME],Prototype=Constructor&&Constructor.prototype,Prototype?enforceInternalState(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor:NATIVE_ARRAY_BUFFER_VIEWS=!1;for(NAME in BigIntArrayConstructorsList)Constructor=global2[NAME],Prototype=Constructor&&Constructor.prototype,Prototype&&(enforceInternalState(Prototype)[TYPED_ARRAY_CONSTRUCTOR]=Constructor);if((!NATIVE_ARRAY_BUFFER_VIEWS||!isCallable(TypedArray)||TypedArray===Function.prototype)&&(TypedArray=__name2(__name(function(){throw new TypeError2("Incorrect invocation")},"TypedArray2"),"TypedArray"),NATIVE_ARRAY_BUFFER_VIEWS))for(NAME in TypedArrayConstructorsList)global2[NAME]&&setPrototypeOf(global2[NAME],TypedArray);if((!NATIVE_ARRAY_BUFFER_VIEWS||!TypedArrayPrototype||TypedArrayPrototype===ObjectPrototype)&&(TypedArrayPrototype=TypedArray.prototype,NATIVE_ARRAY_BUFFER_VIEWS))for(NAME in TypedArrayConstructorsList)global2[NAME]&&setPrototypeOf(global2[NAME].prototype,TypedArrayPrototype);if(NATIVE_ARRAY_BUFFER_VIEWS&&getPrototypeOf(Uint8ClampedArrayPrototype)!==TypedArrayPrototype&&setPrototypeOf(Uint8ClampedArrayPrototype,TypedArrayPrototype),DESCRIPTORS&&!hasOwn(TypedArrayPrototype,TO_STRING_TAG)){TYPED_ARRAY_TAG_REQUIRED=!0,defineBuiltInAccessor(TypedArrayPrototype,TO_STRING_TAG,{configurable:!0,get:__name2(function(){return isObject(this)?this[TYPED_ARRAY_TAG]:void 0},"get")});for(NAME in TypedArrayConstructorsList)global2[NAME]&&createNonEnumerableProperty(global2[NAME],TYPED_ARRAY_TAG,NAME)}module.exports={NATIVE_ARRAY_BUFFER_VIEWS,TYPED_ARRAY_TAG:TYPED_ARRAY_TAG_REQUIRED&&TYPED_ARRAY_TAG,aTypedArray,aTypedArrayConstructor,exportTypedArrayMethod,exportTypedArrayStaticMethod,getTypedArrayConstructor,isView,isTypedArray,TypedArray,TypedArrayPrototype}},5370:(module,__unused_webpack_exports,__webpack_require__2)=>{var lengthOfArrayLike=__webpack_require__2(6198);module.exports=function(Constructor,list,$length){for(var index2=0,length=arguments.length>2?$length:lengthOfArrayLike(list),result=new Constructor(length);length>index2;)result[index2]=list[index2++];return result}},9617:(module,__unused_webpack_exports,__webpack_require__2)=>{var toIndexedObject=__webpack_require__2(5397),toAbsoluteIndex=__webpack_require__2(5610),lengthOfArrayLike=__webpack_require__2(6198),createMethod=__name2(function(IS_INCLUDES){return function($this,el,fromIndex){var O=toIndexedObject($this),length=lengthOfArrayLike(O);if(length===0)return!IS_INCLUDES&&-1;var index2=toAbsoluteIndex(fromIndex,length),value;if(IS_INCLUDES&&el!==el){for(;length>index2;)if(value=O[index2++],value!==value)return!0}else for(;length>index2;index2++)if((IS_INCLUDES||index2 in O)&&O[index2]===el)return IS_INCLUDES||index2||0;return!IS_INCLUDES&&-1}},"createMethod");module.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},4527:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),isArray=__webpack_require__2(4376),$TypeError=TypeError,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(error){return error instanceof TypeError}}();module.exports=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(O,length){if(isArray(O)&&!getOwnPropertyDescriptor(O,"length").writable)throw new $TypeError("Cannot set read only .length");return O.length=length}:function(O,length){return O.length=length}},7628:(module,__unused_webpack_exports,__webpack_require__2)=>{var lengthOfArrayLike=__webpack_require__2(6198);module.exports=function(O,C){for(var len=lengthOfArrayLike(O),A=new C(len),k=0;k<len;k++)A[k]=O[len-k-1];return A}},9928:(module,__unused_webpack_exports,__webpack_require__2)=>{var lengthOfArrayLike=__webpack_require__2(6198),toIntegerOrInfinity=__webpack_require__2(1291),$RangeError=RangeError;module.exports=function(O,C,index2,value){var len=lengthOfArrayLike(O),relativeIndex=toIntegerOrInfinity(index2),actualIndex=relativeIndex<0?len+relativeIndex:relativeIndex;if(actualIndex>=len||actualIndex<0)throw new $RangeError("Incorrect index");for(var A=new C(len),k=0;k<len;k++)A[k]=k===actualIndex?value:O[k];return A}},6319:(module,__unused_webpack_exports,__webpack_require__2)=>{var anObject=__webpack_require__2(8551),iteratorClose=__webpack_require__2(9539);module.exports=function(iterator,fn,value,ENTRIES){try{return ENTRIES?fn(anObject(value)[0],value[1]):fn(value)}catch(error){iteratorClose(iterator,"throw",error)}}},4576:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),toString=uncurryThis({}.toString),stringSlice=uncurryThis("".slice);module.exports=function(it){return stringSlice(toString(it),8,-1)}},6955:(module,__unused_webpack_exports,__webpack_require__2)=>{var TO_STRING_TAG_SUPPORT=__webpack_require__2(2140),isCallable=__webpack_require__2(4901),classofRaw=__webpack_require__2(4576),wellKnownSymbol=__webpack_require__2(8227),TO_STRING_TAG=wellKnownSymbol("toStringTag"),$Object=Object,CORRECT_ARGUMENTS=classofRaw(function(){return arguments}())==="Arguments",tryGet=__name2(function(it,key){try{return it[key]}catch{}},"tryGet");module.exports=TO_STRING_TAG_SUPPORT?classofRaw:function(it){var O,tag,result;return it===void 0?"Undefined":it===null?"Null":typeof(tag=tryGet(O=$Object(it),TO_STRING_TAG))=="string"?tag:CORRECT_ARGUMENTS?classofRaw(O):(result=classofRaw(O))==="Object"&&isCallable(O.callee)?"Arguments":result}},7740:(module,__unused_webpack_exports,__webpack_require__2)=>{var hasOwn=__webpack_require__2(9297),ownKeys=__webpack_require__2(5031),getOwnPropertyDescriptorModule=__webpack_require__2(7347),definePropertyModule=__webpack_require__2(4913);module.exports=function(target,source,exceptions){for(var keys=ownKeys(source),defineProperty=definePropertyModule.f,getOwnPropertyDescriptor=getOwnPropertyDescriptorModule.f,i=0;i<keys.length;i++){var key=keys[i];!hasOwn(target,key)&&!(exceptions&&hasOwn(exceptions,key))&&defineProperty(target,key,getOwnPropertyDescriptor(source,key))}}},2211:(module,__unused_webpack_exports,__webpack_require__2)=>{var fails=__webpack_require__2(9039);module.exports=!fails(function(){function F(){}return __name(F,"F"),__name2(F,"F"),F.prototype.constructor=null,Object.getPrototypeOf(new F)!==F.prototype})},2529:module=>{module.exports=function(value,done){return{value,done}}},6699:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),definePropertyModule=__webpack_require__2(4913),createPropertyDescriptor=__webpack_require__2(6980);module.exports=DESCRIPTORS?function(object,key,value){return definePropertyModule.f(object,key,createPropertyDescriptor(1,value))}:function(object,key,value){return object[key]=value,object}},6980:module=>{module.exports=function(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value}}},4659:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),definePropertyModule=__webpack_require__2(4913),createPropertyDescriptor=__webpack_require__2(6980);module.exports=function(object,key,value){DESCRIPTORS?definePropertyModule.f(object,key,createPropertyDescriptor(0,value)):object[key]=value}},2106:(module,__unused_webpack_exports,__webpack_require__2)=>{var makeBuiltIn=__webpack_require__2(283),defineProperty=__webpack_require__2(4913);module.exports=function(target,name,descriptor){return descriptor.get&&makeBuiltIn(descriptor.get,name,{getter:!0}),descriptor.set&&makeBuiltIn(descriptor.set,name,{setter:!0}),defineProperty.f(target,name,descriptor)}},6840:(module,__unused_webpack_exports,__webpack_require__2)=>{var isCallable=__webpack_require__2(4901),definePropertyModule=__webpack_require__2(4913),makeBuiltIn=__webpack_require__2(283),defineGlobalProperty=__webpack_require__2(9433);module.exports=function(O,key,value,options){options||(options={});var simple=options.enumerable,name=options.name!==void 0?options.name:key;if(isCallable(value)&&makeBuiltIn(value,name,options),options.global)simple?O[key]=value:defineGlobalProperty(key,value);else{try{options.unsafe?O[key]&&(simple=!0):delete O[key]}catch{}simple?O[key]=value:definePropertyModule.f(O,key,{value,enumerable:!1,configurable:!options.nonConfigurable,writable:!options.nonWritable})}return O}},6279:(module,__unused_webpack_exports,__webpack_require__2)=>{var defineBuiltIn=__webpack_require__2(6840);module.exports=function(target,src,options){for(var key in src)defineBuiltIn(target,key,src[key],options);return target}},9433:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),defineProperty=Object.defineProperty;module.exports=function(key,value){try{defineProperty(global2,key,{value,configurable:!0,writable:!0})}catch{global2[key]=value}return value}},3724:(module,__unused_webpack_exports,__webpack_require__2)=>{var fails=__webpack_require__2(9039);module.exports=!fails(function(){return Object.defineProperty({},1,{get:__name2(function(){return 7},"get")})[1]!==7})},4483:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),tryNodeRequire=__webpack_require__2(9714),PROPER_STRUCTURED_CLONE_TRANSFER=__webpack_require__2(1548),structuredClone2=global2.structuredClone,$ArrayBuffer=global2.ArrayBuffer,$MessageChannel=global2.MessageChannel,detach=!1,WorkerThreads,channel,buffer,$detach;if(PROPER_STRUCTURED_CLONE_TRANSFER)detach=__name2(function(transferable){structuredClone2(transferable,{transfer:[transferable]})},"detach");else if($ArrayBuffer)try{$MessageChannel||(WorkerThreads=tryNodeRequire("worker_threads"),WorkerThreads&&($MessageChannel=WorkerThreads.MessageChannel)),$MessageChannel&&(channel=new $MessageChannel,buffer=new $ArrayBuffer(2),$detach=__name2(function(transferable){channel.port1.postMessage(null,[transferable])},"$detach"),buffer.byteLength===2&&($detach(buffer),buffer.byteLength===0&&(detach=$detach)))}catch{}module.exports=detach},4055:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),isObject=__webpack_require__2(34),document2=global2.document,EXISTS=isObject(document2)&&isObject(document2.createElement);module.exports=function(it){return EXISTS?document2.createElement(it):{}}},6837:module=>{var $TypeError=TypeError,MAX_SAFE_INTEGER=9007199254740991;module.exports=function(it){if(it>MAX_SAFE_INTEGER)throw $TypeError("Maximum allowed index exceeded");return it}},5002:module=>{module.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},7290:(module,__unused_webpack_exports,__webpack_require__2)=>{var IS_DENO=__webpack_require__2(516),IS_NODE=__webpack_require__2(9088);module.exports=!IS_DENO&&!IS_NODE&&typeof window=="object"&&typeof document=="object"},516:module=>{module.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},9088:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),classof=__webpack_require__2(4576);module.exports=classof(global2.process)==="process"},9392:module=>{module.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},7388:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),userAgent=__webpack_require__2(9392),process2=global2.process,Deno2=global2.Deno,versions=process2&&process2.versions||Deno2&&Deno2.version,v8=versions&&versions.v8,match,version2;v8&&(match=v8.split("."),version2=match[0]>0&&match[0]<4?1:+(match[0]+match[1])),!version2&&userAgent&&(match=userAgent.match(/Edge\/(\d+)/),(!match||match[1]>=74)&&(match=userAgent.match(/Chrome\/(\d+)/),match&&(version2=+match[1]))),module.exports=version2},8727:module=>{module.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6193:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),$Error=Error,replace=uncurryThis("".replace),TEST=function(arg){return String(new $Error(arg).stack)}("zxcasd"),V8_OR_CHAKRA_STACK_ENTRY=/\n\s*at [^:]*:[^\n]*/,IS_V8_OR_CHAKRA_STACK=V8_OR_CHAKRA_STACK_ENTRY.test(TEST);module.exports=function(stack,dropEntries){if(IS_V8_OR_CHAKRA_STACK&&typeof stack=="string"&&!$Error.prepareStackTrace)for(;dropEntries--;)stack=replace(stack,V8_OR_CHAKRA_STACK_ENTRY,"");return stack}},6518:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),getOwnPropertyDescriptor=__webpack_require__2(7347).f,createNonEnumerableProperty=__webpack_require__2(6699),defineBuiltIn=__webpack_require__2(6840),defineGlobalProperty=__webpack_require__2(9433),copyConstructorProperties=__webpack_require__2(7740),isForced=__webpack_require__2(2796);module.exports=function(options,source){var TARGET=options.target,GLOBAL=options.global,STATIC=options.stat,FORCED,target,key,targetProperty,sourceProperty,descriptor;if(GLOBAL?target=global2:STATIC?target=global2[TARGET]||defineGlobalProperty(TARGET,{}):target=global2[TARGET]&&global2[TARGET].prototype,target)for(key in source){if(sourceProperty=source[key],options.dontCallGetSet?(descriptor=getOwnPropertyDescriptor(target,key),targetProperty=descriptor&&descriptor.value):targetProperty=target[key],FORCED=isForced(GLOBAL?key:TARGET+(STATIC?".":"#")+key,options.forced),!FORCED&&targetProperty!==void 0){if(typeof sourceProperty==typeof targetProperty)continue;copyConstructorProperties(sourceProperty,targetProperty)}(options.sham||targetProperty&&targetProperty.sham)&&createNonEnumerableProperty(sourceProperty,"sham",!0),defineBuiltIn(target,key,sourceProperty,options)}}},9039:module=>{module.exports=function(exec){try{return!!exec()}catch{return!0}}},6080:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(7476),aCallable=__webpack_require__2(9306),NATIVE_BIND=__webpack_require__2(616),bind=uncurryThis(uncurryThis.bind);module.exports=function(fn,that){return aCallable(fn),that===void 0?fn:NATIVE_BIND?bind(fn,that):function(){return fn.apply(that,arguments)}}},616:(module,__unused_webpack_exports,__webpack_require__2)=>{var fails=__webpack_require__2(9039);module.exports=!fails(function(){var test=function(){}.bind();return typeof test!="function"||test.hasOwnProperty("prototype")})},9565:(module,__unused_webpack_exports,__webpack_require__2)=>{var NATIVE_BIND=__webpack_require__2(616),call=Function.prototype.call;module.exports=NATIVE_BIND?call.bind(call):function(){return call.apply(call,arguments)}},350:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),hasOwn=__webpack_require__2(9297),FunctionPrototype=Function.prototype,getDescriptor=DESCRIPTORS&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn(FunctionPrototype,"name"),PROPER=EXISTS&&__name2(__name(function(){},"something"),"something").name==="something",CONFIGURABLE=EXISTS&&(!DESCRIPTORS||DESCRIPTORS&&getDescriptor(FunctionPrototype,"name").configurable);module.exports={EXISTS,PROPER,CONFIGURABLE}},6706:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),aCallable=__webpack_require__2(9306);module.exports=function(object,key,method){try{return uncurryThis(aCallable(Object.getOwnPropertyDescriptor(object,key)[method]))}catch{}}},7476:(module,__unused_webpack_exports,__webpack_require__2)=>{var classofRaw=__webpack_require__2(4576),uncurryThis=__webpack_require__2(9504);module.exports=function(fn){if(classofRaw(fn)==="Function")return uncurryThis(fn)}},9504:(module,__unused_webpack_exports,__webpack_require__2)=>{var NATIVE_BIND=__webpack_require__2(616),FunctionPrototype=Function.prototype,call=FunctionPrototype.call,uncurryThisWithBind=NATIVE_BIND&&FunctionPrototype.bind.bind(call,call);module.exports=NATIVE_BIND?uncurryThisWithBind:function(fn){return function(){return call.apply(fn,arguments)}}},7751:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),isCallable=__webpack_require__2(4901),aFunction=__name2(function(argument){return isCallable(argument)?argument:void 0},"aFunction");module.exports=function(namespace,method){return arguments.length<2?aFunction(global2[namespace]):global2[namespace]&&global2[namespace][method]}},1767:module=>{module.exports=function(obj){return{iterator:obj,next:obj.next,done:!1}}},8646:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767),getIteratorMethod=__webpack_require__2(851);module.exports=function(obj,stringHandling){(!stringHandling||typeof obj!="string")&&anObject(obj);var method=getIteratorMethod(obj);return getIteratorDirect(anObject(method!==void 0?call(method,obj):obj))}},851:(module,__unused_webpack_exports,__webpack_require__2)=>{var classof=__webpack_require__2(6955),getMethod=__webpack_require__2(5966),isNullOrUndefined=__webpack_require__2(4117),Iterators=__webpack_require__2(6269),wellKnownSymbol=__webpack_require__2(8227),ITERATOR=wellKnownSymbol("iterator");module.exports=function(it){if(!isNullOrUndefined(it))return getMethod(it,ITERATOR)||getMethod(it,"@@iterator")||Iterators[classof(it)]}},81:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),tryToString=__webpack_require__2(6823),getIteratorMethod=__webpack_require__2(851),$TypeError=TypeError;module.exports=function(argument,usingIterator){var iteratorMethod=arguments.length<2?getIteratorMethod(argument):usingIterator;if(aCallable(iteratorMethod))return anObject(call(iteratorMethod,argument));throw new $TypeError(tryToString(argument)+" is not iterable")}},5966:(module,__unused_webpack_exports,__webpack_require__2)=>{var aCallable=__webpack_require__2(9306),isNullOrUndefined=__webpack_require__2(4117);module.exports=function(V,P){var func=V[P];return isNullOrUndefined(func)?void 0:aCallable(func)}},3789:(module,__unused_webpack_exports,__webpack_require__2)=>{var aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),call=__webpack_require__2(9565),toIntegerOrInfinity=__webpack_require__2(1291),getIteratorDirect=__webpack_require__2(1767),INVALID_SIZE="Invalid size",$RangeError=RangeError,$TypeError=TypeError,max=Math.max,SetRecord=__name2(function(set,intSize){this.set=set,this.size=max(intSize,0),this.has=aCallable(set.has),this.keys=aCallable(set.keys)},"SetRecord");SetRecord.prototype={getIterator:__name2(function(){return getIteratorDirect(anObject(call(this.keys,this.set)))},"getIterator"),includes:__name2(function(it){return call(this.has,this.set,it)},"includes")},module.exports=function(obj){anObject(obj);var numSize=+obj.size;if(numSize!==numSize)throw new $TypeError(INVALID_SIZE);var intSize=toIntegerOrInfinity(numSize);if(intSize<0)throw new $RangeError(INVALID_SIZE);return new SetRecord(obj,intSize)}},4475:function(module){var check=__name2(function(it){return it&&it.Math===Math&&it},"check");module.exports=check(typeof globalThis=="object"&&globalThis)||check(typeof window=="object"&&window)||check(typeof self=="object"&&self)||check(typeof global=="object"&&global)||check(typeof this=="object"&&this)||function(){return this}()||Function("return this")()},9297:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),toObject=__webpack_require__2(8981),hasOwnProperty=uncurryThis({}.hasOwnProperty);module.exports=Object.hasOwn||__name2(__name(function(it,key){return hasOwnProperty(toObject(it),key)},"hasOwn"),"hasOwn")},421:module=>{module.exports={}},397:(module,__unused_webpack_exports,__webpack_require__2)=>{var getBuiltIn=__webpack_require__2(7751);module.exports=getBuiltIn("document","documentElement")},5917:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),fails=__webpack_require__2(9039),createElement=__webpack_require__2(4055);module.exports=!DESCRIPTORS&&!fails(function(){return Object.defineProperty(createElement("div"),"a",{get:__name2(function(){return 7},"get")}).a!==7})},7055:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),fails=__webpack_require__2(9039),classof=__webpack_require__2(4576),$Object=Object,split=uncurryThis("".split);module.exports=fails(function(){return!$Object("z").propertyIsEnumerable(0)})?function(it){return classof(it)==="String"?split(it,""):$Object(it)}:$Object},3167:(module,__unused_webpack_exports,__webpack_require__2)=>{var isCallable=__webpack_require__2(4901),isObject=__webpack_require__2(34),setPrototypeOf=__webpack_require__2(2967);module.exports=function($this,dummy,Wrapper){var NewTarget,NewTargetPrototype;return setPrototypeOf&&isCallable(NewTarget=dummy.constructor)&&NewTarget!==Wrapper&&isObject(NewTargetPrototype=NewTarget.prototype)&&NewTargetPrototype!==Wrapper.prototype&&setPrototypeOf($this,NewTargetPrototype),$this}},3706:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),isCallable=__webpack_require__2(4901),store=__webpack_require__2(7629),functionToString=uncurryThis(Function.toString);isCallable(store.inspectSource)||(store.inspectSource=function(it){return functionToString(it)}),module.exports=store.inspectSource},1181:(module,__unused_webpack_exports,__webpack_require__2)=>{var NATIVE_WEAK_MAP=__webpack_require__2(8622),global2=__webpack_require__2(4475),isObject=__webpack_require__2(34),createNonEnumerableProperty=__webpack_require__2(6699),hasOwn=__webpack_require__2(9297),shared=__webpack_require__2(7629),sharedKey=__webpack_require__2(6119),hiddenKeys=__webpack_require__2(421),OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError2=global2.TypeError,WeakMap2=global2.WeakMap,set,get,has,enforce=__name2(function(it){return has(it)?get(it):set(it,{})},"enforce"),getterFor=__name2(function(TYPE){return function(it){var state;if(!isObject(it)||(state=get(it)).type!==TYPE)throw new TypeError2("Incompatible receiver, "+TYPE+" required");return state}},"getterFor");if(NATIVE_WEAK_MAP||shared.state){var store=shared.state||(shared.state=new WeakMap2);store.get=store.get,store.has=store.has,store.set=store.set,set=__name2(function(it,metadata){if(store.has(it))throw new TypeError2(OBJECT_ALREADY_INITIALIZED);return metadata.facade=it,store.set(it,metadata),metadata},"set"),get=__name2(function(it){return store.get(it)||{}},"get"),has=__name2(function(it){return store.has(it)},"has")}else{var STATE=sharedKey("state");hiddenKeys[STATE]=!0,set=__name2(function(it,metadata){if(hasOwn(it,STATE))throw new TypeError2(OBJECT_ALREADY_INITIALIZED);return metadata.facade=it,createNonEnumerableProperty(it,STATE,metadata),metadata},"set"),get=__name2(function(it){return hasOwn(it,STATE)?it[STATE]:{}},"get"),has=__name2(function(it){return hasOwn(it,STATE)},"has")}module.exports={set,get,has,enforce,getterFor}},4209:(module,__unused_webpack_exports,__webpack_require__2)=>{var wellKnownSymbol=__webpack_require__2(8227),Iterators=__webpack_require__2(6269),ITERATOR=wellKnownSymbol("iterator"),ArrayPrototype=Array.prototype;module.exports=function(it){return it!==void 0&&(Iterators.Array===it||ArrayPrototype[ITERATOR]===it)}},4376:(module,__unused_webpack_exports,__webpack_require__2)=>{var classof=__webpack_require__2(4576);module.exports=Array.isArray||__name2(__name(function(argument){return classof(argument)==="Array"},"isArray"),"isArray")},1108:(module,__unused_webpack_exports,__webpack_require__2)=>{var classof=__webpack_require__2(6955);module.exports=function(it){var klass=classof(it);return klass==="BigInt64Array"||klass==="BigUint64Array"}},4901:module=>{var documentAll=typeof document=="object"&&document.all;module.exports=typeof documentAll>"u"&&documentAll!==void 0?function(argument){return typeof argument=="function"||argument===documentAll}:function(argument){return typeof argument=="function"}},2796:(module,__unused_webpack_exports,__webpack_require__2)=>{var fails=__webpack_require__2(9039),isCallable=__webpack_require__2(4901),replacement=/#|\.prototype\./,isForced=__name2(function(feature,detection){var value=data[normalize2(feature)];return value===POLYFILL?!0:value===NATIVE?!1:isCallable(detection)?fails(detection):!!detection},"isForced"),normalize2=isForced.normalize=function(string){return String(string).replace(replacement,".").toLowerCase()},data=isForced.data={},NATIVE=isForced.NATIVE="N",POLYFILL=isForced.POLYFILL="P";module.exports=isForced},4117:module=>{module.exports=function(it){return it==null}},34:(module,__unused_webpack_exports,__webpack_require__2)=>{var isCallable=__webpack_require__2(4901);module.exports=function(it){return typeof it=="object"?it!==null:isCallable(it)}},3925:(module,__unused_webpack_exports,__webpack_require__2)=>{var isObject=__webpack_require__2(34);module.exports=function(argument){return isObject(argument)||argument===null}},6395:module=>{module.exports=!1},757:(module,__unused_webpack_exports,__webpack_require__2)=>{var getBuiltIn=__webpack_require__2(7751),isCallable=__webpack_require__2(4901),isPrototypeOf=__webpack_require__2(1625),USE_SYMBOL_AS_UID=__webpack_require__2(7040),$Object=Object;module.exports=USE_SYMBOL_AS_UID?function(it){return typeof it=="symbol"}:function(it){var $Symbol=getBuiltIn("Symbol");return isCallable($Symbol)&&isPrototypeOf($Symbol.prototype,$Object(it))}},507:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565);module.exports=function(record,fn,ITERATOR_INSTEAD_OF_RECORD){for(var iterator=ITERATOR_INSTEAD_OF_RECORD?record:record.iterator,next=record.next,step,result;!(step=call(next,iterator)).done;)if(result=fn(step.value),result!==void 0)return result}},2652:(module,__unused_webpack_exports,__webpack_require__2)=>{var bind=__webpack_require__2(6080),call=__webpack_require__2(9565),anObject=__webpack_require__2(8551),tryToString=__webpack_require__2(6823),isArrayIteratorMethod=__webpack_require__2(4209),lengthOfArrayLike=__webpack_require__2(6198),isPrototypeOf=__webpack_require__2(1625),getIterator=__webpack_require__2(81),getIteratorMethod=__webpack_require__2(851),iteratorClose=__webpack_require__2(9539),$TypeError=TypeError,Result=__name2(function(stopped,result){this.stopped=stopped,this.result=result},"Result"),ResultPrototype=Result.prototype;module.exports=function(iterable,unboundFunction,options){var that=options&&options.that,AS_ENTRIES=!!(options&&options.AS_ENTRIES),IS_RECORD=!!(options&&options.IS_RECORD),IS_ITERATOR=!!(options&&options.IS_ITERATOR),INTERRUPTED=!!(options&&options.INTERRUPTED),fn=bind(unboundFunction,that),iterator,iterFn,index2,length,result,next,step,stop=__name2(function(condition){return iterator&&iteratorClose(iterator,"normal",condition),new Result(!0,condition)},"stop"),callFn=__name2(function(value){return AS_ENTRIES?(anObject(value),INTERRUPTED?fn(value[0],value[1],stop):fn(value[0],value[1])):INTERRUPTED?fn(value,stop):fn(value)},"callFn");if(IS_RECORD)iterator=iterable.iterator;else if(IS_ITERATOR)iterator=iterable;else{if(iterFn=getIteratorMethod(iterable),!iterFn)throw new $TypeError(tryToString(iterable)+" is not iterable");if(isArrayIteratorMethod(iterFn)){for(index2=0,length=lengthOfArrayLike(iterable);length>index2;index2++)if(result=callFn(iterable[index2]),result&&isPrototypeOf(ResultPrototype,result))return result;return new Result(!1)}iterator=getIterator(iterable,iterFn)}for(next=IS_RECORD?iterable.next:iterator.next;!(step=call(next,iterator)).done;){try{result=callFn(step.value)}catch(error){iteratorClose(iterator,"throw",error)}if(typeof result=="object"&&result&&isPrototypeOf(ResultPrototype,result))return result}return new Result(!1)}},9539:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),anObject=__webpack_require__2(8551),getMethod=__webpack_require__2(5966);module.exports=function(iterator,kind,value){var innerResult,innerError;anObject(iterator);try{if(innerResult=getMethod(iterator,"return"),!innerResult){if(kind==="throw")throw value;return value}innerResult=call(innerResult,iterator)}catch(error){innerError=!0,innerResult=error}if(kind==="throw")throw value;if(innerError)throw innerResult;return anObject(innerResult),value}},9462:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),create=__webpack_require__2(2360),createNonEnumerableProperty=__webpack_require__2(6699),defineBuiltIns=__webpack_require__2(6279),wellKnownSymbol=__webpack_require__2(8227),InternalStateModule=__webpack_require__2(1181),getMethod=__webpack_require__2(5966),IteratorPrototype=__webpack_require__2(7657).IteratorPrototype,createIterResultObject=__webpack_require__2(2529),iteratorClose=__webpack_require__2(9539),TO_STRING_TAG=wellKnownSymbol("toStringTag"),ITERATOR_HELPER="IteratorHelper",WRAP_FOR_VALID_ITERATOR="WrapForValidIterator",setInternalState=InternalStateModule.set,createIteratorProxyPrototype=__name2(function(IS_ITERATOR){var getInternalState=InternalStateModule.getterFor(IS_ITERATOR?WRAP_FOR_VALID_ITERATOR:ITERATOR_HELPER);return defineBuiltIns(create(IteratorPrototype),{next:__name2(__name(function(){var state=getInternalState(this);if(IS_ITERATOR)return state.nextHandler();try{var result=state.done?void 0:state.nextHandler();return createIterResultObject(result,state.done)}catch(error){throw state.done=!0,error}},"next"),"next"),return:__name2(function(){var state=getInternalState(this),iterator=state.iterator;if(state.done=!0,IS_ITERATOR){var returnMethod=getMethod(iterator,"return");return returnMethod?call(returnMethod,iterator):createIterResultObject(void 0,!0)}if(state.inner)try{iteratorClose(state.inner.iterator,"normal")}catch(error){return iteratorClose(iterator,"throw",error)}return iteratorClose(iterator,"normal"),createIterResultObject(void 0,!0)},"return")})},"createIteratorProxyPrototype"),WrapForValidIteratorPrototype=createIteratorProxyPrototype(!0),IteratorHelperPrototype=createIteratorProxyPrototype(!1);createNonEnumerableProperty(IteratorHelperPrototype,TO_STRING_TAG,"Iterator Helper"),module.exports=function(nextHandler,IS_ITERATOR){var IteratorProxy=__name2(__name(function(record,state){state?(state.iterator=record.iterator,state.next=record.next):state=record,state.type=IS_ITERATOR?WRAP_FOR_VALID_ITERATOR:ITERATOR_HELPER,state.nextHandler=nextHandler,state.counter=0,state.done=!1,setInternalState(this,state)},"Iterator"),"Iterator");return IteratorProxy.prototype=IS_ITERATOR?WrapForValidIteratorPrototype:IteratorHelperPrototype,IteratorProxy}},713:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767),createIteratorProxy=__webpack_require__2(9462),callWithSafeIterationClosing=__webpack_require__2(6319),IteratorProxy=createIteratorProxy(function(){var iterator=this.iterator,result=anObject(call(this.next,iterator)),done=this.done=!!result.done;if(!done)return callWithSafeIterationClosing(iterator,this.mapper,[result.value,this.counter++],!0)});module.exports=__name2(__name(function(mapper){return anObject(this),aCallable(mapper),new IteratorProxy(getIteratorDirect(this),{mapper})},"map"),"map")},7657:(module,__unused_webpack_exports,__webpack_require__2)=>{var fails=__webpack_require__2(9039),isCallable=__webpack_require__2(4901),isObject=__webpack_require__2(34),create=__webpack_require__2(2360),getPrototypeOf=__webpack_require__2(2787),defineBuiltIn=__webpack_require__2(6840),wellKnownSymbol=__webpack_require__2(8227),IS_PURE=__webpack_require__2(6395),ITERATOR=wellKnownSymbol("iterator"),BUGGY_SAFARI_ITERATORS=!1,IteratorPrototype,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf(getPrototypeOf(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS=!0);var NEW_ITERATOR_PROTOTYPE=!isObject(IteratorPrototype)||fails(function(){var test={};return IteratorPrototype[ITERATOR].call(test)!==test});NEW_ITERATOR_PROTOTYPE?IteratorPrototype={}:IS_PURE&&(IteratorPrototype=create(IteratorPrototype)),isCallable(IteratorPrototype[ITERATOR])||defineBuiltIn(IteratorPrototype,ITERATOR,function(){return this}),module.exports={IteratorPrototype,BUGGY_SAFARI_ITERATORS}},6269:module=>{module.exports={}},6198:(module,__unused_webpack_exports,__webpack_require__2)=>{var toLength=__webpack_require__2(8014);module.exports=function(obj){return toLength(obj.length)}},283:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),fails=__webpack_require__2(9039),isCallable=__webpack_require__2(4901),hasOwn=__webpack_require__2(9297),DESCRIPTORS=__webpack_require__2(3724),CONFIGURABLE_FUNCTION_NAME=__webpack_require__2(350).CONFIGURABLE,inspectSource=__webpack_require__2(3706),InternalStateModule=__webpack_require__2(1181),enforceInternalState=InternalStateModule.enforce,getInternalState=InternalStateModule.get,$String=String,defineProperty=Object.defineProperty,stringSlice=uncurryThis("".slice),replace=uncurryThis("".replace),join2=uncurryThis([].join),CONFIGURABLE_LENGTH=DESCRIPTORS&&!fails(function(){return defineProperty(function(){},"length",{value:8}).length!==8}),TEMPLATE=String(String).split("String"),makeBuiltIn=module.exports=function(value,name,options){stringSlice($String(name),0,7)==="Symbol("&&(name="["+replace($String(name),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),options&&options.getter&&(name="get "+name),options&&options.setter&&(name="set "+name),(!hasOwn(value,"name")||CONFIGURABLE_FUNCTION_NAME&&value.name!==name)&&(DESCRIPTORS?defineProperty(value,"name",{value:name,configurable:!0}):value.name=name),CONFIGURABLE_LENGTH&&options&&hasOwn(options,"arity")&&value.length!==options.arity&&defineProperty(value,"length",{value:options.arity});try{options&&hasOwn(options,"constructor")&&options.constructor?DESCRIPTORS&&defineProperty(value,"prototype",{writable:!1}):value.prototype&&(value.prototype=void 0)}catch{}var state=enforceInternalState(value);return hasOwn(state,"source")||(state.source=join2(TEMPLATE,typeof name=="string"?name:"")),value};Function.prototype.toString=makeBuiltIn(__name2(__name(function(){return isCallable(this)&&getInternalState(this).source||inspectSource(this)},"toString"),"toString"),"toString")},741:module=>{var ceil=Math.ceil,floor=Math.floor;module.exports=Math.trunc||__name2(__name(function(x){var n=+x;return(n>0?floor:ceil)(n)},"trunc"),"trunc")},6043:(module,__unused_webpack_exports,__webpack_require__2)=>{var aCallable=__webpack_require__2(9306),$TypeError=TypeError,PromiseCapability=__name2(function(C){var resolve,reject;this.promise=new C(function($$resolve,$$reject){if(resolve!==void 0||reject!==void 0)throw new $TypeError("Bad Promise constructor");resolve=$$resolve,reject=$$reject}),this.resolve=aCallable(resolve),this.reject=aCallable(reject)},"PromiseCapability");module.exports.f=function(C){return new PromiseCapability(C)}},2603:(module,__unused_webpack_exports,__webpack_require__2)=>{var toString=__webpack_require__2(655);module.exports=function(argument,$default){return argument===void 0?arguments.length<2?"":$default:toString(argument)}},4149:module=>{var $RangeError=RangeError;module.exports=function(it){if(it===it)return it;throw new $RangeError("NaN is not allowed")}},2360:(module,__unused_webpack_exports,__webpack_require__2)=>{var anObject=__webpack_require__2(8551),definePropertiesModule=__webpack_require__2(6801),enumBugKeys=__webpack_require__2(8727),hiddenKeys=__webpack_require__2(421),html=__webpack_require__2(397),documentCreateElement=__webpack_require__2(4055),sharedKey=__webpack_require__2(6119),GT=">",LT="<",PROTOTYPE="prototype",SCRIPT="script",IE_PROTO=sharedKey("IE_PROTO"),EmptyConstructor=__name2(function(){},"EmptyConstructor"),scriptTag=__name2(function(content){return LT+SCRIPT+GT+content+LT+"/"+SCRIPT+GT},"scriptTag"),NullProtoObjectViaActiveX=__name2(function(activeXDocument2){activeXDocument2.write(scriptTag("")),activeXDocument2.close();var temp=activeXDocument2.parentWindow.Object;return activeXDocument2=null,temp},"NullProtoObjectViaActiveX"),NullProtoObjectViaIFrame=__name2(function(){var iframe=documentCreateElement("iframe"),JS="java"+SCRIPT+":",iframeDocument;return iframe.style.display="none",html.appendChild(iframe),iframe.src=String(JS),iframeDocument=iframe.contentWindow.document,iframeDocument.open(),iframeDocument.write(scriptTag("document.F=Object")),iframeDocument.close(),iframeDocument.F},"NullProtoObjectViaIFrame"),activeXDocument,NullProtoObject=__name2(function(){try{activeXDocument=new ActiveXObject("htmlfile")}catch{}NullProtoObject=typeof document<"u"?document.domain&&activeXDocument?NullProtoObjectViaActiveX(activeXDocument):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(activeXDocument);for(var length=enumBugKeys.length;length--;)delete NullProtoObject[PROTOTYPE][enumBugKeys[length]];return NullProtoObject()},"NullProtoObject");hiddenKeys[IE_PROTO]=!0,module.exports=Object.create||__name2(__name(function(O,Properties){var result;return O!==null?(EmptyConstructor[PROTOTYPE]=anObject(O),result=new EmptyConstructor,EmptyConstructor[PROTOTYPE]=null,result[IE_PROTO]=O):result=NullProtoObject(),Properties===void 0?result:definePropertiesModule.f(result,Properties)},"create"),"create")},6801:(__unused_webpack_module,exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),V8_PROTOTYPE_DEFINE_BUG=__webpack_require__2(8686),definePropertyModule=__webpack_require__2(4913),anObject=__webpack_require__2(8551),toIndexedObject=__webpack_require__2(5397),objectKeys=__webpack_require__2(1072);exports.f=DESCRIPTORS&&!V8_PROTOTYPE_DEFINE_BUG?Object.defineProperties:__name2(__name(function(O,Properties){anObject(O);for(var props=toIndexedObject(Properties),keys=objectKeys(Properties),length=keys.length,index2=0,key;length>index2;)definePropertyModule.f(O,key=keys[index2++],props[key]);return O},"defineProperties"),"defineProperties")},4913:(__unused_webpack_module,exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),IE8_DOM_DEFINE=__webpack_require__2(5917),V8_PROTOTYPE_DEFINE_BUG=__webpack_require__2(8686),anObject=__webpack_require__2(8551),toPropertyKey=__webpack_require__2(6969),$TypeError=TypeError,$defineProperty=Object.defineProperty,$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE="configurable",WRITABLE="writable";exports.f=DESCRIPTORS?V8_PROTOTYPE_DEFINE_BUG?__name2(__name(function(O,P,Attributes){if(anObject(O),P=toPropertyKey(P),anObject(Attributes),typeof O=="function"&&P==="prototype"&&"value"in Attributes&&WRITABLE in Attributes&&!Attributes[WRITABLE]){var current=$getOwnPropertyDescriptor(O,P);current&&current[WRITABLE]&&(O[P]=Attributes.value,Attributes={configurable:CONFIGURABLE in Attributes?Attributes[CONFIGURABLE]:current[CONFIGURABLE],enumerable:ENUMERABLE in Attributes?Attributes[ENUMERABLE]:current[ENUMERABLE],writable:!1})}return $defineProperty(O,P,Attributes)},"defineProperty"),"defineProperty"):$defineProperty:__name2(__name(function(O,P,Attributes){if(anObject(O),P=toPropertyKey(P),anObject(Attributes),IE8_DOM_DEFINE)try{return $defineProperty(O,P,Attributes)}catch{}if("get"in Attributes||"set"in Attributes)throw new $TypeError("Accessors not supported");return"value"in Attributes&&(O[P]=Attributes.value),O},"defineProperty"),"defineProperty")},7347:(__unused_webpack_module,exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),call=__webpack_require__2(9565),propertyIsEnumerableModule=__webpack_require__2(8773),createPropertyDescriptor=__webpack_require__2(6980),toIndexedObject=__webpack_require__2(5397),toPropertyKey=__webpack_require__2(6969),hasOwn=__webpack_require__2(9297),IE8_DOM_DEFINE=__webpack_require__2(5917),$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;exports.f=DESCRIPTORS?$getOwnPropertyDescriptor:__name2(__name(function(O,P){if(O=toIndexedObject(O),P=toPropertyKey(P),IE8_DOM_DEFINE)try{return $getOwnPropertyDescriptor(O,P)}catch{}if(hasOwn(O,P))return createPropertyDescriptor(!call(propertyIsEnumerableModule.f,O,P),O[P])},"getOwnPropertyDescriptor"),"getOwnPropertyDescriptor")},8480:(__unused_webpack_module,exports,__webpack_require__2)=>{var internalObjectKeys=__webpack_require__2(1828),enumBugKeys=__webpack_require__2(8727),hiddenKeys=enumBugKeys.concat("length","prototype");exports.f=Object.getOwnPropertyNames||__name2(__name(function(O){return internalObjectKeys(O,hiddenKeys)},"getOwnPropertyNames"),"getOwnPropertyNames")},3717:(__unused_webpack_module,exports)=>{exports.f=Object.getOwnPropertySymbols},2787:(module,__unused_webpack_exports,__webpack_require__2)=>{var hasOwn=__webpack_require__2(9297),isCallable=__webpack_require__2(4901),toObject=__webpack_require__2(8981),sharedKey=__webpack_require__2(6119),CORRECT_PROTOTYPE_GETTER=__webpack_require__2(2211),IE_PROTO=sharedKey("IE_PROTO"),$Object=Object,ObjectPrototype=$Object.prototype;module.exports=CORRECT_PROTOTYPE_GETTER?$Object.getPrototypeOf:function(O){var object=toObject(O);if(hasOwn(object,IE_PROTO))return object[IE_PROTO];var constructor=object.constructor;return isCallable(constructor)&&object instanceof constructor?constructor.prototype:object instanceof $Object?ObjectPrototype:null}},1625:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504);module.exports=uncurryThis({}.isPrototypeOf)},1828:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),hasOwn=__webpack_require__2(9297),toIndexedObject=__webpack_require__2(5397),indexOf=__webpack_require__2(9617).indexOf,hiddenKeys=__webpack_require__2(421),push=uncurryThis([].push);module.exports=function(object,names){var O=toIndexedObject(object),i=0,result=[],key;for(key in O)!hasOwn(hiddenKeys,key)&&hasOwn(O,key)&&push(result,key);for(;names.length>i;)hasOwn(O,key=names[i++])&&(~indexOf(result,key)||push(result,key));return result}},1072:(module,__unused_webpack_exports,__webpack_require__2)=>{var internalObjectKeys=__webpack_require__2(1828),enumBugKeys=__webpack_require__2(8727);module.exports=Object.keys||__name2(__name(function(O){return internalObjectKeys(O,enumBugKeys)},"keys"),"keys")},8773:(__unused_webpack_module,exports)=>{var $propertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor&&!$propertyIsEnumerable.call({1:2},1);exports.f=NASHORN_BUG?__name2(__name(function(V){var descriptor=getOwnPropertyDescriptor(this,V);return!!descriptor&&descriptor.enumerable},"propertyIsEnumerable"),"propertyIsEnumerable"):$propertyIsEnumerable},2967:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThisAccessor=__webpack_require__2(6706),isObject=__webpack_require__2(34),requireObjectCoercible=__webpack_require__2(7750),aPossiblePrototype=__webpack_require__2(3506);module.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var CORRECT_SETTER=!1,test={},setter;try{setter=uncurryThisAccessor(Object.prototype,"__proto__","set"),setter(test,[]),CORRECT_SETTER=test instanceof Array}catch{}return __name2(__name(function(O,proto){return requireObjectCoercible(O),aPossiblePrototype(proto),isObject(O)&&(CORRECT_SETTER?setter(O,proto):O.__proto__=proto),O},"setPrototypeOf"),"setPrototypeOf")}():void 0)},4270:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),isCallable=__webpack_require__2(4901),isObject=__webpack_require__2(34),$TypeError=TypeError;module.exports=function(input,pref){var fn,val;if(pref==="string"&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input))||isCallable(fn=input.valueOf)&&!isObject(val=call(fn,input))||pref!=="string"&&isCallable(fn=input.toString)&&!isObject(val=call(fn,input)))return val;throw new $TypeError("Can't convert object to primitive value")}},5031:(module,__unused_webpack_exports,__webpack_require__2)=>{var getBuiltIn=__webpack_require__2(7751),uncurryThis=__webpack_require__2(9504),getOwnPropertyNamesModule=__webpack_require__2(8480),getOwnPropertySymbolsModule=__webpack_require__2(3717),anObject=__webpack_require__2(8551),concat=uncurryThis([].concat);module.exports=getBuiltIn("Reflect","ownKeys")||__name2(__name(function(it){var keys=getOwnPropertyNamesModule.f(anObject(it)),getOwnPropertySymbols=getOwnPropertySymbolsModule.f;return getOwnPropertySymbols?concat(keys,getOwnPropertySymbols(it)):keys},"ownKeys"),"ownKeys")},8235:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),hasOwn=__webpack_require__2(9297),$SyntaxError=SyntaxError,$parseInt=parseInt,fromCharCode=String.fromCharCode,at=uncurryThis("".charAt),slice=uncurryThis("".slice),exec=uncurryThis(/./.exec),codePoints={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	"},IS_4_HEX_DIGITS=/^[\da-f]{4}$/i,IS_C0_CONTROL_CODE=/^[\u0000-\u001F]$/;module.exports=function(source,i){for(var unterminated=!0,value="";i<source.length;){var chr=at(source,i);if(chr==="\\"){var twoChars=slice(source,i,i+2);if(hasOwn(codePoints,twoChars))value+=codePoints[twoChars],i+=2;else if(twoChars==="\\u"){i+=2;var fourHexDigits=slice(source,i,i+4);if(!exec(IS_4_HEX_DIGITS,fourHexDigits))throw new $SyntaxError("Bad Unicode escape at: "+i);value+=fromCharCode($parseInt(fourHexDigits,16)),i+=4}else throw new $SyntaxError('Unknown escape sequence: "'+twoChars+'"')}else if(chr==='"'){unterminated=!1,i++;break}else{if(exec(IS_C0_CONTROL_CODE,chr))throw new $SyntaxError("Bad control character in string literal at: "+i);value+=chr,i++}}if(unterminated)throw new $SyntaxError("Unterminated string at: "+i);return{value,end:i}}},7750:(module,__unused_webpack_exports,__webpack_require__2)=>{var isNullOrUndefined=__webpack_require__2(4117),$TypeError=TypeError;module.exports=function(it){if(isNullOrUndefined(it))throw new $TypeError("Can't call method on "+it);return it}},9286:(module,__unused_webpack_exports,__webpack_require__2)=>{var SetHelpers=__webpack_require__2(4402),iterate=__webpack_require__2(8469),Set2=SetHelpers.Set,add=SetHelpers.add;module.exports=function(set){var result=new Set2;return iterate(set,function(it){add(result,it)}),result}},3440:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),SetHelpers=__webpack_require__2(4402),clone=__webpack_require__2(9286),size=__webpack_require__2(5170),getSetRecord=__webpack_require__2(3789),iterateSet=__webpack_require__2(8469),iterateSimple=__webpack_require__2(507),has=SetHelpers.has,remove=SetHelpers.remove;module.exports=__name2(__name(function(other){var O=aSet(this),otherRec=getSetRecord(other),result=clone(O);return size(O)<=otherRec.size?iterateSet(O,function(e){otherRec.includes(e)&&remove(result,e)}):iterateSimple(otherRec.getIterator(),function(e){has(O,e)&&remove(result,e)}),result},"difference"),"difference")},4402:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),SetPrototype=Set.prototype;module.exports={Set,add:uncurryThis(SetPrototype.add),has:uncurryThis(SetPrototype.has),remove:uncurryThis(SetPrototype.delete),proto:SetPrototype}},8750:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),SetHelpers=__webpack_require__2(4402),size=__webpack_require__2(5170),getSetRecord=__webpack_require__2(3789),iterateSet=__webpack_require__2(8469),iterateSimple=__webpack_require__2(507),Set2=SetHelpers.Set,add=SetHelpers.add,has=SetHelpers.has;module.exports=__name2(__name(function(other){var O=aSet(this),otherRec=getSetRecord(other),result=new Set2;return size(O)>otherRec.size?iterateSimple(otherRec.getIterator(),function(e){has(O,e)&&add(result,e)}):iterateSet(O,function(e){otherRec.includes(e)&&add(result,e)}),result},"intersection"),"intersection")},4449:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),has=__webpack_require__2(4402).has,size=__webpack_require__2(5170),getSetRecord=__webpack_require__2(3789),iterateSet=__webpack_require__2(8469),iterateSimple=__webpack_require__2(507),iteratorClose=__webpack_require__2(9539);module.exports=__name2(__name(function(other){var O=aSet(this),otherRec=getSetRecord(other);if(size(O)<=otherRec.size)return iterateSet(O,function(e){if(otherRec.includes(e))return!1},!0)!==!1;var iterator=otherRec.getIterator();return iterateSimple(iterator,function(e){if(has(O,e))return iteratorClose(iterator,"normal",!1)})!==!1},"isDisjointFrom"),"isDisjointFrom")},3838:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),size=__webpack_require__2(5170),iterate=__webpack_require__2(8469),getSetRecord=__webpack_require__2(3789);module.exports=__name2(__name(function(other){var O=aSet(this),otherRec=getSetRecord(other);return size(O)>otherRec.size?!1:iterate(O,function(e){if(!otherRec.includes(e))return!1},!0)!==!1},"isSubsetOf"),"isSubsetOf")},8527:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),has=__webpack_require__2(4402).has,size=__webpack_require__2(5170),getSetRecord=__webpack_require__2(3789),iterateSimple=__webpack_require__2(507),iteratorClose=__webpack_require__2(9539);module.exports=__name2(__name(function(other){var O=aSet(this),otherRec=getSetRecord(other);if(size(O)<otherRec.size)return!1;var iterator=otherRec.getIterator();return iterateSimple(iterator,function(e){if(!has(O,e))return iteratorClose(iterator,"normal",!1)})!==!1},"isSupersetOf"),"isSupersetOf")},8469:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),iterateSimple=__webpack_require__2(507),SetHelpers=__webpack_require__2(4402),Set2=SetHelpers.Set,SetPrototype=SetHelpers.proto,forEach=uncurryThis(SetPrototype.forEach),keys=uncurryThis(SetPrototype.keys),next=keys(new Set2).next;module.exports=function(set,fn,interruptible){return interruptible?iterateSimple({iterator:keys(set),next},fn):forEach(set,fn)}},4916:(module,__unused_webpack_exports,__webpack_require__2)=>{var getBuiltIn=__webpack_require__2(7751),createSetLike=__name2(function(size){return{size,has:__name2(function(){return!1},"has"),keys:__name2(function(){return{next:__name2(function(){return{done:!0}},"next")}},"keys")}},"createSetLike");module.exports=function(name){var Set2=getBuiltIn("Set");try{new Set2()[name](createSetLike(0));try{return new Set2()[name](createSetLike(-1)),!1}catch{return!0}}catch{return!1}}},5170:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThisAccessor=__webpack_require__2(6706),SetHelpers=__webpack_require__2(4402);module.exports=uncurryThisAccessor(SetHelpers.proto,"size","get")||function(set){return set.size}},3650:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),SetHelpers=__webpack_require__2(4402),clone=__webpack_require__2(9286),getSetRecord=__webpack_require__2(3789),iterateSimple=__webpack_require__2(507),add=SetHelpers.add,has=SetHelpers.has,remove=SetHelpers.remove;module.exports=__name2(__name(function(other){var O=aSet(this),keysIter=getSetRecord(other).getIterator(),result=clone(O);return iterateSimple(keysIter,function(e){has(O,e)?remove(result,e):add(result,e)}),result},"symmetricDifference"),"symmetricDifference")},4204:(module,__unused_webpack_exports,__webpack_require__2)=>{var aSet=__webpack_require__2(7080),add=__webpack_require__2(4402).add,clone=__webpack_require__2(9286),getSetRecord=__webpack_require__2(3789),iterateSimple=__webpack_require__2(507);module.exports=__name2(__name(function(other){var O=aSet(this),keysIter=getSetRecord(other).getIterator(),result=clone(O);return iterateSimple(keysIter,function(it){add(result,it)}),result},"union"),"union")},6119:(module,__unused_webpack_exports,__webpack_require__2)=>{var shared=__webpack_require__2(5745),uid=__webpack_require__2(3392),keys=shared("keys");module.exports=function(key){return keys[key]||(keys[key]=uid(key))}},7629:(module,__unused_webpack_exports,__webpack_require__2)=>{var IS_PURE=__webpack_require__2(6395),globalThis2=__webpack_require__2(4475),defineGlobalProperty=__webpack_require__2(9433),SHARED="__core-js_shared__",store=module.exports=globalThis2[SHARED]||defineGlobalProperty(SHARED,{});(store.versions||(store.versions=[])).push({version:"3.37.1",mode:IS_PURE?"pure":"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:(module,__unused_webpack_exports,__webpack_require__2)=>{var store=__webpack_require__2(7629);module.exports=function(key,value){return store[key]||(store[key]=value||{})}},1548:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),fails=__webpack_require__2(9039),V8=__webpack_require__2(7388),IS_BROWSER=__webpack_require__2(7290),IS_DENO=__webpack_require__2(516),IS_NODE=__webpack_require__2(9088),structuredClone2=global2.structuredClone;module.exports=!!structuredClone2&&!fails(function(){if(IS_DENO&&V8>92||IS_NODE&&V8>94||IS_BROWSER&&V8>97)return!1;var buffer=new ArrayBuffer(8),clone=structuredClone2(buffer,{transfer:[buffer]});return buffer.byteLength!==0||clone.byteLength!==8})},4495:(module,__unused_webpack_exports,__webpack_require__2)=>{var V8_VERSION=__webpack_require__2(7388),fails=__webpack_require__2(9039),global2=__webpack_require__2(4475),$String=global2.String;module.exports=!!Object.getOwnPropertySymbols&&!fails(function(){var symbol=Symbol("symbol detection");return!$String(symbol)||!(Object(symbol)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41})},5610:(module,__unused_webpack_exports,__webpack_require__2)=>{var toIntegerOrInfinity=__webpack_require__2(1291),max=Math.max,min=Math.min;module.exports=function(index2,length){var integer=toIntegerOrInfinity(index2);return integer<0?max(integer+length,0):min(integer,length)}},5854:(module,__unused_webpack_exports,__webpack_require__2)=>{var toPrimitive=__webpack_require__2(2777),$TypeError=TypeError;module.exports=function(argument){var prim=toPrimitive(argument,"number");if(typeof prim=="number")throw new $TypeError("Can't convert number to bigint");return BigInt(prim)}},7696:(module,__unused_webpack_exports,__webpack_require__2)=>{var toIntegerOrInfinity=__webpack_require__2(1291),toLength=__webpack_require__2(8014),$RangeError=RangeError;module.exports=function(it){if(it===void 0)return 0;var number=toIntegerOrInfinity(it),length=toLength(number);if(number!==length)throw new $RangeError("Wrong length or index");return length}},5397:(module,__unused_webpack_exports,__webpack_require__2)=>{var IndexedObject=__webpack_require__2(7055),requireObjectCoercible=__webpack_require__2(7750);module.exports=function(it){return IndexedObject(requireObjectCoercible(it))}},1291:(module,__unused_webpack_exports,__webpack_require__2)=>{var trunc=__webpack_require__2(741);module.exports=function(argument){var number=+argument;return number!==number||number===0?0:trunc(number)}},8014:(module,__unused_webpack_exports,__webpack_require__2)=>{var toIntegerOrInfinity=__webpack_require__2(1291),min=Math.min;module.exports=function(argument){var len=toIntegerOrInfinity(argument);return len>0?min(len,9007199254740991):0}},8981:(module,__unused_webpack_exports,__webpack_require__2)=>{var requireObjectCoercible=__webpack_require__2(7750),$Object=Object;module.exports=function(argument){return $Object(requireObjectCoercible(argument))}},9590:(module,__unused_webpack_exports,__webpack_require__2)=>{var toIntegerOrInfinity=__webpack_require__2(1291),$RangeError=RangeError;module.exports=function(it){var result=toIntegerOrInfinity(it);if(result<0)throw new $RangeError("The argument can't be less than 0");return result}},2777:(module,__unused_webpack_exports,__webpack_require__2)=>{var call=__webpack_require__2(9565),isObject=__webpack_require__2(34),isSymbol=__webpack_require__2(757),getMethod=__webpack_require__2(5966),ordinaryToPrimitive=__webpack_require__2(4270),wellKnownSymbol=__webpack_require__2(8227),$TypeError=TypeError,TO_PRIMITIVE=wellKnownSymbol("toPrimitive");module.exports=function(input,pref){if(!isObject(input)||isSymbol(input))return input;var exoticToPrim=getMethod(input,TO_PRIMITIVE),result;if(exoticToPrim){if(pref===void 0&&(pref="default"),result=call(exoticToPrim,input,pref),!isObject(result)||isSymbol(result))return result;throw new $TypeError("Can't convert object to primitive value")}return pref===void 0&&(pref="number"),ordinaryToPrimitive(input,pref)}},6969:(module,__unused_webpack_exports,__webpack_require__2)=>{var toPrimitive=__webpack_require__2(2777),isSymbol=__webpack_require__2(757);module.exports=function(argument){var key=toPrimitive(argument,"string");return isSymbol(key)?key:key+""}},2140:(module,__unused_webpack_exports,__webpack_require__2)=>{var wellKnownSymbol=__webpack_require__2(8227),TO_STRING_TAG=wellKnownSymbol("toStringTag"),test={};test[TO_STRING_TAG]="z",module.exports=String(test)==="[object z]"},655:(module,__unused_webpack_exports,__webpack_require__2)=>{var classof=__webpack_require__2(6955),$String=String;module.exports=function(argument){if(classof(argument)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return $String(argument)}},9714:(module,__unused_webpack_exports,__webpack_require__2)=>{var IS_NODE=__webpack_require__2(9088);module.exports=function(name){try{if(IS_NODE)return Function('return require("'+name+'")')()}catch{}}},6823:module=>{var $String=String;module.exports=function(argument){try{return $String(argument)}catch{return"Object"}}},3392:(module,__unused_webpack_exports,__webpack_require__2)=>{var uncurryThis=__webpack_require__2(9504),id=0,postfix=Math.random(),toString=uncurryThis(1 .toString);module.exports=function(key){return"Symbol("+(key===void 0?"":key)+")_"+toString(++id+postfix,36)}},7040:(module,__unused_webpack_exports,__webpack_require__2)=>{var NATIVE_SYMBOL=__webpack_require__2(4495);module.exports=NATIVE_SYMBOL&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},8686:(module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),fails=__webpack_require__2(9039);module.exports=DESCRIPTORS&&fails(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42})},2812:module=>{var $TypeError=TypeError;module.exports=function(passed,required){if(passed<required)throw new $TypeError("Not enough arguments");return passed}},8622:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),isCallable=__webpack_require__2(4901),WeakMap2=global2.WeakMap;module.exports=isCallable(WeakMap2)&&/native code/.test(String(WeakMap2))},8227:(module,__unused_webpack_exports,__webpack_require__2)=>{var global2=__webpack_require__2(4475),shared=__webpack_require__2(5745),hasOwn=__webpack_require__2(9297),uid=__webpack_require__2(3392),NATIVE_SYMBOL=__webpack_require__2(4495),USE_SYMBOL_AS_UID=__webpack_require__2(7040),Symbol2=global2.Symbol,WellKnownSymbolsStore=shared("wks"),createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol2.for||Symbol2:Symbol2&&Symbol2.withoutSetter||uid;module.exports=function(name){return hasOwn(WellKnownSymbolsStore,name)||(WellKnownSymbolsStore[name]=NATIVE_SYMBOL&&hasOwn(Symbol2,name)?Symbol2[name]:createWellKnownSymbol("Symbol."+name)),WellKnownSymbolsStore[name]}},6573:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),defineBuiltInAccessor=__webpack_require__2(2106),isDetached=__webpack_require__2(3238),ArrayBufferPrototype=ArrayBuffer.prototype;DESCRIPTORS&&!("detached"in ArrayBufferPrototype)&&defineBuiltInAccessor(ArrayBufferPrototype,"detached",{configurable:!0,get:__name2(__name(function(){return isDetached(this)},"detached"),"detached")})},7936:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),$transfer=__webpack_require__2(5636);$transfer&&$({target:"ArrayBuffer",proto:!0},{transferToFixedLength:__name2(__name(function(){return $transfer(this,arguments.length?arguments[0]:void 0,!1)},"transferToFixedLength"),"transferToFixedLength")})},8100:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),$transfer=__webpack_require__2(5636);$transfer&&$({target:"ArrayBuffer",proto:!0},{transfer:__name2(__name(function(){return $transfer(this,arguments.length?arguments[0]:void 0,!0)},"transfer"),"transfer")})},4114:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),toObject=__webpack_require__2(8981),lengthOfArrayLike=__webpack_require__2(6198),setArrayLength=__webpack_require__2(4527),doesNotExceedSafeInteger=__webpack_require__2(6837),fails=__webpack_require__2(9039),INCORRECT_TO_LENGTH=fails(function(){return[].push.call({length:4294967296},1)!==4294967297}),properErrorOnNonWritableLength=__name2(function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(error){return error instanceof TypeError}},"properErrorOnNonWritableLength"),FORCED=INCORRECT_TO_LENGTH||!properErrorOnNonWritableLength();$({target:"Array",proto:!0,arity:1,forced:FORCED},{push:__name2(__name(function(item){var O=toObject(this),len=lengthOfArrayLike(O),argCount=arguments.length;doesNotExceedSafeInteger(len+argCount);for(var i=0;i<argCount;i++)O[len]=arguments[i],len++;return setArrayLength(O,len),len},"push"),"push")})},4628:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),newPromiseCapabilityModule=__webpack_require__2(6043);$({target:"Promise",stat:!0},{withResolvers:__name2(__name(function(){var promiseCapability=newPromiseCapabilityModule.f(this);return{promise:promiseCapability.promise,resolve:promiseCapability.resolve,reject:promiseCapability.reject}},"withResolvers"),"withResolvers")})},7642:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),difference=__webpack_require__2(3440),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("difference")},{difference})},8004:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),fails=__webpack_require__2(9039),intersection=__webpack_require__2(8750),setMethodAcceptSetLike=__webpack_require__2(4916),INCORRECT=!setMethodAcceptSetLike("intersection")||fails(function(){return String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))!=="3,2"});$({target:"Set",proto:!0,real:!0,forced:INCORRECT},{intersection})},3853:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),isDisjointFrom=__webpack_require__2(4449),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("isDisjointFrom")},{isDisjointFrom})},5876:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),isSubsetOf=__webpack_require__2(3838),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("isSubsetOf")},{isSubsetOf})},2475:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),isSupersetOf=__webpack_require__2(8527),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("isSupersetOf")},{isSupersetOf})},5024:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),symmetricDifference=__webpack_require__2(3650),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("symmetricDifference")},{symmetricDifference})},1698:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),union=__webpack_require__2(4204),setMethodAcceptSetLike=__webpack_require__2(4916);$({target:"Set",proto:!0,real:!0,forced:!setMethodAcceptSetLike("union")},{union})},7467:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var arrayToReversed=__webpack_require__2(7628),ArrayBufferViewCore=__webpack_require__2(4644),aTypedArray=ArrayBufferViewCore.aTypedArray,exportTypedArrayMethod=ArrayBufferViewCore.exportTypedArrayMethod,getTypedArrayConstructor=ArrayBufferViewCore.getTypedArrayConstructor;exportTypedArrayMethod("toReversed",__name2(__name(function(){return arrayToReversed(aTypedArray(this),getTypedArrayConstructor(this))},"toReversed"),"toReversed"))},4732:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var ArrayBufferViewCore=__webpack_require__2(4644),uncurryThis=__webpack_require__2(9504),aCallable=__webpack_require__2(9306),arrayFromConstructorAndList=__webpack_require__2(5370),aTypedArray=ArrayBufferViewCore.aTypedArray,getTypedArrayConstructor=ArrayBufferViewCore.getTypedArrayConstructor,exportTypedArrayMethod=ArrayBufferViewCore.exportTypedArrayMethod,sort=uncurryThis(ArrayBufferViewCore.TypedArrayPrototype.sort);exportTypedArrayMethod("toSorted",__name2(__name(function(compareFn){compareFn!==void 0&&aCallable(compareFn);var O=aTypedArray(this),A=arrayFromConstructorAndList(getTypedArrayConstructor(O),O);return sort(A,compareFn)},"toSorted"),"toSorted"))},9577:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var arrayWith=__webpack_require__2(9928),ArrayBufferViewCore=__webpack_require__2(4644),isBigIntArray=__webpack_require__2(1108),toIntegerOrInfinity=__webpack_require__2(1291),toBigInt=__webpack_require__2(5854),aTypedArray=ArrayBufferViewCore.aTypedArray,getTypedArrayConstructor=ArrayBufferViewCore.getTypedArrayConstructor,exportTypedArrayMethod=ArrayBufferViewCore.exportTypedArrayMethod,PROPER_ORDER=!!function(){try{new Int8Array(1).with(2,{valueOf:__name2(function(){throw 8},"valueOf")})}catch(error){return error===8}}();exportTypedArrayMethod("with",__name2(function(index2,value){var O=aTypedArray(this),relativeIndex=toIntegerOrInfinity(index2),actualValue=isBigIntArray(O)?toBigInt(value):+value;return arrayWith(O,getTypedArrayConstructor(O),relativeIndex,actualValue)},"with"),!PROPER_ORDER)},8992:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),global2=__webpack_require__2(4475),anInstance=__webpack_require__2(679),anObject=__webpack_require__2(8551),isCallable=__webpack_require__2(4901),getPrototypeOf=__webpack_require__2(2787),defineBuiltInAccessor=__webpack_require__2(2106),createProperty=__webpack_require__2(4659),fails=__webpack_require__2(9039),hasOwn=__webpack_require__2(9297),wellKnownSymbol=__webpack_require__2(8227),IteratorPrototype=__webpack_require__2(7657).IteratorPrototype,DESCRIPTORS=__webpack_require__2(3724),IS_PURE=__webpack_require__2(6395),CONSTRUCTOR="constructor",ITERATOR="Iterator",TO_STRING_TAG=wellKnownSymbol("toStringTag"),$TypeError=TypeError,NativeIterator=global2[ITERATOR],FORCED=IS_PURE||!isCallable(NativeIterator)||NativeIterator.prototype!==IteratorPrototype||!fails(function(){NativeIterator({})}),IteratorConstructor=__name2(__name(function(){if(anInstance(this,IteratorPrototype),getPrototypeOf(this)===IteratorPrototype)throw new $TypeError("Abstract class Iterator not directly constructable")},"Iterator"),"Iterator"),defineIteratorPrototypeAccessor=__name2(function(key,value){DESCRIPTORS?defineBuiltInAccessor(IteratorPrototype,key,{configurable:!0,get:__name2(function(){return value},"get"),set:__name2(function(replacement){if(anObject(this),this===IteratorPrototype)throw new $TypeError("You can't redefine this property");hasOwn(this,key)?this[key]=replacement:createProperty(this,key,replacement)},"set")}):IteratorPrototype[key]=value},"defineIteratorPrototypeAccessor");hasOwn(IteratorPrototype,TO_STRING_TAG)||defineIteratorPrototypeAccessor(TO_STRING_TAG,ITERATOR),(FORCED||!hasOwn(IteratorPrototype,CONSTRUCTOR)||IteratorPrototype[CONSTRUCTOR]===Object)&&defineIteratorPrototypeAccessor(CONSTRUCTOR,IteratorConstructor),IteratorConstructor.prototype=IteratorPrototype,$({global:!0,constructor:!0,forced:FORCED},{Iterator:IteratorConstructor})},4743:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),call=__webpack_require__2(9565),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767),notANaN=__webpack_require__2(4149),toPositiveInteger=__webpack_require__2(9590),createIteratorProxy=__webpack_require__2(9462),IS_PURE=__webpack_require__2(6395),IteratorProxy=createIteratorProxy(function(){for(var iterator=this.iterator,next=this.next,result,done;this.remaining;)if(this.remaining--,result=anObject(call(next,iterator)),done=this.done=!!result.done,done)return;if(result=anObject(call(next,iterator)),done=this.done=!!result.done,!done)return result.value});$({target:"Iterator",proto:!0,real:!0,forced:IS_PURE},{drop:__name2(__name(function(limit){anObject(this);var remaining=toPositiveInteger(notANaN(+limit));return new IteratorProxy(getIteratorDirect(this),{remaining})},"drop"),"drop")})},3215:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),iterate=__webpack_require__2(2652),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767);$({target:"Iterator",proto:!0,real:!0},{every:__name2(__name(function(predicate){anObject(this),aCallable(predicate);var record=getIteratorDirect(this),counter=0;return!iterate(record,function(value,stop){if(!predicate(value,counter++))return stop()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped},"every"),"every")})},4520:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),call=__webpack_require__2(9565),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767),createIteratorProxy=__webpack_require__2(9462),callWithSafeIterationClosing=__webpack_require__2(6319),IS_PURE=__webpack_require__2(6395),IteratorProxy=createIteratorProxy(function(){for(var iterator=this.iterator,predicate=this.predicate,next=this.next,result,done,value;;){if(result=anObject(call(next,iterator)),done=this.done=!!result.done,done)return;if(value=result.value,callWithSafeIterationClosing(iterator,predicate,[value,this.counter++],!0))return value}});$({target:"Iterator",proto:!0,real:!0,forced:IS_PURE},{filter:__name2(__name(function(predicate){return anObject(this),aCallable(predicate),new IteratorProxy(getIteratorDirect(this),{predicate})},"filter2"),"filter")})},670:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),call=__webpack_require__2(9565),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767),getIteratorFlattenable=__webpack_require__2(8646),createIteratorProxy=__webpack_require__2(9462),iteratorClose=__webpack_require__2(9539),IS_PURE=__webpack_require__2(6395),IteratorProxy=createIteratorProxy(function(){for(var iterator=this.iterator,mapper=this.mapper,result,inner;;){if(inner=this.inner)try{if(result=anObject(call(inner.next,inner.iterator)),!result.done)return result.value;this.inner=null}catch(error){iteratorClose(iterator,"throw",error)}if(result=anObject(call(this.next,iterator)),this.done=!!result.done)return;try{this.inner=getIteratorFlattenable(mapper(result.value,this.counter++),!1)}catch(error){iteratorClose(iterator,"throw",error)}}});$({target:"Iterator",proto:!0,real:!0,forced:IS_PURE},{flatMap:__name2(__name(function(mapper){return anObject(this),aCallable(mapper),new IteratorProxy(getIteratorDirect(this),{mapper,inner:null})},"flatMap"),"flatMap")})},1454:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),map=__webpack_require__2(713),IS_PURE=__webpack_require__2(6395);$({target:"Iterator",proto:!0,real:!0,forced:IS_PURE},{map})},7550:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),iterate=__webpack_require__2(2652),aCallable=__webpack_require__2(9306),anObject=__webpack_require__2(8551),getIteratorDirect=__webpack_require__2(1767);$({target:"Iterator",proto:!0,real:!0},{some:__name2(__name(function(predicate){anObject(this),aCallable(predicate);var record=getIteratorDirect(this),counter=0;return iterate(record,function(value,stop){if(predicate(value,counter++))return stop()},{IS_RECORD:!0,INTERRUPTED:!0}).stopped},"some"),"some")})},8335:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),DESCRIPTORS=__webpack_require__2(3724),global2=__webpack_require__2(4475),getBuiltIn=__webpack_require__2(7751),uncurryThis=__webpack_require__2(9504),call=__webpack_require__2(9565),isCallable=__webpack_require__2(4901),isObject=__webpack_require__2(34),isArray=__webpack_require__2(4376),hasOwn=__webpack_require__2(9297),toString=__webpack_require__2(655),lengthOfArrayLike=__webpack_require__2(6198),createProperty=__webpack_require__2(4659),fails=__webpack_require__2(9039),parseJSONString=__webpack_require__2(8235),NATIVE_SYMBOL=__webpack_require__2(4495),JSON2=global2.JSON,Number2=global2.Number,SyntaxError2=global2.SyntaxError,nativeParse=JSON2&&JSON2.parse,enumerableOwnProperties=getBuiltIn("Object","keys"),getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,at=uncurryThis("".charAt),slice=uncurryThis("".slice),exec=uncurryThis(/./.exec),push=uncurryThis([].push),IS_DIGIT=/^\d$/,IS_NON_ZERO_DIGIT=/^[1-9]$/,IS_NUMBER_START=/^(?:-|\d)$/,IS_WHITESPACE=/^[\t\n\r ]$/,PRIMITIVE=0,OBJECT=1,$parse=__name2(function(source,reviver){source=toString(source);var context=new Context(source,0),root=context.parse(),value=root.value,endIndex=context.skip(IS_WHITESPACE,root.end);if(endIndex<source.length)throw new SyntaxError2('Unexpected extra character: "'+at(source,endIndex)+'" after the parsed data at: '+endIndex);return isCallable(reviver)?internalize({"":value},"",reviver,root):value},"$parse"),internalize=__name2(function(holder,name,reviver,node){var val=holder[name],unmodified=node&&val===node.value,context=unmodified&&typeof node.source=="string"?{source:node.source}:{},elementRecordsLen,keys,len,i,P;if(isObject(val)){var nodeIsArray=isArray(val),nodes=unmodified?node.nodes:nodeIsArray?[]:{};if(nodeIsArray)for(elementRecordsLen=nodes.length,len=lengthOfArrayLike(val),i=0;i<len;i++)internalizeProperty(val,i,internalize(val,""+i,reviver,i<elementRecordsLen?nodes[i]:void 0));else for(keys=enumerableOwnProperties(val),len=lengthOfArrayLike(keys),i=0;i<len;i++)P=keys[i],internalizeProperty(val,P,internalize(val,P,reviver,hasOwn(nodes,P)?nodes[P]:void 0))}return call(reviver,holder,name,val,context)},"internalize"),internalizeProperty=__name2(function(object,key,value){if(DESCRIPTORS){var descriptor=getOwnPropertyDescriptor(object,key);if(descriptor&&!descriptor.configurable)return}value===void 0?delete object[key]:createProperty(object,key,value)},"internalizeProperty"),Node2=__name2(function(value,end,source,nodes){this.value=value,this.end=end,this.source=source,this.nodes=nodes},"Node"),Context=__name2(function(source,index2){this.source=source,this.index=index2},"Context");Context.prototype={fork:__name2(function(nextIndex){return new Context(this.source,nextIndex)},"fork"),parse:__name2(function(){var source=this.source,i=this.skip(IS_WHITESPACE,this.index),fork=this.fork(i),chr=at(source,i);if(exec(IS_NUMBER_START,chr))return fork.number();switch(chr){case"{":return fork.object();case"[":return fork.array();case'"':return fork.string();case"t":return fork.keyword(!0);case"f":return fork.keyword(!1);case"n":return fork.keyword(null)}throw new SyntaxError2('Unexpected character: "'+chr+'" at: '+i)},"parse"),node:__name2(function(type,value,start,end,nodes){return new Node2(value,end,type?null:slice(this.source,start,end),nodes)},"node"),object:__name2(function(){for(var source=this.source,i=this.index+1,expectKeypair=!1,object={},nodes={};i<source.length;){if(i=this.until(['"',"}"],i),at(source,i)==="}"&&!expectKeypair){i++;break}var result=this.fork(i).string(),key=result.value;i=result.end,i=this.until([":"],i)+1,i=this.skip(IS_WHITESPACE,i),result=this.fork(i).parse(),createProperty(nodes,key,result),createProperty(object,key,result.value),i=this.until([",","}"],result.end);var chr=at(source,i);if(chr===",")expectKeypair=!0,i++;else if(chr==="}"){i++;break}}return this.node(OBJECT,object,this.index,i,nodes)},"object"),array:__name2(function(){for(var source=this.source,i=this.index+1,expectElement=!1,array=[],nodes=[];i<source.length;){if(i=this.skip(IS_WHITESPACE,i),at(source,i)==="]"&&!expectElement){i++;break}var result=this.fork(i).parse();if(push(nodes,result),push(array,result.value),i=this.until([",","]"],result.end),at(source,i)===",")expectElement=!0,i++;else if(at(source,i)==="]"){i++;break}}return this.node(OBJECT,array,this.index,i,nodes)},"array"),string:__name2(function(){var index2=this.index,parsed=parseJSONString(this.source,this.index+1);return this.node(PRIMITIVE,parsed.value,index2,parsed.end)},"string"),number:__name2(function(){var source=this.source,startIndex=this.index,i=startIndex;if(at(source,i)==="-"&&i++,at(source,i)==="0")i++;else if(exec(IS_NON_ZERO_DIGIT,at(source,i)))i=this.skip(IS_DIGIT,++i);else throw new SyntaxError2("Failed to parse number at: "+i);if(at(source,i)==="."&&(i=this.skip(IS_DIGIT,++i)),at(source,i)==="e"||at(source,i)==="E"){i++,(at(source,i)==="+"||at(source,i)==="-")&&i++;var exponentStartIndex=i;if(i=this.skip(IS_DIGIT,i),exponentStartIndex===i)throw new SyntaxError2("Failed to parse number's exponent value at: "+i)}return this.node(PRIMITIVE,Number2(slice(source,startIndex,i)),startIndex,i)},"number"),keyword:__name2(function(value){var keyword=""+value,index2=this.index,endIndex=index2+keyword.length;if(slice(this.source,index2,endIndex)!==keyword)throw new SyntaxError2("Failed to parse value at: "+index2);return this.node(PRIMITIVE,value,index2,endIndex)},"keyword"),skip:__name2(function(regex,i){for(var source=this.source;i<source.length&&exec(regex,at(source,i));i++);return i},"skip"),until:__name2(function(array,i){i=this.skip(IS_WHITESPACE,i);for(var chr=at(this.source,i),j=0;j<array.length;j++)if(array[j]===chr)return i;throw new SyntaxError2('Unexpected character: "'+chr+'" at: '+i)},"until")};var NO_SOURCE_SUPPORT=fails(function(){var unsafeInt="9007199254740993",source;return nativeParse(unsafeInt,function(key,value,context){source=context.source}),source!==unsafeInt}),PROPER_BASE_PARSE=NATIVE_SYMBOL&&!fails(function(){return 1/nativeParse("-0 	")!==-1/0});$({target:"JSON",stat:!0,forced:NO_SOURCE_SUPPORT},{parse:__name2(__name(function(text,reviver){return PROPER_BASE_PARSE&&!isCallable(reviver)?nativeParse(text):$parse(text,reviver)},"parse"),"parse")})},3375:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(7642)},9225:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(8004)},3972:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(3853)},9209:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(5876)},5714:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(2475)},7561:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(5024)},6197:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{__webpack_require__2(1698)},4979:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var $=__webpack_require__2(6518),global2=__webpack_require__2(4475),getBuiltIn=__webpack_require__2(7751),createPropertyDescriptor=__webpack_require__2(6980),defineProperty=__webpack_require__2(4913).f,hasOwn=__webpack_require__2(9297),anInstance=__webpack_require__2(679),inheritIfRequired=__webpack_require__2(3167),normalizeStringArgument=__webpack_require__2(2603),DOMExceptionConstants=__webpack_require__2(5002),clearErrorStack=__webpack_require__2(6193),DESCRIPTORS=__webpack_require__2(3724),IS_PURE=__webpack_require__2(6395),DOM_EXCEPTION="DOMException",Error2=getBuiltIn("Error"),NativeDOMException=getBuiltIn(DOM_EXCEPTION),$DOMException=__name2(__name(function(){anInstance(this,DOMExceptionPrototype);var argumentsLength=arguments.length,message=normalizeStringArgument(argumentsLength<1?void 0:arguments[0]),name=normalizeStringArgument(argumentsLength<2?void 0:arguments[1],"Error"),that=new NativeDOMException(message,name),error=new Error2(message);return error.name=DOM_EXCEPTION,defineProperty(that,"stack",createPropertyDescriptor(1,clearErrorStack(error.stack,1))),inheritIfRequired(that,this,$DOMException),that},"DOMException"),"DOMException"),DOMExceptionPrototype=$DOMException.prototype=NativeDOMException.prototype,ERROR_HAS_STACK="stack"in new Error2(DOM_EXCEPTION),DOM_EXCEPTION_HAS_STACK="stack"in new NativeDOMException(1,2),descriptor=NativeDOMException&&DESCRIPTORS&&Object.getOwnPropertyDescriptor(global2,DOM_EXCEPTION),BUGGY_DESCRIPTOR=!!descriptor&&!(descriptor.writable&&descriptor.configurable),FORCED_CONSTRUCTOR=ERROR_HAS_STACK&&!BUGGY_DESCRIPTOR&&!DOM_EXCEPTION_HAS_STACK;$({global:!0,constructor:!0,forced:IS_PURE||FORCED_CONSTRUCTOR},{DOMException:FORCED_CONSTRUCTOR?$DOMException:NativeDOMException});var PolyfilledDOMException=getBuiltIn(DOM_EXCEPTION),PolyfilledDOMExceptionPrototype=PolyfilledDOMException.prototype;if(PolyfilledDOMExceptionPrototype.constructor!==PolyfilledDOMException){IS_PURE||defineProperty(PolyfilledDOMExceptionPrototype,"constructor",createPropertyDescriptor(1,PolyfilledDOMException));for(var key in DOMExceptionConstants)if(hasOwn(DOMExceptionConstants,key)){var constant=DOMExceptionConstants[key],constantName=constant.s;hasOwn(PolyfilledDOMException,constantName)||defineProperty(PolyfilledDOMException,constantName,createPropertyDescriptor(6,constant.c))}}},4603:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var defineBuiltIn=__webpack_require__2(6840),uncurryThis=__webpack_require__2(9504),toString=__webpack_require__2(655),validateArgumentsLength=__webpack_require__2(2812),$URLSearchParams=URLSearchParams,URLSearchParamsPrototype=$URLSearchParams.prototype,append=uncurryThis(URLSearchParamsPrototype.append),$delete=uncurryThis(URLSearchParamsPrototype.delete),forEach=uncurryThis(URLSearchParamsPrototype.forEach),push=uncurryThis([].push),params=new $URLSearchParams("a=1&a=2&b=3");params.delete("a",1),params.delete("b",void 0),params+""!="a=2"&&defineBuiltIn(URLSearchParamsPrototype,"delete",function(name){var length=arguments.length,$value=length<2?void 0:arguments[1];if(length&&$value===void 0)return $delete(this,name);var entries=[];forEach(this,function(v,k){push(entries,{key:k,value:v})}),validateArgumentsLength(length,1);for(var key=toString(name),value=toString($value),index2=0,dindex=0,found=!1,entriesLength=entries.length,entry;index2<entriesLength;)entry=entries[index2++],found||entry.key===key?(found=!0,$delete(this,entry.key)):dindex++;for(;dindex<entriesLength;)entry=entries[dindex++],entry.key===key&&entry.value===value||append(this,entry.key,entry.value)},{enumerable:!0,unsafe:!0})},7566:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var defineBuiltIn=__webpack_require__2(6840),uncurryThis=__webpack_require__2(9504),toString=__webpack_require__2(655),validateArgumentsLength=__webpack_require__2(2812),$URLSearchParams=URLSearchParams,URLSearchParamsPrototype=$URLSearchParams.prototype,getAll=uncurryThis(URLSearchParamsPrototype.getAll),$has=uncurryThis(URLSearchParamsPrototype.has),params=new $URLSearchParams("a=1");(params.has("a",2)||!params.has("a",void 0))&&defineBuiltIn(URLSearchParamsPrototype,"has",__name2(__name(function(name){var length=arguments.length,$value=length<2?void 0:arguments[1];if(length&&$value===void 0)return $has(this,name);var values=getAll(this,name);validateArgumentsLength(length,1);for(var value=toString($value),index2=0;index2<values.length;)if(values[index2++]===value)return!0;return!1},"has"),"has"),{enumerable:!0,unsafe:!0})},8721:(__unused_webpack_module,__unused_webpack_exports,__webpack_require__2)=>{var DESCRIPTORS=__webpack_require__2(3724),uncurryThis=__webpack_require__2(9504),defineBuiltInAccessor=__webpack_require__2(2106),URLSearchParamsPrototype=URLSearchParams.prototype,forEach=uncurryThis(URLSearchParamsPrototype.forEach);DESCRIPTORS&&!("size"in URLSearchParamsPrototype)&&defineBuiltInAccessor(URLSearchParamsPrototype,"size",{get:__name2(__name(function(){var count=0;return forEach(this,function(){count++}),count},"size"),"size"),configurable:!0,enumerable:!0})}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==void 0)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.exports}__name(__webpack_require__,"__webpack_require__"),__name2(__webpack_require__,"__webpack_require__"),__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop);var __webpack_exports__=globalThis.pdfjsLib={};__webpack_require__.d(__webpack_exports__,{AbortException:__name2(()=>AbortException,"AbortException"),AnnotationEditorLayer:__name2(()=>AnnotationEditorLayer,"AnnotationEditorLayer"),AnnotationEditorParamsType:__name2(()=>AnnotationEditorParamsType,"AnnotationEditorParamsType"),AnnotationEditorType:__name2(()=>AnnotationEditorType,"AnnotationEditorType"),AnnotationEditorUIManager:__name2(()=>AnnotationEditorUIManager,"AnnotationEditorUIManager"),AnnotationLayer:__name2(()=>AnnotationLayer,"AnnotationLayer"),AnnotationMode:__name2(()=>AnnotationMode,"AnnotationMode"),CMapCompressionType:__name2(()=>CMapCompressionType,"CMapCompressionType"),ColorPicker:__name2(()=>ColorPicker,"ColorPicker"),DOMSVGFactory:__name2(()=>DOMSVGFactory,"DOMSVGFactory"),DrawLayer:__name2(()=>DrawLayer,"DrawLayer"),FeatureTest:__name2(()=>util_FeatureTest,"FeatureTest"),GlobalWorkerOptions:__name2(()=>GlobalWorkerOptions,"GlobalWorkerOptions"),ImageKind:__name2(()=>util_ImageKind,"ImageKind"),InvalidPDFException:__name2(()=>InvalidPDFException,"InvalidPDFException"),MissingPDFException:__name2(()=>MissingPDFException,"MissingPDFException"),OPS:__name2(()=>OPS,"OPS"),PDFDataRangeTransport:__name2(()=>PDFDataRangeTransport,"PDFDataRangeTransport"),PDFDateString:__name2(()=>PDFDateString,"PDFDateString"),PDFWorker:__name2(()=>PDFWorker,"PDFWorker"),PasswordResponses:__name2(()=>PasswordResponses,"PasswordResponses"),PermissionFlag:__name2(()=>PermissionFlag,"PermissionFlag"),PixelsPerInch:__name2(()=>PixelsPerInch,"PixelsPerInch"),RenderingCancelledException:__name2(()=>RenderingCancelledException,"RenderingCancelledException"),TextLayer:__name2(()=>TextLayer,"TextLayer"),UnexpectedResponseException:__name2(()=>UnexpectedResponseException,"UnexpectedResponseException"),Util:__name2(()=>Util,"Util"),VerbosityLevel:__name2(()=>VerbosityLevel,"VerbosityLevel"),XfaLayer:__name2(()=>XfaLayer,"XfaLayer"),build:__name2(()=>build,"build"),createValidAbsoluteUrl:__name2(()=>createValidAbsoluteUrl,"createValidAbsoluteUrl"),fetchData:__name2(()=>fetchData,"fetchData"),getDocument:__name2(()=>getDocument,"getDocument"),getFilenameFromUrl:__name2(()=>getFilenameFromUrl,"getFilenameFromUrl"),getPdfFilenameFromUrl:__name2(()=>getPdfFilenameFromUrl,"getPdfFilenameFromUrl"),getXfaPageViewport:__name2(()=>getXfaPageViewport,"getXfaPageViewport"),isDataScheme:__name2(()=>isDataScheme,"isDataScheme"),isPdfFile:__name2(()=>isPdfFile,"isPdfFile"),noContextMenu:__name2(()=>noContextMenu,"noContextMenu"),normalizeUnicode:__name2(()=>normalizeUnicode,"normalizeUnicode"),setLayerDimensions:__name2(()=>setLayerDimensions,"setLayerDimensions"),shadow:__name2(()=>shadow,"shadow"),version:__name2(()=>version,"version")}),__webpack_require__(4114),__webpack_require__(6573),__webpack_require__(8100),__webpack_require__(7936),__webpack_require__(7467),__webpack_require__(4732),__webpack_require__(9577),__webpack_require__(4603),__webpack_require__(7566),__webpack_require__(8721);const isNodeJS=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),IDENTITY_MATRIX=[1,0,0,1,0,0],FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],MAX_IMAGE_SIZE_TO_CACHE=1e7,LINE_FACTOR=1.35,RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},AnnotationEditorPrefix="pdfjs_internal_editor_",AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},AnnotationEditorParamsType={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},util_ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},VerbosityLevel={ERRORS:0,WARNINGS:1,INFOS:5},CMapCompressionType={NONE:0,BINARY:1},OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let verbosity=VerbosityLevel.WARNINGS;function setVerbosityLevel(level){Number.isInteger(level)&&(verbosity=level)}__name(setVerbosityLevel,"setVerbosityLevel"),__name2(setVerbosityLevel,"setVerbosityLevel");function getVerbosityLevel(){return verbosity}__name(getVerbosityLevel,"getVerbosityLevel"),__name2(getVerbosityLevel,"getVerbosityLevel");function info(msg){verbosity>=VerbosityLevel.INFOS&&console.log(`Info: ${msg}`)}__name(info,"info"),__name2(info,"info");function warn(msg){verbosity>=VerbosityLevel.WARNINGS&&console.log(`Warning: ${msg}`)}__name(warn,"warn"),__name2(warn,"warn");function unreachable(msg){throw new Error(msg)}__name(unreachable,"unreachable"),__name2(unreachable,"unreachable");function assert(cond,msg){cond||unreachable(msg)}__name(assert,"assert"),__name2(assert,"assert");function _isValidProtocol(url){switch(url?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}__name(_isValidProtocol,"_isValidProtocol"),__name2(_isValidProtocol,"_isValidProtocol");function createValidAbsoluteUrl(url,baseUrl=null,options=null){if(!url)return null;try{if(options&&typeof url=="string"){if(options.addDefaultProtocol&&url.startsWith("www.")){const dots=url.match(/\./g);dots?.length>=2&&(url=`http://${url}`)}if(options.tryConvertEncoding)try{url=stringToUTF8String(url)}catch{}}const absoluteUrl=baseUrl?new URL(url,baseUrl):new URL(url);if(_isValidProtocol(absoluteUrl))return absoluteUrl}catch{}return null}__name(createValidAbsoluteUrl,"createValidAbsoluteUrl"),__name2(createValidAbsoluteUrl,"createValidAbsoluteUrl");function shadow(obj,prop,value,nonSerializable=!1){return Object.defineProperty(obj,prop,{value,enumerable:!nonSerializable,configurable:!0,writable:!1}),value}__name(shadow,"shadow"),__name2(shadow,"shadow");const BaseException=__name2(__name(function(){function BaseException2(message,name){this.constructor===BaseException2&&unreachable("Cannot initialize BaseException."),this.message=message,this.name=name}return __name(BaseException2,"BaseException2"),__name2(BaseException2,"BaseException"),BaseException2.prototype=new Error,BaseException2.constructor=BaseException2,BaseException2},"BaseExceptionClosure"),"BaseExceptionClosure")(),_PasswordException=class extends BaseException{static{__name(this,"_PasswordException")}constructor(msg,code){super(msg,"PasswordException"),this.code=code}};__name2(_PasswordException,"PasswordException");let PasswordException=_PasswordException;const _UnknownErrorException=class extends BaseException{static{__name(this,"_UnknownErrorException")}constructor(msg,details){super(msg,"UnknownErrorException"),this.details=details}};__name2(_UnknownErrorException,"UnknownErrorException");let UnknownErrorException=_UnknownErrorException;const _InvalidPDFException=class extends BaseException{static{__name(this,"_InvalidPDFException")}constructor(msg){super(msg,"InvalidPDFException")}};__name2(_InvalidPDFException,"InvalidPDFException");let InvalidPDFException=_InvalidPDFException;const _MissingPDFException=class extends BaseException{static{__name(this,"_MissingPDFException")}constructor(msg){super(msg,"MissingPDFException")}};__name2(_MissingPDFException,"MissingPDFException");let MissingPDFException=_MissingPDFException;const _UnexpectedResponseException=class extends BaseException{static{__name(this,"_UnexpectedResponseException")}constructor(msg,status){super(msg,"UnexpectedResponseException"),this.status=status}};__name2(_UnexpectedResponseException,"UnexpectedResponseException");let UnexpectedResponseException=_UnexpectedResponseException;const _FormatError=class extends BaseException{static{__name(this,"_FormatError")}constructor(msg){super(msg,"FormatError")}};__name2(_FormatError,"FormatError");let FormatError=_FormatError;const _AbortException=class extends BaseException{static{__name(this,"_AbortException")}constructor(msg){super(msg,"AbortException")}};__name2(_AbortException,"AbortException");let AbortException=_AbortException;function bytesToString(bytes){(typeof bytes!="object"||bytes?.length===void 0)&&unreachable("Invalid argument for bytesToString");const length=bytes.length,MAX_ARGUMENT_COUNT=8192;if(length<MAX_ARGUMENT_COUNT)return String.fromCharCode.apply(null,bytes);const strBuf=[];for(let i=0;i<length;i+=MAX_ARGUMENT_COUNT){const chunkEnd=Math.min(i+MAX_ARGUMENT_COUNT,length),chunk=bytes.subarray(i,chunkEnd);strBuf.push(String.fromCharCode.apply(null,chunk))}return strBuf.join("")}__name(bytesToString,"bytesToString"),__name2(bytesToString,"bytesToString");function stringToBytes(str){typeof str!="string"&&unreachable("Invalid argument for stringToBytes");const length=str.length,bytes=new Uint8Array(length);for(let i=0;i<length;++i)bytes[i]=str.charCodeAt(i)&255;return bytes}__name(stringToBytes,"stringToBytes"),__name2(stringToBytes,"stringToBytes");function string32(value){return String.fromCharCode(value>>24&255,value>>16&255,value>>8&255,value&255)}__name(string32,"string32"),__name2(string32,"string32");function objectFromMap(map){const obj=Object.create(null);for(const[key,value]of map)obj[key]=value;return obj}__name(objectFromMap,"objectFromMap"),__name2(objectFromMap,"objectFromMap");function isLittleEndian(){const buffer8=new Uint8Array(4);return buffer8[0]=1,new Uint32Array(buffer8.buffer,0,1)[0]===1}__name(isLittleEndian,"isLittleEndian"),__name2(isLittleEndian,"isLittleEndian");function isEvalSupported(){try{return new Function(""),!0}catch{return!1}}__name(isEvalSupported,"isEvalSupported"),__name2(isEvalSupported,"isEvalSupported");const _util_FeatureTest=class{static{__name(this,"_util_FeatureTest")}static get isLittleEndian(){return shadow(this,"isLittleEndian",isLittleEndian())}static get isEvalSupported(){return shadow(this,"isEvalSupported",isEvalSupported())}static get isOffscreenCanvasSupported(){return shadow(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof navigator?.platform=="string"?shadow(this,"platform",{isMac:navigator.platform.includes("Mac")}):shadow(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){var _a2,_b2;return shadow(this,"isCSSRoundSupported",(_b2=(_a2=globalThis.CSS)==null?void 0:_a2.supports)==null?void 0:_b2.call(_a2,"width: round(1.5px, 1px)"))}};__name2(_util_FeatureTest,"util_FeatureTest");let util_FeatureTest=_util_FeatureTest;const hexNumbers=Array.from(Array(256).keys(),n=>n.toString(16).padStart(2,"0")),_Util=class{static{__name(this,"_Util")}static makeHexColor(r,g,b){return`#${hexNumbers[r]}${hexNumbers[g]}${hexNumbers[b]}`}static scaleMinMax(transform,minMax){let temp;transform[0]?(transform[0]<0&&(temp=minMax[0],minMax[0]=minMax[2],minMax[2]=temp),minMax[0]*=transform[0],minMax[2]*=transform[0],transform[3]<0&&(temp=minMax[1],minMax[1]=minMax[3],minMax[3]=temp),minMax[1]*=transform[3],minMax[3]*=transform[3]):(temp=minMax[0],minMax[0]=minMax[1],minMax[1]=temp,temp=minMax[2],minMax[2]=minMax[3],minMax[3]=temp,transform[1]<0&&(temp=minMax[1],minMax[1]=minMax[3],minMax[3]=temp),minMax[1]*=transform[1],minMax[3]*=transform[1],transform[2]<0&&(temp=minMax[0],minMax[0]=minMax[2],minMax[2]=temp),minMax[0]*=transform[2],minMax[2]*=transform[2]),minMax[0]+=transform[4],minMax[1]+=transform[5],minMax[2]+=transform[4],minMax[3]+=transform[5]}static transform(m1,m2){return[m1[0]*m2[0]+m1[2]*m2[1],m1[1]*m2[0]+m1[3]*m2[1],m1[0]*m2[2]+m1[2]*m2[3],m1[1]*m2[2]+m1[3]*m2[3],m1[0]*m2[4]+m1[2]*m2[5]+m1[4],m1[1]*m2[4]+m1[3]*m2[5]+m1[5]]}static applyTransform(p,m){const xt=p[0]*m[0]+p[1]*m[2]+m[4],yt=p[0]*m[1]+p[1]*m[3]+m[5];return[xt,yt]}static applyInverseTransform(p,m){const d=m[0]*m[3]-m[1]*m[2],xt=(p[0]*m[3]-p[1]*m[2]+m[2]*m[5]-m[4]*m[3])/d,yt=(-p[0]*m[1]+p[1]*m[0]+m[4]*m[1]-m[5]*m[0])/d;return[xt,yt]}static getAxialAlignedBoundingBox(r,m){const p1=this.applyTransform(r,m),p2=this.applyTransform(r.slice(2,4),m),p3=this.applyTransform([r[0],r[3]],m),p4=this.applyTransform([r[2],r[1]],m);return[Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1])]}static inverseTransform(m){const d=m[0]*m[3]-m[1]*m[2];return[m[3]/d,-m[1]/d,-m[2]/d,m[0]/d,(m[2]*m[5]-m[4]*m[3])/d,(m[4]*m[1]-m[5]*m[0])/d]}static singularValueDecompose2dScale(m){const transpose=[m[0],m[2],m[1],m[3]],a=m[0]*transpose[0]+m[1]*transpose[2],b=m[0]*transpose[1]+m[1]*transpose[3],c=m[2]*transpose[0]+m[3]*transpose[2],d=m[2]*transpose[1]+m[3]*transpose[3],first=(a+d)/2,second=Math.sqrt((a+d)**2-4*(a*d-c*b))/2,sx=first+second||1,sy=first-second||1;return[Math.sqrt(sx),Math.sqrt(sy)]}static normalizeRect(rect){const r=rect.slice(0);return rect[0]>rect[2]&&(r[0]=rect[2],r[2]=rect[0]),rect[1]>rect[3]&&(r[1]=rect[3],r[3]=rect[1]),r}static intersect(rect1,rect2){const xLow=Math.max(Math.min(rect1[0],rect1[2]),Math.min(rect2[0],rect2[2])),xHigh=Math.min(Math.max(rect1[0],rect1[2]),Math.max(rect2[0],rect2[2]));if(xLow>xHigh)return null;const yLow=Math.max(Math.min(rect1[1],rect1[3]),Math.min(rect2[1],rect2[3])),yHigh=Math.min(Math.max(rect1[1],rect1[3]),Math.max(rect2[1],rect2[3]));return yLow>yHigh?null:[xLow,yLow,xHigh,yHigh]}static bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3,minMax){return minMax?(minMax[0]=Math.min(minMax[0],x0,x3),minMax[1]=Math.min(minMax[1],y0,y3),minMax[2]=Math.max(minMax[2],x0,x3),minMax[3]=Math.max(minMax[3],y0,y3)):minMax=[Math.min(x0,x3),Math.min(y0,y3),Math.max(x0,x3),Math.max(y0,y3)],__privateMethod(this,_Util_static,getExtremum_fn).call(this,x0,x1,x2,x3,y0,y1,y2,y3,3*(-x0+3*(x1-x2)+x3),6*(x0-2*x1+x2),3*(x1-x0),minMax),__privateMethod(this,_Util_static,getExtremum_fn).call(this,x0,x1,x2,x3,y0,y1,y2,y3,3*(-y0+3*(y1-y2)+y3),6*(y0-2*y1+y2),3*(y1-y0),minMax),minMax}};_Util_static=new WeakSet,getExtremumOnCurve_fn=__name2(function(x0,x1,x2,x3,y0,y1,y2,y3,t,minMax){if(t<=0||t>=1)return;const mt=1-t,tt=t*t,ttt=tt*t,x=mt*(mt*(mt*x0+3*t*x1)+3*tt*x2)+ttt*x3,y=mt*(mt*(mt*y0+3*t*y1)+3*tt*y2)+ttt*y3;minMax[0]=Math.min(minMax[0],x),minMax[1]=Math.min(minMax[1],y),minMax[2]=Math.max(minMax[2],x),minMax[3]=Math.max(minMax[3],y)},"#getExtremumOnCurve"),getExtremum_fn=__name2(function(x0,x1,x2,x3,y0,y1,y2,y3,a,b,c,minMax){if(Math.abs(a)<1e-12){Math.abs(b)>=1e-12&&__privateMethod(this,_Util_static,getExtremumOnCurve_fn).call(this,x0,x1,x2,x3,y0,y1,y2,y3,-c/b,minMax);return}const delta=b**2-4*c*a;if(delta<0)return;const sqrtDelta=Math.sqrt(delta),a2=2*a;__privateMethod(this,_Util_static,getExtremumOnCurve_fn).call(this,x0,x1,x2,x3,y0,y1,y2,y3,(-b+sqrtDelta)/a2,minMax),__privateMethod(this,_Util_static,getExtremumOnCurve_fn).call(this,x0,x1,x2,x3,y0,y1,y2,y3,(-b-sqrtDelta)/a2,minMax)},"#getExtremum"),__privateAdd(_Util,_Util_static),__name2(_Util,"Util");let Util=_Util;function stringToUTF8String(str){return decodeURIComponent(escape(str))}__name(stringToUTF8String,"stringToUTF8String"),__name2(stringToUTF8String,"stringToUTF8String");let NormalizeRegex=null,NormalizationMap=null;function normalizeUnicode(str){return NormalizeRegex||(NormalizeRegex=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,NormalizationMap=new Map([["\uFB05","\u017Ft"]])),str.replaceAll(NormalizeRegex,(_,p1,p2)=>p1?p1.normalize("NFKC"):NormalizationMap.get(p2))}__name(normalizeUnicode,"normalizeUnicode"),__name2(normalizeUnicode,"normalizeUnicode");function getUuid(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const buf=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(buf);else for(let i=0;i<32;i++)buf[i]=Math.floor(Math.random()*255);return bytesToString(buf)}__name(getUuid,"getUuid"),__name2(getUuid,"getUuid");const AnnotationPrefix="pdfjs_internal_id_",FontRenderOps={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};__webpack_require__(4628),__webpack_require__(1454),__webpack_require__(3375),__webpack_require__(9225),__webpack_require__(3972),__webpack_require__(9209),__webpack_require__(5714),__webpack_require__(7561),__webpack_require__(6197),__webpack_require__(4979),__webpack_require__(8992),__webpack_require__(4743),__webpack_require__(3215),__webpack_require__(7550),__webpack_require__(8335),__webpack_require__(4520);const _BaseFilterFactory=class _BaseFilterFactory2{static{__name(this,"_BaseFilterFactory")}constructor(){this.constructor===_BaseFilterFactory2&&unreachable("Cannot initialize BaseFilterFactory.")}addFilter(maps){return"none"}addHCMFilter(fgColor,bgColor){return"none"}addAlphaFilter(map){return"none"}addLuminosityFilter(map){return"none"}addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){return"none"}destroy(keepHCM=!1){}};__name2(_BaseFilterFactory,"BaseFilterFactory");let BaseFilterFactory=_BaseFilterFactory;const _BaseCanvasFactory=class _BaseCanvasFactory2{static{__name(this,"_BaseCanvasFactory")}constructor({enableHWA=!1}={}){__privateAdd(this,_enableHWA,!1),this.constructor===_BaseCanvasFactory2&&unreachable("Cannot initialize BaseCanvasFactory."),__privateSet(this,_enableHWA,enableHWA)}create(width,height){if(width<=0||height<=0)throw new Error("Invalid canvas size");const canvas=this._createCanvas(width,height);return{canvas,context:canvas.getContext("2d",{willReadFrequently:!__privateGet(this,_enableHWA)})}}reset(canvasAndContext,width,height){if(!canvasAndContext.canvas)throw new Error("Canvas is not specified");if(width<=0||height<=0)throw new Error("Invalid canvas size");canvasAndContext.canvas.width=width,canvasAndContext.canvas.height=height}destroy(canvasAndContext){if(!canvasAndContext.canvas)throw new Error("Canvas is not specified");canvasAndContext.canvas.width=0,canvasAndContext.canvas.height=0,canvasAndContext.canvas=null,canvasAndContext.context=null}_createCanvas(width,height){unreachable("Abstract method `_createCanvas` called.")}};_enableHWA=new WeakMap,__name2(_BaseCanvasFactory,"BaseCanvasFactory");let BaseCanvasFactory=_BaseCanvasFactory;const _BaseCMapReaderFactory=class _BaseCMapReaderFactory2{static{__name(this,"_BaseCMapReaderFactory")}constructor({baseUrl=null,isCompressed=!0}){this.constructor===_BaseCMapReaderFactory2&&unreachable("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=baseUrl,this.isCompressed=isCompressed}async fetch({name}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!name)throw new Error("CMap name must be specified.");const url=this.baseUrl+name+(this.isCompressed?".bcmap":""),compressionType=this.isCompressed?CMapCompressionType.BINARY:CMapCompressionType.NONE;return this._fetchData(url,compressionType).catch(reason=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${url}`)})}_fetchData(url,compressionType){unreachable("Abstract method `_fetchData` called.")}};__name2(_BaseCMapReaderFactory,"BaseCMapReaderFactory");let BaseCMapReaderFactory=_BaseCMapReaderFactory;const _BaseStandardFontDataFactory=class _BaseStandardFontDataFactory2{static{__name(this,"_BaseStandardFontDataFactory")}constructor({baseUrl=null}){this.constructor===_BaseStandardFontDataFactory2&&unreachable("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=baseUrl}async fetch({filename}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!filename)throw new Error("Font filename must be specified.");const url=`${this.baseUrl}${filename}`;return this._fetchData(url).catch(reason=>{throw new Error(`Unable to load font data at: ${url}`)})}_fetchData(url){unreachable("Abstract method `_fetchData` called.")}};__name2(_BaseStandardFontDataFactory,"BaseStandardFontDataFactory");let BaseStandardFontDataFactory=_BaseStandardFontDataFactory;const _BaseSVGFactory=class _BaseSVGFactory2{static{__name(this,"_BaseSVGFactory")}constructor(){this.constructor===_BaseSVGFactory2&&unreachable("Cannot initialize BaseSVGFactory.")}create(width,height,skipDimensions=!1){if(width<=0||height<=0)throw new Error("Invalid SVG dimensions");const svg=this._createSVG("svg:svg");return svg.setAttribute("version","1.1"),skipDimensions||(svg.setAttribute("width",`${width}px`),svg.setAttribute("height",`${height}px`)),svg.setAttribute("preserveAspectRatio","none"),svg.setAttribute("viewBox",`0 0 ${width} ${height}`),svg}createElement(type){if(typeof type!="string")throw new Error("Invalid SVG element type");return this._createSVG(type)}_createSVG(type){unreachable("Abstract method `_createSVG` called.")}};__name2(_BaseSVGFactory,"BaseSVGFactory");let BaseSVGFactory=_BaseSVGFactory;const SVG_NS="http://www.w3.org/2000/svg",_PixelsPerInch=class{static{__name(this,"_PixelsPerInch")}};__name2(_PixelsPerInch,"PixelsPerInch"),__publicField(_PixelsPerInch,"CSS",96),__publicField(_PixelsPerInch,"PDF",72),__publicField(_PixelsPerInch,"PDF_TO_CSS_UNITS",_PixelsPerInch.CSS/_PixelsPerInch.PDF);let PixelsPerInch=_PixelsPerInch;const _DOMFilterFactory=class extends BaseFilterFactory{static{__name(this,"_DOMFilterFactory")}constructor({docId,ownerDocument=globalThis.document}={}){super(),__privateAdd(this,_DOMFilterFactory_instances),__privateAdd(this,_baseUrl),__privateAdd(this,__cache),__privateAdd(this,__defs),__privateAdd(this,_docId),__privateAdd(this,_document),__privateAdd(this,__hcmCache),__privateAdd(this,_id,0),__privateSet(this,_docId,docId),__privateSet(this,_document,ownerDocument)}addFilter(maps){if(!maps)return"none";let value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(maps);if(value)return value;const[tableR,tableG,tableB]=__privateMethod(this,_DOMFilterFactory_instances,createTables_fn).call(this,maps),key=maps.length===1?tableR:`${tableR}${tableG}${tableB}`;if(value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(key),value)return __privateGet(this,_DOMFilterFactory_instances,cache_get).set(maps,value),value;const id=`g_${__privateGet(this,_docId)}_transfer_map_${__privateWrapper(this,_id)._++}`,url=__privateMethod(this,_DOMFilterFactory_instances,createUrl_fn).call(this,id);__privateGet(this,_DOMFilterFactory_instances,cache_get).set(maps,url),__privateGet(this,_DOMFilterFactory_instances,cache_get).set(key,url);const filter2=__privateMethod(this,_DOMFilterFactory_instances,createFilter_fn).call(this,id);return __privateMethod(this,_DOMFilterFactory_instances,addTransferMapConversion_fn).call(this,tableR,tableG,tableB,filter2),url}addHCMFilter(fgColor,bgColor){var _a2;const key=`${fgColor}-${bgColor}`,filterName="base";let info2=__privateGet(this,_DOMFilterFactory_instances,hcmCache_get).get(filterName);if(info2?.key===key||(info2?((_a2=info2.filter)==null||_a2.remove(),info2.key=key,info2.url="none",info2.filter=null):(info2={key,url:"none",filter:null},__privateGet(this,_DOMFilterFactory_instances,hcmCache_get).set(filterName,info2)),!fgColor||!bgColor))return info2.url;const fgRGB=__privateMethod(this,_DOMFilterFactory_instances,getRGB_fn).call(this,fgColor);fgColor=Util.makeHexColor(...fgRGB);const bgRGB=__privateMethod(this,_DOMFilterFactory_instances,getRGB_fn).call(this,bgColor);if(bgColor=Util.makeHexColor(...bgRGB),__privateGet(this,_DOMFilterFactory_instances,defs_get).style.color="",fgColor==="#000000"&&bgColor==="#ffffff"||fgColor===bgColor)return info2.url;const map=new Array(256);for(let i=0;i<=255;i++){const x=i/255;map[i]=x<=.03928?x/12.92:((x+.055)/1.055)**2.4}const table=map.join(","),id=`g_${__privateGet(this,_docId)}_hcm_filter`,filter2=info2.filter=__privateMethod(this,_DOMFilterFactory_instances,createFilter_fn).call(this,id);__privateMethod(this,_DOMFilterFactory_instances,addTransferMapConversion_fn).call(this,table,table,table,filter2),__privateMethod(this,_DOMFilterFactory_instances,addGrayConversion_fn).call(this,filter2);const getSteps=__name2((c,n)=>{const start=fgRGB[c]/255,end=bgRGB[c]/255,arr=new Array(n+1);for(let i=0;i<=n;i++)arr[i]=start+i/n*(end-start);return arr.join(",")},"getSteps");return __privateMethod(this,_DOMFilterFactory_instances,addTransferMapConversion_fn).call(this,getSteps(0,5),getSteps(1,5),getSteps(2,5),filter2),info2.url=__privateMethod(this,_DOMFilterFactory_instances,createUrl_fn).call(this,id),info2.url}addAlphaFilter(map){let value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(map);if(value)return value;const[tableA]=__privateMethod(this,_DOMFilterFactory_instances,createTables_fn).call(this,[map]),key=`alpha_${tableA}`;if(value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(key),value)return __privateGet(this,_DOMFilterFactory_instances,cache_get).set(map,value),value;const id=`g_${__privateGet(this,_docId)}_alpha_map_${__privateWrapper(this,_id)._++}`,url=__privateMethod(this,_DOMFilterFactory_instances,createUrl_fn).call(this,id);__privateGet(this,_DOMFilterFactory_instances,cache_get).set(map,url),__privateGet(this,_DOMFilterFactory_instances,cache_get).set(key,url);const filter2=__privateMethod(this,_DOMFilterFactory_instances,createFilter_fn).call(this,id);return __privateMethod(this,_DOMFilterFactory_instances,addTransferMapAlphaConversion_fn).call(this,tableA,filter2),url}addLuminosityFilter(map){let value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(map||"luminosity");if(value)return value;let tableA,key;if(map?([tableA]=__privateMethod(this,_DOMFilterFactory_instances,createTables_fn).call(this,[map]),key=`luminosity_${tableA}`):key="luminosity",value=__privateGet(this,_DOMFilterFactory_instances,cache_get).get(key),value)return __privateGet(this,_DOMFilterFactory_instances,cache_get).set(map,value),value;const id=`g_${__privateGet(this,_docId)}_luminosity_map_${__privateWrapper(this,_id)._++}`,url=__privateMethod(this,_DOMFilterFactory_instances,createUrl_fn).call(this,id);__privateGet(this,_DOMFilterFactory_instances,cache_get).set(map,url),__privateGet(this,_DOMFilterFactory_instances,cache_get).set(key,url);const filter2=__privateMethod(this,_DOMFilterFactory_instances,createFilter_fn).call(this,id);return __privateMethod(this,_DOMFilterFactory_instances,addLuminosityConversion_fn).call(this,filter2),map&&__privateMethod(this,_DOMFilterFactory_instances,addTransferMapAlphaConversion_fn).call(this,tableA,filter2),url}addHighlightHCMFilter(filterName,fgColor,bgColor,newFgColor,newBgColor){var _a2;const key=`${fgColor}-${bgColor}-${newFgColor}-${newBgColor}`;let info2=__privateGet(this,_DOMFilterFactory_instances,hcmCache_get).get(filterName);if(info2?.key===key||(info2?((_a2=info2.filter)==null||_a2.remove(),info2.key=key,info2.url="none",info2.filter=null):(info2={key,url:"none",filter:null},__privateGet(this,_DOMFilterFactory_instances,hcmCache_get).set(filterName,info2)),!fgColor||!bgColor))return info2.url;const[fgRGB,bgRGB]=[fgColor,bgColor].map(__privateMethod(this,_DOMFilterFactory_instances,getRGB_fn).bind(this));let fgGray=Math.round(.2126*fgRGB[0]+.7152*fgRGB[1]+.0722*fgRGB[2]),bgGray=Math.round(.2126*bgRGB[0]+.7152*bgRGB[1]+.0722*bgRGB[2]),[newFgRGB,newBgRGB]=[newFgColor,newBgColor].map(__privateMethod(this,_DOMFilterFactory_instances,getRGB_fn).bind(this));bgGray<fgGray&&([fgGray,bgGray,newFgRGB,newBgRGB]=[bgGray,fgGray,newBgRGB,newFgRGB]),__privateGet(this,_DOMFilterFactory_instances,defs_get).style.color="";const getSteps=__name2((fg,bg,n)=>{const arr=new Array(256),step=(bgGray-fgGray)/n,newStart=fg/255,newStep=(bg-fg)/(255*n);let prev=0;for(let i=0;i<=n;i++){const k=Math.round(fgGray+i*step),value=newStart+i*newStep;for(let j=prev;j<=k;j++)arr[j]=value;prev=k+1}for(let i=prev;i<256;i++)arr[i]=arr[prev-1];return arr.join(",")},"getSteps"),id=`g_${__privateGet(this,_docId)}_hcm_${filterName}_filter`,filter2=info2.filter=__privateMethod(this,_DOMFilterFactory_instances,createFilter_fn).call(this,id);return __privateMethod(this,_DOMFilterFactory_instances,addGrayConversion_fn).call(this,filter2),__privateMethod(this,_DOMFilterFactory_instances,addTransferMapConversion_fn).call(this,getSteps(newFgRGB[0],newBgRGB[0],5),getSteps(newFgRGB[1],newBgRGB[1],5),getSteps(newFgRGB[2],newBgRGB[2],5),filter2),info2.url=__privateMethod(this,_DOMFilterFactory_instances,createUrl_fn).call(this,id),info2.url}destroy(keepHCM=!1){keepHCM&&__privateGet(this,_DOMFilterFactory_instances,hcmCache_get).size!==0||(__privateGet(this,__defs)&&(__privateGet(this,__defs).parentNode.parentNode.remove(),__privateSet(this,__defs,null)),__privateGet(this,__cache)&&(__privateGet(this,__cache).clear(),__privateSet(this,__cache,null)),__privateSet(this,_id,0))}};_baseUrl=new WeakMap,__cache=new WeakMap,__defs=new WeakMap,_docId=new WeakMap,_document=new WeakMap,__hcmCache=new WeakMap,_id=new WeakMap,_DOMFilterFactory_instances=new WeakSet,cache_get=__name2(function(){return __privateGet(this,__cache)||__privateSet(this,__cache,new Map)},"#cache"),hcmCache_get=__name2(function(){return __privateGet(this,__hcmCache)||__privateSet(this,__hcmCache,new Map)},"#hcmCache"),defs_get=__name2(function(){if(!__privateGet(this,__defs)){const div=__privateGet(this,_document).createElement("div"),{style}=div;style.visibility="hidden",style.contain="strict",style.width=style.height=0,style.position="absolute",style.top=style.left=0,style.zIndex=-1;const svg=__privateGet(this,_document).createElementNS(SVG_NS,"svg");svg.setAttribute("width",0),svg.setAttribute("height",0),__privateSet(this,__defs,__privateGet(this,_document).createElementNS(SVG_NS,"defs")),div.append(svg),svg.append(__privateGet(this,__defs)),__privateGet(this,_document).body.append(div)}return __privateGet(this,__defs)},"#defs"),createTables_fn=__name2(function(maps){if(maps.length===1){const mapR2=maps[0],buffer=new Array(256);for(let i=0;i<256;i++)buffer[i]=mapR2[i]/255;const table=buffer.join(",");return[table,table,table]}const[mapR,mapG,mapB]=maps,bufferR=new Array(256),bufferG=new Array(256),bufferB=new Array(256);for(let i=0;i<256;i++)bufferR[i]=mapR[i]/255,bufferG[i]=mapG[i]/255,bufferB[i]=mapB[i]/255;return[bufferR.join(","),bufferG.join(","),bufferB.join(",")]},"#createTables"),createUrl_fn=__name2(function(id){if(__privateGet(this,_baseUrl)===void 0){__privateSet(this,_baseUrl,"");const url=__privateGet(this,_document).URL;url!==__privateGet(this,_document).baseURI&&(isDataScheme(url)?warn('#createUrl: ignore "data:"-URL for performance reasons.'):__privateSet(this,_baseUrl,url.split("#",1)[0]))}return`url(${__privateGet(this,_baseUrl)}#${id})`},"#createUrl"),addLuminosityConversion_fn=__name2(function(filter2){const feColorMatrix=__privateGet(this,_document).createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix"),feColorMatrix.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),filter2.append(feColorMatrix)},"#addLuminosityConversion"),addGrayConversion_fn=__name2(function(filter2){const feColorMatrix=__privateGet(this,_document).createElementNS(SVG_NS,"feColorMatrix");feColorMatrix.setAttribute("type","matrix"),feColorMatrix.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),filter2.append(feColorMatrix)},"#addGrayConversion"),createFilter_fn=__name2(function(id){const filter2=__privateGet(this,_document).createElementNS(SVG_NS,"filter");return filter2.setAttribute("color-interpolation-filters","sRGB"),filter2.setAttribute("id",id),__privateGet(this,_DOMFilterFactory_instances,defs_get).append(filter2),filter2},"#createFilter"),appendFeFunc_fn=__name2(function(feComponentTransfer,func,table){const feFunc=__privateGet(this,_document).createElementNS(SVG_NS,func);feFunc.setAttribute("type","discrete"),feFunc.setAttribute("tableValues",table),feComponentTransfer.append(feFunc)},"#appendFeFunc"),addTransferMapConversion_fn=__name2(function(rTable,gTable,bTable,filter2){const feComponentTransfer=__privateGet(this,_document).createElementNS(SVG_NS,"feComponentTransfer");filter2.append(feComponentTransfer),__privateMethod(this,_DOMFilterFactory_instances,appendFeFunc_fn).call(this,feComponentTransfer,"feFuncR",rTable),__privateMethod(this,_DOMFilterFactory_instances,appendFeFunc_fn).call(this,feComponentTransfer,"feFuncG",gTable),__privateMethod(this,_DOMFilterFactory_instances,appendFeFunc_fn).call(this,feComponentTransfer,"feFuncB",bTable)},"#addTransferMapConversion"),addTransferMapAlphaConversion_fn=__name2(function(aTable,filter2){const feComponentTransfer=__privateGet(this,_document).createElementNS(SVG_NS,"feComponentTransfer");filter2.append(feComponentTransfer),__privateMethod(this,_DOMFilterFactory_instances,appendFeFunc_fn).call(this,feComponentTransfer,"feFuncA",aTable)},"#addTransferMapAlphaConversion"),getRGB_fn=__name2(function(color){return __privateGet(this,_DOMFilterFactory_instances,defs_get).style.color=color,getRGB(getComputedStyle(__privateGet(this,_DOMFilterFactory_instances,defs_get)).getPropertyValue("color"))},"#getRGB"),__name2(_DOMFilterFactory,"DOMFilterFactory");let DOMFilterFactory=_DOMFilterFactory;const _DOMCanvasFactory=class extends BaseCanvasFactory{static{__name(this,"_DOMCanvasFactory")}constructor({ownerDocument=globalThis.document,enableHWA=!1}={}){super({enableHWA}),this._document=ownerDocument}_createCanvas(width,height){const canvas=this._document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas}};__name2(_DOMCanvasFactory,"DOMCanvasFactory");let DOMCanvasFactory=_DOMCanvasFactory;async function fetchData(url,type="text"){if(isValidFetchUrl(url,document.baseURI)){const response=await fetch(url);if(!response.ok)throw new Error(response.statusText);switch(type){case"arraybuffer":return response.arrayBuffer();case"blob":return response.blob();case"json":return response.json()}return response.text()}return new Promise((resolve,reject)=>{const request=new XMLHttpRequest;request.open("GET",url,!0),request.responseType=type,request.onreadystatechange=()=>{if(request.readyState===XMLHttpRequest.DONE){if(request.status===200||request.status===0){switch(type){case"arraybuffer":case"blob":case"json":resolve(request.response);return}resolve(request.responseText);return}reject(new Error(request.statusText))}},request.send(null)})}__name(fetchData,"fetchData"),__name2(fetchData,"fetchData");const _DOMCMapReaderFactory=class extends BaseCMapReaderFactory{static{__name(this,"_DOMCMapReaderFactory")}_fetchData(url,compressionType){return fetchData(url,this.isCompressed?"arraybuffer":"text").then(data=>({cMapData:data instanceof ArrayBuffer?new Uint8Array(data):stringToBytes(data),compressionType}))}};__name2(_DOMCMapReaderFactory,"DOMCMapReaderFactory");let DOMCMapReaderFactory=_DOMCMapReaderFactory;const _DOMStandardFontDataFactory=class extends BaseStandardFontDataFactory{static{__name(this,"_DOMStandardFontDataFactory")}_fetchData(url){return fetchData(url,"arraybuffer").then(data=>new Uint8Array(data))}};__name2(_DOMStandardFontDataFactory,"DOMStandardFontDataFactory");let DOMStandardFontDataFactory=_DOMStandardFontDataFactory;const _DOMSVGFactory=class extends BaseSVGFactory{static{__name(this,"_DOMSVGFactory")}_createSVG(type){return document.createElementNS(SVG_NS,type)}};__name2(_DOMSVGFactory,"DOMSVGFactory");let DOMSVGFactory=_DOMSVGFactory;const _PageViewport=class _PageViewport2{static{__name(this,"_PageViewport")}constructor({viewBox,scale,rotation,offsetX=0,offsetY=0,dontFlip=!1}){this.viewBox=viewBox,this.scale=scale,this.rotation=rotation,this.offsetX=offsetX,this.offsetY=offsetY;const centerX=(viewBox[2]+viewBox[0])/2,centerY=(viewBox[3]+viewBox[1])/2;let rotateA,rotateB,rotateC,rotateD;switch(rotation%=360,rotation<0&&(rotation+=360),rotation){case 180:rotateA=-1,rotateB=0,rotateC=0,rotateD=1;break;case 90:rotateA=0,rotateB=1,rotateC=1,rotateD=0;break;case 270:rotateA=0,rotateB=-1,rotateC=-1,rotateD=0;break;case 0:rotateA=1,rotateB=0,rotateC=0,rotateD=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}dontFlip&&(rotateC=-rotateC,rotateD=-rotateD);let offsetCanvasX,offsetCanvasY,width,height;rotateA===0?(offsetCanvasX=Math.abs(centerY-viewBox[1])*scale+offsetX,offsetCanvasY=Math.abs(centerX-viewBox[0])*scale+offsetY,width=(viewBox[3]-viewBox[1])*scale,height=(viewBox[2]-viewBox[0])*scale):(offsetCanvasX=Math.abs(centerX-viewBox[0])*scale+offsetX,offsetCanvasY=Math.abs(centerY-viewBox[1])*scale+offsetY,width=(viewBox[2]-viewBox[0])*scale,height=(viewBox[3]-viewBox[1])*scale),this.transform=[rotateA*scale,rotateB*scale,rotateC*scale,rotateD*scale,offsetCanvasX-rotateA*scale*centerX-rotateC*scale*centerY,offsetCanvasY-rotateB*scale*centerX-rotateD*scale*centerY],this.width=width,this.height=height}get rawDims(){const{viewBox}=this;return shadow(this,"rawDims",{pageWidth:viewBox[2]-viewBox[0],pageHeight:viewBox[3]-viewBox[1],pageX:viewBox[0],pageY:viewBox[1]})}clone({scale=this.scale,rotation=this.rotation,offsetX=this.offsetX,offsetY=this.offsetY,dontFlip=!1}={}){return new _PageViewport2({viewBox:this.viewBox.slice(),scale,rotation,offsetX,offsetY,dontFlip})}convertToViewportPoint(x,y){return Util.applyTransform([x,y],this.transform)}convertToViewportRectangle(rect){const topLeft=Util.applyTransform([rect[0],rect[1]],this.transform),bottomRight=Util.applyTransform([rect[2],rect[3]],this.transform);return[topLeft[0],topLeft[1],bottomRight[0],bottomRight[1]]}convertToPdfPoint(x,y){return Util.applyInverseTransform([x,y],this.transform)}};__name2(_PageViewport,"PageViewport");let PageViewport=_PageViewport;const _RenderingCancelledException=class extends BaseException{static{__name(this,"_RenderingCancelledException")}constructor(msg,extraDelay=0){super(msg,"RenderingCancelledException"),this.extraDelay=extraDelay}};__name2(_RenderingCancelledException,"RenderingCancelledException");let RenderingCancelledException=_RenderingCancelledException;function isDataScheme(url){const ii=url.length;let i=0;for(;i<ii&&url[i].trim()==="";)i++;return url.substring(i,i+5).toLowerCase()==="data:"}__name(isDataScheme,"isDataScheme"),__name2(isDataScheme,"isDataScheme");function isPdfFile(filename){return typeof filename=="string"&&/\.pdf$/i.test(filename)}__name(isPdfFile,"isPdfFile"),__name2(isPdfFile,"isPdfFile");function getFilenameFromUrl(url){return[url]=url.split(/[#?]/,1),url.substring(url.lastIndexOf("/")+1)}__name(getFilenameFromUrl,"getFilenameFromUrl"),__name2(getFilenameFromUrl,"getFilenameFromUrl");function getPdfFilenameFromUrl(url,defaultFilename="document.pdf"){if(typeof url!="string")return defaultFilename;if(isDataScheme(url))return warn('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),defaultFilename;const reURI=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,reFilename=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,splitURI=reURI.exec(url);let suggestedFilename=reFilename.exec(splitURI[1])||reFilename.exec(splitURI[2])||reFilename.exec(splitURI[3]);if(suggestedFilename&&(suggestedFilename=suggestedFilename[0],suggestedFilename.includes("%")))try{suggestedFilename=reFilename.exec(decodeURIComponent(suggestedFilename))[0]}catch{}return suggestedFilename||defaultFilename}__name(getPdfFilenameFromUrl,"getPdfFilenameFromUrl"),__name2(getPdfFilenameFromUrl,"getPdfFilenameFromUrl");const _StatTimer=class{static{__name(this,"_StatTimer")}constructor(){__publicField(this,"started",Object.create(null)),__publicField(this,"times",[])}time(name){name in this.started&&warn(`Timer is already running for ${name}`),this.started[name]=Date.now()}timeEnd(name){name in this.started||warn(`Timer has not been started for ${name}`),this.times.push({name,start:this.started[name],end:Date.now()}),delete this.started[name]}toString(){const outBuf=[];let longest=0;for(const{name}of this.times)longest=Math.max(name.length,longest);for(const{name,start,end}of this.times)outBuf.push(`${name.padEnd(longest)} ${end-start}ms
`);return outBuf.join("")}};__name2(_StatTimer,"StatTimer");let StatTimer=_StatTimer;function isValidFetchUrl(url,baseUrl){try{const{protocol}=baseUrl?new URL(url,baseUrl):new URL(url);return protocol==="http:"||protocol==="https:"}catch{return!1}}__name(isValidFetchUrl,"isValidFetchUrl"),__name2(isValidFetchUrl,"isValidFetchUrl");function noContextMenu(e){e.preventDefault()}__name(noContextMenu,"noContextMenu"),__name2(noContextMenu,"noContextMenu");let pdfDateStringRegex;const _PDFDateString=class{static{__name(this,"_PDFDateString")}static toDateObject(input){if(!input||typeof input!="string")return null;pdfDateStringRegex||(pdfDateStringRegex=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const matches=pdfDateStringRegex.exec(input);if(!matches)return null;const year=parseInt(matches[1],10);let month=parseInt(matches[2],10);month=month>=1&&month<=12?month-1:0;let day=parseInt(matches[3],10);day=day>=1&&day<=31?day:1;let hour=parseInt(matches[4],10);hour=hour>=0&&hour<=23?hour:0;let minute=parseInt(matches[5],10);minute=minute>=0&&minute<=59?minute:0;let second=parseInt(matches[6],10);second=second>=0&&second<=59?second:0;const universalTimeRelation=matches[7]||"Z";let offsetHour=parseInt(matches[8],10);offsetHour=offsetHour>=0&&offsetHour<=23?offsetHour:0;let offsetMinute=parseInt(matches[9],10)||0;return offsetMinute=offsetMinute>=0&&offsetMinute<=59?offsetMinute:0,universalTimeRelation==="-"?(hour+=offsetHour,minute+=offsetMinute):universalTimeRelation==="+"&&(hour-=offsetHour,minute-=offsetMinute),new Date(Date.UTC(year,month,day,hour,minute,second))}};__name2(_PDFDateString,"PDFDateString");let PDFDateString=_PDFDateString;function getXfaPageViewport(xfaPage,{scale=1,rotation=0}){const{width,height}=xfaPage.attributes.style,viewBox=[0,0,parseInt(width),parseInt(height)];return new PageViewport({viewBox,scale,rotation})}__name(getXfaPageViewport,"getXfaPageViewport"),__name2(getXfaPageViewport,"getXfaPageViewport");function getRGB(color){if(color.startsWith("#")){const colorRGB=parseInt(color.slice(1),16);return[(colorRGB&16711680)>>16,(colorRGB&65280)>>8,colorRGB&255]}return color.startsWith("rgb(")?color.slice(4,-1).split(",").map(x=>parseInt(x)):color.startsWith("rgba(")?color.slice(5,-1).split(",").map(x=>parseInt(x)).slice(0,3):(warn(`Not a valid color format: "${color}"`),[0,0,0])}__name(getRGB,"getRGB"),__name2(getRGB,"getRGB");function getColorValues(colors){const span=document.createElement("span");span.style.visibility="hidden",document.body.append(span);for(const name of colors.keys()){span.style.color=name;const computedColor=window.getComputedStyle(span).color;colors.set(name,getRGB(computedColor))}span.remove()}__name(getColorValues,"getColorValues"),__name2(getColorValues,"getColorValues");function getCurrentTransform(ctx){const{a,b,c,d,e,f}=ctx.getTransform();return[a,b,c,d,e,f]}__name(getCurrentTransform,"getCurrentTransform"),__name2(getCurrentTransform,"getCurrentTransform");function getCurrentTransformInverse(ctx){const{a,b,c,d,e,f}=ctx.getTransform().invertSelf();return[a,b,c,d,e,f]}__name(getCurrentTransformInverse,"getCurrentTransformInverse"),__name2(getCurrentTransformInverse,"getCurrentTransformInverse");function setLayerDimensions(div,viewport,mustFlip=!1,mustRotate=!0){if(viewport instanceof PageViewport){const{pageWidth,pageHeight}=viewport.rawDims,{style}=div,useRound=util_FeatureTest.isCSSRoundSupported,w=`var(--scale-factor) * ${pageWidth}px`,h=`var(--scale-factor) * ${pageHeight}px`,widthStr=useRound?`round(${w}, 1px)`:`calc(${w})`,heightStr=useRound?`round(${h}, 1px)`:`calc(${h})`;!mustFlip||viewport.rotation%180===0?(style.width=widthStr,style.height=heightStr):(style.width=heightStr,style.height=widthStr)}mustRotate&&div.setAttribute("data-main-rotation",viewport.rotation)}__name(setLayerDimensions,"setLayerDimensions"),__name2(setLayerDimensions,"setLayerDimensions");const _EditorToolbar=class _EditorToolbar2{static{__name(this,"_EditorToolbar")}constructor(editor){__privateAdd(this,_EditorToolbar_instances),__privateAdd(this,_toolbar,null),__privateAdd(this,_colorPicker,null),__privateAdd(this,_editor),__privateAdd(this,_buttons,null),__privateSet(this,_editor,editor)}render(){const editToolbar=__privateSet(this,_toolbar,document.createElement("div"));editToolbar.className="editToolbar",editToolbar.setAttribute("role","toolbar");const signal=__privateGet(this,_editor)._uiManager._signal;editToolbar.addEventListener("contextmenu",noContextMenu,{signal}),editToolbar.addEventListener("pointerdown",__privateMethod(_EditorToolbar2,_EditorToolbar_static,pointerDown_fn),{signal});const buttons=__privateSet(this,_buttons,document.createElement("div"));buttons.className="buttons",editToolbar.append(buttons);const position=__privateGet(this,_editor).toolbarPosition;if(position){const{style}=editToolbar,x=__privateGet(this,_editor)._uiManager.direction==="ltr"?1-position[0]:position[0];style.insetInlineEnd=`${100*x}%`,style.top=`calc(${100*position[1]}% + var(--editor-toolbar-vert-offset))`}return __privateMethod(this,_EditorToolbar_instances,addDeleteButton_fn).call(this),editToolbar}hide(){var _a2;__privateGet(this,_toolbar).classList.add("hidden"),(_a2=__privateGet(this,_colorPicker))==null||_a2.hideDropdown()}show(){__privateGet(this,_toolbar).classList.remove("hidden")}addAltTextButton(button){__privateMethod(this,_EditorToolbar_instances,addListenersToElement_fn).call(this,button),__privateGet(this,_buttons).prepend(button,__privateGet(this,_EditorToolbar_instances,divider_get))}addColorPicker(colorPicker){__privateSet(this,_colorPicker,colorPicker);const button=colorPicker.renderButton();__privateMethod(this,_EditorToolbar_instances,addListenersToElement_fn).call(this,button),__privateGet(this,_buttons).prepend(button,__privateGet(this,_EditorToolbar_instances,divider_get))}remove(){var _a2;__privateGet(this,_toolbar).remove(),(_a2=__privateGet(this,_colorPicker))==null||_a2.destroy(),__privateSet(this,_colorPicker,null)}};_toolbar=new WeakMap,_colorPicker=new WeakMap,_editor=new WeakMap,_buttons=new WeakMap,_EditorToolbar_static=new WeakSet,pointerDown_fn=__name2(function(e){e.stopPropagation()},"#pointerDown"),_EditorToolbar_instances=new WeakSet,focusIn_fn=__name2(function(e){__privateGet(this,_editor)._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()},"#focusIn"),focusOut_fn=__name2(function(e){__privateGet(this,_editor)._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()},"#focusOut"),addListenersToElement_fn=__name2(function(element){const signal=__privateGet(this,_editor)._uiManager._signal;element.addEventListener("focusin",__privateMethod(this,_EditorToolbar_instances,focusIn_fn).bind(this),{capture:!0,signal}),element.addEventListener("focusout",__privateMethod(this,_EditorToolbar_instances,focusOut_fn).bind(this),{capture:!0,signal}),element.addEventListener("contextmenu",noContextMenu,{signal})},"#addListenersToElement"),addDeleteButton_fn=__name2(function(){const button=document.createElement("button");button.className="delete",button.tabIndex=0,button.setAttribute("data-l10n-id",`pdfjs-editor-remove-${__privateGet(this,_editor).editorType}-button`),__privateMethod(this,_EditorToolbar_instances,addListenersToElement_fn).call(this,button),button.addEventListener("click",e=>{__privateGet(this,_editor)._uiManager.delete()},{signal:__privateGet(this,_editor)._uiManager._signal}),__privateGet(this,_buttons).append(button)},"#addDeleteButton"),divider_get=__name2(function(){const divider=document.createElement("div");return divider.className="divider",divider},"#divider"),__privateAdd(_EditorToolbar,_EditorToolbar_static),__name2(_EditorToolbar,"EditorToolbar");let EditorToolbar=_EditorToolbar;const _HighlightToolbar=class{static{__name(this,"_HighlightToolbar")}constructor(uiManager){__privateAdd(this,_HighlightToolbar_instances),__privateAdd(this,_buttons2,null),__privateAdd(this,_toolbar2,null),__privateAdd(this,_uiManager),__privateSet(this,_uiManager,uiManager)}show(parent,boxes,isLTR){const[x,y]=__privateMethod(this,_HighlightToolbar_instances,getLastPoint_fn).call(this,boxes,isLTR),{style}=__privateGet(this,_toolbar2)||__privateSet(this,_toolbar2,__privateMethod(this,_HighlightToolbar_instances,render_fn).call(this));parent.append(__privateGet(this,_toolbar2)),style.insetInlineEnd=`${100*x}%`,style.top=`calc(${100*y}% + var(--editor-toolbar-vert-offset))`}hide(){__privateGet(this,_toolbar2).remove()}};_buttons2=new WeakMap,_toolbar2=new WeakMap,_uiManager=new WeakMap,_HighlightToolbar_instances=new WeakSet,render_fn=__name2(function(){const editToolbar=__privateSet(this,_toolbar2,document.createElement("div"));editToolbar.className="editToolbar",editToolbar.setAttribute("role","toolbar"),editToolbar.addEventListener("contextmenu",noContextMenu,{signal:__privateGet(this,_uiManager)._signal});const buttons=__privateSet(this,_buttons2,document.createElement("div"));return buttons.className="buttons",editToolbar.append(buttons),__privateMethod(this,_HighlightToolbar_instances,addHighlightButton_fn).call(this),editToolbar},"#render"),getLastPoint_fn=__name2(function(boxes,isLTR){let lastY=0,lastX=0;for(const box of boxes){const y=box.y+box.height;if(y<lastY)continue;const x=box.x+(isLTR?box.width:0);if(y>lastY){lastX=x,lastY=y;continue}isLTR?x>lastX&&(lastX=x):x<lastX&&(lastX=x)}return[isLTR?1-lastX:lastX,lastY]},"#getLastPoint"),addHighlightButton_fn=__name2(function(){const button=document.createElement("button");button.className="highlightButton",button.tabIndex=0,button.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const span=document.createElement("span");button.append(span),span.className="visuallyHidden",span.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const signal=__privateGet(this,_uiManager)._signal;button.addEventListener("contextmenu",noContextMenu,{signal}),button.addEventListener("click",()=>{__privateGet(this,_uiManager).highlightSelection("floating_button")},{signal}),__privateGet(this,_buttons2).append(button)},"#addHighlightButton"),__name2(_HighlightToolbar,"HighlightToolbar");let HighlightToolbar=_HighlightToolbar;function bindEvents(obj,element,names){for(const name of names)element.addEventListener(name,obj[name].bind(obj))}__name(bindEvents,"bindEvents"),__name2(bindEvents,"bindEvents");function opacityToHex(opacity){return Math.round(Math.min(255,Math.max(1,255*opacity))).toString(16).padStart(2,"0")}__name(opacityToHex,"opacityToHex"),__name2(opacityToHex,"opacityToHex");const _IdManager=class{static{__name(this,"_IdManager")}constructor(){__privateAdd(this,_id2,0)}get id(){return`${AnnotationEditorPrefix}${__privateWrapper(this,_id2)._++}`}};_id2=new WeakMap,__name2(_IdManager,"IdManager");let IdManager=_IdManager;const _ImageManager=class{static{__name(this,"_ImageManager")}constructor(){__privateAdd(this,_ImageManager_instances),__privateAdd(this,_baseId,getUuid()),__privateAdd(this,_id3,0),__privateAdd(this,_cache,null)}static get _isSVGFittingCanvas(){const svg='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',ctx=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),image=new Image;image.src=svg;const promise=image.decode().then(()=>(ctx.drawImage(image,0,0,1,1,0,0,1,3),new Uint32Array(ctx.getImageData(0,0,1,1).data.buffer)[0]===0));return shadow(this,"_isSVGFittingCanvas",promise)}async getFromFile(file){const{lastModified,name,size,type}=file;return __privateMethod(this,_ImageManager_instances,get_fn).call(this,`${lastModified}_${name}_${size}_${type}`,file)}async getFromUrl(url){return __privateMethod(this,_ImageManager_instances,get_fn).call(this,url,url)}async getFromId(id){__privateGet(this,_cache)||__privateSet(this,_cache,new Map);const data=__privateGet(this,_cache).get(id);return data?data.bitmap?(data.refCounter+=1,data):data.file?this.getFromFile(data.file):this.getFromUrl(data.url):null}getSvgUrl(id){const data=__privateGet(this,_cache).get(id);return data?.isSvg?data.svgUrl:null}deleteId(id){__privateGet(this,_cache)||__privateSet(this,_cache,new Map);const data=__privateGet(this,_cache).get(id);data&&(data.refCounter-=1,data.refCounter===0&&(data.bitmap=null))}isValidId(id){return id.startsWith(`image_${__privateGet(this,_baseId)}_`)}};_baseId=new WeakMap,_id3=new WeakMap,_cache=new WeakMap,_ImageManager_instances=new WeakSet,get_fn=__name2(async function(key,rawData){__privateGet(this,_cache)||__privateSet(this,_cache,new Map);let data=__privateGet(this,_cache).get(key);if(data===null)return null;if(data?.bitmap)return data.refCounter+=1,data;try{data||(data={bitmap:null,id:`image_${__privateGet(this,_baseId)}_${__privateWrapper(this,_id3)._++}`,refCounter:0,isSvg:!1});let image;if(typeof rawData=="string"?(data.url=rawData,image=await fetchData(rawData,"blob")):image=data.file=rawData,image.type==="image/svg+xml"){const mustRemoveAspectRatioPromise=_ImageManager._isSVGFittingCanvas,fileReader=new FileReader,imageElement=new Image,imagePromise=new Promise((resolve,reject)=>{imageElement.onload=()=>{data.bitmap=imageElement,data.isSvg=!0,resolve()},fileReader.onload=async()=>{const url=data.svgUrl=fileReader.result;imageElement.src=await mustRemoveAspectRatioPromise?`${url}#svgView(preserveAspectRatio(none))`:url},imageElement.onerror=fileReader.onerror=reject});fileReader.readAsDataURL(image),await imagePromise}else data.bitmap=await createImageBitmap(image);data.refCounter=1}catch(e){console.error(e),data=null}return __privateGet(this,_cache).set(key,data),data&&__privateGet(this,_cache).set(data.id,data),data},"#get"),__name2(_ImageManager,"ImageManager");let ImageManager=_ImageManager;const _CommandManager=class{static{__name(this,"_CommandManager")}constructor(maxSize=128){__privateAdd(this,_commands,[]),__privateAdd(this,_locked,!1),__privateAdd(this,_maxSize),__privateAdd(this,_position,-1),__privateSet(this,_maxSize,maxSize)}add({cmd,undo,post,mustExec,type=NaN,overwriteIfSameType=!1,keepUndo=!1}){if(mustExec&&cmd(),__privateGet(this,_locked))return;const save={cmd,undo,post,type};if(__privateGet(this,_position)===-1){__privateGet(this,_commands).length>0&&(__privateGet(this,_commands).length=0),__privateSet(this,_position,0),__privateGet(this,_commands).push(save);return}if(overwriteIfSameType&&__privateGet(this,_commands)[__privateGet(this,_position)].type===type){keepUndo&&(save.undo=__privateGet(this,_commands)[__privateGet(this,_position)].undo),__privateGet(this,_commands)[__privateGet(this,_position)]=save;return}const next=__privateGet(this,_position)+1;next===__privateGet(this,_maxSize)?__privateGet(this,_commands).splice(0,1):(__privateSet(this,_position,next),next<__privateGet(this,_commands).length&&__privateGet(this,_commands).splice(next)),__privateGet(this,_commands).push(save)}undo(){if(__privateGet(this,_position)===-1)return;__privateSet(this,_locked,!0);const{undo,post}=__privateGet(this,_commands)[__privateGet(this,_position)];undo(),post?.(),__privateSet(this,_locked,!1),__privateSet(this,_position,__privateGet(this,_position)-1)}redo(){if(__privateGet(this,_position)<__privateGet(this,_commands).length-1){__privateSet(this,_position,__privateGet(this,_position)+1),__privateSet(this,_locked,!0);const{cmd,post}=__privateGet(this,_commands)[__privateGet(this,_position)];cmd(),post?.(),__privateSet(this,_locked,!1)}}hasSomethingToUndo(){return __privateGet(this,_position)!==-1}hasSomethingToRedo(){return __privateGet(this,_position)<__privateGet(this,_commands).length-1}destroy(){__privateSet(this,_commands,null)}};_commands=new WeakMap,_locked=new WeakMap,_maxSize=new WeakMap,_position=new WeakMap,__name2(_CommandManager,"CommandManager");let CommandManager=_CommandManager;const _KeyboardManager=class{static{__name(this,"_KeyboardManager")}constructor(callbacks){__privateAdd(this,_KeyboardManager_instances),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac}=util_FeatureTest.platform;for(const[keys,callback,options={}]of callbacks)for(const key of keys){const isMacKey=key.startsWith("mac+");isMac&&isMacKey?(this.callbacks.set(key.slice(4),{callback,options}),this.allKeys.add(key.split("+").at(-1))):!isMac&&!isMacKey&&(this.callbacks.set(key,{callback,options}),this.allKeys.add(key.split("+").at(-1)))}}exec(self2,event){if(!this.allKeys.has(event.key))return;const info2=this.callbacks.get(__privateMethod(this,_KeyboardManager_instances,serialize_fn).call(this,event));if(!info2)return;const{callback,options:{bubbles=!1,args=[],checker=null}}=info2;checker&&!checker(self2,event)||(callback.bind(self2,...args,event)(),bubbles||(event.stopPropagation(),event.preventDefault()))}};_KeyboardManager_instances=new WeakSet,serialize_fn=__name2(function(event){event.altKey&&this.buffer.push("alt"),event.ctrlKey&&this.buffer.push("ctrl"),event.metaKey&&this.buffer.push("meta"),event.shiftKey&&this.buffer.push("shift"),this.buffer.push(event.key);const str=this.buffer.join("+");return this.buffer.length=0,str},"#serialize"),__name2(_KeyboardManager,"KeyboardManager");let KeyboardManager=_KeyboardManager;const _ColorManager=class _ColorManager2{static{__name(this,"_ColorManager")}get _colors(){const colors=new Map([["CanvasText",null],["Canvas",null]]);return getColorValues(colors),shadow(this,"_colors",colors)}convert(color){const rgb=getRGB(color);if(!window.matchMedia("(forced-colors: active)").matches)return rgb;for(const[name,RGB]of this._colors)if(RGB.every((x,i)=>x===rgb[i]))return _ColorManager2._colorsMapping.get(name);return rgb}getHexCode(name){const rgb=this._colors.get(name);return rgb?Util.makeHexColor(...rgb):name}};__name2(_ColorManager,"ColorManager"),__publicField(_ColorManager,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let ColorManager=_ColorManager;const _AnnotationEditorUIManager=class _AnnotationEditorUIManager2{static{__name(this,"_AnnotationEditorUIManager")}constructor(container,viewer,altTextManager,eventBus,pdfDocument,pageColors,highlightColors,enableHighlightFloatingButton,enableUpdatedAddImage,mlManager){__privateAdd(this,_AnnotationEditorUIManager_instances),__privateAdd(this,_abortController,new AbortController),__privateAdd(this,_activeEditor,null),__privateAdd(this,_allEditors,new Map),__privateAdd(this,_allLayers,new Map),__privateAdd(this,_altTextManager,null),__privateAdd(this,_annotationStorage,null),__privateAdd(this,_changedExistingAnnotations,null),__privateAdd(this,_commandManager,new CommandManager),__privateAdd(this,_currentPageIndex,0),__privateAdd(this,_deletedAnnotationsElementIds,new Set),__privateAdd(this,_draggingEditors,null),__privateAdd(this,_editorTypes,null),__privateAdd(this,_editorsToRescale,new Set),__privateAdd(this,_enableHighlightFloatingButton,!1),__privateAdd(this,_enableUpdatedAddImage,!1),__privateAdd(this,_filterFactory,null),__privateAdd(this,_focusMainContainerTimeoutId,null),__privateAdd(this,_highlightColors,null),__privateAdd(this,_highlightWhenShiftUp,!1),__privateAdd(this,_highlightToolbar,null),__privateAdd(this,_idManager,new IdManager),__privateAdd(this,_isEnabled,!1),__privateAdd(this,_isWaiting,!1),__privateAdd(this,_lastActiveElement,null),__privateAdd(this,_mainHighlightColorPicker,null),__privateAdd(this,_mlManager,null),__privateAdd(this,_mode,AnnotationEditorType.NONE),__privateAdd(this,_selectedEditors,new Set),__privateAdd(this,_selectedTextNode,null),__privateAdd(this,_pageColors,null),__privateAdd(this,_showAllStates,null),__privateAdd(this,_boundBlur,this.blur.bind(this)),__privateAdd(this,_boundFocus,this.focus.bind(this)),__privateAdd(this,_boundCopy,this.copy.bind(this)),__privateAdd(this,_boundCut,this.cut.bind(this)),__privateAdd(this,_boundPaste,this.paste.bind(this)),__privateAdd(this,_boundKeydown,this.keydown.bind(this)),__privateAdd(this,_boundKeyup,this.keyup.bind(this)),__privateAdd(this,_boundOnEditingAction,this.onEditingAction.bind(this)),__privateAdd(this,_boundOnPageChanging,this.onPageChanging.bind(this)),__privateAdd(this,_boundOnScaleChanging,this.onScaleChanging.bind(this)),__privateAdd(this,_boundOnRotationChanging,this.onRotationChanging.bind(this)),__privateAdd(this,_previousStates,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),__privateAdd(this,_translation,[0,0]),__privateAdd(this,_translationTimeoutId,null),__privateAdd(this,_container,null),__privateAdd(this,_viewer,null),this._signal=__privateGet(this,_abortController).signal,__privateSet(this,_container,container),__privateSet(this,_viewer,viewer),__privateSet(this,_altTextManager,altTextManager),this._eventBus=eventBus,this._eventBus._on("editingaction",__privateGet(this,_boundOnEditingAction)),this._eventBus._on("pagechanging",__privateGet(this,_boundOnPageChanging)),this._eventBus._on("scalechanging",__privateGet(this,_boundOnScaleChanging)),this._eventBus._on("rotationchanging",__privateGet(this,_boundOnRotationChanging)),__privateMethod(this,_AnnotationEditorUIManager_instances,addSelectionListener_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,addDragAndDropListeners_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,addKeyboardManager_fn).call(this),__privateSet(this,_annotationStorage,pdfDocument.annotationStorage),__privateSet(this,_filterFactory,pdfDocument.filterFactory),__privateSet(this,_pageColors,pageColors),__privateSet(this,_highlightColors,highlightColors||null),__privateSet(this,_enableHighlightFloatingButton,enableHighlightFloatingButton),__privateSet(this,_enableUpdatedAddImage,enableUpdatedAddImage),__privateSet(this,_mlManager,mlManager||null),this.viewParameters={realScale:PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}static get _keyboardManager(){const proto=_AnnotationEditorUIManager2.prototype,arrowChecker=__name2(self2=>__privateGet(self2,_container).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&self2.hasSomethingToControl(),"arrowChecker"),textInputChecker=__name2((_self,{target:el})=>{if(el instanceof HTMLInputElement){const{type}=el;return type!=="text"&&type!=="number"}return!0},"textInputChecker"),small=this.TRANSLATE_SMALL,big=this.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+a","mac+meta+a"],proto.selectAll,{checker:textInputChecker}],[["ctrl+z","mac+meta+z"],proto.undo,{checker:textInputChecker}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],proto.redo,{checker:textInputChecker}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],proto.delete,{checker:textInputChecker}],[["Enter","mac+Enter"],proto.addNewEditorFromKeyboard,{checker:__name2((self2,{target:el})=>!(el instanceof HTMLButtonElement)&&__privateGet(self2,_container).contains(el)&&!self2.isEnterHandled,"checker")}],[[" ","mac+ "],proto.addNewEditorFromKeyboard,{checker:__name2((self2,{target:el})=>!(el instanceof HTMLButtonElement)&&__privateGet(self2,_container).contains(document.activeElement),"checker")}],[["Escape","mac+Escape"],proto.unselectAll],[["ArrowLeft","mac+ArrowLeft"],proto.translateSelectedEditors,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto.translateSelectedEditors,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto.translateSelectedEditors,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto.translateSelectedEditors,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto.translateSelectedEditors,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto.translateSelectedEditors,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto.translateSelectedEditors,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto.translateSelectedEditors,{args:[0,big],checker:arrowChecker}]]))}destroy(){var _a2,_b2,_c;(_a2=__privateGet(this,_abortController))==null||_a2.abort(),__privateSet(this,_abortController,null),this._signal=null,this._eventBus._off("editingaction",__privateGet(this,_boundOnEditingAction)),this._eventBus._off("pagechanging",__privateGet(this,_boundOnPageChanging)),this._eventBus._off("scalechanging",__privateGet(this,_boundOnScaleChanging)),this._eventBus._off("rotationchanging",__privateGet(this,_boundOnRotationChanging));for(const layer of __privateGet(this,_allLayers).values())layer.destroy();__privateGet(this,_allLayers).clear(),__privateGet(this,_allEditors).clear(),__privateGet(this,_editorsToRescale).clear(),__privateSet(this,_activeEditor,null),__privateGet(this,_selectedEditors).clear(),__privateGet(this,_commandManager).destroy(),(_b2=__privateGet(this,_altTextManager))==null||_b2.destroy(),(_c=__privateGet(this,_highlightToolbar))==null||_c.hide(),__privateSet(this,_highlightToolbar,null),__privateGet(this,_focusMainContainerTimeoutId)&&(clearTimeout(__privateGet(this,_focusMainContainerTimeoutId)),__privateSet(this,_focusMainContainerTimeoutId,null)),__privateGet(this,_translationTimeoutId)&&(clearTimeout(__privateGet(this,_translationTimeoutId)),__privateSet(this,_translationTimeoutId,null))}async mlGuess(data){var _a2;return((_a2=__privateGet(this,_mlManager))==null?void 0:_a2.guess(data))||null}async isMLEnabledFor(name){var _a2;return!!await((_a2=__privateGet(this,_mlManager))==null?void 0:_a2.isEnabledFor(name))}get useNewAltTextFlow(){return __privateGet(this,_enableUpdatedAddImage)}get hcmFilter(){return shadow(this,"hcmFilter",__privateGet(this,_pageColors)?__privateGet(this,_filterFactory).addHCMFilter(__privateGet(this,_pageColors).foreground,__privateGet(this,_pageColors).background):"none")}get direction(){return shadow(this,"direction",getComputedStyle(__privateGet(this,_container)).direction)}get highlightColors(){return shadow(this,"highlightColors",__privateGet(this,_highlightColors)?new Map(__privateGet(this,_highlightColors).split(",").map(pair=>pair.split("=").map(x=>x.trim()))):null)}get highlightColorNames(){return shadow(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setMainHighlightColorPicker(colorPicker){__privateSet(this,_mainHighlightColorPicker,colorPicker)}editAltText(editor){var _a2;(_a2=__privateGet(this,_altTextManager))==null||_a2.editAltText(this,editor)}switchToMode(mode,callback){this._eventBus.on("annotationeditormodechanged",callback,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode})}setPreference(name,value){this._eventBus.dispatch("setpreference",{source:this,name,value})}onPageChanging({pageNumber}){__privateSet(this,_currentPageIndex,pageNumber-1)}focusMainContainer(){__privateGet(this,_container).focus()}findParent(x,y){for(const layer of __privateGet(this,_allLayers).values()){const{x:layerX,y:layerY,width,height}=layer.div.getBoundingClientRect();if(x>=layerX&&x<=layerX+width&&y>=layerY&&y<=layerY+height)return layer}return null}disableUserSelect(value=!1){__privateGet(this,_viewer).classList.toggle("noUserSelect",value)}addShouldRescale(editor){__privateGet(this,_editorsToRescale).add(editor)}removeShouldRescale(editor){__privateGet(this,_editorsToRescale).delete(editor)}onScaleChanging({scale}){this.commitOrRemove(),this.viewParameters.realScale=scale*PixelsPerInch.PDF_TO_CSS_UNITS;for(const editor of __privateGet(this,_editorsToRescale))editor.onScaleChanging()}onRotationChanging({pagesRotation}){this.commitOrRemove(),this.viewParameters.rotation=pagesRotation}highlightSelection(methodOfCreation=""){const selection=document.getSelection();if(!selection||selection.isCollapsed)return;const{anchorNode,anchorOffset,focusNode,focusOffset}=selection,text=selection.toString(),textLayer=__privateMethod(this,_AnnotationEditorUIManager_instances,getAnchorElementForSelection_fn).call(this,selection).closest(".textLayer"),boxes=this.getSelectionBoxes(textLayer);if(!boxes)return;selection.empty();const layer=__privateMethod(this,_AnnotationEditorUIManager_instances,getLayerForTextLayer_fn).call(this,textLayer),isNoneMode=__privateGet(this,_mode)===AnnotationEditorType.NONE,callback=__name2(()=>{layer?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation,boxes,anchorNode,anchorOffset,focusNode,focusOffset,text}),isNoneMode&&this.showAllEditors("highlight",!0,!0)},"callback");if(isNoneMode){this.switchToMode(AnnotationEditorType.HIGHLIGHT,callback);return}callback()}addToAnnotationStorage(editor){!editor.isEmpty()&&__privateGet(this,_annotationStorage)&&!__privateGet(this,_annotationStorage).has(editor.id)&&__privateGet(this,_annotationStorage).setValue(editor.id,editor)}blur(){if(this.isShiftKeyDown=!1,__privateGet(this,_highlightWhenShiftUp)&&(__privateSet(this,_highlightWhenShiftUp,!1),__privateMethod(this,_AnnotationEditorUIManager_instances,onSelectEnd_fn).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement}=document;for(const editor of __privateGet(this,_selectedEditors))if(editor.div.contains(activeElement)){__privateSet(this,_lastActiveElement,[editor,activeElement]),editor._focusEventsAllowed=!1;break}}focus(){if(!__privateGet(this,_lastActiveElement))return;const[lastEditor,lastActiveElement]=__privateGet(this,_lastActiveElement);__privateSet(this,_lastActiveElement,null),lastActiveElement.addEventListener("focusin",()=>{lastEditor._focusEventsAllowed=!0},{once:!0,signal:this._signal}),lastActiveElement.focus()}addEditListeners(){__privateMethod(this,_AnnotationEditorUIManager_instances,addKeyboardManager_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,addCopyPasteListeners_fn).call(this)}removeEditListeners(){__privateMethod(this,_AnnotationEditorUIManager_instances,removeKeyboardManager_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,removeCopyPasteListeners_fn).call(this)}dragOver(event){for(const{type}of event.dataTransfer.items)for(const editorType of __privateGet(this,_editorTypes))if(editorType.isHandlingMimeForPasting(type)){event.dataTransfer.dropEffect="copy",event.preventDefault();return}}drop(event){for(const item of event.dataTransfer.items)for(const editorType of __privateGet(this,_editorTypes))if(editorType.isHandlingMimeForPasting(item.type)){editorType.paste(item,this.currentLayer),event.preventDefault();return}}copy(event){var _a2;if(event.preventDefault(),(_a2=__privateGet(this,_activeEditor))==null||_a2.commitOrRemove(),!this.hasSelection)return;const editors=[];for(const editor of __privateGet(this,_selectedEditors)){const serialized=editor.serialize(!0);serialized&&editors.push(serialized)}editors.length!==0&&event.clipboardData.setData("application/pdfjs",JSON.stringify(editors))}cut(event){this.copy(event),this.delete()}paste(event){event.preventDefault();const{clipboardData}=event;for(const item of clipboardData.items)for(const editorType of __privateGet(this,_editorTypes))if(editorType.isHandlingMimeForPasting(item.type)){editorType.paste(item,this.currentLayer);return}let data=clipboardData.getData("application/pdfjs");if(!data)return;try{data=JSON.parse(data)}catch(ex){warn(`paste: "${ex.message}".`);return}if(!Array.isArray(data))return;this.unselectAll();const layer=this.currentLayer;try{const newEditors=[];for(const editor of data){const deserializedEditor=layer.deserialize(editor);if(!deserializedEditor)return;newEditors.push(deserializedEditor)}const cmd=__name2(()=>{for(const editor of newEditors)__privateMethod(this,_AnnotationEditorUIManager_instances,addEditorToLayer_fn).call(this,editor);__privateMethod(this,_AnnotationEditorUIManager_instances,selectEditors_fn).call(this,newEditors)},"cmd"),undo=__name2(()=>{for(const editor of newEditors)editor.remove()},"undo");this.addCommands({cmd,undo,mustExec:!0})}catch(ex){warn(`paste: "${ex.message}".`)}}keydown(event){!this.isShiftKeyDown&&event.key==="Shift"&&(this.isShiftKeyDown=!0),__privateGet(this,_mode)!==AnnotationEditorType.NONE&&!this.isEditorHandlingKeyboard&&_AnnotationEditorUIManager2._keyboardManager.exec(this,event)}keyup(event){this.isShiftKeyDown&&event.key==="Shift"&&(this.isShiftKeyDown=!1,__privateGet(this,_highlightWhenShiftUp)&&(__privateSet(this,_highlightWhenShiftUp,!1),__privateMethod(this,_AnnotationEditorUIManager_instances,onSelectEnd_fn).call(this,"main_toolbar")))}onEditingAction({name}){switch(name){case"undo":case"redo":case"delete":case"selectAll":this[name]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(isEditing){isEditing?(__privateMethod(this,_AnnotationEditorUIManager_instances,addFocusManager_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,addCopyPasteListeners_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{isEditing:__privateGet(this,_mode)!==AnnotationEditorType.NONE,isEmpty:__privateMethod(this,_AnnotationEditorUIManager_instances,isEmpty_fn).call(this),hasSomethingToUndo:__privateGet(this,_commandManager).hasSomethingToUndo(),hasSomethingToRedo:__privateGet(this,_commandManager).hasSomethingToRedo(),hasSelectedEditor:!1})):(__privateMethod(this,_AnnotationEditorUIManager_instances,removeFocusManager_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,removeCopyPasteListeners_fn).call(this),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(types){if(!__privateGet(this,_editorTypes)){__privateSet(this,_editorTypes,types);for(const editorType of __privateGet(this,_editorTypes))__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,editorType.defaultPropertiesToUpdate)}}getId(){return __privateGet(this,_idManager).id}get currentLayer(){return __privateGet(this,_allLayers).get(__privateGet(this,_currentPageIndex))}getLayer(pageIndex){return __privateGet(this,_allLayers).get(pageIndex)}get currentPageIndex(){return __privateGet(this,_currentPageIndex)}addLayer(layer){__privateGet(this,_allLayers).set(layer.pageIndex,layer),__privateGet(this,_isEnabled)?layer.enable():layer.disable()}removeLayer(layer){__privateGet(this,_allLayers).delete(layer.pageIndex)}updateMode(mode,editId=null,isFromKeyboard=!1){if(__privateGet(this,_mode)!==mode){if(__privateSet(this,_mode,mode),mode===AnnotationEditorType.NONE){this.setEditingState(!1),__privateMethod(this,_AnnotationEditorUIManager_instances,disableAll_fn).call(this);return}this.setEditingState(!0),__privateMethod(this,_AnnotationEditorUIManager_instances,enableAll_fn).call(this),this.unselectAll();for(const layer of __privateGet(this,_allLayers).values())layer.updateMode(mode);if(!editId&&isFromKeyboard){this.addNewEditorFromKeyboard();return}if(editId){for(const editor of __privateGet(this,_allEditors).values())if(editor.annotationElementId===editId){this.setSelected(editor),editor.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(mode){mode!==__privateGet(this,_mode)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode})}updateParams(type,value){var _a2;if(__privateGet(this,_editorTypes)){switch(type){case AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:(_a2=__privateGet(this,_mainHighlightColorPicker))==null||_a2.updateColor(value);break;case AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(__privateGet(this,_showAllStates)||__privateSet(this,_showAllStates,new Map)).set(type,value),this.showAllEditors("highlight",value);break}for(const editor of __privateGet(this,_selectedEditors))editor.updateParams(type,value);for(const editorType of __privateGet(this,_editorTypes))editorType.updateDefaultParams(type,value)}}showAllEditors(type,visible,updateButton=!1){var _a2;for(const editor of __privateGet(this,_allEditors).values())editor.editorType===type&&editor.show(visible);(((_a2=__privateGet(this,_showAllStates))==null?void 0:_a2.get(AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL))??!0)!==visible&&__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,[[AnnotationEditorParamsType.HIGHLIGHT_SHOW_ALL,visible]])}enableWaiting(mustWait=!1){if(__privateGet(this,_isWaiting)!==mustWait){__privateSet(this,_isWaiting,mustWait);for(const layer of __privateGet(this,_allLayers).values())mustWait?layer.disableClick():layer.enableClick(),layer.div.classList.toggle("waiting",mustWait)}}getEditors(pageIndex){const editors=[];for(const editor of __privateGet(this,_allEditors).values())editor.pageIndex===pageIndex&&editors.push(editor);return editors}getEditor(id){return __privateGet(this,_allEditors).get(id)}addEditor(editor){__privateGet(this,_allEditors).set(editor.id,editor)}removeEditor(editor){var _a2;editor.div.contains(document.activeElement)&&(__privateGet(this,_focusMainContainerTimeoutId)&&clearTimeout(__privateGet(this,_focusMainContainerTimeoutId)),__privateSet(this,_focusMainContainerTimeoutId,setTimeout(()=>{this.focusMainContainer(),__privateSet(this,_focusMainContainerTimeoutId,null)},0))),__privateGet(this,_allEditors).delete(editor.id),this.unselect(editor),(!editor.annotationElementId||!__privateGet(this,_deletedAnnotationsElementIds).has(editor.annotationElementId))&&((_a2=__privateGet(this,_annotationStorage))==null||_a2.remove(editor.id))}addDeletedAnnotationElement(editor){__privateGet(this,_deletedAnnotationsElementIds).add(editor.annotationElementId),this.addChangedExistingAnnotation(editor),editor.deleted=!0}isDeletedAnnotationElement(annotationElementId){return __privateGet(this,_deletedAnnotationsElementIds).has(annotationElementId)}removeDeletedAnnotationElement(editor){__privateGet(this,_deletedAnnotationsElementIds).delete(editor.annotationElementId),this.removeChangedExistingAnnotation(editor),editor.deleted=!1}setActiveEditor(editor){__privateGet(this,_activeEditor)!==editor&&(__privateSet(this,_activeEditor,editor),editor&&__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,editor.propertiesToUpdate))}updateUI(editor){__privateGet(this,_AnnotationEditorUIManager_instances,lastSelectedEditor_get)===editor&&__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,editor.propertiesToUpdate)}toggleSelected(editor){if(__privateGet(this,_selectedEditors).has(editor)){__privateGet(this,_selectedEditors).delete(editor),editor.unselect(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:this.hasSelection});return}__privateGet(this,_selectedEditors).add(editor),editor.select(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,editor.propertiesToUpdate),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:!0})}setSelected(editor){for(const ed of __privateGet(this,_selectedEditors))ed!==editor&&ed.unselect();__privateGet(this,_selectedEditors).clear(),__privateGet(this,_selectedEditors).add(editor),editor.select(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,editor.propertiesToUpdate),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:!0})}isSelected(editor){return __privateGet(this,_selectedEditors).has(editor)}get firstSelectedEditor(){return __privateGet(this,_selectedEditors).values().next().value}unselect(editor){editor.unselect(),__privateGet(this,_selectedEditors).delete(editor),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return __privateGet(this,_selectedEditors).size!==0}get isEnterHandled(){return __privateGet(this,_selectedEditors).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){__privateGet(this,_commandManager).undo(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSomethingToUndo:__privateGet(this,_commandManager).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:__privateMethod(this,_AnnotationEditorUIManager_instances,isEmpty_fn).call(this)})}redo(){__privateGet(this,_commandManager).redo(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:__privateGet(this,_commandManager).hasSomethingToRedo(),isEmpty:__privateMethod(this,_AnnotationEditorUIManager_instances,isEmpty_fn).call(this)})}addCommands(params){__privateGet(this,_commandManager).add(params),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:__privateMethod(this,_AnnotationEditorUIManager_instances,isEmpty_fn).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const editors=[...__privateGet(this,_selectedEditors)],cmd=__name2(()=>{for(const editor of editors)editor.remove()},"cmd"),undo=__name2(()=>{for(const editor of editors)__privateMethod(this,_AnnotationEditorUIManager_instances,addEditorToLayer_fn).call(this,editor)},"undo");this.addCommands({cmd,undo,mustExec:!0})}commitOrRemove(){var _a2;(_a2=__privateGet(this,_activeEditor))==null||_a2.commitOrRemove()}hasSomethingToControl(){return __privateGet(this,_activeEditor)||this.hasSelection}selectAll(){for(const editor of __privateGet(this,_selectedEditors))editor.commit();__privateMethod(this,_AnnotationEditorUIManager_instances,selectEditors_fn).call(this,__privateGet(this,_allEditors).values())}unselectAll(){if(!(__privateGet(this,_activeEditor)&&(__privateGet(this,_activeEditor).commitOrRemove(),__privateGet(this,_mode)!==AnnotationEditorType.NONE))&&this.hasSelection){for(const editor of __privateGet(this,_selectedEditors))editor.unselect();__privateGet(this,_selectedEditors).clear(),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(x,y,noCommit=!1){if(noCommit||this.commitOrRemove(),!this.hasSelection)return;__privateGet(this,_translation)[0]+=x,__privateGet(this,_translation)[1]+=y;const[totalX,totalY]=__privateGet(this,_translation),editors=[...__privateGet(this,_selectedEditors)],TIME_TO_WAIT=1e3;__privateGet(this,_translationTimeoutId)&&clearTimeout(__privateGet(this,_translationTimeoutId)),__privateSet(this,_translationTimeoutId,setTimeout(()=>{__privateSet(this,_translationTimeoutId,null),__privateGet(this,_translation)[0]=__privateGet(this,_translation)[1]=0,this.addCommands({cmd:__name2(()=>{for(const editor of editors)__privateGet(this,_allEditors).has(editor.id)&&editor.translateInPage(totalX,totalY)},"cmd"),undo:__name2(()=>{for(const editor of editors)__privateGet(this,_allEditors).has(editor.id)&&editor.translateInPage(-totalX,-totalY)},"undo"),mustExec:!1})},TIME_TO_WAIT));for(const editor of editors)editor.translateInPage(x,y)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),__privateSet(this,_draggingEditors,new Map);for(const editor of __privateGet(this,_selectedEditors))__privateGet(this,_draggingEditors).set(editor,{savedX:editor.x,savedY:editor.y,savedPageIndex:editor.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!__privateGet(this,_draggingEditors))return!1;this.disableUserSelect(!1);const map=__privateGet(this,_draggingEditors);__privateSet(this,_draggingEditors,null);let mustBeAddedInUndoStack=!1;for(const[{x,y,pageIndex},value]of map)value.newX=x,value.newY=y,value.newPageIndex=pageIndex,mustBeAddedInUndoStack||(mustBeAddedInUndoStack=x!==value.savedX||y!==value.savedY||pageIndex!==value.savedPageIndex);if(!mustBeAddedInUndoStack)return!1;const move=__name2((editor,x,y,pageIndex)=>{if(__privateGet(this,_allEditors).has(editor.id)){const parent=__privateGet(this,_allLayers).get(pageIndex);parent?editor._setParentAndPosition(parent,x,y):(editor.pageIndex=pageIndex,editor.x=x,editor.y=y)}},"move");return this.addCommands({cmd:__name2(()=>{for(const[editor,{newX,newY,newPageIndex}]of map)move(editor,newX,newY,newPageIndex)},"cmd"),undo:__name2(()=>{for(const[editor,{savedX,savedY,savedPageIndex}]of map)move(editor,savedX,savedY,savedPageIndex)},"undo"),mustExec:!0}),!0}dragSelectedEditors(tx,ty){if(__privateGet(this,_draggingEditors))for(const editor of __privateGet(this,_draggingEditors).keys())editor.drag(tx,ty)}rebuild(editor){if(editor.parent===null){const parent=this.getLayer(editor.pageIndex);parent?(parent.changeParent(editor),parent.addOrRebuild(editor)):(this.addEditor(editor),this.addToAnnotationStorage(editor),editor.rebuild())}else editor.parent.addOrRebuild(editor)}get isEditorHandlingKeyboard(){var _a2;return((_a2=this.getActive())==null?void 0:_a2.shouldGetKeyboardEvents())||__privateGet(this,_selectedEditors).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(editor){return __privateGet(this,_activeEditor)===editor}getActive(){return __privateGet(this,_activeEditor)}getMode(){return __privateGet(this,_mode)}get imageManager(){return shadow(this,"imageManager",new ImageManager)}getSelectionBoxes(textLayer){if(!textLayer)return null;const selection=document.getSelection();for(let i=0,ii=selection.rangeCount;i<ii;i++)if(!textLayer.contains(selection.getRangeAt(i).commonAncestorContainer))return null;const{x:layerX,y:layerY,width:parentWidth,height:parentHeight}=textLayer.getBoundingClientRect();let rotator;switch(textLayer.getAttribute("data-main-rotation")){case"90":rotator=__name2((x,y,w,h)=>({x:(y-layerY)/parentHeight,y:1-(x+w-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth}),"rotator");break;case"180":rotator=__name2((x,y,w,h)=>({x:1-(x+w-layerX)/parentWidth,y:1-(y+h-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight}),"rotator");break;case"270":rotator=__name2((x,y,w,h)=>({x:1-(y+h-layerY)/parentHeight,y:(x-layerX)/parentWidth,width:h/parentHeight,height:w/parentWidth}),"rotator");break;default:rotator=__name2((x,y,w,h)=>({x:(x-layerX)/parentWidth,y:(y-layerY)/parentHeight,width:w/parentWidth,height:h/parentHeight}),"rotator");break}const boxes=[];for(let i=0,ii=selection.rangeCount;i<ii;i++){const range=selection.getRangeAt(i);if(!range.collapsed)for(const{x,y,width,height}of range.getClientRects())width===0||height===0||boxes.push(rotator(x,y,width,height))}return boxes.length===0?null:boxes}addChangedExistingAnnotation({annotationElementId,id}){(__privateGet(this,_changedExistingAnnotations)||__privateSet(this,_changedExistingAnnotations,new Map)).set(annotationElementId,id)}removeChangedExistingAnnotation({annotationElementId}){var _a2;(_a2=__privateGet(this,_changedExistingAnnotations))==null||_a2.delete(annotationElementId)}renderAnnotationElement(annotation){var _a2;const editorId=(_a2=__privateGet(this,_changedExistingAnnotations))==null?void 0:_a2.get(annotation.data.id);if(!editorId)return;const editor=__privateGet(this,_annotationStorage).getRawValue(editorId);editor&&(__privateGet(this,_mode)===AnnotationEditorType.NONE&&!editor.hasBeenModified||editor.renderAnnotationElement(annotation))}};_abortController=new WeakMap,_activeEditor=new WeakMap,_allEditors=new WeakMap,_allLayers=new WeakMap,_altTextManager=new WeakMap,_annotationStorage=new WeakMap,_changedExistingAnnotations=new WeakMap,_commandManager=new WeakMap,_currentPageIndex=new WeakMap,_deletedAnnotationsElementIds=new WeakMap,_draggingEditors=new WeakMap,_editorTypes=new WeakMap,_editorsToRescale=new WeakMap,_enableHighlightFloatingButton=new WeakMap,_enableUpdatedAddImage=new WeakMap,_filterFactory=new WeakMap,_focusMainContainerTimeoutId=new WeakMap,_highlightColors=new WeakMap,_highlightWhenShiftUp=new WeakMap,_highlightToolbar=new WeakMap,_idManager=new WeakMap,_isEnabled=new WeakMap,_isWaiting=new WeakMap,_lastActiveElement=new WeakMap,_mainHighlightColorPicker=new WeakMap,_mlManager=new WeakMap,_mode=new WeakMap,_selectedEditors=new WeakMap,_selectedTextNode=new WeakMap,_pageColors=new WeakMap,_showAllStates=new WeakMap,_boundBlur=new WeakMap,_boundFocus=new WeakMap,_boundCopy=new WeakMap,_boundCut=new WeakMap,_boundPaste=new WeakMap,_boundKeydown=new WeakMap,_boundKeyup=new WeakMap,_boundOnEditingAction=new WeakMap,_boundOnPageChanging=new WeakMap,_boundOnScaleChanging=new WeakMap,_boundOnRotationChanging=new WeakMap,_previousStates=new WeakMap,_translation=new WeakMap,_translationTimeoutId=new WeakMap,_container=new WeakMap,_viewer=new WeakMap,_AnnotationEditorUIManager_instances=new WeakSet,getAnchorElementForSelection_fn=__name2(function({anchorNode}){return anchorNode.nodeType===Node.TEXT_NODE?anchorNode.parentElement:anchorNode},"#getAnchorElementForSelection"),getLayerForTextLayer_fn=__name2(function(textLayer){const{currentLayer}=this;if(currentLayer.hasTextLayer(textLayer))return currentLayer;for(const layer of __privateGet(this,_allLayers).values())if(layer.hasTextLayer(textLayer))return layer;return null},"#getLayerForTextLayer"),displayHighlightToolbar_fn=__name2(function(){const selection=document.getSelection();if(!selection||selection.isCollapsed)return;const textLayer=__privateMethod(this,_AnnotationEditorUIManager_instances,getAnchorElementForSelection_fn).call(this,selection).closest(".textLayer"),boxes=this.getSelectionBoxes(textLayer);boxes&&(__privateGet(this,_highlightToolbar)||__privateSet(this,_highlightToolbar,new HighlightToolbar(this)),__privateGet(this,_highlightToolbar).show(textLayer,boxes,this.direction==="ltr"))},"#displayHighlightToolbar"),selectionChange_fn=__name2(function(){var _a2,_b2,_c;const selection=document.getSelection();if(!selection||selection.isCollapsed){__privateGet(this,_selectedTextNode)&&((_a2=__privateGet(this,_highlightToolbar))==null||_a2.hide(),__privateSet(this,_selectedTextNode,null),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedText:!1}));return}const{anchorNode}=selection;if(anchorNode===__privateGet(this,_selectedTextNode))return;const textLayer=__privateMethod(this,_AnnotationEditorUIManager_instances,getAnchorElementForSelection_fn).call(this,selection).closest(".textLayer");if(!textLayer){__privateGet(this,_selectedTextNode)&&((_b2=__privateGet(this,_highlightToolbar))==null||_b2.hide(),__privateSet(this,_selectedTextNode,null),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedText:!1}));return}if((_c=__privateGet(this,_highlightToolbar))==null||_c.hide(),__privateSet(this,_selectedTextNode,anchorNode),__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedText:!0}),!(__privateGet(this,_mode)!==AnnotationEditorType.HIGHLIGHT&&__privateGet(this,_mode)!==AnnotationEditorType.NONE)&&(__privateGet(this,_mode)===AnnotationEditorType.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),__privateSet(this,_highlightWhenShiftUp,this.isShiftKeyDown),!this.isShiftKeyDown)){const activeLayer=__privateGet(this,_mode)===AnnotationEditorType.HIGHLIGHT?__privateMethod(this,_AnnotationEditorUIManager_instances,getLayerForTextLayer_fn).call(this,textLayer):null;activeLayer?.toggleDrawing();const signal=this._signal,pointerup=__name2(e=>{e.type==="pointerup"&&e.button!==0||(activeLayer?.toggleDrawing(!0),window.removeEventListener("pointerup",pointerup),window.removeEventListener("blur",pointerup),e.type==="pointerup"&&__privateMethod(this,_AnnotationEditorUIManager_instances,onSelectEnd_fn).call(this,"main_toolbar"))},"pointerup");window.addEventListener("pointerup",pointerup,{signal}),window.addEventListener("blur",pointerup,{signal})}},"#selectionChange"),onSelectEnd_fn=__name2(function(methodOfCreation=""){__privateGet(this,_mode)===AnnotationEditorType.HIGHLIGHT?this.highlightSelection(methodOfCreation):__privateGet(this,_enableHighlightFloatingButton)&&__privateMethod(this,_AnnotationEditorUIManager_instances,displayHighlightToolbar_fn).call(this)},"#onSelectEnd"),addSelectionListener_fn=__name2(function(){document.addEventListener("selectionchange",__privateMethod(this,_AnnotationEditorUIManager_instances,selectionChange_fn).bind(this),{signal:this._signal})},"#addSelectionListener"),addFocusManager_fn=__name2(function(){const signal=this._signal;window.addEventListener("focus",__privateGet(this,_boundFocus),{signal}),window.addEventListener("blur",__privateGet(this,_boundBlur),{signal})},"#addFocusManager"),removeFocusManager_fn=__name2(function(){window.removeEventListener("focus",__privateGet(this,_boundFocus)),window.removeEventListener("blur",__privateGet(this,_boundBlur))},"#removeFocusManager"),addKeyboardManager_fn=__name2(function(){const signal=this._signal;window.addEventListener("keydown",__privateGet(this,_boundKeydown),{signal}),window.addEventListener("keyup",__privateGet(this,_boundKeyup),{signal})},"#addKeyboardManager"),removeKeyboardManager_fn=__name2(function(){window.removeEventListener("keydown",__privateGet(this,_boundKeydown)),window.removeEventListener("keyup",__privateGet(this,_boundKeyup))},"#removeKeyboardManager"),addCopyPasteListeners_fn=__name2(function(){const signal=this._signal;document.addEventListener("copy",__privateGet(this,_boundCopy),{signal}),document.addEventListener("cut",__privateGet(this,_boundCut),{signal}),document.addEventListener("paste",__privateGet(this,_boundPaste),{signal})},"#addCopyPasteListeners"),removeCopyPasteListeners_fn=__name2(function(){document.removeEventListener("copy",__privateGet(this,_boundCopy)),document.removeEventListener("cut",__privateGet(this,_boundCut)),document.removeEventListener("paste",__privateGet(this,_boundPaste))},"#removeCopyPasteListeners"),addDragAndDropListeners_fn=__name2(function(){const signal=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal}),document.addEventListener("drop",this.drop.bind(this),{signal})},"#addDragAndDropListeners"),dispatchUpdateStates_fn=__name2(function(details){Object.entries(details).some(([key,value])=>__privateGet(this,_previousStates)[key]!==value)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(__privateGet(this,_previousStates),details)}),__privateGet(this,_mode)===AnnotationEditorType.HIGHLIGHT&&details.hasSelectedEditor===!1&&__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateUI_fn).call(this,[[AnnotationEditorParamsType.HIGHLIGHT_FREE,!0]]))},"#dispatchUpdateStates"),dispatchUpdateUI_fn=__name2(function(details){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details})},"#dispatchUpdateUI"),enableAll_fn=__name2(function(){if(!__privateGet(this,_isEnabled)){__privateSet(this,_isEnabled,!0);for(const layer of __privateGet(this,_allLayers).values())layer.enable();for(const editor of __privateGet(this,_allEditors).values())editor.enable()}},"#enableAll"),disableAll_fn=__name2(function(){if(this.unselectAll(),__privateGet(this,_isEnabled)){__privateSet(this,_isEnabled,!1);for(const layer of __privateGet(this,_allLayers).values())layer.disable();for(const editor of __privateGet(this,_allEditors).values())editor.disable()}},"#disableAll"),addEditorToLayer_fn=__name2(function(editor){const layer=__privateGet(this,_allLayers).get(editor.pageIndex);layer?layer.addOrRebuild(editor):(this.addEditor(editor),this.addToAnnotationStorage(editor))},"#addEditorToLayer"),lastSelectedEditor_get=__name2(function(){let ed=null;for(ed of __privateGet(this,_selectedEditors));return ed},"#lastSelectedEditor"),isEmpty_fn=__name2(function(){if(__privateGet(this,_allEditors).size===0)return!0;if(__privateGet(this,_allEditors).size===1)for(const editor of __privateGet(this,_allEditors).values())return editor.isEmpty();return!1},"#isEmpty"),selectEditors_fn=__name2(function(editors){for(const editor of __privateGet(this,_selectedEditors))editor.unselect();__privateGet(this,_selectedEditors).clear();for(const editor of editors)editor.isEmpty()||(__privateGet(this,_selectedEditors).add(editor),editor.select());__privateMethod(this,_AnnotationEditorUIManager_instances,dispatchUpdateStates_fn).call(this,{hasSelectedEditor:this.hasSelection})},"#selectEditors"),__name2(_AnnotationEditorUIManager,"AnnotationEditorUIManager"),__publicField(_AnnotationEditorUIManager,"TRANSLATE_SMALL",1),__publicField(_AnnotationEditorUIManager,"TRANSLATE_BIG",10);let AnnotationEditorUIManager=_AnnotationEditorUIManager;const _AltText=class _AltText2{static{__name(this,"_AltText")}constructor(editor){__privateAdd(this,_AltText_instances),__privateAdd(this,_altText,""),__privateAdd(this,_altTextDecorative,!1),__privateAdd(this,_altTextButton,null),__privateAdd(this,_altTextTooltip,null),__privateAdd(this,_altTextTooltipTimeout,null),__privateAdd(this,_altTextWasFromKeyBoard,!1),__privateAdd(this,_editor2,null),__privateSet(this,_editor2,editor)}static initialize(l10nPromise){_AltText2._l10nPromise||(_AltText2._l10nPromise=l10nPromise)}async render(){const altText=__privateSet(this,_altTextButton,document.createElement("button"));altText.className="altText";const msg=await _AltText2._l10nPromise.get("pdfjs-editor-alt-text-button-label");altText.textContent=msg,altText.setAttribute("aria-label",msg),altText.tabIndex="0";const signal=__privateGet(this,_editor2)._uiManager._signal;altText.addEventListener("contextmenu",noContextMenu,{signal}),altText.addEventListener("pointerdown",event=>event.stopPropagation(),{signal});const onClick=__name2(event=>{event.preventDefault(),__privateGet(this,_editor2)._uiManager.editAltText(__privateGet(this,_editor2))},"onClick");return altText.addEventListener("click",onClick,{capture:!0,signal}),altText.addEventListener("keydown",event=>{event.target===altText&&event.key==="Enter"&&(__privateSet(this,_altTextWasFromKeyBoard,!0),onClick(event))},{signal}),await __privateMethod(this,_AltText_instances,setState_fn).call(this),altText}finish(){__privateGet(this,_altTextButton)&&(__privateGet(this,_altTextButton).focus({focusVisible:__privateGet(this,_altTextWasFromKeyBoard)}),__privateSet(this,_altTextWasFromKeyBoard,!1))}isEmpty(){return!__privateGet(this,_altText)&&!__privateGet(this,_altTextDecorative)}get data(){return{altText:__privateGet(this,_altText),decorative:__privateGet(this,_altTextDecorative)}}set data({altText,decorative}){__privateGet(this,_altText)===altText&&__privateGet(this,_altTextDecorative)===decorative||(__privateSet(this,_altText,altText),__privateSet(this,_altTextDecorative,decorative),__privateMethod(this,_AltText_instances,setState_fn).call(this))}toggle(enabled=!1){__privateGet(this,_altTextButton)&&(!enabled&&__privateGet(this,_altTextTooltipTimeout)&&(clearTimeout(__privateGet(this,_altTextTooltipTimeout)),__privateSet(this,_altTextTooltipTimeout,null)),__privateGet(this,_altTextButton).disabled=!enabled)}destroy(){var _a2;(_a2=__privateGet(this,_altTextButton))==null||_a2.remove(),__privateSet(this,_altTextButton,null),__privateSet(this,_altTextTooltip,null)}};_altText=new WeakMap,_altTextDecorative=new WeakMap,_altTextButton=new WeakMap,_altTextTooltip=new WeakMap,_altTextTooltipTimeout=new WeakMap,_altTextWasFromKeyBoard=new WeakMap,_editor2=new WeakMap,_AltText_instances=new WeakSet,setState_fn=__name2(async function(){var _a2;const button=__privateGet(this,_altTextButton);if(!button)return;if(!__privateGet(this,_altText)&&!__privateGet(this,_altTextDecorative)){button.classList.remove("done"),(_a2=__privateGet(this,_altTextTooltip))==null||_a2.remove();return}button.classList.add("done"),_AltText._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(msg=>{button.setAttribute("aria-label",msg)});let tooltip=__privateGet(this,_altTextTooltip);if(!tooltip){__privateSet(this,_altTextTooltip,tooltip=document.createElement("span")),tooltip.className="tooltip",tooltip.setAttribute("role","tooltip");const id=tooltip.id=`alt-text-tooltip-${__privateGet(this,_editor2).id}`;button.setAttribute("aria-describedby",id);const DELAY_TO_SHOW_TOOLTIP=100,signal=__privateGet(this,_editor2)._uiManager._signal;signal.addEventListener("abort",()=>{clearTimeout(__privateGet(this,_altTextTooltipTimeout)),__privateSet(this,_altTextTooltipTimeout,null)},{once:!0}),button.addEventListener("mouseenter",()=>{__privateSet(this,_altTextTooltipTimeout,setTimeout(()=>{__privateSet(this,_altTextTooltipTimeout,null),__privateGet(this,_altTextTooltip).classList.add("show"),__privateGet(this,_editor2)._reportTelemetry({action:"alt_text_tooltip"})},DELAY_TO_SHOW_TOOLTIP))},{signal}),button.addEventListener("mouseleave",()=>{var _a3;__privateGet(this,_altTextTooltipTimeout)&&(clearTimeout(__privateGet(this,_altTextTooltipTimeout)),__privateSet(this,_altTextTooltipTimeout,null)),(_a3=__privateGet(this,_altTextTooltip))==null||_a3.classList.remove("show")},{signal})}tooltip.innerText=__privateGet(this,_altTextDecorative)?await _AltText._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):__privateGet(this,_altText),tooltip.parentNode||button.append(tooltip);const element=__privateGet(this,_editor2).getImageForAltText();element?.setAttribute("aria-describedby",tooltip.id)},"#setState"),__name2(_AltText,"AltText"),__publicField(_AltText,"_l10nPromise",null);let AltText=_AltText;const _AnnotationEditor=class _AnnotationEditor2{static{__name(this,"_AnnotationEditor")}constructor(parameters){__privateAdd(this,_AnnotationEditor_instances),__privateAdd(this,_accessibilityData,null),__privateAdd(this,_allResizerDivs,null),__privateAdd(this,_altText2,null),__privateAdd(this,_disabled,!1),__privateAdd(this,_keepAspectRatio,!1),__privateAdd(this,_resizersDiv,null),__privateAdd(this,_savedDimensions,null),__privateAdd(this,_boundFocusin,this.focusin.bind(this)),__privateAdd(this,_boundFocusout,this.focusout.bind(this)),__privateAdd(this,_editToolbar,null),__privateAdd(this,_focusedResizerName,""),__privateAdd(this,_hasBeenClicked,!1),__privateAdd(this,_initialPosition,null),__privateAdd(this,_isEditing,!1),__privateAdd(this,_isInEditMode,!1),__privateAdd(this,_isResizerEnabledForKeyboard,!1),__privateAdd(this,_moveInDOMTimeout,null),__privateAdd(this,_prevDragX,0),__privateAdd(this,_prevDragY,0),__privateAdd(this,_telemetryTimeouts,null),__publicField(this,"_initialOptions",Object.create(null)),__publicField(this,"_isVisible",!0),__publicField(this,"_uiManager",null),__publicField(this,"_focusEventsAllowed",!0),__publicField(this,"_l10nPromise",null),__privateAdd(this,_isDraggable,!1),__privateAdd(this,_zIndex,_AnnotationEditor2._zIndex++),this.constructor===_AnnotationEditor2&&unreachable("Cannot initialize AnnotationEditor."),this.parent=parameters.parent,this.id=parameters.id,this.width=this.height=null,this.pageIndex=parameters.parent.pageIndex,this.name=parameters.name,this.div=null,this._uiManager=parameters.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=parameters.isCentered,this._structTreeParentId=null;const{rotation,rawDims:{pageWidth,pageHeight,pageX,pageY}}=this.parent.viewport;this.rotation=rotation,this.pageRotation=(360+rotation-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[pageWidth,pageHeight],this.pageTranslation=[pageX,pageY];const[width,height]=this.parentDimensions;this.x=parameters.x/width,this.y=parameters.y/height,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const resize=_AnnotationEditor2.prototype._resizeWithKeyboard,small=AnnotationEditorUIManager.TRANSLATE_SMALL,big=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_resizerKeyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],resize,{args:[-small,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],resize,{args:[-big,0]}],[["ArrowRight","mac+ArrowRight"],resize,{args:[small,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],resize,{args:[big,0]}],[["ArrowUp","mac+ArrowUp"],resize,{args:[0,-small]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],resize,{args:[0,-big]}],[["ArrowDown","mac+ArrowDown"],resize,{args:[0,small]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],resize,{args:[0,big]}],[["Escape","mac+Escape"],_AnnotationEditor2.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return shadow(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(editor){const fakeEditor=new FakeEditor({id:editor.parent.getNextId(),parent:editor.parent,uiManager:editor._uiManager});fakeEditor.annotationElementId=editor.annotationElementId,fakeEditor.deleted=!0,fakeEditor._uiManager.addToAnnotationStorage(fakeEditor)}static initialize(l10n,_uiManager4,options){if(_AnnotationEditor2._l10nPromise||(_AnnotationEditor2._l10nPromise=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(str=>[str,l10n.get(str.replaceAll(/([A-Z])/g,c=>`-${c.toLowerCase()}`))]))),options?.strings)for(const str of options.strings)_AnnotationEditor2._l10nPromise.set(str,l10n.get(str));if(_AnnotationEditor2._borderLineWidth!==-1)return;const style=getComputedStyle(document.documentElement);_AnnotationEditor2._borderLineWidth=parseFloat(style.getPropertyValue("--outline-width"))||0}static updateDefaultParams(_type2,_value){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(mime){return!1}static paste(item,parent){unreachable("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return __privateGet(this,_isDraggable)}set _isDraggable(value){var _a2;__privateSet(this,_isDraggable,value),(_a2=this.div)==null||_a2.classList.toggle("draggable",value)}get isEnterHandled(){return!0}center(){const[pageWidth,pageHeight]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*pageHeight/(pageWidth*2),this.y+=this.width*pageWidth/(pageHeight*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*pageHeight/(pageWidth*2),this.y-=this.width*pageWidth/(pageHeight*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(params){this._uiManager.addCommands(params)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=__privateGet(this,_zIndex)}setParent(parent){parent!==null?(this.pageIndex=parent.pageIndex,this.pageDimensions=parent.pageDimensions):__privateMethod(this,_AnnotationEditor_instances,stopResizing_fn).call(this),this.parent=parent}focusin(event){this._focusEventsAllowed&&(__privateGet(this,_hasBeenClicked)?__privateSet(this,_hasBeenClicked,!1):this.parent.setSelected(this))}focusout(event){var _a2;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const target=event.relatedTarget;target?.closest(`#${this.id}`)||(event.preventDefault(),(_a2=this.parent)!=null&&_a2.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(x,y,tx,ty){const[width,height]=this.parentDimensions;[tx,ty]=this.screenToPageTranslation(tx,ty),this.x=(x+tx)/width,this.y=(y+ty)/height,this.fixAndSetPosition()}translate(x,y){__privateMethod(this,_AnnotationEditor_instances,translate_fn).call(this,this.parentDimensions,x,y)}translateInPage(x,y){__privateGet(this,_initialPosition)||__privateSet(this,_initialPosition,[this.x,this.y]),__privateMethod(this,_AnnotationEditor_instances,translate_fn).call(this,this.pageDimensions,x,y),this.div.scrollIntoView({block:"nearest"})}drag(tx,ty){__privateGet(this,_initialPosition)||__privateSet(this,_initialPosition,[this.x,this.y]);const[parentWidth,parentHeight]=this.parentDimensions;if(this.x+=tx/parentWidth,this.y+=ty/parentHeight,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:x2,y:y2}=this.div.getBoundingClientRect();this.parent.findNewParent(this,x2,y2)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x,y}=this;const[bx,by]=this.getBaseTranslation();x+=bx,y+=by,this.div.style.left=`${(100*x).toFixed(2)}%`,this.div.style.top=`${(100*y).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!__privateGet(this,_initialPosition)&&(__privateGet(this,_initialPosition)[0]!==this.x||__privateGet(this,_initialPosition)[1]!==this.y)}getBaseTranslation(){const[parentWidth,parentHeight]=this.parentDimensions,{_borderLineWidth}=_AnnotationEditor2,x=_borderLineWidth/parentWidth,y=_borderLineWidth/parentHeight;switch(this.rotation){case 90:return[-x,y];case 180:return[x,y];case 270:return[x,-y];default:return[-x,-y]}}get _mustFixPosition(){return!0}fixAndSetPosition(rotation=this.rotation){const[pageWidth,pageHeight]=this.pageDimensions;let{x,y,width,height}=this;if(width*=pageWidth,height*=pageHeight,x*=pageWidth,y*=pageHeight,this._mustFixPosition)switch(rotation){case 0:x=Math.max(0,Math.min(pageWidth-width,x)),y=Math.max(0,Math.min(pageHeight-height,y));break;case 90:x=Math.max(0,Math.min(pageWidth-height,x)),y=Math.min(pageHeight,Math.max(width,y));break;case 180:x=Math.min(pageWidth,Math.max(width,x)),y=Math.min(pageHeight,Math.max(height,y));break;case 270:x=Math.min(pageWidth,Math.max(height,x)),y=Math.max(0,Math.min(pageHeight-width,y));break}this.x=x/=pageWidth,this.y=y/=pageHeight;const[bx,by]=this.getBaseTranslation();x+=bx,y+=by;const{style}=this.div;style.left=`${(100*x).toFixed(2)}%`,style.top=`${(100*y).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(x,y){var _a2;return __privateMethod(_a2=_AnnotationEditor2,_AnnotationEditor_static,rotatePoint_fn).call(_a2,x,y,this.parentRotation)}pageTranslationToScreen(x,y){var _a2;return __privateMethod(_a2=_AnnotationEditor2,_AnnotationEditor_static,rotatePoint_fn).call(_a2,x,y,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale,pageDimensions:[pageWidth,pageHeight]}=this,scaledWidth=pageWidth*parentScale,scaledHeight=pageHeight*parentScale;return util_FeatureTest.isCSSRoundSupported?[Math.round(scaledWidth),Math.round(scaledHeight)]:[scaledWidth,scaledHeight]}setDims(width,height){const[parentWidth,parentHeight]=this.parentDimensions;this.div.style.width=`${(100*width/parentWidth).toFixed(2)}%`,__privateGet(this,_keepAspectRatio)||(this.div.style.height=`${(100*height/parentHeight).toFixed(2)}%`)}fixDims(){const{style}=this.div,{height,width}=style,widthPercent=width.endsWith("%"),heightPercent=!__privateGet(this,_keepAspectRatio)&&height.endsWith("%");if(widthPercent&&heightPercent)return;const[parentWidth,parentHeight]=this.parentDimensions;widthPercent||(style.width=`${(100*parseFloat(width)/parentWidth).toFixed(2)}%`),!__privateGet(this,_keepAspectRatio)&&!heightPercent&&(style.height=`${(100*parseFloat(height)/parentHeight).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}altTextFinish(){var _a2;(_a2=__privateGet(this,_altText2))==null||_a2.finish()}async addEditToolbar(){return __privateGet(this,_editToolbar)||__privateGet(this,_isInEditMode)?__privateGet(this,_editToolbar):(__privateSet(this,_editToolbar,new EditorToolbar(this)),this.div.append(__privateGet(this,_editToolbar).render()),__privateGet(this,_altText2)&&__privateGet(this,_editToolbar).addAltTextButton(await __privateGet(this,_altText2).render()),__privateGet(this,_editToolbar))}removeEditToolbar(){var _a2;__privateGet(this,_editToolbar)&&(__privateGet(this,_editToolbar).remove(),__privateSet(this,_editToolbar,null),(_a2=__privateGet(this,_altText2))==null||_a2.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){__privateGet(this,_altText2)||(AltText.initialize(_AnnotationEditor2._l10nPromise),__privateSet(this,_altText2,new AltText(this)),__privateGet(this,_accessibilityData)&&(__privateGet(this,_altText2).data=__privateGet(this,_accessibilityData),__privateSet(this,_accessibilityData,null)),await this.addEditToolbar())}get altTextData(){var _a2;return(_a2=__privateGet(this,_altText2))==null?void 0:_a2.data}set altTextData(data){__privateGet(this,_altText2)&&(__privateGet(this,_altText2).data=data)}hasAltText(){var _a2;return!((_a2=__privateGet(this,_altText2))!=null&&_a2.isEmpty())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=__privateGet(this,_disabled)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground();const signal=this._uiManager._signal;this.div.addEventListener("focusin",__privateGet(this,_boundFocusin),{signal}),this.div.addEventListener("focusout",__privateGet(this,_boundFocusout),{signal});const[parentWidth,parentHeight]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*parentHeight/parentWidth).toFixed(2)}%`,this.div.style.maxHeight=`${(100*parentWidth/parentHeight).toFixed(2)}%`);const[tx,ty]=this.getInitialTranslation();return this.translate(tx,ty),bindEvents(this,this.div,["pointerdown"]),this.div}pointerdown(event){const{isMac}=util_FeatureTest.platform;if(event.button!==0||event.ctrlKey&&isMac){event.preventDefault();return}if(__privateSet(this,_hasBeenClicked,!0),this._isDraggable){__privateMethod(this,_AnnotationEditor_instances,setUpDragSession_fn).call(this,event);return}__privateMethod(this,_AnnotationEditor_instances,selectOnPointerEvent_fn).call(this,event)}moveInDOM(){__privateGet(this,_moveInDOMTimeout)&&clearTimeout(__privateGet(this,_moveInDOMTimeout)),__privateSet(this,_moveInDOMTimeout,setTimeout(()=>{var _a2;__privateSet(this,_moveInDOMTimeout,null),(_a2=this.parent)==null||_a2.moveEditorInDOM(this)},0))}_setParentAndPosition(parent,x,y){parent.changeParent(this),this.x=x,this.y=y,this.fixAndSetPosition()}getRect(tx,ty,rotation=this.rotation){const scale=this.parentScale,[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation,shiftX=tx/scale,shiftY=ty/scale,x=this.x*pageWidth,y=this.y*pageHeight,width=this.width*pageWidth,height=this.height*pageHeight;switch(rotation){case 0:return[x+shiftX+pageX,pageHeight-y-shiftY-height+pageY,x+shiftX+width+pageX,pageHeight-y-shiftY+pageY];case 90:return[x+shiftY+pageX,pageHeight-y+shiftX+pageY,x+shiftY+height+pageX,pageHeight-y+shiftX+width+pageY];case 180:return[x-shiftX-width+pageX,pageHeight-y+shiftY+pageY,x-shiftX+pageX,pageHeight-y+shiftY+height+pageY];case 270:return[x-shiftY-height+pageX,pageHeight-y-shiftX-width+pageY,x-shiftY+pageX,pageHeight-y-shiftX+pageY];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(rect,pageHeight){const[x1,y1,x2,y2]=rect,width=x2-x1,height=y2-y1;switch(this.rotation){case 0:return[x1,pageHeight-y2,width,height];case 90:return[x1,pageHeight-y1,height,width];case 180:return[x2,pageHeight-y1,width,height];case 270:return[x2,pageHeight-y2,height,width];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){__privateSet(this,_isInEditMode,!0)}disableEditMode(){__privateSet(this,_isInEditMode,!1)}isInEditMode(){return __privateGet(this,_isInEditMode)}shouldGetKeyboardEvents(){return __privateGet(this,_isResizerEnabledForKeyboard)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var _a2,_b2;const signal=this._uiManager._signal;(_a2=this.div)==null||_a2.addEventListener("focusin",__privateGet(this,_boundFocusin),{signal}),(_b2=this.div)==null||_b2.addEventListener("focusout",__privateGet(this,_boundFocusout),{signal})}rotate(_angle){}serialize(isForCopying=!1,context=null){unreachable("An editor must be serializable")}static deserialize(data,parent,uiManager){const editor=new this.prototype.constructor({parent,id:parent.getNextId(),uiManager});editor.rotation=data.rotation,__privateSet(editor,_accessibilityData,data.accessibilityData);const[pageWidth,pageHeight]=editor.pageDimensions,[x,y,width,height]=editor.getRectInCurrentCoords(data.rect,pageHeight);return editor.x=x/pageWidth,editor.y=y/pageHeight,editor.width=width/pageWidth,editor.height=height/pageHeight,editor}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.div.removeEventListener("focusin",__privateGet(this,_boundFocusin)),this.div.removeEventListener("focusout",__privateGet(this,_boundFocusout)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),__privateGet(this,_moveInDOMTimeout)&&(clearTimeout(__privateGet(this,_moveInDOMTimeout)),__privateSet(this,_moveInDOMTimeout,null)),__privateMethod(this,_AnnotationEditor_instances,stopResizing_fn).call(this),this.removeEditToolbar(),__privateGet(this,_telemetryTimeouts)){for(const timeout of __privateGet(this,_telemetryTimeouts).values())clearTimeout(timeout);__privateSet(this,_telemetryTimeouts,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(__privateMethod(this,_AnnotationEditor_instances,createResizers_fn).call(this),__privateGet(this,_resizersDiv).classList.remove("hidden"),bindEvents(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(event){if(!this.isResizable||event.target!==this.div||event.key!=="Enter")return;this._uiManager.setSelected(this),__privateSet(this,_savedDimensions,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const children=__privateGet(this,_resizersDiv).children;if(!__privateGet(this,_allResizerDivs)){__privateSet(this,_allResizerDivs,Array.from(children));const boundResizerKeydown=__privateMethod(this,_AnnotationEditor_instances,resizerKeydown_fn).bind(this),boundResizerBlur=__privateMethod(this,_AnnotationEditor_instances,resizerBlur_fn).bind(this),signal=this._uiManager._signal;for(const div of __privateGet(this,_allResizerDivs)){const name=div.getAttribute("data-resizer-name");div.setAttribute("role","spinbutton"),div.addEventListener("keydown",boundResizerKeydown,{signal}),div.addEventListener("blur",boundResizerBlur,{signal}),div.addEventListener("focus",__privateMethod(this,_AnnotationEditor_instances,resizerFocus_fn).bind(this,name),{signal}),_AnnotationEditor2._l10nPromise.get(`pdfjs-editor-resizer-label-${name}`).then(msg=>div.setAttribute("aria-label",msg))}}const first=__privateGet(this,_allResizerDivs)[0];let firstPosition=0;for(const div of children){if(div===first)break;firstPosition++}const nextFirstPosition=(360-this.rotation+this.parentRotation)%360/90*(__privateGet(this,_allResizerDivs).length/4);if(nextFirstPosition!==firstPosition){if(nextFirstPosition<firstPosition)for(let i2=0;i2<firstPosition-nextFirstPosition;i2++)__privateGet(this,_resizersDiv).append(__privateGet(this,_resizersDiv).firstChild);else if(nextFirstPosition>firstPosition)for(let i2=0;i2<nextFirstPosition-firstPosition;i2++)__privateGet(this,_resizersDiv).firstChild.before(__privateGet(this,_resizersDiv).lastChild);let i=0;for(const child of children){const name=__privateGet(this,_allResizerDivs)[i++].getAttribute("data-resizer-name");_AnnotationEditor2._l10nPromise.get(`pdfjs-editor-resizer-label-${name}`).then(msg=>child.setAttribute("aria-label",msg))}}__privateMethod(this,_AnnotationEditor_instances,setResizerTabIndex_fn).call(this,0),__privateSet(this,_isResizerEnabledForKeyboard,!0),__privateGet(this,_resizersDiv).firstChild.focus({focusVisible:!0}),event.preventDefault(),event.stopImmediatePropagation()}_resizeWithKeyboard(x,y){__privateGet(this,_isResizerEnabledForKeyboard)&&__privateMethod(this,_AnnotationEditor_instances,resizerPointermove_fn).call(this,__privateGet(this,_focusedResizerName),{movementX:x,movementY:y})}_stopResizingWithKeyboard(){__privateMethod(this,_AnnotationEditor_instances,stopResizing_fn).call(this),this.div.focus()}select(){var _a2,_b2;if(this.makeResizable(),(_a2=this.div)==null||_a2.classList.add("selectedEditor"),!__privateGet(this,_editToolbar)){this.addEditToolbar().then(()=>{var _a3,_b3;(_a3=this.div)!=null&&_a3.classList.contains("selectedEditor")&&((_b3=__privateGet(this,_editToolbar))==null||_b3.show())});return}(_b2=__privateGet(this,_editToolbar))==null||_b2.show()}unselect(){var _a2,_b2,_c,_d;(_a2=__privateGet(this,_resizersDiv))==null||_a2.classList.add("hidden"),(_b2=this.div)==null||_b2.classList.remove("selectedEditor"),(_c=this.div)!=null&&_c.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(_d=__privateGet(this,_editToolbar))==null||_d.hide()}updateParams(type,value){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return __privateGet(this,_isEditing)}set isEditing(value){__privateSet(this,_isEditing,value),this.parent&&(value?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(width,height){__privateSet(this,_keepAspectRatio,!0);const aspectRatio=width/height,{style}=this.div;style.aspectRatio=aspectRatio,style.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(data,mustWait=!1){if(mustWait){__privateGet(this,_telemetryTimeouts)||__privateSet(this,_telemetryTimeouts,new Map);const{action}=data;let timeout=__privateGet(this,_telemetryTimeouts).get(action);timeout&&clearTimeout(timeout),timeout=setTimeout(()=>{this._reportTelemetry(data),__privateGet(this,_telemetryTimeouts).delete(action),__privateGet(this,_telemetryTimeouts).size===0&&__privateSet(this,_telemetryTimeouts,null)},_AnnotationEditor2._telemetryTimeout),__privateGet(this,_telemetryTimeouts).set(action,timeout);return}data.type||(data.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data}})}show(visible=this._isVisible){this.div.classList.toggle("hidden",!visible),this._isVisible=visible}enable(){this.div&&(this.div.tabIndex=0),__privateSet(this,_disabled,!1)}disable(){this.div&&(this.div.tabIndex=-1),__privateSet(this,_disabled,!0)}renderAnnotationElement(annotation){let content=annotation.container.querySelector(".annotationContent");if(!content)content=document.createElement("div"),content.classList.add("annotationContent",this.editorType),annotation.container.prepend(content);else if(content.nodeName==="CANVAS"){const canvas=content;content=document.createElement("div"),content.classList.add("annotationContent",this.editorType),canvas.before(content)}return content}resetAnnotationElement(annotation){const{firstChild}=annotation.container;firstChild.nodeName==="DIV"&&firstChild.classList.contains("annotationContent")&&firstChild.remove()}};_accessibilityData=new WeakMap,_allResizerDivs=new WeakMap,_altText2=new WeakMap,_disabled=new WeakMap,_keepAspectRatio=new WeakMap,_resizersDiv=new WeakMap,_savedDimensions=new WeakMap,_boundFocusin=new WeakMap,_boundFocusout=new WeakMap,_editToolbar=new WeakMap,_focusedResizerName=new WeakMap,_hasBeenClicked=new WeakMap,_initialPosition=new WeakMap,_isEditing=new WeakMap,_isInEditMode=new WeakMap,_isResizerEnabledForKeyboard=new WeakMap,_moveInDOMTimeout=new WeakMap,_prevDragX=new WeakMap,_prevDragY=new WeakMap,_telemetryTimeouts=new WeakMap,_isDraggable=new WeakMap,_zIndex=new WeakMap,_AnnotationEditor_instances=new WeakSet,translate_fn=__name2(function([width,height],x,y){[x,y]=this.screenToPageTranslation(x,y),this.x+=x/width,this.y+=y/height,this.fixAndSetPosition()},"#translate"),_AnnotationEditor_static=new WeakSet,rotatePoint_fn=__name2(function(x,y,angle){switch(angle){case 90:return[y,-x];case 180:return[-x,-y];case 270:return[-y,x];default:return[x,y]}},"#rotatePoint"),getRotationMatrix_fn=__name2(function(rotation){switch(rotation){case 90:{const[pageWidth,pageHeight]=this.pageDimensions;return[0,-pageWidth/pageHeight,pageHeight/pageWidth,0]}case 180:return[-1,0,0,-1];case 270:{const[pageWidth,pageHeight]=this.pageDimensions;return[0,pageWidth/pageHeight,-pageHeight/pageWidth,0]}default:return[1,0,0,1]}},"#getRotationMatrix"),createResizers_fn=__name2(function(){if(__privateGet(this,_resizersDiv))return;__privateSet(this,_resizersDiv,document.createElement("div")),__privateGet(this,_resizersDiv).classList.add("resizers");const classes=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],signal=this._uiManager._signal;for(const name of classes){const div=document.createElement("div");__privateGet(this,_resizersDiv).append(div),div.classList.add("resizer",name),div.setAttribute("data-resizer-name",name),div.addEventListener("pointerdown",__privateMethod(this,_AnnotationEditor_instances,resizerPointerdown_fn).bind(this,name),{signal}),div.addEventListener("contextmenu",noContextMenu,{signal}),div.tabIndex=-1}this.div.prepend(__privateGet(this,_resizersDiv))},"#createResizers"),resizerPointerdown_fn=__name2(function(name,event){var _a2;event.preventDefault();const{isMac}=util_FeatureTest.platform;if(event.button!==0||event.ctrlKey&&isMac)return;(_a2=__privateGet(this,_altText2))==null||_a2.toggle(!1);const boundResizerPointermove=__privateMethod(this,_AnnotationEditor_instances,resizerPointermove_fn).bind(this,name),savedDraggable=this._isDraggable;this._isDraggable=!1;const signal=this._uiManager._signal,pointerMoveOptions={passive:!0,capture:!0,signal};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",boundResizerPointermove,pointerMoveOptions),window.addEventListener("contextmenu",noContextMenu,{signal});const savedX=this.x,savedY=this.y,savedWidth=this.width,savedHeight=this.height,savedParentCursor=this.parent.div.style.cursor,savedCursor=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(event.target).cursor;const pointerUpCallback=__name2(()=>{var _a3;this.parent.togglePointerEvents(!0),(_a3=__privateGet(this,_altText2))==null||_a3.toggle(!0),this._isDraggable=savedDraggable,window.removeEventListener("pointerup",pointerUpCallback),window.removeEventListener("blur",pointerUpCallback),window.removeEventListener("pointermove",boundResizerPointermove,pointerMoveOptions),window.removeEventListener("contextmenu",noContextMenu),this.parent.div.style.cursor=savedParentCursor,this.div.style.cursor=savedCursor,__privateMethod(this,_AnnotationEditor_instances,addResizeToUndoStack_fn).call(this,savedX,savedY,savedWidth,savedHeight)},"pointerUpCallback");window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("blur",pointerUpCallback,{signal})},"#resizerPointerdown"),addResizeToUndoStack_fn=__name2(function(savedX,savedY,savedWidth,savedHeight){const newX=this.x,newY=this.y,newWidth=this.width,newHeight=this.height;newX===savedX&&newY===savedY&&newWidth===savedWidth&&newHeight===savedHeight||this.addCommands({cmd:__name2(()=>{this.width=newWidth,this.height=newHeight,this.x=newX,this.y=newY;const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(parentWidth*newWidth,parentHeight*newHeight),this.fixAndSetPosition()},"cmd"),undo:__name2(()=>{this.width=savedWidth,this.height=savedHeight,this.x=savedX,this.y=savedY;const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(parentWidth*savedWidth,parentHeight*savedHeight),this.fixAndSetPosition()},"undo"),mustExec:!0})},"#addResizeToUndoStack"),resizerPointermove_fn=__name2(function(name,event){const[parentWidth,parentHeight]=this.parentDimensions,savedX=this.x,savedY=this.y,savedWidth=this.width,savedHeight=this.height,minWidth=_AnnotationEditor.MIN_SIZE/parentWidth,minHeight=_AnnotationEditor.MIN_SIZE/parentHeight,round=__name2(x=>Math.round(x*1e4)/1e4,"round"),rotationMatrix=__privateMethod(this,_AnnotationEditor_instances,getRotationMatrix_fn).call(this,this.rotation),transf=__name2((x,y)=>[rotationMatrix[0]*x+rotationMatrix[2]*y,rotationMatrix[1]*x+rotationMatrix[3]*y],"transf"),invRotationMatrix=__privateMethod(this,_AnnotationEditor_instances,getRotationMatrix_fn).call(this,360-this.rotation),invTransf=__name2((x,y)=>[invRotationMatrix[0]*x+invRotationMatrix[2]*y,invRotationMatrix[1]*x+invRotationMatrix[3]*y],"invTransf");let getPoint,getOpposite,isDiagonal=!1,isHorizontal=!1;switch(name){case"topLeft":isDiagonal=!0,getPoint=__name2((w,h)=>[0,0],"getPoint"),getOpposite=__name2((w,h)=>[w,h],"getOpposite");break;case"topMiddle":getPoint=__name2((w,h)=>[w/2,0],"getPoint"),getOpposite=__name2((w,h)=>[w/2,h],"getOpposite");break;case"topRight":isDiagonal=!0,getPoint=__name2((w,h)=>[w,0],"getPoint"),getOpposite=__name2((w,h)=>[0,h],"getOpposite");break;case"middleRight":isHorizontal=!0,getPoint=__name2((w,h)=>[w,h/2],"getPoint"),getOpposite=__name2((w,h)=>[0,h/2],"getOpposite");break;case"bottomRight":isDiagonal=!0,getPoint=__name2((w,h)=>[w,h],"getPoint"),getOpposite=__name2((w,h)=>[0,0],"getOpposite");break;case"bottomMiddle":getPoint=__name2((w,h)=>[w/2,h],"getPoint"),getOpposite=__name2((w,h)=>[w/2,0],"getOpposite");break;case"bottomLeft":isDiagonal=!0,getPoint=__name2((w,h)=>[0,h],"getPoint"),getOpposite=__name2((w,h)=>[w,0],"getOpposite");break;case"middleLeft":isHorizontal=!0,getPoint=__name2((w,h)=>[0,h/2],"getPoint"),getOpposite=__name2((w,h)=>[w,h/2],"getOpposite");break}const point=getPoint(savedWidth,savedHeight),oppositePoint=getOpposite(savedWidth,savedHeight);let transfOppositePoint=transf(...oppositePoint);const oppositeX=round(savedX+transfOppositePoint[0]),oppositeY=round(savedY+transfOppositePoint[1]);let ratioX=1,ratioY=1,[deltaX,deltaY]=this.screenToPageTranslation(event.movementX,event.movementY);if([deltaX,deltaY]=invTransf(deltaX/parentWidth,deltaY/parentHeight),isDiagonal){const oldDiag=Math.hypot(savedWidth,savedHeight);ratioX=ratioY=Math.max(Math.min(Math.hypot(oppositePoint[0]-point[0]-deltaX,oppositePoint[1]-point[1]-deltaY)/oldDiag,1/savedWidth,1/savedHeight),minWidth/savedWidth,minHeight/savedHeight)}else isHorizontal?ratioX=Math.max(minWidth,Math.min(1,Math.abs(oppositePoint[0]-point[0]-deltaX)))/savedWidth:ratioY=Math.max(minHeight,Math.min(1,Math.abs(oppositePoint[1]-point[1]-deltaY)))/savedHeight;const newWidth=round(savedWidth*ratioX),newHeight=round(savedHeight*ratioY);transfOppositePoint=transf(...getOpposite(newWidth,newHeight));const newX=oppositeX-transfOppositePoint[0],newY=oppositeY-transfOppositePoint[1];this.width=newWidth,this.height=newHeight,this.x=newX,this.y=newY,this.setDims(parentWidth*newWidth,parentHeight*newHeight),this.fixAndSetPosition()},"#resizerPointermove"),selectOnPointerEvent_fn=__name2(function(event){const{isMac}=util_FeatureTest.platform;event.ctrlKey&&!isMac||event.shiftKey||event.metaKey&&isMac?this.parent.toggleSelected(this):this.parent.setSelected(this)},"#selectOnPointerEvent"),setUpDragSession_fn=__name2(function(event){const isSelected=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let pointerMoveOptions,pointerMoveCallback;const signal=this._uiManager._signal;isSelected&&(this.div.classList.add("moving"),pointerMoveOptions={passive:!0,capture:!0,signal},__privateSet(this,_prevDragX,event.clientX),__privateSet(this,_prevDragY,event.clientY),pointerMoveCallback=__name2(e=>{const{clientX:x,clientY:y}=e,[tx,ty]=this.screenToPageTranslation(x-__privateGet(this,_prevDragX),y-__privateGet(this,_prevDragY));__privateSet(this,_prevDragX,x),__privateSet(this,_prevDragY,y),this._uiManager.dragSelectedEditors(tx,ty)},"pointerMoveCallback"),window.addEventListener("pointermove",pointerMoveCallback,pointerMoveOptions));const pointerUpCallback=__name2(()=>{window.removeEventListener("pointerup",pointerUpCallback),window.removeEventListener("blur",pointerUpCallback),isSelected&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",pointerMoveCallback,pointerMoveOptions)),__privateSet(this,_hasBeenClicked,!1),this._uiManager.endDragSession()||__privateMethod(this,_AnnotationEditor_instances,selectOnPointerEvent_fn).call(this,event)},"pointerUpCallback");window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("blur",pointerUpCallback,{signal})},"#setUpDragSession"),resizerKeydown_fn=__name2(function(event){_AnnotationEditor._resizerKeyboardManager.exec(this,event)},"#resizerKeydown"),resizerBlur_fn=__name2(function(event){var _a2;__privateGet(this,_isResizerEnabledForKeyboard)&&((_a2=event.relatedTarget)==null?void 0:_a2.parentNode)!==__privateGet(this,_resizersDiv)&&__privateMethod(this,_AnnotationEditor_instances,stopResizing_fn).call(this)},"#resizerBlur"),resizerFocus_fn=__name2(function(name){__privateSet(this,_focusedResizerName,__privateGet(this,_isResizerEnabledForKeyboard)?name:"")},"#resizerFocus"),setResizerTabIndex_fn=__name2(function(value){if(__privateGet(this,_allResizerDivs))for(const div of __privateGet(this,_allResizerDivs))div.tabIndex=value},"#setResizerTabIndex"),stopResizing_fn=__name2(function(){if(__privateSet(this,_isResizerEnabledForKeyboard,!1),__privateMethod(this,_AnnotationEditor_instances,setResizerTabIndex_fn).call(this,-1),__privateGet(this,_savedDimensions)){const{savedX,savedY,savedWidth,savedHeight}=__privateGet(this,_savedDimensions);__privateMethod(this,_AnnotationEditor_instances,addResizeToUndoStack_fn).call(this,savedX,savedY,savedWidth,savedHeight),__privateSet(this,_savedDimensions,null)}},"#stopResizing"),__privateAdd(_AnnotationEditor,_AnnotationEditor_static),__name2(_AnnotationEditor,"AnnotationEditor"),__publicField(_AnnotationEditor,"_borderLineWidth",-1),__publicField(_AnnotationEditor,"_colorManager",new ColorManager),__publicField(_AnnotationEditor,"_zIndex",1),__publicField(_AnnotationEditor,"_telemetryTimeout",1e3);let AnnotationEditor=_AnnotationEditor;const _FakeEditor=class extends AnnotationEditor{static{__name(this,"_FakeEditor")}constructor(params){super(params),this.annotationElementId=params.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}};__name2(_FakeEditor,"FakeEditor");let FakeEditor=_FakeEditor;const SEED=3285377520,MASK_HIGH=4294901760,MASK_LOW=65535,_MurmurHash3_64=class{static{__name(this,"_MurmurHash3_64")}constructor(seed){this.h1=seed?seed&4294967295:SEED,this.h2=seed?seed&4294967295:SEED}update(input){let data,length;if(typeof input=="string"){data=new Uint8Array(input.length*2),length=0;for(let i=0,ii=input.length;i<ii;i++){const code=input.charCodeAt(i);code<=255?data[length++]=code:(data[length++]=code>>>8,data[length++]=code&255)}}else if(ArrayBuffer.isView(input))data=input.slice(),length=data.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const blockCounts=length>>2,tailLength=length-blockCounts*4,dataUint32=new Uint32Array(data.buffer,0,blockCounts);let k1=0,k2=0,h1=this.h1,h2=this.h2;const C1=3432918353,C2=461845907,C1_LOW=C1&MASK_LOW,C2_LOW=C2&MASK_LOW;for(let i=0;i<blockCounts;i++)i&1?(k1=dataUint32[i],k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW,k1=k1<<15|k1>>>17,k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW,h1^=k1,h1=h1<<13|h1>>>19,h1=h1*5+3864292196):(k2=dataUint32[i],k2=k2*C1&MASK_HIGH|k2*C1_LOW&MASK_LOW,k2=k2<<15|k2>>>17,k2=k2*C2&MASK_HIGH|k2*C2_LOW&MASK_LOW,h2^=k2,h2=h2<<13|h2>>>19,h2=h2*5+3864292196);switch(k1=0,tailLength){case 3:k1^=data[blockCounts*4+2]<<16;case 2:k1^=data[blockCounts*4+1]<<8;case 1:k1^=data[blockCounts*4],k1=k1*C1&MASK_HIGH|k1*C1_LOW&MASK_LOW,k1=k1<<15|k1>>>17,k1=k1*C2&MASK_HIGH|k1*C2_LOW&MASK_LOW,blockCounts&1?h1^=k1:h2^=k1}this.h1=h1,this.h2=h2}hexdigest(){let h1=this.h1,h2=this.h2;return h1^=h2>>>1,h1=h1*3981806797&MASK_HIGH|h1*36045&MASK_LOW,h2=h2*4283543511&MASK_HIGH|((h2<<16|h1>>>16)*2950163797&MASK_HIGH)>>>16,h1^=h2>>>1,h1=h1*444984403&MASK_HIGH|h1*60499&MASK_LOW,h2=h2*3301882366&MASK_HIGH|((h2<<16|h1>>>16)*3120437893&MASK_HIGH)>>>16,h1^=h2>>>1,(h1>>>0).toString(16).padStart(8,"0")+(h2>>>0).toString(16).padStart(8,"0")}};__name2(_MurmurHash3_64,"MurmurHash3_64");let MurmurHash3_64=_MurmurHash3_64;const SerializableEmpty=Object.freeze({map:null,hash:"",transfer:void 0}),_AnnotationStorage=class{static{__name(this,"_AnnotationStorage")}constructor(){__privateAdd(this,_AnnotationStorage_instances),__privateAdd(this,_modified,!1),__privateAdd(this,_modifiedIds,null),__privateAdd(this,_storage,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(key,defaultValue){const value=__privateGet(this,_storage).get(key);return value===void 0?defaultValue:Object.assign(defaultValue,value)}getRawValue(key){return __privateGet(this,_storage).get(key)}remove(key){if(__privateGet(this,_storage).delete(key),__privateGet(this,_storage).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const value of __privateGet(this,_storage).values())if(value instanceof AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(key,value){const obj=__privateGet(this,_storage).get(key);let modified=!1;if(obj!==void 0)for(const[entry,val]of Object.entries(value))obj[entry]!==val&&(modified=!0,obj[entry]=val);else modified=!0,__privateGet(this,_storage).set(key,value);modified&&__privateMethod(this,_AnnotationStorage_instances,setModified_fn).call(this),value instanceof AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(value.constructor._type)}has(key){return __privateGet(this,_storage).has(key)}getAll(){return __privateGet(this,_storage).size>0?objectFromMap(__privateGet(this,_storage)):null}setAll(obj){for(const[key,val]of Object.entries(obj))this.setValue(key,val)}get size(){return __privateGet(this,_storage).size}resetModified(){__privateGet(this,_modified)&&(__privateSet(this,_modified,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new PrintAnnotationStorage(this)}get serializable(){if(__privateGet(this,_storage).size===0)return SerializableEmpty;const map=new Map,hash=new MurmurHash3_64,transfer=[],context=Object.create(null);let hasBitmap=!1;for(const[key,val]of __privateGet(this,_storage)){const serialized=val instanceof AnnotationEditor?val.serialize(!1,context):val;serialized&&(map.set(key,serialized),hash.update(`${key}:${JSON.stringify(serialized)}`),hasBitmap||(hasBitmap=!!serialized.bitmap))}if(hasBitmap)for(const value of map.values())value.bitmap&&transfer.push(value.bitmap);return map.size>0?{map,hash:hash.hexdigest(),transfer}:SerializableEmpty}get editorStats(){let stats=null;const typeToEditor=new Map;for(const value of __privateGet(this,_storage).values()){if(!(value instanceof AnnotationEditor))continue;const editorStats=value.telemetryFinalData;if(!editorStats)continue;const{type}=editorStats;typeToEditor.has(type)||typeToEditor.set(type,Object.getPrototypeOf(value).constructor),stats||(stats=Object.create(null));const map=stats[type]||(stats[type]=new Map);for(const[key,val]of Object.entries(editorStats)){if(key==="type")continue;let counters=map.get(key);counters||(counters=new Map,map.set(key,counters));const count=counters.get(val)??0;counters.set(val,count+1)}}for(const[type,editor]of typeToEditor)stats[type]=editor.computeTelemetryFinalData(stats[type]);return stats}resetModifiedIds(){__privateSet(this,_modifiedIds,null)}get modifiedIds(){if(__privateGet(this,_modifiedIds))return __privateGet(this,_modifiedIds);const ids=[];for(const value of __privateGet(this,_storage).values())!(value instanceof AnnotationEditor)||!value.annotationElementId||!value.serialize()||ids.push(value.annotationElementId);return __privateSet(this,_modifiedIds,{ids:new Set(ids),hash:ids.join(",")})}};_modified=new WeakMap,_modifiedIds=new WeakMap,_storage=new WeakMap,_AnnotationStorage_instances=new WeakSet,setModified_fn=__name2(function(){__privateGet(this,_modified)||(__privateSet(this,_modified,!0),typeof this.onSetModified=="function"&&this.onSetModified())},"#setModified"),__name2(_AnnotationStorage,"AnnotationStorage");let AnnotationStorage=_AnnotationStorage;const _PrintAnnotationStorage=class extends AnnotationStorage{static{__name(this,"_PrintAnnotationStorage")}constructor(parent){super(),__privateAdd(this,_serializable);const{map,hash,transfer}=parent.serializable,clone=structuredClone(map,transfer?{transfer}:null);__privateSet(this,_serializable,{map:clone,hash,transfer})}get print(){unreachable("Should not call PrintAnnotationStorage.print")}get serializable(){return __privateGet(this,_serializable)}get modifiedIds(){return shadow(this,"modifiedIds",{ids:new Set,hash:""})}};_serializable=new WeakMap,__name2(_PrintAnnotationStorage,"PrintAnnotationStorage");let PrintAnnotationStorage=_PrintAnnotationStorage;const _FontLoader=class{static{__name(this,"_FontLoader")}constructor({ownerDocument=globalThis.document,styleElement=null}){__privateAdd(this,_systemFonts,new Set),this._document=ownerDocument,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(nativeFontFace){this.nativeFontFaces.add(nativeFontFace),this._document.fonts.add(nativeFontFace)}removeNativeFontFace(nativeFontFace){this.nativeFontFaces.delete(nativeFontFace),this._document.fonts.delete(nativeFontFace)}insertRule(rule){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const styleSheet=this.styleElement.sheet;styleSheet.insertRule(rule,styleSheet.cssRules.length)}clear(){for(const nativeFontFace of this.nativeFontFaces)this._document.fonts.delete(nativeFontFace);this.nativeFontFaces.clear(),__privateGet(this,_systemFonts).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:info2,_inspectFont}){if(!(!info2||__privateGet(this,_systemFonts).has(info2.loadedName))){if(assert(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName,src,style}=info2,fontFace=new FontFace(loadedName,src,style);this.addNativeFontFace(fontFace);try{await fontFace.load(),__privateGet(this,_systemFonts).add(loadedName),_inspectFont?.(info2)}catch{warn(`Cannot load system font: ${info2.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(fontFace)}return}unreachable("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(font){if(font.attached||font.missingFile&&!font.systemFontInfo)return;if(font.attached=!0,font.systemFontInfo){await this.loadSystemFont(font);return}if(this.isFontLoadingAPISupported){const nativeFontFace=font.createNativeFontFace();if(nativeFontFace){this.addNativeFontFace(nativeFontFace);try{await nativeFontFace.loaded}catch(ex){throw warn(`Failed to load font '${nativeFontFace.family}': '${ex}'.`),font.disableFontFace=!0,ex}}return}const rule=font.createFontFaceRule();if(rule){if(this.insertRule(rule),this.isSyncFontLoadingSupported)return;await new Promise(resolve=>{const request=this._queueLoadingCallback(resolve);this._prepareFontLoadEvent(font,request)})}}get isFontLoadingAPISupported(){var _a2;const hasFonts=!!((_a2=this._document)!=null&&_a2.fonts);return shadow(this,"isFontLoadingAPISupported",hasFonts)}get isSyncFontLoadingSupported(){let supported=!1;return(isNodeJS||typeof navigator<"u"&&typeof navigator?.userAgent=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(supported=!0),shadow(this,"isSyncFontLoadingSupported",supported)}_queueLoadingCallback(callback){function completeRequest(){for(assert(!request.done,"completeRequest() cannot be called twice."),request.done=!0;loadingRequests.length>0&&loadingRequests[0].done;){const otherRequest=loadingRequests.shift();setTimeout(otherRequest.callback,0)}}__name(completeRequest,"completeRequest"),__name2(completeRequest,"completeRequest");const{loadingRequests}=this,request={done:!1,complete:completeRequest,callback};return loadingRequests.push(request),request}get _loadTestFont(){const testFont=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return shadow(this,"_loadTestFont",testFont)}_prepareFontLoadEvent(font,request){function int32(data2,offset){return data2.charCodeAt(offset)<<24|data2.charCodeAt(offset+1)<<16|data2.charCodeAt(offset+2)<<8|data2.charCodeAt(offset+3)&255}__name(int32,"int32"),__name2(int32,"int32");function spliceString(s,offset,remove,insert){const chunk1=s.substring(0,offset),chunk2=s.substring(offset+remove);return chunk1+insert+chunk2}__name(spliceString,"spliceString"),__name2(spliceString,"spliceString");let i,ii;const canvas=this._document.createElement("canvas");canvas.width=1,canvas.height=1;const ctx=canvas.getContext("2d");let called=0;function isFontReady(name,callback){if(++called>30){warn("Load test font never loaded."),callback();return}if(ctx.font="30px "+name,ctx.fillText(".",0,20),ctx.getImageData(0,0,1,1).data[3]>0){callback();return}setTimeout(isFontReady.bind(null,name,callback))}__name(isFontReady,"isFontReady"),__name2(isFontReady,"isFontReady");const loadTestFontId=`lt${Date.now()}${this.loadTestFontId++}`;let data=this._loadTestFont;data=spliceString(data,976,loadTestFontId.length,loadTestFontId);const CFF_CHECKSUM_OFFSET=16,XXXX_VALUE=1482184792;let checksum=int32(data,CFF_CHECKSUM_OFFSET);for(i=0,ii=loadTestFontId.length-3;i<ii;i+=4)checksum=checksum-XXXX_VALUE+int32(loadTestFontId,i)|0;i<loadTestFontId.length&&(checksum=checksum-XXXX_VALUE+int32(loadTestFontId+"XXX",i)|0),data=spliceString(data,CFF_CHECKSUM_OFFSET,4,string32(checksum));const url=`url(data:font/opentype;base64,${btoa(data)});`,rule=`@font-face {font-family:"${loadTestFontId}";src:${url}}`;this.insertRule(rule);const div=this._document.createElement("div");div.style.visibility="hidden",div.style.width=div.style.height="10px",div.style.position="absolute",div.style.top=div.style.left="0px";for(const name of[font.loadedName,loadTestFontId]){const span=this._document.createElement("span");span.textContent="Hi",span.style.fontFamily=name,div.append(span)}this._document.body.append(div),isFontReady(loadTestFontId,()=>{div.remove(),request.complete()})}};_systemFonts=new WeakMap,__name2(_FontLoader,"FontLoader");let FontLoader=_FontLoader;const _FontFaceObject=class{static{__name(this,"_FontFaceObject")}constructor(translatedData,{disableFontFace=!1,inspectFont=null}){this.compiledGlyphs=Object.create(null);for(const i in translatedData)this[i]=translatedData[i];this.disableFontFace=disableFontFace===!0,this._inspectFont=inspectFont}createNativeFontFace(){var _a2;if(!this.data||this.disableFontFace)return null;let nativeFontFace;if(!this.cssFontInfo)nativeFontFace=new FontFace(this.loadedName,this.data,{});else{const css={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(css.style=`oblique ${this.cssFontInfo.italicAngle}deg`),nativeFontFace=new FontFace(this.cssFontInfo.fontFamily,this.data,css)}return(_a2=this._inspectFont)==null||_a2.call(this,this),nativeFontFace}createFontFaceRule(){var _a2;if(!this.data||this.disableFontFace)return null;const data=bytesToString(this.data),url=`url(data:${this.mimetype};base64,${btoa(data)});`;let rule;if(!this.cssFontInfo)rule=`@font-face {font-family:"${this.loadedName}";src:${url}}`;else{let css=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(css+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),rule=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${css}src:${url}}`}return(_a2=this._inspectFont)==null||_a2.call(this,this,url),rule}getPathGenerator(objs,character){if(this.compiledGlyphs[character]!==void 0)return this.compiledGlyphs[character];let cmds;try{cmds=objs.get(this.loadedName+"_path_"+character)}catch(ex){warn(`getPathGenerator - ignoring character: "${ex}".`)}if(!Array.isArray(cmds)||cmds.length===0)return this.compiledGlyphs[character]=function(c,size){};const commands=[];for(let i=0,ii=cmds.length;i<ii;)switch(cmds[i++]){case FontRenderOps.BEZIER_CURVE_TO:{const[a,b,c,d,e,f]=cmds.slice(i,i+6);commands.push(ctx=>ctx.bezierCurveTo(a,b,c,d,e,f)),i+=6}break;case FontRenderOps.MOVE_TO:{const[a,b]=cmds.slice(i,i+2);commands.push(ctx=>ctx.moveTo(a,b)),i+=2}break;case FontRenderOps.LINE_TO:{const[a,b]=cmds.slice(i,i+2);commands.push(ctx=>ctx.lineTo(a,b)),i+=2}break;case FontRenderOps.QUADRATIC_CURVE_TO:{const[a,b,c,d]=cmds.slice(i,i+4);commands.push(ctx=>ctx.quadraticCurveTo(a,b,c,d)),i+=4}break;case FontRenderOps.RESTORE:commands.push(ctx=>ctx.restore());break;case FontRenderOps.SAVE:commands.push(ctx=>ctx.save());break;case FontRenderOps.SCALE:assert(commands.length===2,"Scale command is only valid at the third position.");break;case FontRenderOps.TRANSFORM:{const[a,b,c,d,e,f]=cmds.slice(i,i+6);commands.push(ctx=>ctx.transform(a,b,c,d,e,f)),i+=6}break;case FontRenderOps.TRANSLATE:{const[a,b]=cmds.slice(i,i+2);commands.push(ctx=>ctx.translate(a,b)),i+=2}break}return this.compiledGlyphs[character]=__name2(__name(function(ctx,size){commands[0](ctx),commands[1](ctx),ctx.scale(size,-size);for(let i=2,ii=commands.length;i<ii;i++)commands[i](ctx)},"glyphDrawer"),"glyphDrawer")}};__name2(_FontFaceObject,"FontFaceObject");let FontFaceObject=_FontFaceObject;if(isNodeJS){var packageCapability=Promise.withResolvers(),packageMap=null;__name2(async()=>{const fs=await import("./__vite-browser-external.mjs"),http=await import("./__vite-browser-external.mjs"),https=await import("./__vite-browser-external.mjs"),url=await import("./__vite-browser-external.mjs");let canvas,path2d;try{canvas=await import("./__vite-browser-external.mjs")}catch{}try{path2d=await Promise.resolve().then(()=>index)}catch{}return new Map(Object.entries({fs,http,https,url,canvas,path2d}))},"loadPackages")().then(map=>{var _a2,_b2,_c,_d;if(packageMap=map,packageCapability.resolve(),!globalThis.DOMMatrix){const DOMMatrix2=(_a2=map.get("canvas"))==null?void 0:_a2.DOMMatrix;DOMMatrix2?globalThis.DOMMatrix=DOMMatrix2:warn("Cannot polyfill `DOMMatrix`, rendering may be broken.")}if(!globalThis.Path2D){const CanvasRenderingContext2D=(_b2=map.get("canvas"))==null?void 0:_b2.CanvasRenderingContext2D,applyPath2DToCanvasRenderingContext2=(_c=map.get("path2d"))==null?void 0:_c.applyPath2DToCanvasRenderingContext,Path2D2=(_d=map.get("path2d"))==null?void 0:_d.Path2D;CanvasRenderingContext2D&&applyPath2DToCanvasRenderingContext2&&Path2D2?(applyPath2DToCanvasRenderingContext2(CanvasRenderingContext2D),globalThis.Path2D=Path2D2):warn("Cannot polyfill `Path2D`, rendering may be broken.")}},reason=>{warn(`loadPackages: ${reason}`),packageMap=new Map,packageCapability.resolve()})}const _NodePackages=class{static{__name(this,"_NodePackages")}static get promise(){return packageCapability.promise}static get(name){return packageMap?.get(name)}};__name2(_NodePackages,"NodePackages");let NodePackages=_NodePackages;const node_utils_fetchData=__name2(function(url){return NodePackages.get("fs").promises.readFile(url).then(data=>new Uint8Array(data))},"node_utils_fetchData"),_NodeFilterFactory=class extends BaseFilterFactory{static{__name(this,"_NodeFilterFactory")}};__name2(_NodeFilterFactory,"NodeFilterFactory");let NodeFilterFactory=_NodeFilterFactory;const _NodeCanvasFactory=class extends BaseCanvasFactory{static{__name(this,"_NodeCanvasFactory")}_createCanvas(width,height){return NodePackages.get("canvas").createCanvas(width,height)}};__name2(_NodeCanvasFactory,"NodeCanvasFactory");let NodeCanvasFactory=_NodeCanvasFactory;const _NodeCMapReaderFactory=class extends BaseCMapReaderFactory{static{__name(this,"_NodeCMapReaderFactory")}_fetchData(url,compressionType){return node_utils_fetchData(url).then(data=>({cMapData:data,compressionType}))}};__name2(_NodeCMapReaderFactory,"NodeCMapReaderFactory");let NodeCMapReaderFactory=_NodeCMapReaderFactory;const _NodeStandardFontDataFactory=class extends BaseStandardFontDataFactory{static{__name(this,"_NodeStandardFontDataFactory")}_fetchData(url){return node_utils_fetchData(url)}};__name2(_NodeStandardFontDataFactory,"NodeStandardFontDataFactory");let NodeStandardFontDataFactory=_NodeStandardFontDataFactory;const PathType={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function applyBoundingBox(ctx,bbox){if(!bbox)return;const width=bbox[2]-bbox[0],height=bbox[3]-bbox[1],region=new Path2D;region.rect(bbox[0],bbox[1],width,height),ctx.clip(region)}__name(applyBoundingBox,"applyBoundingBox"),__name2(applyBoundingBox,"applyBoundingBox");const _BaseShadingPattern=class _BaseShadingPattern2{static{__name(this,"_BaseShadingPattern")}constructor(){this.constructor===_BaseShadingPattern2&&unreachable("Cannot initialize BaseShadingPattern.")}getPattern(){unreachable("Abstract method `getPattern` called.")}};__name2(_BaseShadingPattern,"BaseShadingPattern");let BaseShadingPattern=_BaseShadingPattern;const _RadialAxialShadingPattern=class extends BaseShadingPattern{static{__name(this,"_RadialAxialShadingPattern")}constructor(IR){super(),this._type=IR[1],this._bbox=IR[2],this._colorStops=IR[3],this._p0=IR[4],this._p1=IR[5],this._r0=IR[6],this._r1=IR[7],this.matrix=null}_createGradient(ctx){let grad;this._type==="axial"?grad=ctx.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(grad=ctx.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const colorStop of this._colorStops)grad.addColorStop(colorStop[0],colorStop[1]);return grad}getPattern(ctx,owner,inverse,pathType){let pattern;if(pathType===PathType.STROKE||pathType===PathType.FILL){const ownerBBox=owner.current.getClippedPathBoundingBox(pathType,getCurrentTransform(ctx))||[0,0,0,0],width=Math.ceil(ownerBBox[2]-ownerBBox[0])||1,height=Math.ceil(ownerBBox[3]-ownerBBox[1])||1,tmpCanvas=owner.cachedCanvases.getCanvas("pattern",width,height,!0),tmpCtx=tmpCanvas.context;tmpCtx.clearRect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height),tmpCtx.beginPath(),tmpCtx.rect(0,0,tmpCtx.canvas.width,tmpCtx.canvas.height),tmpCtx.translate(-ownerBBox[0],-ownerBBox[1]),inverse=Util.transform(inverse,[1,0,0,1,ownerBBox[0],ownerBBox[1]]),tmpCtx.transform(...owner.baseTransform),this.matrix&&tmpCtx.transform(...this.matrix),applyBoundingBox(tmpCtx,this._bbox),tmpCtx.fillStyle=this._createGradient(tmpCtx),tmpCtx.fill(),pattern=ctx.createPattern(tmpCanvas.canvas,"no-repeat");const domMatrix=new DOMMatrix(inverse);pattern.setTransform(domMatrix)}else applyBoundingBox(ctx,this._bbox),pattern=this._createGradient(ctx);return pattern}};__name2(_RadialAxialShadingPattern,"RadialAxialShadingPattern");let RadialAxialShadingPattern=_RadialAxialShadingPattern;function drawTriangle(data,context,p1,p2,p3,c1,c2,c3){const coords=context.coords,colors=context.colors,bytes=data.data,rowSize=data.width*4;let tmp;coords[p1+1]>coords[p2+1]&&(tmp=p1,p1=p2,p2=tmp,tmp=c1,c1=c2,c2=tmp),coords[p2+1]>coords[p3+1]&&(tmp=p2,p2=p3,p3=tmp,tmp=c2,c2=c3,c3=tmp),coords[p1+1]>coords[p2+1]&&(tmp=p1,p1=p2,p2=tmp,tmp=c1,c1=c2,c2=tmp);const x1=(coords[p1]+context.offsetX)*context.scaleX,y1=(coords[p1+1]+context.offsetY)*context.scaleY,x2=(coords[p2]+context.offsetX)*context.scaleX,y2=(coords[p2+1]+context.offsetY)*context.scaleY,x3=(coords[p3]+context.offsetX)*context.scaleX,y3=(coords[p3+1]+context.offsetY)*context.scaleY;if(y1>=y3)return;const c1r=colors[c1],c1g=colors[c1+1],c1b=colors[c1+2],c2r=colors[c2],c2g=colors[c2+1],c2b=colors[c2+2],c3r=colors[c3],c3g=colors[c3+1],c3b=colors[c3+2],minY=Math.round(y1),maxY=Math.round(y3);let xa,car,cag,cab,xb,cbr,cbg,cbb;for(let y=minY;y<=maxY;y++){if(y<y2){const k2=y<y1?0:(y1-y)/(y1-y2);xa=x1-(x1-x2)*k2,car=c1r-(c1r-c2r)*k2,cag=c1g-(c1g-c2g)*k2,cab=c1b-(c1b-c2b)*k2}else{let k2;y>y3?k2=1:y2===y3?k2=0:k2=(y2-y)/(y2-y3),xa=x2-(x2-x3)*k2,car=c2r-(c2r-c3r)*k2,cag=c2g-(c2g-c3g)*k2,cab=c2b-(c2b-c3b)*k2}let k;y<y1?k=0:y>y3?k=1:k=(y1-y)/(y1-y3),xb=x1-(x1-x3)*k,cbr=c1r-(c1r-c3r)*k,cbg=c1g-(c1g-c3g)*k,cbb=c1b-(c1b-c3b)*k;const x1_=Math.round(Math.min(xa,xb)),x2_=Math.round(Math.max(xa,xb));let j=rowSize*y+x1_*4;for(let x=x1_;x<=x2_;x++)k=(xa-x)/(xa-xb),k<0?k=0:k>1&&(k=1),bytes[j++]=car-(car-cbr)*k|0,bytes[j++]=cag-(cag-cbg)*k|0,bytes[j++]=cab-(cab-cbb)*k|0,bytes[j++]=255}}__name(drawTriangle,"drawTriangle"),__name2(drawTriangle,"drawTriangle");function drawFigure(data,figure,context){const ps=figure.coords,cs=figure.colors;let i,ii;switch(figure.type){case"lattice":const verticesPerRow=figure.verticesPerRow,rows=Math.floor(ps.length/verticesPerRow)-1,cols=verticesPerRow-1;for(i=0;i<rows;i++){let q=i*verticesPerRow;for(let j=0;j<cols;j++,q++)drawTriangle(data,context,ps[q],ps[q+1],ps[q+verticesPerRow],cs[q],cs[q+1],cs[q+verticesPerRow]),drawTriangle(data,context,ps[q+verticesPerRow+1],ps[q+1],ps[q+verticesPerRow],cs[q+verticesPerRow+1],cs[q+1],cs[q+verticesPerRow])}break;case"triangles":for(i=0,ii=ps.length;i<ii;i+=3)drawTriangle(data,context,ps[i],ps[i+1],ps[i+2],cs[i],cs[i+1],cs[i+2]);break;default:throw new Error("illegal figure")}}__name(drawFigure,"drawFigure"),__name2(drawFigure,"drawFigure");const _MeshShadingPattern=class extends BaseShadingPattern{static{__name(this,"_MeshShadingPattern")}constructor(IR){super(),this._coords=IR[2],this._colors=IR[3],this._figures=IR[4],this._bounds=IR[5],this._bbox=IR[7],this._background=IR[8],this.matrix=null}_createMeshCanvas(combinedScale,backgroundColor,cachedCanvases){const offsetX=Math.floor(this._bounds[0]),offsetY=Math.floor(this._bounds[1]),boundsWidth=Math.ceil(this._bounds[2])-offsetX,boundsHeight=Math.ceil(this._bounds[3])-offsetY,width=Math.min(Math.ceil(Math.abs(boundsWidth*combinedScale[0]*1.1)),3e3),height=Math.min(Math.ceil(Math.abs(boundsHeight*combinedScale[1]*1.1)),3e3),scaleX=boundsWidth/width,scaleY=boundsHeight/height,context={coords:this._coords,colors:this._colors,offsetX:-offsetX,offsetY:-offsetY,scaleX:1/scaleX,scaleY:1/scaleY},paddedWidth=width+2*2,paddedHeight=height+2*2,tmpCanvas=cachedCanvases.getCanvas("mesh",paddedWidth,paddedHeight,!1),tmpCtx=tmpCanvas.context,data=tmpCtx.createImageData(width,height);if(backgroundColor){const bytes=data.data;for(let i=0,ii=bytes.length;i<ii;i+=4)bytes[i]=backgroundColor[0],bytes[i+1]=backgroundColor[1],bytes[i+2]=backgroundColor[2],bytes[i+3]=255}for(const figure of this._figures)drawFigure(data,figure,context);return tmpCtx.putImageData(data,2,2),{canvas:tmpCanvas.canvas,offsetX:offsetX-2*scaleX,offsetY:offsetY-2*scaleY,scaleX,scaleY}}getPattern(ctx,owner,inverse,pathType){applyBoundingBox(ctx,this._bbox);let scale;if(pathType===PathType.SHADING)scale=Util.singularValueDecompose2dScale(getCurrentTransform(ctx));else if(scale=Util.singularValueDecompose2dScale(owner.baseTransform),this.matrix){const matrixScale=Util.singularValueDecompose2dScale(this.matrix);scale=[scale[0]*matrixScale[0],scale[1]*matrixScale[1]]}const temporaryPatternCanvas=this._createMeshCanvas(scale,pathType===PathType.SHADING?null:this._background,owner.cachedCanvases);return pathType!==PathType.SHADING&&(ctx.setTransform(...owner.baseTransform),this.matrix&&ctx.transform(...this.matrix)),ctx.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY),ctx.scale(temporaryPatternCanvas.scaleX,temporaryPatternCanvas.scaleY),ctx.createPattern(temporaryPatternCanvas.canvas,"no-repeat")}};__name2(_MeshShadingPattern,"MeshShadingPattern");let MeshShadingPattern=_MeshShadingPattern;const _DummyShadingPattern=class extends BaseShadingPattern{static{__name(this,"_DummyShadingPattern")}getPattern(){return"hotpink"}};__name2(_DummyShadingPattern,"DummyShadingPattern");let DummyShadingPattern=_DummyShadingPattern;function getShadingPattern(IR){switch(IR[0]){case"RadialAxial":return new RadialAxialShadingPattern(IR);case"Mesh":return new MeshShadingPattern(IR);case"Dummy":return new DummyShadingPattern}throw new Error(`Unknown IR type: ${IR[0]}`)}__name(getShadingPattern,"getShadingPattern"),__name2(getShadingPattern,"getShadingPattern");const PaintType={COLORED:1,UNCOLORED:2},_TilingPattern=class _TilingPattern2{static{__name(this,"_TilingPattern")}constructor(IR,color,ctx,canvasGraphicsFactory,baseTransform){this.operatorList=IR[2],this.matrix=IR[3],this.bbox=IR[4],this.xstep=IR[5],this.ystep=IR[6],this.paintType=IR[7],this.tilingType=IR[8],this.color=color,this.ctx=ctx,this.canvasGraphicsFactory=canvasGraphicsFactory,this.baseTransform=baseTransform}createPatternCanvas(owner){const operatorList=this.operatorList,bbox=this.bbox,xstep=this.xstep,ystep=this.ystep,paintType=this.paintType,tilingType=this.tilingType,color=this.color,canvasGraphicsFactory=this.canvasGraphicsFactory;info("TilingType: "+tilingType);const x0=bbox[0],y0=bbox[1],x1=bbox[2],y1=bbox[3],matrixScale=Util.singularValueDecompose2dScale(this.matrix),curMatrixScale=Util.singularValueDecompose2dScale(this.baseTransform),combinedScale=[matrixScale[0]*curMatrixScale[0],matrixScale[1]*curMatrixScale[1]],dimx=this.getSizeAndScale(xstep,this.ctx.canvas.width,combinedScale[0]),dimy=this.getSizeAndScale(ystep,this.ctx.canvas.height,combinedScale[1]),tmpCanvas=owner.cachedCanvases.getCanvas("pattern",dimx.size,dimy.size,!0),tmpCtx=tmpCanvas.context,graphics=canvasGraphicsFactory.createCanvasGraphics(tmpCtx);graphics.groupLevel=owner.groupLevel,this.setFillAndStrokeStyleToContext(graphics,paintType,color);let adjustedX0=x0,adjustedY0=y0,adjustedX1=x1,adjustedY1=y1;return x0<0&&(adjustedX0=0,adjustedX1+=Math.abs(x0)),y0<0&&(adjustedY0=0,adjustedY1+=Math.abs(y0)),tmpCtx.translate(-(dimx.scale*adjustedX0),-(dimy.scale*adjustedY0)),graphics.transform(dimx.scale,0,0,dimy.scale,0,0),tmpCtx.save(),this.clipBbox(graphics,adjustedX0,adjustedY0,adjustedX1,adjustedY1),graphics.baseTransform=getCurrentTransform(graphics.ctx),graphics.executeOperatorList(operatorList),graphics.endDrawing(),{canvas:tmpCanvas.canvas,scaleX:dimx.scale,scaleY:dimy.scale,offsetX:adjustedX0,offsetY:adjustedY0}}getSizeAndScale(step,realOutputSize,scale){step=Math.abs(step);const maxSize=Math.max(_TilingPattern2.MAX_PATTERN_SIZE,realOutputSize);let size=Math.ceil(step*scale);return size>=maxSize?size=maxSize:scale=size/step,{scale,size}}clipBbox(graphics,x0,y0,x1,y1){const bboxWidth=x1-x0,bboxHeight=y1-y0;graphics.ctx.rect(x0,y0,bboxWidth,bboxHeight),graphics.current.updateRectMinMax(getCurrentTransform(graphics.ctx),[x0,y0,x1,y1]),graphics.clip(),graphics.endPath()}setFillAndStrokeStyleToContext(graphics,paintType,color){const context=graphics.ctx,current=graphics.current;switch(paintType){case PaintType.COLORED:const ctx=this.ctx;context.fillStyle=ctx.fillStyle,context.strokeStyle=ctx.strokeStyle,current.fillColor=ctx.fillStyle,current.strokeColor=ctx.strokeStyle;break;case PaintType.UNCOLORED:const cssColor=Util.makeHexColor(color[0],color[1],color[2]);context.fillStyle=cssColor,context.strokeStyle=cssColor,current.fillColor=cssColor,current.strokeColor=cssColor;break;default:throw new FormatError(`Unsupported paint type: ${paintType}`)}}getPattern(ctx,owner,inverse,pathType){let matrix=inverse;pathType!==PathType.SHADING&&(matrix=Util.transform(matrix,owner.baseTransform),this.matrix&&(matrix=Util.transform(matrix,this.matrix)));const temporaryPatternCanvas=this.createPatternCanvas(owner);let domMatrix=new DOMMatrix(matrix);domMatrix=domMatrix.translate(temporaryPatternCanvas.offsetX,temporaryPatternCanvas.offsetY),domMatrix=domMatrix.scale(1/temporaryPatternCanvas.scaleX,1/temporaryPatternCanvas.scaleY);const pattern=ctx.createPattern(temporaryPatternCanvas.canvas,"repeat");return pattern.setTransform(domMatrix),pattern}};__name2(_TilingPattern,"TilingPattern"),__publicField(_TilingPattern,"MAX_PATTERN_SIZE",3e3);let TilingPattern=_TilingPattern;function convertBlackAndWhiteToRGBA({src,srcPos=0,dest,width,height,nonBlackColor=4294967295,inverseDecode=!1}){const black=util_FeatureTest.isLittleEndian?4278190080:255,[zeroMapping,oneMapping]=inverseDecode?[nonBlackColor,black]:[black,nonBlackColor],widthInSource=width>>3,widthRemainder=width&7,srcLength=src.length;dest=new Uint32Array(dest.buffer);let destPos=0;for(let i=0;i<height;i++){for(const max=srcPos+widthInSource;srcPos<max;srcPos++){const elem2=srcPos<srcLength?src[srcPos]:255;dest[destPos++]=elem2&128?oneMapping:zeroMapping,dest[destPos++]=elem2&64?oneMapping:zeroMapping,dest[destPos++]=elem2&32?oneMapping:zeroMapping,dest[destPos++]=elem2&16?oneMapping:zeroMapping,dest[destPos++]=elem2&8?oneMapping:zeroMapping,dest[destPos++]=elem2&4?oneMapping:zeroMapping,dest[destPos++]=elem2&2?oneMapping:zeroMapping,dest[destPos++]=elem2&1?oneMapping:zeroMapping}if(widthRemainder===0)continue;const elem=srcPos<srcLength?src[srcPos++]:255;for(let j=0;j<widthRemainder;j++)dest[destPos++]=elem&1<<7-j?oneMapping:zeroMapping}return{srcPos,destPos}}__name(convertBlackAndWhiteToRGBA,"convertBlackAndWhiteToRGBA"),__name2(convertBlackAndWhiteToRGBA,"convertBlackAndWhiteToRGBA");const MIN_FONT_SIZE=16,MAX_FONT_SIZE=100,EXECUTION_TIME=15,EXECUTION_STEPS=10,MAX_SIZE_TO_COMPILE=1e3,FULL_CHUNK_HEIGHT=16;function mirrorContextOperations(ctx,destCtx){if(ctx._removeMirroring)throw new Error("Context is already forwarding operations.");ctx.__originalSave=ctx.save,ctx.__originalRestore=ctx.restore,ctx.__originalRotate=ctx.rotate,ctx.__originalScale=ctx.scale,ctx.__originalTranslate=ctx.translate,ctx.__originalTransform=ctx.transform,ctx.__originalSetTransform=ctx.setTransform,ctx.__originalResetTransform=ctx.resetTransform,ctx.__originalClip=ctx.clip,ctx.__originalMoveTo=ctx.moveTo,ctx.__originalLineTo=ctx.lineTo,ctx.__originalBezierCurveTo=ctx.bezierCurveTo,ctx.__originalRect=ctx.rect,ctx.__originalClosePath=ctx.closePath,ctx.__originalBeginPath=ctx.beginPath,ctx._removeMirroring=()=>{ctx.save=ctx.__originalSave,ctx.restore=ctx.__originalRestore,ctx.rotate=ctx.__originalRotate,ctx.scale=ctx.__originalScale,ctx.translate=ctx.__originalTranslate,ctx.transform=ctx.__originalTransform,ctx.setTransform=ctx.__originalSetTransform,ctx.resetTransform=ctx.__originalResetTransform,ctx.clip=ctx.__originalClip,ctx.moveTo=ctx.__originalMoveTo,ctx.lineTo=ctx.__originalLineTo,ctx.bezierCurveTo=ctx.__originalBezierCurveTo,ctx.rect=ctx.__originalRect,ctx.closePath=ctx.__originalClosePath,ctx.beginPath=ctx.__originalBeginPath,delete ctx._removeMirroring},ctx.save=__name2(__name(function(){destCtx.save(),this.__originalSave()},"ctxSave"),"ctxSave"),ctx.restore=__name2(__name(function(){destCtx.restore(),this.__originalRestore()},"ctxRestore"),"ctxRestore"),ctx.translate=__name2(__name(function(x,y){destCtx.translate(x,y),this.__originalTranslate(x,y)},"ctxTranslate"),"ctxTranslate"),ctx.scale=__name2(__name(function(x,y){destCtx.scale(x,y),this.__originalScale(x,y)},"ctxScale"),"ctxScale"),ctx.transform=__name2(__name(function(a,b,c,d,e,f){destCtx.transform(a,b,c,d,e,f),this.__originalTransform(a,b,c,d,e,f)},"ctxTransform"),"ctxTransform"),ctx.setTransform=__name2(__name(function(a,b,c,d,e,f){destCtx.setTransform(a,b,c,d,e,f),this.__originalSetTransform(a,b,c,d,e,f)},"ctxSetTransform"),"ctxSetTransform"),ctx.resetTransform=__name2(__name(function(){destCtx.resetTransform(),this.__originalResetTransform()},"ctxResetTransform"),"ctxResetTransform"),ctx.rotate=__name2(__name(function(angle){destCtx.rotate(angle),this.__originalRotate(angle)},"ctxRotate"),"ctxRotate"),ctx.clip=__name2(__name(function(rule){destCtx.clip(rule),this.__originalClip(rule)},"ctxRotate"),"ctxRotate"),ctx.moveTo=function(x,y){destCtx.moveTo(x,y),this.__originalMoveTo(x,y)},ctx.lineTo=function(x,y){destCtx.lineTo(x,y),this.__originalLineTo(x,y)},ctx.bezierCurveTo=function(cp1x,cp1y,cp2x,cp2y,x,y){destCtx.bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y),this.__originalBezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y)},ctx.rect=function(x,y,width,height){destCtx.rect(x,y,width,height),this.__originalRect(x,y,width,height)},ctx.closePath=function(){destCtx.closePath(),this.__originalClosePath()},ctx.beginPath=function(){destCtx.beginPath(),this.__originalBeginPath()}}__name(mirrorContextOperations,"mirrorContextOperations"),__name2(mirrorContextOperations,"mirrorContextOperations");const _CachedCanvases=class{static{__name(this,"_CachedCanvases")}constructor(canvasFactory){this.canvasFactory=canvasFactory,this.cache=Object.create(null)}getCanvas(id,width,height){let canvasEntry;return this.cache[id]!==void 0?(canvasEntry=this.cache[id],this.canvasFactory.reset(canvasEntry,width,height)):(canvasEntry=this.canvasFactory.create(width,height),this.cache[id]=canvasEntry),canvasEntry}delete(id){delete this.cache[id]}clear(){for(const id in this.cache){const canvasEntry=this.cache[id];this.canvasFactory.destroy(canvasEntry),delete this.cache[id]}}};__name2(_CachedCanvases,"CachedCanvases");let CachedCanvases=_CachedCanvases;function drawImageAtIntegerCoords(ctx,srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH){const[a,b,c,d,tx,ty]=getCurrentTransform(ctx);if(b===0&&c===0){const tlX=destX*a+tx,rTlX=Math.round(tlX),tlY=destY*d+ty,rTlY=Math.round(tlY),brX=(destX+destW)*a+tx,rWidth=Math.abs(Math.round(brX)-rTlX)||1,brY=(destY+destH)*d+ty,rHeight=Math.abs(Math.round(brY)-rTlY)||1;return ctx.setTransform(Math.sign(a),0,0,Math.sign(d),rTlX,rTlY),ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rWidth,rHeight),ctx.setTransform(a,b,c,d,tx,ty),[rWidth,rHeight]}if(a===0&&d===0){const tlX=destY*c+tx,rTlX=Math.round(tlX),tlY=destX*b+ty,rTlY=Math.round(tlY),brX=(destY+destH)*c+tx,rWidth=Math.abs(Math.round(brX)-rTlX)||1,brY=(destX+destW)*b+ty,rHeight=Math.abs(Math.round(brY)-rTlY)||1;return ctx.setTransform(0,Math.sign(b),Math.sign(c),0,rTlX,rTlY),ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,0,0,rHeight,rWidth),ctx.setTransform(a,b,c,d,tx,ty),[rHeight,rWidth]}ctx.drawImage(srcImg,srcX,srcY,srcW,srcH,destX,destY,destW,destH);const scaleX=Math.hypot(a,b),scaleY=Math.hypot(c,d);return[scaleX*destW,scaleY*destH]}__name(drawImageAtIntegerCoords,"drawImageAtIntegerCoords"),__name2(drawImageAtIntegerCoords,"drawImageAtIntegerCoords");function compileType3Glyph(imgData){const{width,height}=imgData;if(width>MAX_SIZE_TO_COMPILE||height>MAX_SIZE_TO_COMPILE)return null;const POINT_TO_PROCESS_LIMIT=1e3,POINT_TYPES=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),width1=width+1;let points=new Uint8Array(width1*(height+1)),i,j,j0;const lineSize=width+7&-8;let data=new Uint8Array(lineSize*height),pos=0;for(const elem of imgData.data){let mask=128;for(;mask>0;)data[pos++]=elem&mask?0:255,mask>>=1}let count=0;for(pos=0,data[pos]!==0&&(points[0]=1,++count),j=1;j<width;j++)data[pos]!==data[pos+1]&&(points[j]=data[pos]?2:1,++count),pos++;for(data[pos]!==0&&(points[j]=2,++count),i=1;i<height;i++){pos=i*lineSize,j0=i*width1,data[pos-lineSize]!==data[pos]&&(points[j0]=data[pos]?1:8,++count);let sum=(data[pos]?4:0)+(data[pos-lineSize]?8:0);for(j=1;j<width;j++)sum=(sum>>2)+(data[pos+1]?4:0)+(data[pos-lineSize+1]?8:0),POINT_TYPES[sum]&&(points[j0+j]=POINT_TYPES[sum],++count),pos++;if(data[pos-lineSize]!==data[pos]&&(points[j0+j]=data[pos]?2:4,++count),count>POINT_TO_PROCESS_LIMIT)return null}for(pos=lineSize*(height-1),j0=i*width1,data[pos]!==0&&(points[j0]=8,++count),j=1;j<width;j++)data[pos]!==data[pos+1]&&(points[j0+j]=data[pos]?4:8,++count),pos++;if(data[pos]!==0&&(points[j0+j]=4,++count),count>POINT_TO_PROCESS_LIMIT)return null;const steps=new Int32Array([0,width1,-1,0,-width1,0,0,0,1]),path=new Path2D;for(i=0;count&&i<=height;i++){let p=i*width1;const end=p+width;for(;p<end&&!points[p];)p++;if(p===end)continue;path.moveTo(p%width1,i);const p0=p;let type=points[p];do{const step=steps[type];do p+=step;while(!points[p]);const pp=points[p];pp!==5&&pp!==10?(type=pp,points[p]=0):(type=pp&51*type>>4,points[p]&=type>>2|type<<2),path.lineTo(p%width1,p/width1|0),points[p]||--count}while(p0!==p);--i}return data=null,points=null,__name2(function(c){c.save(),c.scale(1/width,-1/height),c.translate(0,-height),c.fill(path),c.beginPath(),c.restore()},"drawOutline")}__name(compileType3Glyph,"compileType3Glyph"),__name2(compileType3Glyph,"compileType3Glyph");const _CanvasExtraState=class{static{__name(this,"_CanvasExtraState")}constructor(width,height){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,width,height])}clone(){const clone=Object.create(this);return clone.clipBox=this.clipBox.slice(),clone}setCurrentPoint(x,y){this.x=x,this.y=y}updatePathMinMax(transform,x,y){[x,y]=Util.applyTransform([x,y],transform),this.minX=Math.min(this.minX,x),this.minY=Math.min(this.minY,y),this.maxX=Math.max(this.maxX,x),this.maxY=Math.max(this.maxY,y)}updateRectMinMax(transform,rect){const p1=Util.applyTransform(rect,transform),p2=Util.applyTransform(rect.slice(2),transform),p3=Util.applyTransform([rect[0],rect[3]],transform),p4=Util.applyTransform([rect[2],rect[1]],transform);this.minX=Math.min(this.minX,p1[0],p2[0],p3[0],p4[0]),this.minY=Math.min(this.minY,p1[1],p2[1],p3[1],p4[1]),this.maxX=Math.max(this.maxX,p1[0],p2[0],p3[0],p4[0]),this.maxY=Math.max(this.maxY,p1[1],p2[1],p3[1],p4[1])}updateScalingPathMinMax(transform,minMax){Util.scaleMinMax(transform,minMax),this.minX=Math.min(this.minX,minMax[0]),this.minY=Math.min(this.minY,minMax[1]),this.maxX=Math.max(this.maxX,minMax[2]),this.maxY=Math.max(this.maxY,minMax[3])}updateCurvePathMinMax(transform,x0,y0,x1,y1,x2,y2,x3,y3,minMax){const box=Util.bezierBoundingBox(x0,y0,x1,y1,x2,y2,x3,y3,minMax);minMax||this.updateRectMinMax(transform,box)}getPathBoundingBox(pathType=PathType.FILL,transform=null){const box=[this.minX,this.minY,this.maxX,this.maxY];if(pathType===PathType.STROKE){transform||unreachable("Stroke bounding box must include transform.");const scale=Util.singularValueDecompose2dScale(transform),xStrokePad=scale[0]*this.lineWidth/2,yStrokePad=scale[1]*this.lineWidth/2;box[0]-=xStrokePad,box[1]-=yStrokePad,box[2]+=xStrokePad,box[3]+=yStrokePad}return box}updateClipFromPath(){const intersect=Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(intersect||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(box){this.clipBox=box,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(pathType=PathType.FILL,transform=null){return Util.intersect(this.clipBox,this.getPathBoundingBox(pathType,transform))}};__name2(_CanvasExtraState,"CanvasExtraState");let CanvasExtraState=_CanvasExtraState;function putBinaryImageData(ctx,imgData){if(typeof ImageData<"u"&&imgData instanceof ImageData){ctx.putImageData(imgData,0,0);return}const height=imgData.height,width=imgData.width,partialChunkHeight=height%FULL_CHUNK_HEIGHT,fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT,totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1,chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);let srcPos=0,destPos;const src=imgData.data,dest=chunkImgData.data;let i,j,thisChunkHeight,elemsInThisChunk;if(imgData.kind===util_ImageKind.GRAYSCALE_1BPP){const srcLength=src.byteLength,dest32=new Uint32Array(dest.buffer,0,dest.byteLength>>2),dest32DataLength=dest32.length,fullSrcDiff=width+7>>3,white=4294967295,black=util_FeatureTest.isLittleEndian?4278190080:255;for(i=0;i<totalChunks;i++){for(thisChunkHeight=i<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight,destPos=0,j=0;j<thisChunkHeight;j++){const srcDiff=srcLength-srcPos;let k=0;const kEnd=srcDiff>fullSrcDiff?width:srcDiff*8-7,kEndUnrolled=kEnd&-8;let mask=0,srcByte=0;for(;k<kEndUnrolled;k+=8)srcByte=src[srcPos++],dest32[destPos++]=srcByte&128?white:black,dest32[destPos++]=srcByte&64?white:black,dest32[destPos++]=srcByte&32?white:black,dest32[destPos++]=srcByte&16?white:black,dest32[destPos++]=srcByte&8?white:black,dest32[destPos++]=srcByte&4?white:black,dest32[destPos++]=srcByte&2?white:black,dest32[destPos++]=srcByte&1?white:black;for(;k<kEnd;k++)mask===0&&(srcByte=src[srcPos++],mask=128),dest32[destPos++]=srcByte&mask?white:black,mask>>=1}for(;destPos<dest32DataLength;)dest32[destPos++]=0;ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT)}}else if(imgData.kind===util_ImageKind.RGBA_32BPP){for(j=0,elemsInThisChunk=width*FULL_CHUNK_HEIGHT*4,i=0;i<fullChunks;i++)dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk)),srcPos+=elemsInThisChunk,ctx.putImageData(chunkImgData,0,j),j+=FULL_CHUNK_HEIGHT;i<totalChunks&&(elemsInThisChunk=width*partialChunkHeight*4,dest.set(src.subarray(srcPos,srcPos+elemsInThisChunk)),ctx.putImageData(chunkImgData,0,j))}else if(imgData.kind===util_ImageKind.RGB_24BPP)for(thisChunkHeight=FULL_CHUNK_HEIGHT,elemsInThisChunk=width*thisChunkHeight,i=0;i<totalChunks;i++){for(i>=fullChunks&&(thisChunkHeight=partialChunkHeight,elemsInThisChunk=width*thisChunkHeight),destPos=0,j=elemsInThisChunk;j--;)dest[destPos++]=src[srcPos++],dest[destPos++]=src[srcPos++],dest[destPos++]=src[srcPos++],dest[destPos++]=255;ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT)}else throw new Error(`bad image kind: ${imgData.kind}`)}__name(putBinaryImageData,"putBinaryImageData"),__name2(putBinaryImageData,"putBinaryImageData");function putBinaryImageMask(ctx,imgData){if(imgData.bitmap){ctx.drawImage(imgData.bitmap,0,0);return}const height=imgData.height,width=imgData.width,partialChunkHeight=height%FULL_CHUNK_HEIGHT,fullChunks=(height-partialChunkHeight)/FULL_CHUNK_HEIGHT,totalChunks=partialChunkHeight===0?fullChunks:fullChunks+1,chunkImgData=ctx.createImageData(width,FULL_CHUNK_HEIGHT);let srcPos=0;const src=imgData.data,dest=chunkImgData.data;for(let i=0;i<totalChunks;i++){const thisChunkHeight=i<fullChunks?FULL_CHUNK_HEIGHT:partialChunkHeight;({srcPos}=convertBlackAndWhiteToRGBA({src,srcPos,dest,width,height:thisChunkHeight,nonBlackColor:0})),ctx.putImageData(chunkImgData,0,i*FULL_CHUNK_HEIGHT)}}__name(putBinaryImageMask,"putBinaryImageMask"),__name2(putBinaryImageMask,"putBinaryImageMask");function copyCtxState(sourceCtx,destCtx){const properties=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const property of properties)sourceCtx[property]!==void 0&&(destCtx[property]=sourceCtx[property]);sourceCtx.setLineDash!==void 0&&(destCtx.setLineDash(sourceCtx.getLineDash()),destCtx.lineDashOffset=sourceCtx.lineDashOffset)}__name(copyCtxState,"copyCtxState"),__name2(copyCtxState,"copyCtxState");function resetCtxToDefault(ctx){if(ctx.strokeStyle=ctx.fillStyle="#000000",ctx.fillRule="nonzero",ctx.globalAlpha=1,ctx.lineWidth=1,ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=10,ctx.globalCompositeOperation="source-over",ctx.font="10px sans-serif",ctx.setLineDash!==void 0&&(ctx.setLineDash([]),ctx.lineDashOffset=0),!isNodeJS){const{filter:filter2}=ctx;filter2!=="none"&&filter2!==""&&(ctx.filter="none")}}__name(resetCtxToDefault,"resetCtxToDefault"),__name2(resetCtxToDefault,"resetCtxToDefault");function getImageSmoothingEnabled(transform,interpolate){if(interpolate)return!0;const scale=Util.singularValueDecompose2dScale(transform);scale[0]=Math.fround(scale[0]),scale[1]=Math.fround(scale[1]);const actualScale=Math.fround((globalThis.devicePixelRatio||1)*PixelsPerInch.PDF_TO_CSS_UNITS);return scale[0]<=actualScale&&scale[1]<=actualScale}__name(getImageSmoothingEnabled,"getImageSmoothingEnabled"),__name2(getImageSmoothingEnabled,"getImageSmoothingEnabled");const LINE_CAP_STYLES=["butt","round","square"],LINE_JOIN_STYLES=["miter","round","bevel"],NORMAL_CLIP={},EO_CLIP={},_CanvasGraphics=class _CanvasGraphics2{static{__name(this,"_CanvasGraphics")}constructor(canvasCtx,commonObjs,objs,canvasFactory,filterFactory,{optionalContentConfig,markedContentStack=null},annotationCanvasMap,pageColors){__privateAdd(this,_CanvasGraphics_instances),this.ctx=canvasCtx,this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=commonObjs,this.objs=objs,this.canvasFactory=canvasFactory,this.filterFactory=filterFactory,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=markedContentStack||[],this.optionalContentConfig=optionalContentConfig,this.cachedCanvases=new CachedCanvases(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=annotationCanvasMap,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=pageColors,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(data,fallback=null){return typeof data=="string"?data.startsWith("g_")?this.commonObjs.get(data):this.objs.get(data):fallback}beginDrawing({transform,viewport,transparency=!1,background=null}){const width=this.ctx.canvas.width,height=this.ctx.canvas.height,savedFillStyle=this.ctx.fillStyle;if(this.ctx.fillStyle=background||"#ffffff",this.ctx.fillRect(0,0,width,height),this.ctx.fillStyle=savedFillStyle,transparency){const transparentCanvas=this.cachedCanvases.getCanvas("transparent",width,height);this.compositeCtx=this.ctx,this.transparentCanvas=transparentCanvas.canvas,this.ctx=transparentCanvas.context,this.ctx.save(),this.ctx.transform(...getCurrentTransform(this.compositeCtx))}this.ctx.save(),resetCtxToDefault(this.ctx),transform&&(this.ctx.transform(...transform),this.outputScaleX=transform[0],this.outputScaleY=transform[0]),this.ctx.transform(...viewport.transform),this.viewportScale=viewport.scale,this.baseTransform=getCurrentTransform(this.ctx)}executeOperatorList(operatorList,executionStartIdx,continueCallback,stepper){const argsArray=operatorList.argsArray,fnArray=operatorList.fnArray;let i=executionStartIdx||0;const argsArrayLen=argsArray.length;if(argsArrayLen===i)return i;const chunkOperations=argsArrayLen-i>EXECUTION_STEPS&&typeof continueCallback=="function",endTime=chunkOperations?Date.now()+EXECUTION_TIME:0;let steps=0;const commonObjs=this.commonObjs,objs=this.objs;let fnId;for(;;){if(stepper!==void 0&&i===stepper.nextBreakPoint)return stepper.breakIt(i,continueCallback),i;if(fnId=fnArray[i],fnId!==OPS.dependency)this[fnId].apply(this,argsArray[i]);else for(const depObjId of argsArray[i]){const objsPool=depObjId.startsWith("g_")?commonObjs:objs;if(!objsPool.has(depObjId))return objsPool.get(depObjId,continueCallback),i}if(i++,i===argsArrayLen)return i;if(chunkOperations&&++steps>EXECUTION_STEPS){if(Date.now()>endTime)return continueCallback(),i;steps=0}}}endDrawing(){__privateMethod(this,_CanvasGraphics_instances,restoreInitialState_fn).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const cache of this._cachedBitmapsMap.values()){for(const canvas of cache.values())typeof HTMLCanvasElement<"u"&&canvas instanceof HTMLCanvasElement&&(canvas.width=canvas.height=0);cache.clear()}this._cachedBitmapsMap.clear(),__privateMethod(this,_CanvasGraphics_instances,drawFilter_fn).call(this)}_scaleImage(img,inverseTransform){const width=img.width,height=img.height;let widthScale=Math.max(Math.hypot(inverseTransform[0],inverseTransform[1]),1),heightScale=Math.max(Math.hypot(inverseTransform[2],inverseTransform[3]),1),paintWidth=width,paintHeight=height,tmpCanvasId="prescale1",tmpCanvas,tmpCtx;for(;widthScale>2&&paintWidth>1||heightScale>2&&paintHeight>1;){let newWidth=paintWidth,newHeight=paintHeight;widthScale>2&&paintWidth>1&&(newWidth=paintWidth>=16384?Math.floor(paintWidth/2)-1||1:Math.ceil(paintWidth/2),widthScale/=paintWidth/newWidth),heightScale>2&&paintHeight>1&&(newHeight=paintHeight>=16384?Math.floor(paintHeight/2)-1||1:Math.ceil(paintHeight)/2,heightScale/=paintHeight/newHeight),tmpCanvas=this.cachedCanvases.getCanvas(tmpCanvasId,newWidth,newHeight),tmpCtx=tmpCanvas.context,tmpCtx.clearRect(0,0,newWidth,newHeight),tmpCtx.drawImage(img,0,0,paintWidth,paintHeight,0,0,newWidth,newHeight),img=tmpCanvas.canvas,paintWidth=newWidth,paintHeight=newHeight,tmpCanvasId=tmpCanvasId==="prescale1"?"prescale2":"prescale1"}return{img,paintWidth,paintHeight}}_createMaskCanvas(img){const ctx=this.ctx,{width,height}=img,fillColor=this.current.fillColor,isPatternFill=this.current.patternFill,currentTransform=getCurrentTransform(ctx);let cache,cacheKey,scaled,maskCanvas;if((img.bitmap||img.data)&&img.count>1){const mainKey=img.bitmap||img.data.buffer;cacheKey=JSON.stringify(isPatternFill?currentTransform:[currentTransform.slice(0,4),fillColor]),cache=this._cachedBitmapsMap.get(mainKey),cache||(cache=new Map,this._cachedBitmapsMap.set(mainKey,cache));const cachedImage=cache.get(cacheKey);if(cachedImage&&!isPatternFill){const offsetX2=Math.round(Math.min(currentTransform[0],currentTransform[2])+currentTransform[4]),offsetY2=Math.round(Math.min(currentTransform[1],currentTransform[3])+currentTransform[5]);return{canvas:cachedImage,offsetX:offsetX2,offsetY:offsetY2}}scaled=cachedImage}scaled||(maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height),putBinaryImageMask(maskCanvas.context,img));let maskToCanvas=Util.transform(currentTransform,[1/width,0,0,-1/height,0,0]);maskToCanvas=Util.transform(maskToCanvas,[1,0,0,1,0,-height]);const[minX,minY,maxX,maxY]=Util.getAxialAlignedBoundingBox([0,0,width,height],maskToCanvas),drawnWidth=Math.round(maxX-minX)||1,drawnHeight=Math.round(maxY-minY)||1,fillCanvas=this.cachedCanvases.getCanvas("fillCanvas",drawnWidth,drawnHeight),fillCtx=fillCanvas.context,offsetX=minX,offsetY=minY;fillCtx.translate(-offsetX,-offsetY),fillCtx.transform(...maskToCanvas),scaled||(scaled=this._scaleImage(maskCanvas.canvas,getCurrentTransformInverse(fillCtx)),scaled=scaled.img,cache&&isPatternFill&&cache.set(cacheKey,scaled)),fillCtx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(fillCtx),img.interpolate),drawImageAtIntegerCoords(fillCtx,scaled,0,0,scaled.width,scaled.height,0,0,width,height),fillCtx.globalCompositeOperation="source-in";const inverse=Util.transform(getCurrentTransformInverse(fillCtx),[1,0,0,1,-offsetX,-offsetY]);return fillCtx.fillStyle=isPatternFill?fillColor.getPattern(ctx,this,inverse,PathType.FILL):fillColor,fillCtx.fillRect(0,0,width,height),cache&&!isPatternFill&&(this.cachedCanvases.delete("fillCanvas"),cache.set(cacheKey,fillCanvas.canvas)),{canvas:fillCanvas.canvas,offsetX:Math.round(offsetX),offsetY:Math.round(offsetY)}}setLineWidth(width){width!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=width,this.ctx.lineWidth=width}setLineCap(style){this.ctx.lineCap=LINE_CAP_STYLES[style]}setLineJoin(style){this.ctx.lineJoin=LINE_JOIN_STYLES[style]}setMiterLimit(limit){this.ctx.miterLimit=limit}setDash(dashArray,dashPhase){const ctx=this.ctx;ctx.setLineDash!==void 0&&(ctx.setLineDash(dashArray),ctx.lineDashOffset=dashPhase)}setRenderingIntent(intent){}setFlatness(flatness){}setGState(states){for(const[key,value]of states)switch(key){case"LW":this.setLineWidth(value);break;case"LC":this.setLineCap(value);break;case"LJ":this.setLineJoin(value);break;case"ML":this.setMiterLimit(value);break;case"D":this.setDash(value[0],value[1]);break;case"RI":this.setRenderingIntent(value);break;case"FL":this.setFlatness(value);break;case"Font":this.setFont(value[0],value[1]);break;case"CA":this.current.strokeAlpha=value;break;case"ca":this.current.fillAlpha=value,this.ctx.globalAlpha=value;break;case"BM":this.ctx.globalCompositeOperation=value;break;case"SMask":this.current.activeSMask=value?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(value);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const inSMaskMode=this.inSMaskMode;this.current.activeSMask&&!inSMaskMode?this.beginSMaskMode():!this.current.activeSMask&&inSMaskMode&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const drawnWidth=this.ctx.canvas.width,drawnHeight=this.ctx.canvas.height,cacheId="smaskGroupAt"+this.groupLevel,scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight);this.suspendedCtx=this.ctx,this.ctx=scratchCanvas.context;const ctx=this.ctx;ctx.setTransform(...getCurrentTransform(this.suspendedCtx)),copyCtxState(this.suspendedCtx,ctx),mirrorContextOperations(ctx,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),copyCtxState(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(dirtyBox){if(!this.current.activeSMask)return;dirtyBox?(dirtyBox[0]=Math.floor(dirtyBox[0]),dirtyBox[1]=Math.floor(dirtyBox[1]),dirtyBox[2]=Math.ceil(dirtyBox[2]),dirtyBox[3]=Math.ceil(dirtyBox[3])):dirtyBox=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const smask=this.current.activeSMask,suspendedCtx=this.suspendedCtx;this.composeSMask(suspendedCtx,smask,this.ctx,dirtyBox),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(ctx,smask,layerCtx,layerBox){const layerOffsetX=layerBox[0],layerOffsetY=layerBox[1],layerWidth=layerBox[2]-layerOffsetX,layerHeight=layerBox[3]-layerOffsetY;layerWidth===0||layerHeight===0||(this.genericComposeSMask(smask.context,layerCtx,layerWidth,layerHeight,smask.subtype,smask.backdrop,smask.transferMap,layerOffsetX,layerOffsetY,smask.offsetX,smask.offsetY),ctx.save(),ctx.globalAlpha=1,ctx.globalCompositeOperation="source-over",ctx.setTransform(1,0,0,1,0,0),ctx.drawImage(layerCtx.canvas,0,0),ctx.restore())}genericComposeSMask(maskCtx,layerCtx,width,height,subtype,backdrop,transferMap,layerOffsetX,layerOffsetY,maskOffsetX,maskOffsetY){let maskCanvas=maskCtx.canvas,maskX=layerOffsetX-maskOffsetX,maskY=layerOffsetY-maskOffsetY;if(backdrop){if(maskX<0||maskY<0||maskX+width>maskCanvas.width||maskY+height>maskCanvas.height){const canvas=this.cachedCanvases.getCanvas("maskExtension",width,height),ctx=canvas.context;ctx.drawImage(maskCanvas,-maskX,-maskY),backdrop.some(c=>c!==0)&&(ctx.globalCompositeOperation="destination-atop",ctx.fillStyle=Util.makeHexColor(...backdrop),ctx.fillRect(0,0,width,height),ctx.globalCompositeOperation="source-over"),maskCanvas=canvas.canvas,maskX=maskY=0}else if(backdrop.some(c=>c!==0)){maskCtx.save(),maskCtx.globalAlpha=1,maskCtx.setTransform(1,0,0,1,0,0);const clip2=new Path2D;clip2.rect(maskX,maskY,width,height),maskCtx.clip(clip2),maskCtx.globalCompositeOperation="destination-atop",maskCtx.fillStyle=Util.makeHexColor(...backdrop),maskCtx.fillRect(maskX,maskY,width,height),maskCtx.restore()}}layerCtx.save(),layerCtx.globalAlpha=1,layerCtx.setTransform(1,0,0,1,0,0),subtype==="Alpha"&&transferMap?layerCtx.filter=this.filterFactory.addAlphaFilter(transferMap):subtype==="Luminosity"&&(layerCtx.filter=this.filterFactory.addLuminosityFilter(transferMap));const clip=new Path2D;clip.rect(layerOffsetX,layerOffsetY,width,height),layerCtx.clip(clip),layerCtx.globalCompositeOperation="destination-in",layerCtx.drawImage(maskCanvas,maskX,maskY,width,height,layerOffsetX,layerOffsetY,width,height),layerCtx.restore()}save(){this.inSMaskMode?(copyCtxState(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const old=this.current;this.stateStack.push(old),this.current=old.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),copyCtxState(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(ops,args,minMax){const ctx=this.ctx,current=this.current;let x=current.x,y=current.y,startX,startY;const currentTransform=getCurrentTransform(ctx),isScalingMatrix=currentTransform[0]===0&&currentTransform[3]===0||currentTransform[1]===0&&currentTransform[2]===0,minMaxForBezier=isScalingMatrix?minMax.slice(0):null;for(let i=0,j=0,ii=ops.length;i<ii;i++)switch(ops[i]|0){case OPS.rectangle:x=args[j++],y=args[j++];const width=args[j++],height=args[j++],xw=x+width,yh=y+height;ctx.moveTo(x,y),width===0||height===0?ctx.lineTo(xw,yh):(ctx.lineTo(xw,y),ctx.lineTo(xw,yh),ctx.lineTo(x,yh)),isScalingMatrix||current.updateRectMinMax(currentTransform,[x,y,xw,yh]),ctx.closePath();break;case OPS.moveTo:x=args[j++],y=args[j++],ctx.moveTo(x,y),isScalingMatrix||current.updatePathMinMax(currentTransform,x,y);break;case OPS.lineTo:x=args[j++],y=args[j++],ctx.lineTo(x,y),isScalingMatrix||current.updatePathMinMax(currentTransform,x,y);break;case OPS.curveTo:startX=x,startY=y,x=args[j+4],y=args[j+5],ctx.bezierCurveTo(args[j],args[j+1],args[j+2],args[j+3],x,y),current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],args[j+2],args[j+3],x,y,minMaxForBezier),j+=6;break;case OPS.curveTo2:startX=x,startY=y,ctx.bezierCurveTo(x,y,args[j],args[j+1],args[j+2],args[j+3]),current.updateCurvePathMinMax(currentTransform,startX,startY,x,y,args[j],args[j+1],args[j+2],args[j+3],minMaxForBezier),x=args[j+2],y=args[j+3],j+=4;break;case OPS.curveTo3:startX=x,startY=y,x=args[j+2],y=args[j+3],ctx.bezierCurveTo(args[j],args[j+1],x,y,x,y),current.updateCurvePathMinMax(currentTransform,startX,startY,args[j],args[j+1],x,y,x,y,minMaxForBezier),j+=4;break;case OPS.closePath:ctx.closePath();break}isScalingMatrix&&current.updateScalingPathMinMax(currentTransform,minMaxForBezier),current.setCurrentPoint(x,y)}closePath(){this.ctx.closePath()}stroke(consumePath=!0){const ctx=this.ctx,strokeColor=this.current.strokeColor;ctx.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof strokeColor=="object"&&strokeColor?.getPattern?(ctx.save(),ctx.strokeStyle=strokeColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.STROKE),this.rescaleAndStroke(!1),ctx.restore()):this.rescaleAndStroke(!0)),consumePath&&this.consumePath(this.current.getClippedPathBoundingBox()),ctx.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(consumePath=!0){const ctx=this.ctx,fillColor=this.current.fillColor,isPatternFill=this.current.patternFill;let needRestore=!1;isPatternFill&&(ctx.save(),ctx.fillStyle=fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.FILL),needRestore=!0);const intersect=this.current.getClippedPathBoundingBox();this.contentVisible&&intersect!==null&&(this.pendingEOFill?(ctx.fill("evenodd"),this.pendingEOFill=!1):ctx.fill()),needRestore&&ctx.restore(),consumePath&&this.consumePath(intersect)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=NORMAL_CLIP}eoClip(){this.pendingClip=EO_CLIP}beginText(){this.current.textMatrix=IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const paths=this.pendingTextPaths,ctx=this.ctx;if(paths===void 0){ctx.beginPath();return}ctx.save(),ctx.beginPath();for(const path of paths)ctx.setTransform(...path.transform),ctx.translate(path.x,path.y),path.addToPath(ctx,path.fontSize);ctx.restore(),ctx.clip(),ctx.beginPath(),delete this.pendingTextPaths}setCharSpacing(spacing){this.current.charSpacing=spacing}setWordSpacing(spacing){this.current.wordSpacing=spacing}setHScale(scale){this.current.textHScale=scale/100}setLeading(leading){this.current.leading=-leading}setFont(fontRefName,size){var _a2;const fontObj=this.commonObjs.get(fontRefName),current=this.current;if(!fontObj)throw new Error(`Can't find font for ${fontRefName}`);if(current.fontMatrix=fontObj.fontMatrix||FONT_IDENTITY_MATRIX,(current.fontMatrix[0]===0||current.fontMatrix[3]===0)&&warn("Invalid font matrix for font "+fontRefName),size<0?(size=-size,current.fontDirection=-1):current.fontDirection=1,this.current.font=fontObj,this.current.fontSize=size,fontObj.isType3Font)return;const name=fontObj.loadedName||"sans-serif",typeface=((_a2=fontObj.systemFontInfo)==null?void 0:_a2.css)||`"${name}", ${fontObj.fallbackName}`;let bold="normal";fontObj.black?bold="900":fontObj.bold&&(bold="bold");const italic=fontObj.italic?"italic":"normal";let browserFontSize=size;size<MIN_FONT_SIZE?browserFontSize=MIN_FONT_SIZE:size>MAX_FONT_SIZE&&(browserFontSize=MAX_FONT_SIZE),this.current.fontSizeScale=size/browserFontSize,this.ctx.font=`${italic} ${bold} ${browserFontSize}px ${typeface}`}setTextRenderingMode(mode){this.current.textRenderingMode=mode}setTextRise(rise){this.current.textRise=rise}moveText(x,y){this.current.x=this.current.lineX+=x,this.current.y=this.current.lineY+=y}setLeadingMoveText(x,y){this.setLeading(-y),this.moveText(x,y)}setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f],this.current.textMatrixScale=Math.hypot(a,b),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(character,x,y,patternTransform){const ctx=this.ctx,current=this.current,font=current.font,textRenderingMode=current.textRenderingMode,fontSize=current.fontSize/current.fontSizeScale,fillStrokeMode=textRenderingMode&TextRenderingMode.FILL_STROKE_MASK,isAddToPathSet=!!(textRenderingMode&TextRenderingMode.ADD_TO_PATH_FLAG),patternFill=current.patternFill&&!font.missingFile;let addToPath;(font.disableFontFace||isAddToPathSet||patternFill)&&(addToPath=font.getPathGenerator(this.commonObjs,character)),font.disableFontFace||patternFill?(ctx.save(),ctx.translate(x,y),ctx.beginPath(),addToPath(ctx,fontSize),patternTransform&&ctx.setTransform(...patternTransform),(fillStrokeMode===TextRenderingMode.FILL||fillStrokeMode===TextRenderingMode.FILL_STROKE)&&ctx.fill(),(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE)&&ctx.stroke(),ctx.restore()):((fillStrokeMode===TextRenderingMode.FILL||fillStrokeMode===TextRenderingMode.FILL_STROKE)&&ctx.fillText(character,x,y),(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE)&&ctx.strokeText(character,x,y)),isAddToPathSet&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:getCurrentTransform(ctx),x,y,fontSize,addToPath})}get isFontSubpixelAAEnabled(){const{context:ctx}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);ctx.scale(1.5,1),ctx.fillText("I",0,10);const data=ctx.getImageData(0,0,10,10).data;let enabled=!1;for(let i=3;i<data.length;i+=4)if(data[i]>0&&data[i]<255){enabled=!0;break}return shadow(this,"isFontSubpixelAAEnabled",enabled)}showText(glyphs){const current=this.current,font=current.font;if(font.isType3Font)return this.showType3Text(glyphs);const fontSize=current.fontSize;if(fontSize===0)return;const ctx=this.ctx,fontSizeScale=current.fontSizeScale,charSpacing=current.charSpacing,wordSpacing=current.wordSpacing,fontDirection=current.fontDirection,textHScale=current.textHScale*fontDirection,glyphsLength=glyphs.length,vertical=font.vertical,spacingDir=vertical?1:-1,defaultVMetrics=font.defaultVMetrics,widthAdvanceScale=fontSize*current.fontMatrix[0],simpleFillText=current.textRenderingMode===TextRenderingMode.FILL&&!font.disableFontFace&&!current.patternFill;ctx.save(),ctx.transform(...current.textMatrix),ctx.translate(current.x,current.y+current.textRise),fontDirection>0?ctx.scale(textHScale,-1):ctx.scale(textHScale,1);let patternTransform;if(current.patternFill){ctx.save();const pattern=current.fillColor.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.FILL);patternTransform=getCurrentTransform(ctx),ctx.restore(),ctx.fillStyle=pattern}let lineWidth=current.lineWidth;const scale=current.textMatrixScale;if(scale===0||lineWidth===0){const fillStrokeMode=current.textRenderingMode&TextRenderingMode.FILL_STROKE_MASK;(fillStrokeMode===TextRenderingMode.STROKE||fillStrokeMode===TextRenderingMode.FILL_STROKE)&&(lineWidth=this.getSinglePixelWidth())}else lineWidth/=scale;if(fontSizeScale!==1&&(ctx.scale(fontSizeScale,fontSizeScale),lineWidth/=fontSizeScale),ctx.lineWidth=lineWidth,font.isInvalidPDFjsFont){const chars=[];let width=0;for(const glyph of glyphs)chars.push(glyph.unicode),width+=glyph.width;ctx.fillText(chars.join(""),0,0),current.x+=width*widthAdvanceScale*textHScale,ctx.restore(),this.compose();return}let x=0,i;for(i=0;i<glyphsLength;++i){const glyph=glyphs[i];if(typeof glyph=="number"){x+=spacingDir*glyph*fontSize/1e3;continue}let restoreNeeded=!1;const spacing=(glyph.isSpace?wordSpacing:0)+charSpacing,character=glyph.fontChar,accent=glyph.accent;let scaledX,scaledY,width=glyph.width;if(vertical){const vmetric=glyph.vmetric||defaultVMetrics,vx=-(glyph.vmetric?vmetric[1]:width*.5)*widthAdvanceScale,vy=vmetric[2]*widthAdvanceScale;width=vmetric?-vmetric[0]:width,scaledX=vx/fontSizeScale,scaledY=(x+vy)/fontSizeScale}else scaledX=x/fontSizeScale,scaledY=0;if(font.remeasure&&width>0){const measuredWidth=ctx.measureText(character).width*1e3/fontSize*fontSizeScale;if(width<measuredWidth&&this.isFontSubpixelAAEnabled){const characterScaleX=width/measuredWidth;restoreNeeded=!0,ctx.save(),ctx.scale(characterScaleX,1),scaledX/=characterScaleX}else width!==measuredWidth&&(scaledX+=(width-measuredWidth)/2e3*fontSize/fontSizeScale)}if(this.contentVisible&&(glyph.isInFont||font.missingFile)){if(simpleFillText&&!accent)ctx.fillText(character,scaledX,scaledY);else if(this.paintChar(character,scaledX,scaledY,patternTransform),accent){const scaledAccentX=scaledX+fontSize*accent.offset.x/fontSizeScale,scaledAccentY=scaledY-fontSize*accent.offset.y/fontSizeScale;this.paintChar(accent.fontChar,scaledAccentX,scaledAccentY,patternTransform)}}const charWidth=vertical?width*widthAdvanceScale-spacing*fontDirection:width*widthAdvanceScale+spacing*fontDirection;x+=charWidth,restoreNeeded&&ctx.restore()}vertical?current.y-=x:current.x+=x*textHScale,ctx.restore(),this.compose()}showType3Text(glyphs){const ctx=this.ctx,current=this.current,font=current.font,fontSize=current.fontSize,fontDirection=current.fontDirection,spacingDir=font.vertical?1:-1,charSpacing=current.charSpacing,wordSpacing=current.wordSpacing,textHScale=current.textHScale*fontDirection,fontMatrix=current.fontMatrix||FONT_IDENTITY_MATRIX,glyphsLength=glyphs.length,isTextInvisible=current.textRenderingMode===TextRenderingMode.INVISIBLE;let i,glyph,width,spacingLength;if(!(isTextInvisible||fontSize===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,ctx.save(),ctx.transform(...current.textMatrix),ctx.translate(current.x,current.y),ctx.scale(textHScale,fontDirection),i=0;i<glyphsLength;++i){if(glyph=glyphs[i],typeof glyph=="number"){spacingLength=spacingDir*glyph*fontSize/1e3,this.ctx.translate(spacingLength,0),current.x+=spacingLength*textHScale;continue}const spacing=(glyph.isSpace?wordSpacing:0)+charSpacing,operatorList=font.charProcOperatorList[glyph.operatorListId];if(!operatorList){warn(`Type3 character "${glyph.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=glyph,this.save(),ctx.scale(fontSize,fontSize),ctx.transform(...fontMatrix),this.executeOperatorList(operatorList),this.restore()),width=Util.applyTransform([glyph.width,0],fontMatrix)[0]*fontSize+spacing,ctx.translate(width,0),current.x+=width*textHScale}ctx.restore(),this.processingType3=null}}setCharWidth(xWidth,yWidth){}setCharWidthAndBounds(xWidth,yWidth,llx,lly,urx,ury){this.ctx.rect(llx,lly,urx-llx,ury-lly),this.ctx.clip(),this.endPath()}getColorN_Pattern(IR){let pattern;if(IR[0]==="TilingPattern"){const color=IR[1],baseTransform=this.baseTransform||getCurrentTransform(this.ctx),canvasGraphicsFactory={createCanvasGraphics:__name2(ctx=>new _CanvasGraphics2(ctx,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack}),"createCanvasGraphics")};pattern=new TilingPattern(IR,color,this.ctx,canvasGraphicsFactory,baseTransform)}else pattern=this._getPattern(IR[1],IR[2]);return pattern}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(r,g,b){this.ctx.strokeStyle=this.current.strokeColor=Util.makeHexColor(r,g,b)}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent"}setFillRGBColor(r,g,b){this.ctx.fillStyle=this.current.fillColor=Util.makeHexColor(r,g,b),this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(objId,matrix=null){let pattern;return this.cachedPatterns.has(objId)?pattern=this.cachedPatterns.get(objId):(pattern=getShadingPattern(this.getObject(objId)),this.cachedPatterns.set(objId,pattern)),matrix&&(pattern.matrix=matrix),pattern}shadingFill(objId){if(!this.contentVisible)return;const ctx=this.ctx;this.save();const pattern=this._getPattern(objId);ctx.fillStyle=pattern.getPattern(ctx,this,getCurrentTransformInverse(ctx),PathType.SHADING);const inv=getCurrentTransformInverse(ctx);if(inv){const{width,height}=ctx.canvas,[x0,y0,x1,y1]=Util.getAxialAlignedBoundingBox([0,0,width,height],inv);this.ctx.fillRect(x0,y0,x1-x0,y1-y0)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){unreachable("Should not call beginInlineImage")}beginImageData(){unreachable("Should not call beginImageData")}paintFormXObjectBegin(matrix,bbox){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),matrix&&this.transform(...matrix),this.baseTransform=getCurrentTransform(this.ctx),bbox)){const width=bbox[2]-bbox[0],height=bbox[3]-bbox[1];this.ctx.rect(bbox[0],bbox[1],width,height),this.current.updateRectMinMax(getCurrentTransform(this.ctx),bbox),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(group){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const currentCtx=this.ctx;group.isolated||info("TODO: Support non-isolated groups."),group.knockout&&warn("Knockout groups not supported.");const currentTransform=getCurrentTransform(currentCtx);if(group.matrix&&currentCtx.transform(...group.matrix),!group.bbox)throw new Error("Bounding box is required.");let bounds=Util.getAxialAlignedBoundingBox(group.bbox,getCurrentTransform(currentCtx));const canvasBounds=[0,0,currentCtx.canvas.width,currentCtx.canvas.height];bounds=Util.intersect(bounds,canvasBounds)||[0,0,0,0];const offsetX=Math.floor(bounds[0]),offsetY=Math.floor(bounds[1]),drawnWidth=Math.max(Math.ceil(bounds[2])-offsetX,1),drawnHeight=Math.max(Math.ceil(bounds[3])-offsetY,1);this.current.startNewPathAndClipBox([0,0,drawnWidth,drawnHeight]);let cacheId="groupAt"+this.groupLevel;group.smask&&(cacheId+="_smask_"+this.smaskCounter++%2);const scratchCanvas=this.cachedCanvases.getCanvas(cacheId,drawnWidth,drawnHeight),groupCtx=scratchCanvas.context;groupCtx.translate(-offsetX,-offsetY),groupCtx.transform(...currentTransform),group.smask?this.smaskStack.push({canvas:scratchCanvas.canvas,context:groupCtx,offsetX,offsetY,subtype:group.smask.subtype,backdrop:group.smask.backdrop,transferMap:group.smask.transferMap||null,startTransformInverse:null}):(currentCtx.setTransform(1,0,0,1,0,0),currentCtx.translate(offsetX,offsetY),currentCtx.save()),copyCtxState(currentCtx,groupCtx),this.ctx=groupCtx,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(currentCtx),this.groupLevel++}endGroup(group){if(!this.contentVisible)return;this.groupLevel--;const groupCtx=this.ctx,ctx=this.groupStack.pop();if(this.ctx=ctx,this.ctx.imageSmoothingEnabled=!1,group.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const currentMtx=getCurrentTransform(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...currentMtx);const dirtyBox=Util.getAxialAlignedBoundingBox([0,0,groupCtx.canvas.width,groupCtx.canvas.height],currentMtx);this.ctx.drawImage(groupCtx.canvas,0,0),this.ctx.restore(),this.compose(dirtyBox)}}beginAnnotation(id,rect,transform,matrix,hasOwnCanvas){if(__privateMethod(this,_CanvasGraphics_instances,restoreInitialState_fn).call(this),resetCtxToDefault(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),rect){const width=rect[2]-rect[0],height=rect[3]-rect[1];if(hasOwnCanvas&&this.annotationCanvasMap){transform=transform.slice(),transform[4]-=rect[0],transform[5]-=rect[1],rect=rect.slice(),rect[0]=rect[1]=0,rect[2]=width,rect[3]=height;const[scaleX,scaleY]=Util.singularValueDecompose2dScale(getCurrentTransform(this.ctx)),{viewportScale}=this,canvasWidth=Math.ceil(width*this.outputScaleX*viewportScale),canvasHeight=Math.ceil(height*this.outputScaleY*viewportScale);this.annotationCanvas=this.canvasFactory.create(canvasWidth,canvasHeight);const{canvas,context}=this.annotationCanvas;this.annotationCanvasMap.set(id,canvas),this.annotationCanvas.savedCtx=this.ctx,this.ctx=context,this.ctx.save(),this.ctx.setTransform(scaleX,0,0,-scaleY,0,height*scaleY),resetCtxToDefault(this.ctx)}else resetCtxToDefault(this.ctx),this.ctx.rect(rect[0],rect[1],width,height),this.ctx.clip(),this.endPath()}this.current=new CanvasExtraState(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...transform),this.transform(...matrix)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),__privateMethod(this,_CanvasGraphics_instances,drawFilter_fn).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(img){if(!this.contentVisible)return;const count=img.count;img=this.getObject(img.data,img),img.count=count;const ctx=this.ctx,glyph=this.processingType3;if(glyph&&(glyph.compiled===void 0&&(glyph.compiled=compileType3Glyph(img)),glyph.compiled)){glyph.compiled(ctx);return}const mask=this._createMaskCanvas(img),maskCanvas=mask.canvas;ctx.save(),ctx.setTransform(1,0,0,1,0,0),ctx.drawImage(maskCanvas,mask.offsetX,mask.offsetY),ctx.restore(),this.compose()}paintImageMaskXObjectRepeat(img,scaleX,skewX=0,skewY=0,scaleY,positions){if(!this.contentVisible)return;img=this.getObject(img.data,img);const ctx=this.ctx;ctx.save();const currentTransform=getCurrentTransform(ctx);ctx.transform(scaleX,skewX,skewY,scaleY,0,0);const mask=this._createMaskCanvas(img);ctx.setTransform(1,0,0,1,mask.offsetX-currentTransform[4],mask.offsetY-currentTransform[5]);for(let i=0,ii=positions.length;i<ii;i+=2){const trans=Util.transform(currentTransform,[scaleX,skewX,skewY,scaleY,positions[i],positions[i+1]]),[x,y]=Util.applyTransform([0,0],trans);ctx.drawImage(mask.canvas,x,y)}ctx.restore(),this.compose()}paintImageMaskXObjectGroup(images){if(!this.contentVisible)return;const ctx=this.ctx,fillColor=this.current.fillColor,isPatternFill=this.current.patternFill;for(const image of images){const{data,width,height,transform}=image,maskCanvas=this.cachedCanvases.getCanvas("maskCanvas",width,height),maskCtx=maskCanvas.context;maskCtx.save();const img=this.getObject(data,image);putBinaryImageMask(maskCtx,img),maskCtx.globalCompositeOperation="source-in",maskCtx.fillStyle=isPatternFill?fillColor.getPattern(maskCtx,this,getCurrentTransformInverse(ctx),PathType.FILL):fillColor,maskCtx.fillRect(0,0,width,height),maskCtx.restore(),ctx.save(),ctx.transform(...transform),ctx.scale(1,-1),drawImageAtIntegerCoords(ctx,maskCanvas.canvas,0,0,width,height,0,-1,1,1),ctx.restore()}this.compose()}paintImageXObject(objId){if(!this.contentVisible)return;const imgData=this.getObject(objId);if(!imgData){warn("Dependent image isn't ready yet");return}this.paintInlineImageXObject(imgData)}paintImageXObjectRepeat(objId,scaleX,scaleY,positions){if(!this.contentVisible)return;const imgData=this.getObject(objId);if(!imgData){warn("Dependent image isn't ready yet");return}const width=imgData.width,height=imgData.height,map=[];for(let i=0,ii=positions.length;i<ii;i+=2)map.push({transform:[scaleX,0,0,scaleY,positions[i],positions[i+1]],x:0,y:0,w:width,h:height});this.paintInlineImageXObjectGroup(imgData,map)}applyTransferMapsToCanvas(ctx){return this.current.transferMaps!=="none"&&(ctx.filter=this.current.transferMaps,ctx.drawImage(ctx.canvas,0,0),ctx.filter="none"),ctx.canvas}applyTransferMapsToBitmap(imgData){if(this.current.transferMaps==="none")return imgData.bitmap;const{bitmap,width,height}=imgData,tmpCanvas=this.cachedCanvases.getCanvas("inlineImage",width,height),tmpCtx=tmpCanvas.context;return tmpCtx.filter=this.current.transferMaps,tmpCtx.drawImage(bitmap,0,0),tmpCtx.filter="none",tmpCanvas.canvas}paintInlineImageXObject(imgData){if(!this.contentVisible)return;const width=imgData.width,height=imgData.height,ctx=this.ctx;if(this.save(),!isNodeJS){const{filter:filter2}=ctx;filter2!=="none"&&filter2!==""&&(ctx.filter="none")}ctx.scale(1/width,-1/height);let imgToPaint;if(imgData.bitmap)imgToPaint=this.applyTransferMapsToBitmap(imgData);else if(typeof HTMLElement=="function"&&imgData instanceof HTMLElement||!imgData.data)imgToPaint=imgData;else{const tmpCtx=this.cachedCanvases.getCanvas("inlineImage",width,height).context;putBinaryImageData(tmpCtx,imgData),imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}const scaled=this._scaleImage(imgToPaint,getCurrentTransformInverse(ctx));ctx.imageSmoothingEnabled=getImageSmoothingEnabled(getCurrentTransform(ctx),imgData.interpolate),drawImageAtIntegerCoords(ctx,scaled.img,0,0,scaled.paintWidth,scaled.paintHeight,0,-height,width,height),this.compose(),this.restore()}paintInlineImageXObjectGroup(imgData,map){if(!this.contentVisible)return;const ctx=this.ctx;let imgToPaint;if(imgData.bitmap)imgToPaint=imgData.bitmap;else{const w=imgData.width,h=imgData.height,tmpCtx=this.cachedCanvases.getCanvas("inlineImage",w,h).context;putBinaryImageData(tmpCtx,imgData),imgToPaint=this.applyTransferMapsToCanvas(tmpCtx)}for(const entry of map)ctx.save(),ctx.transform(...entry.transform),ctx.scale(1,-1),drawImageAtIntegerCoords(ctx,imgToPaint,entry.x,entry.y,entry.w,entry.h,0,-1,1,1),ctx.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(tag){}markPointProps(tag,properties){}beginMarkedContent(tag){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(tag,properties){tag==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(properties)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(clipBox){const isEmpty=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(clipBox);const ctx=this.ctx;this.pendingClip&&(isEmpty||(this.pendingClip===EO_CLIP?ctx.clip("evenodd"):ctx.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),ctx.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const m=getCurrentTransform(this.ctx);if(m[1]===0&&m[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(m[0]),Math.abs(m[3]));else{const absDet=Math.abs(m[0]*m[3]-m[2]*m[1]),normX=Math.hypot(m[0],m[2]),normY=Math.hypot(m[1],m[3]);this._cachedGetSinglePixelWidth=Math.max(normX,normY)/absDet}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth}=this.current,{a,b,c,d}=this.ctx.getTransform();let scaleX,scaleY;if(b===0&&c===0){const normX=Math.abs(a),normY=Math.abs(d);if(normX===normY)if(lineWidth===0)scaleX=scaleY=1/normX;else{const scaledLineWidth=normX*lineWidth;scaleX=scaleY=scaledLineWidth<1?1/scaledLineWidth:1}else if(lineWidth===0)scaleX=1/normX,scaleY=1/normY;else{const scaledXLineWidth=normX*lineWidth,scaledYLineWidth=normY*lineWidth;scaleX=scaledXLineWidth<1?1/scaledXLineWidth:1,scaleY=scaledYLineWidth<1?1/scaledYLineWidth:1}}else{const absDet=Math.abs(a*d-b*c),normX=Math.hypot(a,b),normY=Math.hypot(c,d);if(lineWidth===0)scaleX=normY/absDet,scaleY=normX/absDet;else{const baseArea=lineWidth*absDet;scaleX=normY>baseArea?normY/baseArea:1,scaleY=normX>baseArea?normX/baseArea:1}}this._cachedScaleForStroking[0]=scaleX,this._cachedScaleForStroking[1]=scaleY}return this._cachedScaleForStroking}rescaleAndStroke(saveRestore){const{ctx}=this,{lineWidth}=this.current,[scaleX,scaleY]=this.getScaleForStroking();if(ctx.lineWidth=lineWidth||1,scaleX===1&&scaleY===1){ctx.stroke();return}const dashes=ctx.getLineDash();if(saveRestore&&ctx.save(),ctx.scale(scaleX,scaleY),dashes.length>0){const scale=Math.max(scaleX,scaleY);ctx.setLineDash(dashes.map(x=>x/scale)),ctx.lineDashOffset/=scale}ctx.stroke(),saveRestore&&ctx.restore()}isContentVisible(){for(let i=this.markedContentStack.length-1;i>=0;i--)if(!this.markedContentStack[i].visible)return!1;return!0}};_CanvasGraphics_instances=new WeakSet,restoreInitialState_fn=__name2(function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},"#restoreInitialState"),drawFilter_fn=__name2(function(){if(this.pageColors){const hcmFilterId=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(hcmFilterId!=="none"){const savedFilter=this.ctx.filter;this.ctx.filter=hcmFilterId,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=savedFilter}}},"#drawFilter"),__name2(_CanvasGraphics,"CanvasGraphics");let CanvasGraphics=_CanvasGraphics;for(const op in OPS)CanvasGraphics.prototype[op]!==void 0&&(CanvasGraphics.prototype[OPS[op]]=CanvasGraphics.prototype[op]);const _GlobalWorkerOptions=class{static{__name(this,"_GlobalWorkerOptions")}static get workerPort(){return __privateGet(this,_port)}static set workerPort(val){if(!(typeof Worker<"u"&&val instanceof Worker)&&val!==null)throw new Error("Invalid `workerPort` type.");__privateSet(this,_port,val)}static get workerSrc(){return __privateGet(this,_src)}static set workerSrc(val){if(typeof val!="string")throw new Error("Invalid `workerSrc` type.");__privateSet(this,_src,val)}};_port=new WeakMap,_src=new WeakMap,__name2(_GlobalWorkerOptions,"GlobalWorkerOptions"),__privateAdd(_GlobalWorkerOptions,_port,null),__privateAdd(_GlobalWorkerOptions,_src,"");let GlobalWorkerOptions=_GlobalWorkerOptions;const CallbackKind={UNKNOWN:0,DATA:1,ERROR:2},StreamKind={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function wrapReason(reason){switch(reason instanceof Error||typeof reason=="object"&&reason!==null||unreachable('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),reason.name){case"AbortException":return new AbortException(reason.message);case"MissingPDFException":return new MissingPDFException(reason.message);case"PasswordException":return new PasswordException(reason.message,reason.code);case"UnexpectedResponseException":return new UnexpectedResponseException(reason.message,reason.status);case"UnknownErrorException":return new UnknownErrorException(reason.message,reason.details);default:return new UnknownErrorException(reason.message,reason.toString())}}__name(wrapReason,"wrapReason"),__name2(wrapReason,"wrapReason");const _MessageHandler=class{static{__name(this,"_MessageHandler")}constructor(sourceName,targetName,comObj){__privateAdd(this,_MessageHandler_instances),this.sourceName=sourceName,this.targetName=targetName,this.comObj=comObj,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=event=>{const data=event.data;if(data.targetName!==this.sourceName)return;if(data.stream){__privateMethod(this,_MessageHandler_instances,processStreamMessage_fn).call(this,data);return}if(data.callback){const callbackId=data.callbackId,capability=this.callbackCapabilities[callbackId];if(!capability)throw new Error(`Cannot resolve callback ${callbackId}`);if(delete this.callbackCapabilities[callbackId],data.callback===CallbackKind.DATA)capability.resolve(data.data);else if(data.callback===CallbackKind.ERROR)capability.reject(wrapReason(data.reason));else throw new Error("Unexpected callback case");return}const action=this.actionHandler[data.action];if(!action)throw new Error(`Unknown action from worker: ${data.action}`);if(data.callbackId){const cbSourceName=this.sourceName,cbTargetName=data.sourceName;new Promise(function(resolve){resolve(action(data.data))}).then(function(result){comObj.postMessage({sourceName:cbSourceName,targetName:cbTargetName,callback:CallbackKind.DATA,callbackId:data.callbackId,data:result})},function(reason){comObj.postMessage({sourceName:cbSourceName,targetName:cbTargetName,callback:CallbackKind.ERROR,callbackId:data.callbackId,reason:wrapReason(reason)})});return}if(data.streamId){__privateMethod(this,_MessageHandler_instances,createStreamSink_fn).call(this,data);return}action(data.data)},comObj.addEventListener("message",this._onComObjOnMessage)}on(actionName,handler){const ah=this.actionHandler;if(ah[actionName])throw new Error(`There is already an actionName called "${actionName}"`);ah[actionName]=handler}send(actionName,data,transfers){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,data},transfers)}sendWithPromise(actionName,data,transfers){const callbackId=this.callbackId++,capability=Promise.withResolvers();this.callbackCapabilities[callbackId]=capability;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:actionName,callbackId,data},transfers)}catch(ex){capability.reject(ex)}return capability.promise}sendWithStream(actionName,data,queueingStrategy,transfers){const streamId=this.streamId++,sourceName=this.sourceName,targetName=this.targetName,comObj=this.comObj;return new ReadableStream({start:__name2(controller=>{const startCapability=Promise.withResolvers();return this.streamControllers[streamId]={controller,startCall:startCapability,pullCall:null,cancelCall:null,isClosed:!1},comObj.postMessage({sourceName,targetName,action:actionName,streamId,data,desiredSize:controller.desiredSize},transfers),startCapability.promise},"start"),pull:__name2(controller=>{const pullCapability=Promise.withResolvers();return this.streamControllers[streamId].pullCall=pullCapability,comObj.postMessage({sourceName,targetName,stream:StreamKind.PULL,streamId,desiredSize:controller.desiredSize}),pullCapability.promise},"pull"),cancel:__name2(reason=>{assert(reason instanceof Error,"cancel must have a valid reason");const cancelCapability=Promise.withResolvers();return this.streamControllers[streamId].cancelCall=cancelCapability,this.streamControllers[streamId].isClosed=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind.CANCEL,streamId,reason:wrapReason(reason)}),cancelCapability.promise},"cancel")},queueingStrategy)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}};_MessageHandler_instances=new WeakSet,createStreamSink_fn=__name2(function(data){const streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj,self2=this,action=this.actionHandler[data.action],streamSink={enqueue(chunk,size=1,transfers){if(this.isCancelled)return;const lastDesiredSize=this.desiredSize;this.desiredSize-=size,lastDesiredSize>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),comObj.postMessage({sourceName,targetName,stream:StreamKind.ENQUEUE,streamId,chunk},transfers)},close(){this.isCancelled||(this.isCancelled=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind.CLOSE,streamId}),delete self2.streamSinks[streamId])},error(reason){assert(reason instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,comObj.postMessage({sourceName,targetName,stream:StreamKind.ERROR,streamId,reason:wrapReason(reason)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:data.desiredSize,ready:null};streamSink.sinkCapability.resolve(),streamSink.ready=streamSink.sinkCapability.promise,this.streamSinks[streamId]=streamSink,new Promise(function(resolve){resolve(action(data.data,streamSink))}).then(function(){comObj.postMessage({sourceName,targetName,stream:StreamKind.START_COMPLETE,streamId,success:!0})},function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind.START_COMPLETE,streamId,reason:wrapReason(reason)})})},"#createStreamSink"),processStreamMessage_fn=__name2(function(data){const streamId=data.streamId,sourceName=this.sourceName,targetName=data.sourceName,comObj=this.comObj,streamController=this.streamControllers[streamId],streamSink=this.streamSinks[streamId];switch(data.stream){case StreamKind.START_COMPLETE:data.success?streamController.startCall.resolve():streamController.startCall.reject(wrapReason(data.reason));break;case StreamKind.PULL_COMPLETE:data.success?streamController.pullCall.resolve():streamController.pullCall.reject(wrapReason(data.reason));break;case StreamKind.PULL:if(!streamSink){comObj.postMessage({sourceName,targetName,stream:StreamKind.PULL_COMPLETE,streamId,success:!0});break}streamSink.desiredSize<=0&&data.desiredSize>0&&streamSink.sinkCapability.resolve(),streamSink.desiredSize=data.desiredSize,new Promise(function(resolve){var _a2;resolve((_a2=streamSink.onPull)==null?void 0:_a2.call(streamSink))}).then(function(){comObj.postMessage({sourceName,targetName,stream:StreamKind.PULL_COMPLETE,streamId,success:!0})},function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind.PULL_COMPLETE,streamId,reason:wrapReason(reason)})});break;case StreamKind.ENQUEUE:if(assert(streamController,"enqueue should have stream controller"),streamController.isClosed)break;streamController.controller.enqueue(data.chunk);break;case StreamKind.CLOSE:if(assert(streamController,"close should have stream controller"),streamController.isClosed)break;streamController.isClosed=!0,streamController.controller.close(),__privateMethod(this,_MessageHandler_instances,deleteStreamController_fn).call(this,streamController,streamId);break;case StreamKind.ERROR:assert(streamController,"error should have stream controller"),streamController.controller.error(wrapReason(data.reason)),__privateMethod(this,_MessageHandler_instances,deleteStreamController_fn).call(this,streamController,streamId);break;case StreamKind.CANCEL_COMPLETE:data.success?streamController.cancelCall.resolve():streamController.cancelCall.reject(wrapReason(data.reason)),__privateMethod(this,_MessageHandler_instances,deleteStreamController_fn).call(this,streamController,streamId);break;case StreamKind.CANCEL:if(!streamSink)break;new Promise(function(resolve){var _a2;resolve((_a2=streamSink.onCancel)==null?void 0:_a2.call(streamSink,wrapReason(data.reason)))}).then(function(){comObj.postMessage({sourceName,targetName,stream:StreamKind.CANCEL_COMPLETE,streamId,success:!0})},function(reason){comObj.postMessage({sourceName,targetName,stream:StreamKind.CANCEL_COMPLETE,streamId,reason:wrapReason(reason)})}),streamSink.sinkCapability.reject(wrapReason(data.reason)),streamSink.isCancelled=!0,delete this.streamSinks[streamId];break;default:throw new Error("Unexpected stream case")}},"#processStreamMessage"),deleteStreamController_fn=__name2(async function(streamController,streamId){var _a2,_b2,_c;await Promise.allSettled([(_a2=streamController.startCall)==null?void 0:_a2.promise,(_b2=streamController.pullCall)==null?void 0:_b2.promise,(_c=streamController.cancelCall)==null?void 0:_c.promise]),delete this.streamControllers[streamId]},"#deleteStreamController"),__name2(_MessageHandler,"MessageHandler");let MessageHandler=_MessageHandler;const _Metadata=class{static{__name(this,"_Metadata")}constructor({parsedData,rawData}){__privateAdd(this,_metadataMap),__privateAdd(this,_data),__privateSet(this,_metadataMap,parsedData),__privateSet(this,_data,rawData)}getRaw(){return __privateGet(this,_data)}get(name){return __privateGet(this,_metadataMap).get(name)??null}getAll(){return objectFromMap(__privateGet(this,_metadataMap))}has(name){return __privateGet(this,_metadataMap).has(name)}};_metadataMap=new WeakMap,_data=new WeakMap,__name2(_Metadata,"Metadata");let Metadata=_Metadata;const INTERNAL=Symbol("INTERNAL"),_OptionalContentGroup=class{static{__name(this,"_OptionalContentGroup")}constructor(renderingIntent,{name,intent,usage}){__privateAdd(this,_isDisplay,!1),__privateAdd(this,_isPrint,!1),__privateAdd(this,_userSet,!1),__privateAdd(this,_visible,!0),__privateSet(this,_isDisplay,!!(renderingIntent&RenderingIntentFlag.DISPLAY)),__privateSet(this,_isPrint,!!(renderingIntent&RenderingIntentFlag.PRINT)),this.name=name,this.intent=intent,this.usage=usage}get visible(){if(__privateGet(this,_userSet))return __privateGet(this,_visible);if(!__privateGet(this,_visible))return!1;const{print,view}=this.usage;return __privateGet(this,_isDisplay)?view?.viewState!=="OFF":__privateGet(this,_isPrint)?print?.printState!=="OFF":!0}_setVisible(internal,visible,userSet=!1){internal!==INTERNAL&&unreachable("Internal method `_setVisible` called."),__privateSet(this,_userSet,userSet),__privateSet(this,_visible,visible)}};_isDisplay=new WeakMap,_isPrint=new WeakMap,_userSet=new WeakMap,_visible=new WeakMap,__name2(_OptionalContentGroup,"OptionalContentGroup");let OptionalContentGroup=_OptionalContentGroup;const _OptionalContentConfig=class{static{__name(this,"_OptionalContentConfig")}constructor(data,renderingIntent=RenderingIntentFlag.DISPLAY){if(__privateAdd(this,_OptionalContentConfig_instances),__privateAdd(this,_cachedGetHash,null),__privateAdd(this,_groups,new Map),__privateAdd(this,_initialHash,null),__privateAdd(this,_order,null),this.renderingIntent=renderingIntent,this.name=null,this.creator=null,data!==null){this.name=data.name,this.creator=data.creator,__privateSet(this,_order,data.order);for(const group of data.groups)__privateGet(this,_groups).set(group.id,new OptionalContentGroup(renderingIntent,group));if(data.baseState==="OFF")for(const group of __privateGet(this,_groups).values())group._setVisible(INTERNAL,!1);for(const on of data.on)__privateGet(this,_groups).get(on)._setVisible(INTERNAL,!0);for(const off of data.off)__privateGet(this,_groups).get(off)._setVisible(INTERNAL,!1);__privateSet(this,_initialHash,this.getHash())}}isVisible(group){if(__privateGet(this,_groups).size===0)return!0;if(!group)return info("Optional content group not defined."),!0;if(group.type==="OCG")return __privateGet(this,_groups).has(group.id)?__privateGet(this,_groups).get(group.id).visible:(warn(`Optional content group not found: ${group.id}`),!0);if(group.type==="OCMD"){if(group.expression)return __privateMethod(this,_OptionalContentConfig_instances,evaluateVisibilityExpression_fn).call(this,group.expression);if(!group.policy||group.policy==="AnyOn"){for(const id of group.ids){if(!__privateGet(this,_groups).has(id))return warn(`Optional content group not found: ${id}`),!0;if(__privateGet(this,_groups).get(id).visible)return!0}return!1}else if(group.policy==="AllOn"){for(const id of group.ids){if(!__privateGet(this,_groups).has(id))return warn(`Optional content group not found: ${id}`),!0;if(!__privateGet(this,_groups).get(id).visible)return!1}return!0}else if(group.policy==="AnyOff"){for(const id of group.ids){if(!__privateGet(this,_groups).has(id))return warn(`Optional content group not found: ${id}`),!0;if(!__privateGet(this,_groups).get(id).visible)return!0}return!1}else if(group.policy==="AllOff"){for(const id of group.ids){if(!__privateGet(this,_groups).has(id))return warn(`Optional content group not found: ${id}`),!0;if(__privateGet(this,_groups).get(id).visible)return!1}return!0}return warn(`Unknown optional content policy ${group.policy}.`),!0}return warn(`Unknown group type ${group.type}.`),!0}setVisibility(id,visible=!0){const group=__privateGet(this,_groups).get(id);if(!group){warn(`Optional content group not found: ${id}`);return}group._setVisible(INTERNAL,!!visible,!0),__privateSet(this,_cachedGetHash,null)}setOCGState({state,preserveRB}){let operator;for(const elem of state){switch(elem){case"ON":case"OFF":case"Toggle":operator=elem;continue}const group=__privateGet(this,_groups).get(elem);if(group)switch(operator){case"ON":group._setVisible(INTERNAL,!0);break;case"OFF":group._setVisible(INTERNAL,!1);break;case"Toggle":group._setVisible(INTERNAL,!group.visible);break}}__privateSet(this,_cachedGetHash,null)}get hasInitialVisibility(){return __privateGet(this,_initialHash)===null||this.getHash()===__privateGet(this,_initialHash)}getOrder(){return __privateGet(this,_groups).size?__privateGet(this,_order)?__privateGet(this,_order).slice():[...__privateGet(this,_groups).keys()]:null}getGroups(){return __privateGet(this,_groups).size>0?objectFromMap(__privateGet(this,_groups)):null}getGroup(id){return __privateGet(this,_groups).get(id)||null}getHash(){if(__privateGet(this,_cachedGetHash)!==null)return __privateGet(this,_cachedGetHash);const hash=new MurmurHash3_64;for(const[id,group]of __privateGet(this,_groups))hash.update(`${id}:${group.visible}`);return __privateSet(this,_cachedGetHash,hash.hexdigest())}};_cachedGetHash=new WeakMap,_groups=new WeakMap,_initialHash=new WeakMap,_order=new WeakMap,_OptionalContentConfig_instances=new WeakSet,evaluateVisibilityExpression_fn=__name2(function(array){const length=array.length;if(length<2)return!0;const operator=array[0];for(let i=1;i<length;i++){const element=array[i];let state;if(Array.isArray(element))state=__privateMethod(this,_OptionalContentConfig_instances,evaluateVisibilityExpression_fn).call(this,element);else if(__privateGet(this,_groups).has(element))state=__privateGet(this,_groups).get(element).visible;else return warn(`Optional content group not found: ${element}`),!0;switch(operator){case"And":if(!state)return!1;break;case"Or":if(state)return!0;break;case"Not":return!state;default:return!0}}return operator==="And"},"#evaluateVisibilityExpression"),__name2(_OptionalContentConfig,"OptionalContentConfig");let OptionalContentConfig=_OptionalContentConfig;const _PDFDataTransportStream=class{static{__name(this,"_PDFDataTransportStream")}constructor(pdfDataRangeTransport,{disableRange=!1,disableStream=!1}){assert(pdfDataRangeTransport,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length,initialData,progressiveDone,contentDispositionFilename}=pdfDataRangeTransport;if(this._queuedChunks=[],this._progressiveDone=progressiveDone,this._contentDispositionFilename=contentDispositionFilename,initialData?.length>0){const buffer=initialData instanceof Uint8Array&&initialData.byteLength===initialData.buffer.byteLength?initialData.buffer:new Uint8Array(initialData).buffer;this._queuedChunks.push(buffer)}this._pdfDataRangeTransport=pdfDataRangeTransport,this._isStreamingSupported=!disableStream,this._isRangeSupported=!disableRange,this._contentLength=length,this._fullRequestReader=null,this._rangeReaders=[],pdfDataRangeTransport.addRangeListener((begin,chunk)=>{this._onReceiveData({begin,chunk})}),pdfDataRangeTransport.addProgressListener((loaded,total)=>{this._onProgress({loaded,total})}),pdfDataRangeTransport.addProgressiveReadListener(chunk=>{this._onReceiveData({chunk})}),pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),pdfDataRangeTransport.transportReady()}_onReceiveData({begin,chunk}){const buffer=chunk instanceof Uint8Array&&chunk.byteLength===chunk.buffer.byteLength?chunk.buffer:new Uint8Array(chunk).buffer;if(begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(buffer):this._queuedChunks.push(buffer);else{const found=this._rangeReaders.some(function(rangeReader){return rangeReader._begin!==begin?!1:(rangeReader._enqueue(buffer),!0)});assert(found,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var _a2;return((_a2=this._fullRequestReader)==null?void 0:_a2._loaded)??0}_onProgress(evt){var _a2,_b2,_c,_d;evt.total===void 0?(_b2=(_a2=this._rangeReaders[0])==null?void 0:_a2.onProgress)==null||_b2.call(_a2,{loaded:evt.loaded}):(_d=(_c=this._fullRequestReader)==null?void 0:_c.onProgress)==null||_d.call(_c,{loaded:evt.loaded,total:evt.total})}_onProgressiveDone(){var _a2;(_a2=this._fullRequestReader)==null||_a2.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(reader){const i=this._rangeReaders.indexOf(reader);i>=0&&this._rangeReaders.splice(i,1)}getFullReader(){assert(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const queuedChunks=this._queuedChunks;return this._queuedChunks=null,new PDFDataTransportStreamReader(this,queuedChunks,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(begin,end){if(end<=this._progressiveDataLength)return null;const reader=new PDFDataTransportStreamRangeReader(this,begin,end);return this._pdfDataRangeTransport.requestDataRange(begin,end),this._rangeReaders.push(reader),reader}cancelAllRequests(reason){var _a2;(_a2=this._fullRequestReader)==null||_a2.cancel(reason);for(const reader of this._rangeReaders.slice(0))reader.cancel(reason);this._pdfDataRangeTransport.abort()}};__name2(_PDFDataTransportStream,"PDFDataTransportStream");let PDFDataTransportStream=_PDFDataTransportStream;const _PDFDataTransportStreamReader=class{static{__name(this,"_PDFDataTransportStreamReader")}constructor(stream,queuedChunks,progressiveDone=!1,contentDispositionFilename=null){this._stream=stream,this._done=progressiveDone||!1,this._filename=isPdfFile(contentDispositionFilename)?contentDispositionFilename:null,this._queuedChunks=queuedChunks||[],this._loaded=0;for(const chunk of this._queuedChunks)this._loaded+=chunk.byteLength;this._requests=[],this._headersReady=Promise.resolve(),stream._fullRequestReader=this,this.onProgress=null}_enqueue(chunk){this._done||(this._requests.length>0?this._requests.shift().resolve({value:chunk,done:!1}):this._queuedChunks.push(chunk),this._loaded+=chunk.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return this._requests.push(requestCapability),requestCapability.promise}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}};__name2(_PDFDataTransportStreamReader,"PDFDataTransportStreamReader");let PDFDataTransportStreamReader=_PDFDataTransportStreamReader;const _PDFDataTransportStreamRangeReader=class{static{__name(this,"_PDFDataTransportStreamRangeReader")}constructor(stream,begin,end){this._stream=stream,this._begin=begin,this._end=end,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(chunk){if(!this._done){if(this._requests.length===0)this._queuedChunk=chunk;else{this._requests.shift().resolve({value:chunk,done:!1});for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const chunk=this._queuedChunk;return this._queuedChunk=null,{value:chunk,done:!1}}if(this._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return this._requests.push(requestCapability),requestCapability.promise}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}};__name2(_PDFDataTransportStreamRangeReader,"PDFDataTransportStreamRangeReader");let PDFDataTransportStreamRangeReader=_PDFDataTransportStreamRangeReader;function getFilenameFromContentDispositionHeader(contentDisposition){let needsEncodingFixup=!0,tmp=toParamRegExp("filename\\*","i").exec(contentDisposition);if(tmp){tmp=tmp[1];let filename=rfc2616unquote(tmp);return filename=unescape(filename),filename=rfc5987decode(filename),filename=rfc2047decode(filename),fixupEncoding(filename)}if(tmp=rfc2231getparam(contentDisposition),tmp){const filename=rfc2047decode(tmp);return fixupEncoding(filename)}if(tmp=toParamRegExp("filename","i").exec(contentDisposition),tmp){tmp=tmp[1];let filename=rfc2616unquote(tmp);return filename=rfc2047decode(filename),fixupEncoding(filename)}function toParamRegExp(attributePattern,flags){return new RegExp("(?:^|;)\\s*"+attributePattern+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',flags)}__name(toParamRegExp,"toParamRegExp"),__name2(toParamRegExp,"toParamRegExp");function textdecode(encoding,value){if(encoding){if(!/^[\x00-\xFF]+$/.test(value))return value;try{const decoder=new TextDecoder(encoding,{fatal:!0}),buffer=stringToBytes(value);value=decoder.decode(buffer),needsEncodingFixup=!1}catch{}}return value}__name(textdecode,"textdecode"),__name2(textdecode,"textdecode");function fixupEncoding(value){return needsEncodingFixup&&/[\x80-\xff]/.test(value)&&(value=textdecode("utf-8",value),needsEncodingFixup&&(value=textdecode("iso-8859-1",value))),value}__name(fixupEncoding,"fixupEncoding"),__name2(fixupEncoding,"fixupEncoding");function rfc2231getparam(contentDispositionStr){const matches=[];let match;const iter=toParamRegExp("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(match=iter.exec(contentDispositionStr))!==null;){let[,n,quot,part]=match;if(n=parseInt(n,10),n in matches){if(n===0)break;continue}matches[n]=[quot,part]}const parts=[];for(let n=0;n<matches.length&&n in matches;++n){let[quot,part]=matches[n];part=rfc2616unquote(part),quot&&(part=unescape(part),n===0&&(part=rfc5987decode(part))),parts.push(part)}return parts.join("")}__name(rfc2231getparam,"rfc2231getparam"),__name2(rfc2231getparam,"rfc2231getparam");function rfc2616unquote(value){if(value.startsWith('"')){const parts=value.slice(1).split('\\"');for(let i=0;i<parts.length;++i){const quotindex=parts[i].indexOf('"');quotindex!==-1&&(parts[i]=parts[i].slice(0,quotindex),parts.length=i+1),parts[i]=parts[i].replaceAll(/\\(.)/g,"$1")}value=parts.join('"')}return value}__name(rfc2616unquote,"rfc2616unquote"),__name2(rfc2616unquote,"rfc2616unquote");function rfc5987decode(extvalue){const encodingend=extvalue.indexOf("'");if(encodingend===-1)return extvalue;const encoding=extvalue.slice(0,encodingend),value=extvalue.slice(encodingend+1).replace(/^[^']*'/,"");return textdecode(encoding,value)}__name(rfc5987decode,"rfc5987decode"),__name2(rfc5987decode,"rfc5987decode");function rfc2047decode(value){return!value.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(value)?value:value.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(matches,charset,encoding,text){if(encoding==="q"||encoding==="Q")return text=text.replaceAll("_"," "),text=text.replaceAll(/=([0-9a-fA-F]{2})/g,function(match,hex){return String.fromCharCode(parseInt(hex,16))}),textdecode(charset,text);try{text=atob(text)}catch{}return textdecode(charset,text)})}return __name(rfc2047decode,"rfc2047decode"),__name2(rfc2047decode,"rfc2047decode"),""}__name(getFilenameFromContentDispositionHeader,"getFilenameFromContentDispositionHeader"),__name2(getFilenameFromContentDispositionHeader,"getFilenameFromContentDispositionHeader");function validateRangeRequestCapabilities({getResponseHeader,isHttp,rangeChunkSize,disableRange}){const returnValues={allowRangeRequests:!1,suggestedLength:void 0},length=parseInt(getResponseHeader("Content-Length"),10);return!Number.isInteger(length)||(returnValues.suggestedLength=length,length<=2*rangeChunkSize)||disableRange||!isHttp||getResponseHeader("Accept-Ranges")!=="bytes"||(getResponseHeader("Content-Encoding")||"identity")!=="identity"||(returnValues.allowRangeRequests=!0),returnValues}__name(validateRangeRequestCapabilities,"validateRangeRequestCapabilities"),__name2(validateRangeRequestCapabilities,"validateRangeRequestCapabilities");function extractFilenameFromHeader(getResponseHeader){const contentDisposition=getResponseHeader("Content-Disposition");if(contentDisposition){let filename=getFilenameFromContentDispositionHeader(contentDisposition);if(filename.includes("%"))try{filename=decodeURIComponent(filename)}catch{}if(isPdfFile(filename))return filename}return null}__name(extractFilenameFromHeader,"extractFilenameFromHeader"),__name2(extractFilenameFromHeader,"extractFilenameFromHeader");function createResponseStatusError(status,url){return status===404||status===0&&url.startsWith("file:")?new MissingPDFException('Missing PDF "'+url+'".'):new UnexpectedResponseException(`Unexpected server response (${status}) while retrieving PDF "${url}".`,status)}__name(createResponseStatusError,"createResponseStatusError"),__name2(createResponseStatusError,"createResponseStatusError");function validateResponseStatus(status){return status===200||status===206}__name(validateResponseStatus,"validateResponseStatus"),__name2(validateResponseStatus,"validateResponseStatus");function createFetchOptions(headers,withCredentials,abortController){return{method:"GET",headers,signal:abortController.signal,mode:"cors",credentials:withCredentials?"include":"same-origin",redirect:"follow"}}__name(createFetchOptions,"createFetchOptions"),__name2(createFetchOptions,"createFetchOptions");function createHeaders(httpHeaders){const headers=new Headers;for(const property in httpHeaders){const value=httpHeaders[property];value!==void 0&&headers.append(property,value)}return headers}__name(createHeaders,"createHeaders"),__name2(createHeaders,"createHeaders");function getArrayBuffer(val){return val instanceof Uint8Array?val.buffer:val instanceof ArrayBuffer?val:(warn(`getArrayBuffer - unexpected data format: ${val}`),new Uint8Array(val).buffer)}__name(getArrayBuffer,"getArrayBuffer"),__name2(getArrayBuffer,"getArrayBuffer");const _PDFFetchStream=class{static{__name(this,"_PDFFetchStream")}constructor(source){this.source=source,this.isHttp=/^https?:/i.test(source.url),this.httpHeaders=this.isHttp&&source.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var _a2;return((_a2=this._fullRequestReader)==null?void 0:_a2._loaded)??0}getFullReader(){return assert(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new PDFFetchStreamReader(this),this._fullRequestReader}getRangeReader(begin,end){if(end<=this._progressiveDataLength)return null;const reader=new PDFFetchStreamRangeReader(this,begin,end);return this._rangeRequestReaders.push(reader),reader}cancelAllRequests(reason){var _a2;(_a2=this._fullRequestReader)==null||_a2.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}};__name2(_PDFFetchStream,"PDFFetchStream");let PDFFetchStream=_PDFFetchStream;const _PDFFetchStreamReader=class{static{__name(this,"_PDFFetchStreamReader")}constructor(stream){this._stream=stream,this._reader=null,this._loaded=0,this._filename=null;const source=stream.source;this._withCredentials=source.withCredentials||!1,this._contentLength=source.length,this._headersCapability=Promise.withResolvers(),this._disableRange=source.disableRange||!1,this._rangeChunkSize=source.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!source.disableStream,this._isRangeSupported=!source.disableRange,this._headers=createHeaders(this._stream.httpHeaders);const url=source.url;fetch(url,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then(response=>{if(!validateResponseStatus(response.status))throw createResponseStatusError(response.status,url);this._reader=response.body.getReader(),this._headersCapability.resolve();const getResponseHeader=__name2(name=>response.headers.get(name),"getResponseHeader"),{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({getResponseHeader,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=allowRangeRequests,this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(getResponseHeader),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var _a2;await this._headersCapability.promise;const{value,done}=await this._reader.read();return done?{value,done}:(this._loaded+=value.byteLength,(_a2=this.onProgress)==null||_a2.call(this,{loaded:this._loaded,total:this._contentLength}),{value:getArrayBuffer(value),done:!1})}cancel(reason){var _a2;(_a2=this._reader)==null||_a2.cancel(reason),this._abortController.abort()}};__name2(_PDFFetchStreamReader,"PDFFetchStreamReader");let PDFFetchStreamReader=_PDFFetchStreamReader;const _PDFFetchStreamRangeReader=class{static{__name(this,"_PDFFetchStreamRangeReader")}constructor(stream,begin,end){this._stream=stream,this._reader=null,this._loaded=0;const source=stream.source;this._withCredentials=source.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!source.disableStream,this._abortController=new AbortController,this._headers=createHeaders(this._stream.httpHeaders),this._headers.append("Range",`bytes=${begin}-${end-1}`);const url=source.url;fetch(url,createFetchOptions(this._headers,this._withCredentials,this._abortController)).then(response=>{if(!validateResponseStatus(response.status))throw createResponseStatusError(response.status,url);this._readCapability.resolve(),this._reader=response.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var _a2;await this._readCapability.promise;const{value,done}=await this._reader.read();return done?{value,done}:(this._loaded+=value.byteLength,(_a2=this.onProgress)==null||_a2.call(this,{loaded:this._loaded}),{value:getArrayBuffer(value),done:!1})}cancel(reason){var _a2;(_a2=this._reader)==null||_a2.cancel(reason),this._abortController.abort()}};__name2(_PDFFetchStreamRangeReader,"PDFFetchStreamRangeReader");let PDFFetchStreamRangeReader=_PDFFetchStreamRangeReader;const OK_RESPONSE=200,PARTIAL_CONTENT_RESPONSE=206;function network_getArrayBuffer(xhr){const data=xhr.response;return typeof data!="string"?data:stringToBytes(data).buffer}__name(network_getArrayBuffer,"network_getArrayBuffer"),__name2(network_getArrayBuffer,"network_getArrayBuffer");const _NetworkManager=class{static{__name(this,"_NetworkManager")}constructor(url,args={}){this.url=url,this.isHttp=/^https?:/i.test(url),this.httpHeaders=this.isHttp&&args.httpHeaders||Object.create(null),this.withCredentials=args.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(begin,end,listeners){const args={begin,end};for(const prop in listeners)args[prop]=listeners[prop];return this.request(args)}requestFull(listeners){return this.request(listeners)}request(args){const xhr=new XMLHttpRequest,xhrId=this.currXhrId++,pendingRequest=this.pendingRequests[xhrId]={xhr};xhr.open("GET",this.url),xhr.withCredentials=this.withCredentials;for(const property in this.httpHeaders){const value=this.httpHeaders[property];value!==void 0&&xhr.setRequestHeader(property,value)}return this.isHttp&&"begin"in args&&"end"in args?(xhr.setRequestHeader("Range",`bytes=${args.begin}-${args.end-1}`),pendingRequest.expectedStatus=PARTIAL_CONTENT_RESPONSE):pendingRequest.expectedStatus=OK_RESPONSE,xhr.responseType="arraybuffer",args.onError&&(xhr.onerror=function(evt){args.onError(xhr.status)}),xhr.onreadystatechange=this.onStateChange.bind(this,xhrId),xhr.onprogress=this.onProgress.bind(this,xhrId),pendingRequest.onHeadersReceived=args.onHeadersReceived,pendingRequest.onDone=args.onDone,pendingRequest.onError=args.onError,pendingRequest.onProgress=args.onProgress,xhr.send(null),xhrId}onProgress(xhrId,evt){var _a2;const pendingRequest=this.pendingRequests[xhrId];pendingRequest&&((_a2=pendingRequest.onProgress)==null||_a2.call(pendingRequest,evt))}onStateChange(xhrId,evt){var _a2,_b2,_c;const pendingRequest=this.pendingRequests[xhrId];if(!pendingRequest)return;const xhr=pendingRequest.xhr;if(xhr.readyState>=2&&pendingRequest.onHeadersReceived&&(pendingRequest.onHeadersReceived(),delete pendingRequest.onHeadersReceived),xhr.readyState!==4||!(xhrId in this.pendingRequests))return;if(delete this.pendingRequests[xhrId],xhr.status===0&&this.isHttp){(_a2=pendingRequest.onError)==null||_a2.call(pendingRequest,xhr.status);return}const xhrStatus=xhr.status||OK_RESPONSE;if(!(xhrStatus===OK_RESPONSE&&pendingRequest.expectedStatus===PARTIAL_CONTENT_RESPONSE)&&xhrStatus!==pendingRequest.expectedStatus){(_b2=pendingRequest.onError)==null||_b2.call(pendingRequest,xhr.status);return}const chunk=network_getArrayBuffer(xhr);if(xhrStatus===PARTIAL_CONTENT_RESPONSE){const rangeHeader=xhr.getResponseHeader("Content-Range"),matches=/bytes (\d+)-(\d+)\/(\d+)/.exec(rangeHeader);pendingRequest.onDone({begin:parseInt(matches[1],10),chunk})}else chunk?pendingRequest.onDone({begin:0,chunk}):(_c=pendingRequest.onError)==null||_c.call(pendingRequest,xhr.status)}getRequestXhr(xhrId){return this.pendingRequests[xhrId].xhr}isPendingRequest(xhrId){return xhrId in this.pendingRequests}abortRequest(xhrId){const xhr=this.pendingRequests[xhrId].xhr;delete this.pendingRequests[xhrId],xhr.abort()}};__name2(_NetworkManager,"NetworkManager");let NetworkManager=_NetworkManager;const _PDFNetworkStream=class{static{__name(this,"_PDFNetworkStream")}constructor(source){this._source=source,this._manager=new NetworkManager(source.url,{httpHeaders:source.httpHeaders,withCredentials:source.withCredentials}),this._rangeChunkSize=source.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(reader){const i=this._rangeRequestReaders.indexOf(reader);i>=0&&this._rangeRequestReaders.splice(i,1)}getFullReader(){return assert(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new PDFNetworkStreamFullRequestReader(this._manager,this._source),this._fullRequestReader}getRangeReader(begin,end){const reader=new PDFNetworkStreamRangeRequestReader(this._manager,begin,end);return reader.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(reader),reader}cancelAllRequests(reason){var _a2;(_a2=this._fullRequestReader)==null||_a2.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}};__name2(_PDFNetworkStream,"PDFNetworkStream");let PDFNetworkStream=_PDFNetworkStream;const _PDFNetworkStreamFullRequestReader=class{static{__name(this,"_PDFNetworkStreamFullRequestReader")}constructor(manager,source){this._manager=manager;const args={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=source.url,this._fullRequestId=manager.requestFull(args),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=source.disableRange||!1,this._contentLength=source.length,this._rangeChunkSize=source.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const fullRequestXhrId=this._fullRequestId,fullRequestXhr=this._manager.getRequestXhr(fullRequestXhrId),getResponseHeader=__name2(name=>fullRequestXhr.getResponseHeader(name),"getResponseHeader"),{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({getResponseHeader,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});allowRangeRequests&&(this._isRangeSupported=!0),this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(getResponseHeader),this._isRangeSupported&&this._manager.abortRequest(fullRequestXhrId),this._headersReceivedCapability.resolve()}_onDone(data){if(data&&(this._requests.length>0?this._requests.shift().resolve({value:data.chunk,done:!1}):this._cachedChunks.push(data.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(status){this._storedError=createResponseStatusError(status,this._url),this._headersReceivedCapability.reject(this._storedError);for(const requestCapability of this._requests)requestCapability.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(evt){var _a2;(_a2=this.onProgress)==null||_a2.call(this,{loaded:evt.loaded,total:evt.lengthComputable?evt.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return this._requests.push(requestCapability),requestCapability.promise}cancel(reason){this._done=!0,this._headersReceivedCapability.reject(reason);for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}};__name2(_PDFNetworkStreamFullRequestReader,"PDFNetworkStreamFullRequestReader");let PDFNetworkStreamFullRequestReader=_PDFNetworkStreamFullRequestReader;const _PDFNetworkStreamRangeRequestReader=class{static{__name(this,"_PDFNetworkStreamRangeRequestReader")}constructor(manager,begin,end){this._manager=manager;const args={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=manager.url,this._requestId=manager.requestRange(begin,end,args),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var _a2;(_a2=this.onClosed)==null||_a2.call(this,this)}_onDone(data){const chunk=data.chunk;this._requests.length>0?this._requests.shift().resolve({value:chunk,done:!1}):this._queuedChunk=chunk,this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(status){this._storedError=createResponseStatusError(status,this._url);for(const requestCapability of this._requests)requestCapability.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(evt){var _a2;this.isStreamingSupported||(_a2=this.onProgress)==null||_a2.call(this,{loaded:evt.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const chunk=this._queuedChunk;return this._queuedChunk=null,{value:chunk,done:!1}}if(this._done)return{value:void 0,done:!0};const requestCapability=Promise.withResolvers();return this._requests.push(requestCapability),requestCapability.promise}cancel(reason){this._done=!0;for(const requestCapability of this._requests)requestCapability.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}};__name2(_PDFNetworkStreamRangeRequestReader,"PDFNetworkStreamRangeRequestReader");let PDFNetworkStreamRangeRequestReader=_PDFNetworkStreamRangeRequestReader;const fileUriRegex=/^file:\/\/\/[a-zA-Z]:\//;function parseUrl(sourceUrl){const url=NodePackages.get("url"),parsedUrl=url.parse(sourceUrl);return parsedUrl.protocol==="file:"||parsedUrl.host?parsedUrl:/^[a-z]:[/\\]/i.test(sourceUrl)?url.parse(`file:///${sourceUrl}`):(parsedUrl.host||(parsedUrl.protocol="file:"),parsedUrl)}__name(parseUrl,"parseUrl"),__name2(parseUrl,"parseUrl");const _PDFNodeStream=class{static{__name(this,"_PDFNodeStream")}constructor(source){this.source=source,this.url=parseUrl(source.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&source.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var _a2;return((_a2=this._fullRequestReader)==null?void 0:_a2._loaded)??0}getFullReader(){return assert(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new PDFNodeStreamFsFullReader(this):new PDFNodeStreamFullReader(this),this._fullRequestReader}getRangeReader(start,end){if(end<=this._progressiveDataLength)return null;const rangeReader=this.isFsUrl?new PDFNodeStreamFsRangeReader(this,start,end):new PDFNodeStreamRangeReader(this,start,end);return this._rangeRequestReaders.push(rangeReader),rangeReader}cancelAllRequests(reason){var _a2;(_a2=this._fullRequestReader)==null||_a2.cancel(reason);for(const reader of this._rangeRequestReaders.slice(0))reader.cancel(reason)}};__name2(_PDFNodeStream,"PDFNodeStream");let PDFNodeStream=_PDFNodeStream;const _BaseFullReader=class{static{__name(this,"_BaseFullReader")}constructor(stream){this._url=stream.url,this._done=!1,this._storedError=null,this.onProgress=null;const source=stream.source;this._contentLength=source.length,this._loaded=0,this._filename=null,this._disableRange=source.disableRange||!1,this._rangeChunkSize=source.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!source.disableStream,this._isRangeSupported=!source.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var _a2;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const chunk=this._readableStream.read();return chunk===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=chunk.length,(_a2=this.onProgress)==null||_a2.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(chunk).buffer,done:!1})}cancel(reason){if(!this._readableStream){this._error(reason);return}this._readableStream.destroy(reason)}_error(reason){this._storedError=reason,this._readCapability.resolve()}_setReadableStream(readableStream){this._readableStream=readableStream,readableStream.on("readable",()=>{this._readCapability.resolve()}),readableStream.on("end",()=>{readableStream.destroy(),this._done=!0,this._readCapability.resolve()}),readableStream.on("error",reason=>{this._error(reason)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}};__name2(_BaseFullReader,"BaseFullReader");let BaseFullReader=_BaseFullReader;const _BaseRangeReader=class{static{__name(this,"_BaseRangeReader")}constructor(stream){this._url=stream.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const source=stream.source;this._isStreamingSupported=!source.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var _a2;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const chunk=this._readableStream.read();return chunk===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=chunk.length,(_a2=this.onProgress)==null||_a2.call(this,{loaded:this._loaded}),{value:new Uint8Array(chunk).buffer,done:!1})}cancel(reason){if(!this._readableStream){this._error(reason);return}this._readableStream.destroy(reason)}_error(reason){this._storedError=reason,this._readCapability.resolve()}_setReadableStream(readableStream){this._readableStream=readableStream,readableStream.on("readable",()=>{this._readCapability.resolve()}),readableStream.on("end",()=>{readableStream.destroy(),this._done=!0,this._readCapability.resolve()}),readableStream.on("error",reason=>{this._error(reason)}),this._storedError&&this._readableStream.destroy(this._storedError)}};__name2(_BaseRangeReader,"BaseRangeReader");let BaseRangeReader=_BaseRangeReader;function createRequestOptions(parsedUrl,headers){return{protocol:parsedUrl.protocol,auth:parsedUrl.auth,host:parsedUrl.hostname,port:parsedUrl.port,path:parsedUrl.path,method:"GET",headers}}__name(createRequestOptions,"createRequestOptions"),__name2(createRequestOptions,"createRequestOptions");const _PDFNodeStreamFullReader=class extends BaseFullReader{static{__name(this,"_PDFNodeStreamFullReader")}constructor(stream){super(stream);const handleResponse=__name2(response=>{if(response.statusCode===404){const error=new MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=error,this._headersCapability.reject(error);return}this._headersCapability.resolve(),this._setReadableStream(response);const getResponseHeader=__name2(name=>this._readableStream.headers[name.toLowerCase()],"getResponseHeader"),{allowRangeRequests,suggestedLength}=validateRangeRequestCapabilities({getResponseHeader,isHttp:stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=allowRangeRequests,this._contentLength=suggestedLength||this._contentLength,this._filename=extractFilenameFromHeader(getResponseHeader)},"handleResponse");if(this._request=null,this._url.protocol==="http:"){const http=NodePackages.get("http");this._request=http.request(createRequestOptions(this._url,stream.httpHeaders),handleResponse)}else{const https=NodePackages.get("https");this._request=https.request(createRequestOptions(this._url,stream.httpHeaders),handleResponse)}this._request.on("error",reason=>{this._storedError=reason,this._headersCapability.reject(reason)}),this._request.end()}};__name2(_PDFNodeStreamFullReader,"PDFNodeStreamFullReader");let PDFNodeStreamFullReader=_PDFNodeStreamFullReader;const _PDFNodeStreamRangeReader=class extends BaseRangeReader{static{__name(this,"_PDFNodeStreamRangeReader")}constructor(stream,start,end){super(stream),this._httpHeaders={};for(const property in stream.httpHeaders){const value=stream.httpHeaders[property];value!==void 0&&(this._httpHeaders[property]=value)}this._httpHeaders.Range=`bytes=${start}-${end-1}`;const handleResponse=__name2(response=>{if(response.statusCode===404){const error=new MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=error;return}this._setReadableStream(response)},"handleResponse");if(this._request=null,this._url.protocol==="http:"){const http=NodePackages.get("http");this._request=http.request(createRequestOptions(this._url,this._httpHeaders),handleResponse)}else{const https=NodePackages.get("https");this._request=https.request(createRequestOptions(this._url,this._httpHeaders),handleResponse)}this._request.on("error",reason=>{this._storedError=reason}),this._request.end()}};__name2(_PDFNodeStreamRangeReader,"PDFNodeStreamRangeReader");let PDFNodeStreamRangeReader=_PDFNodeStreamRangeReader;const _PDFNodeStreamFsFullReader=class extends BaseFullReader{static{__name(this,"_PDFNodeStreamFsFullReader")}constructor(stream){super(stream);let path=decodeURIComponent(this._url.path);fileUriRegex.test(this._url.href)&&(path=path.replace(/^\//,""));const fs=NodePackages.get("fs");fs.promises.lstat(path).then(stat=>{this._contentLength=stat.size,this._setReadableStream(fs.createReadStream(path)),this._headersCapability.resolve()},error=>{error.code==="ENOENT"&&(error=new MissingPDFException(`Missing PDF "${path}".`)),this._storedError=error,this._headersCapability.reject(error)})}};__name2(_PDFNodeStreamFsFullReader,"PDFNodeStreamFsFullReader");let PDFNodeStreamFsFullReader=_PDFNodeStreamFsFullReader;const _PDFNodeStreamFsRangeReader=class extends BaseRangeReader{static{__name(this,"_PDFNodeStreamFsRangeReader")}constructor(stream,start,end){super(stream);let path=decodeURIComponent(this._url.path);fileUriRegex.test(this._url.href)&&(path=path.replace(/^\//,""));const fs=NodePackages.get("fs");this._setReadableStream(fs.createReadStream(path,{start,end:end-1}))}};__name2(_PDFNodeStreamFsRangeReader,"PDFNodeStreamFsRangeReader");let PDFNodeStreamFsRangeReader=_PDFNodeStreamFsRangeReader;const MAX_TEXT_DIVS_TO_RENDER=1e5,DEFAULT_FONT_SIZE=30,DEFAULT_FONT_ASCENT=.8,_TextLayer=class _TextLayer2{static{__name(this,"_TextLayer")}constructor({textContentSource,container,viewport}){__privateAdd(this,_TextLayer_instances),__privateAdd(this,_capability,Promise.withResolvers()),__privateAdd(this,_container2,null),__privateAdd(this,_disableProcessItems,!1),__privateAdd(this,_fontInspectorEnabled,!!((_a=globalThis.FontInspector)!=null&&_a.enabled)),__privateAdd(this,_lang,null),__privateAdd(this,_layoutTextParams,null),__privateAdd(this,_pageHeight,0),__privateAdd(this,_pageWidth,0),__privateAdd(this,_reader,null),__privateAdd(this,_rootContainer,null),__privateAdd(this,_rotation,0),__privateAdd(this,_scale,0),__privateAdd(this,_styleCache,Object.create(null)),__privateAdd(this,_textContentItemsStr,[]),__privateAdd(this,_textContentSource,null),__privateAdd(this,_textDivs,[]),__privateAdd(this,_textDivProperties,new WeakMap),__privateAdd(this,_transform,null);var _a2;if(textContentSource instanceof ReadableStream)__privateSet(this,_textContentSource,textContentSource);else if(typeof textContentSource=="object")__privateSet(this,_textContentSource,new ReadableStream({start(controller){controller.enqueue(textContentSource),controller.close()}}));else throw new Error('No "textContentSource" parameter specified.');__privateSet(this,_container2,__privateSet(this,_rootContainer,container)),__privateSet(this,_scale,viewport.scale*(globalThis.devicePixelRatio||1)),__privateSet(this,_rotation,viewport.rotation),__privateSet(this,_layoutTextParams,{prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null});const{pageWidth,pageHeight,pageX,pageY}=viewport.rawDims;__privateSet(this,_transform,[1,0,0,-1,-pageX,pageY+pageHeight]),__privateSet(this,_pageWidth,pageWidth),__privateSet(this,_pageHeight,pageHeight),__privateMethod(_a2=_TextLayer2,_TextLayer_static,ensureMinFontSizeComputed_fn).call(_a2),setLayerDimensions(container,viewport),__privateGet(this,_capability).promise.catch(()=>{}).then(()=>{__privateGet(_TextLayer2,_pendingTextLayers).delete(this),__privateSet(this,_layoutTextParams,null),__privateSet(this,_styleCache,null)})}render(){const pump=__name2(()=>{__privateGet(this,_reader).read().then(({value,done})=>{if(done){__privateGet(this,_capability).resolve();return}__privateGet(this,_lang)??__privateSet(this,_lang,value.lang),Object.assign(__privateGet(this,_styleCache),value.styles),__privateMethod(this,_TextLayer_instances,processItems_fn).call(this,value.items),pump()},__privateGet(this,_capability).reject)},"pump");return __privateSet(this,_reader,__privateGet(this,_textContentSource).getReader()),__privateGet(_TextLayer2,_pendingTextLayers).add(this),pump(),__privateGet(this,_capability).promise}update({viewport,onBefore=null}){var _a2;const scale=viewport.scale*(globalThis.devicePixelRatio||1),rotation=viewport.rotation;if(rotation!==__privateGet(this,_rotation)&&(onBefore?.(),__privateSet(this,_rotation,rotation),setLayerDimensions(__privateGet(this,_rootContainer),{rotation})),scale!==__privateGet(this,_scale)){onBefore?.(),__privateSet(this,_scale,scale);const params={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:__privateMethod(_a2=_TextLayer2,_TextLayer_static,getCtx_fn).call(_a2,__privateGet(this,_lang))};for(const div of __privateGet(this,_textDivs))params.properties=__privateGet(this,_textDivProperties).get(div),params.div=div,__privateMethod(this,_TextLayer_instances,layout_fn).call(this,params)}}cancel(){var _a2;const abortEx=new AbortException("TextLayer task cancelled.");(_a2=__privateGet(this,_reader))==null||_a2.cancel(abortEx).catch(()=>{}),__privateSet(this,_reader,null),__privateGet(this,_capability).reject(abortEx)}get textDivs(){return __privateGet(this,_textDivs)}get textContentItemsStr(){return __privateGet(this,_textContentItemsStr)}static cleanup(){if(!(__privateGet(this,_pendingTextLayers).size>0)){__privateGet(this,_ascentCache).clear();for(const{canvas}of __privateGet(this,_canvasContexts).values())canvas.remove();__privateGet(this,_canvasContexts).clear()}}};_capability=new WeakMap,_container2=new WeakMap,_disableProcessItems=new WeakMap,_fontInspectorEnabled=new WeakMap,_lang=new WeakMap,_layoutTextParams=new WeakMap,_pageHeight=new WeakMap,_pageWidth=new WeakMap,_reader=new WeakMap,_rootContainer=new WeakMap,_rotation=new WeakMap,_scale=new WeakMap,_styleCache=new WeakMap,_textContentItemsStr=new WeakMap,_textContentSource=new WeakMap,_textDivs=new WeakMap,_textDivProperties=new WeakMap,_transform=new WeakMap,_ascentCache=new WeakMap,_canvasContexts=new WeakMap,_minFontSize=new WeakMap,_pendingTextLayers=new WeakMap,_TextLayer_instances=new WeakSet,processItems_fn=__name2(function(items){var _a2,_b2;if(__privateGet(this,_disableProcessItems))return;(_b2=__privateGet(this,_layoutTextParams)).ctx??(_b2.ctx=__privateMethod(_a2=_TextLayer,_TextLayer_static,getCtx_fn).call(_a2,__privateGet(this,_lang)));const textDivs=__privateGet(this,_textDivs),textContentItemsStr=__privateGet(this,_textContentItemsStr);for(const item of items){if(textDivs.length>MAX_TEXT_DIVS_TO_RENDER){warn("Ignoring additional textDivs for performance reasons."),__privateSet(this,_disableProcessItems,!0);return}if(item.str===void 0){if(item.type==="beginMarkedContentProps"||item.type==="beginMarkedContent"){const parent=__privateGet(this,_container2);__privateSet(this,_container2,document.createElement("span")),__privateGet(this,_container2).classList.add("markedContent"),item.id!==null&&__privateGet(this,_container2).setAttribute("id",`${item.id}`),parent.append(__privateGet(this,_container2))}else item.type==="endMarkedContent"&&__privateSet(this,_container2,__privateGet(this,_container2).parentNode);continue}textContentItemsStr.push(item.str),__privateMethod(this,_TextLayer_instances,appendText_fn).call(this,item)}},"#processItems"),appendText_fn=__name2(function(geom){var _a2;const textDiv=document.createElement("span"),textDivProperties={angle:0,canvasWidth:0,hasText:geom.str!=="",hasEOL:geom.hasEOL,fontSize:0};__privateGet(this,_textDivs).push(textDiv);const tx=Util.transform(__privateGet(this,_transform),geom.transform);let angle=Math.atan2(tx[1],tx[0]);const style=__privateGet(this,_styleCache)[geom.fontName];style.vertical&&(angle+=Math.PI/2);const fontFamily=__privateGet(this,_fontInspectorEnabled)&&style.fontSubstitution||style.fontFamily,fontHeight=Math.hypot(tx[2],tx[3]),fontAscent=fontHeight*__privateMethod(_a2=_TextLayer,_TextLayer_static,getAscent_fn).call(_a2,fontFamily,__privateGet(this,_lang));let left,top;angle===0?(left=tx[4],top=tx[5]-fontAscent):(left=tx[4]+fontAscent*Math.sin(angle),top=tx[5]-fontAscent*Math.cos(angle));const scaleFactorStr="calc(var(--scale-factor)*",divStyle=textDiv.style;__privateGet(this,_container2)===__privateGet(this,_rootContainer)?(divStyle.left=`${(100*left/__privateGet(this,_pageWidth)).toFixed(2)}%`,divStyle.top=`${(100*top/__privateGet(this,_pageHeight)).toFixed(2)}%`):(divStyle.left=`${scaleFactorStr}${left.toFixed(2)}px)`,divStyle.top=`${scaleFactorStr}${top.toFixed(2)}px)`),divStyle.fontSize=`${scaleFactorStr}${(__privateGet(_TextLayer,_minFontSize)*fontHeight).toFixed(2)}px)`,divStyle.fontFamily=fontFamily,textDivProperties.fontSize=fontHeight,textDiv.setAttribute("role","presentation"),textDiv.textContent=geom.str,textDiv.dir=geom.dir,__privateGet(this,_fontInspectorEnabled)&&(textDiv.dataset.fontName=style.fontSubstitutionLoadedName||geom.fontName),angle!==0&&(textDivProperties.angle=angle*(180/Math.PI));let shouldScaleText=!1;if(geom.str.length>1)shouldScaleText=!0;else if(geom.str!==" "&&geom.transform[0]!==geom.transform[3]){const absScaleX=Math.abs(geom.transform[0]),absScaleY=Math.abs(geom.transform[3]);absScaleX!==absScaleY&&Math.max(absScaleX,absScaleY)/Math.min(absScaleX,absScaleY)>1.5&&(shouldScaleText=!0)}if(shouldScaleText&&(textDivProperties.canvasWidth=style.vertical?geom.height:geom.width),__privateGet(this,_textDivProperties).set(textDiv,textDivProperties),__privateGet(this,_layoutTextParams).div=textDiv,__privateGet(this,_layoutTextParams).properties=textDivProperties,__privateMethod(this,_TextLayer_instances,layout_fn).call(this,__privateGet(this,_layoutTextParams)),textDivProperties.hasText&&__privateGet(this,_container2).append(textDiv),textDivProperties.hasEOL){const br=document.createElement("br");br.setAttribute("role","presentation"),__privateGet(this,_container2).append(br)}},"#appendText"),layout_fn=__name2(function(params){const{div,properties,ctx,prevFontSize,prevFontFamily}=params,{style}=div;let transform="";if(__privateGet(_TextLayer,_minFontSize)>1&&(transform=`scale(${1/__privateGet(_TextLayer,_minFontSize)})`),properties.canvasWidth!==0&&properties.hasText){const{fontFamily}=style,{canvasWidth,fontSize}=properties;(prevFontSize!==fontSize||prevFontFamily!==fontFamily)&&(ctx.font=`${fontSize*__privateGet(this,_scale)}px ${fontFamily}`,params.prevFontSize=fontSize,params.prevFontFamily=fontFamily);const{width}=ctx.measureText(div.textContent);width>0&&(transform=`scaleX(${canvasWidth*__privateGet(this,_scale)/width}) ${transform}`)}properties.angle!==0&&(transform=`rotate(${properties.angle}deg) ${transform}`),transform.length>0&&(style.transform=transform)},"#layout"),_TextLayer_static=new WeakSet,getCtx_fn=__name2(function(lang=null){let canvasContext=__privateGet(this,_canvasContexts).get(lang||(lang=""));if(!canvasContext){const canvas=document.createElement("canvas");canvas.className="hiddenCanvasElement",canvas.lang=lang,document.body.append(canvas),canvasContext=canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}),__privateGet(this,_canvasContexts).set(lang,canvasContext)}return canvasContext},"#getCtx"),ensureMinFontSizeComputed_fn=__name2(function(){if(__privateGet(this,_minFontSize)!==null)return;const div=document.createElement("div");div.style.opacity=0,div.style.lineHeight=1,div.style.fontSize="1px",div.style.position="absolute",div.textContent="X",document.body.append(div),__privateSet(this,_minFontSize,div.getBoundingClientRect().height),div.remove()},"#ensureMinFontSizeComputed"),getAscent_fn=__name2(function(fontFamily,lang){const cachedAscent=__privateGet(this,_ascentCache).get(fontFamily);if(cachedAscent)return cachedAscent;const ctx=__privateMethod(this,_TextLayer_static,getCtx_fn).call(this,lang),savedFont=ctx.font;ctx.canvas.width=ctx.canvas.height=DEFAULT_FONT_SIZE,ctx.font=`${DEFAULT_FONT_SIZE}px ${fontFamily}`;const metrics=ctx.measureText("");let ascent=metrics.fontBoundingBoxAscent,descent=Math.abs(metrics.fontBoundingBoxDescent);if(ascent){const ratio2=ascent/(ascent+descent);return __privateGet(this,_ascentCache).set(fontFamily,ratio2),ctx.canvas.width=ctx.canvas.height=0,ctx.font=savedFont,ratio2}ctx.strokeStyle="red",ctx.clearRect(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE),ctx.strokeText("g",0,0);let pixels=ctx.getImageData(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE).data;descent=0;for(let i=pixels.length-1-3;i>=0;i-=4)if(pixels[i]>0){descent=Math.ceil(i/4/DEFAULT_FONT_SIZE);break}ctx.clearRect(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE),ctx.strokeText("A",0,DEFAULT_FONT_SIZE),pixels=ctx.getImageData(0,0,DEFAULT_FONT_SIZE,DEFAULT_FONT_SIZE).data,ascent=0;for(let i=0,ii=pixels.length;i<ii;i+=4)if(pixels[i]>0){ascent=DEFAULT_FONT_SIZE-Math.floor(i/4/DEFAULT_FONT_SIZE);break}ctx.canvas.width=ctx.canvas.height=0,ctx.font=savedFont;const ratio=ascent?ascent/(ascent+descent):DEFAULT_FONT_ASCENT;return __privateGet(this,_ascentCache).set(fontFamily,ratio),ratio},"#getAscent"),__privateAdd(_TextLayer,_TextLayer_static),__name2(_TextLayer,"TextLayer"),__privateAdd(_TextLayer,_ascentCache,new Map),__privateAdd(_TextLayer,_canvasContexts,new Map),__privateAdd(_TextLayer,_minFontSize,null),__privateAdd(_TextLayer,_pendingTextLayers,new Set);let TextLayer=_TextLayer;const _XfaText=class _XfaText2{static{__name(this,"_XfaText")}static textContent(xfa){const items=[],output={items,styles:Object.create(null)};function walk(node){var _a2;if(!node)return;let str=null;const name=node.name;if(name==="#text")str=node.value;else if(_XfaText2.shouldBuildText(name))(_a2=node?.attributes)!=null&&_a2.textContent?str=node.attributes.textContent:node.value&&(str=node.value);else return;if(str!==null&&items.push({str}),!!node.children)for(const child of node.children)walk(child)}return __name(walk,"walk"),__name2(walk,"walk"),walk(xfa),output}static shouldBuildText(name){return!(name==="textarea"||name==="input"||name==="option"||name==="select")}};__name2(_XfaText,"XfaText");let XfaText=_XfaText;const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=isNodeJS?NodeCanvasFactory:DOMCanvasFactory,DefaultCMapReaderFactory=isNodeJS?NodeCMapReaderFactory:DOMCMapReaderFactory,DefaultFilterFactory=isNodeJS?NodeFilterFactory:DOMFilterFactory,DefaultStandardFontDataFactory=isNodeJS?NodeStandardFontDataFactory:DOMStandardFontDataFactory;function getDocument(src={}){typeof src=="string"||src instanceof URL?src={url:src}:(src instanceof ArrayBuffer||ArrayBuffer.isView(src))&&(src={data:src});const task=new PDFDocumentLoadingTask,{docId}=task,url=src.url?getUrlProp(src.url):null,data=src.data?getDataProp(src.data):null,httpHeaders=src.httpHeaders||null,withCredentials=src.withCredentials===!0,password=src.password??null,rangeTransport=src.range instanceof PDFDataRangeTransport?src.range:null,rangeChunkSize=Number.isInteger(src.rangeChunkSize)&&src.rangeChunkSize>0?src.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let worker=src.worker instanceof PDFWorker?src.worker:null;const verbosity2=src.verbosity,docBaseUrl=typeof src.docBaseUrl=="string"&&!isDataScheme(src.docBaseUrl)?src.docBaseUrl:null,cMapUrl=typeof src.cMapUrl=="string"?src.cMapUrl:null,cMapPacked=src.cMapPacked!==!1,CMapReaderFactory=src.CMapReaderFactory||DefaultCMapReaderFactory,standardFontDataUrl=typeof src.standardFontDataUrl=="string"?src.standardFontDataUrl:null,StandardFontDataFactory=src.StandardFontDataFactory||DefaultStandardFontDataFactory,ignoreErrors=src.stopAtErrors!==!0,maxImageSize=Number.isInteger(src.maxImageSize)&&src.maxImageSize>-1?src.maxImageSize:-1,isEvalSupported2=src.isEvalSupported!==!1,isOffscreenCanvasSupported=typeof src.isOffscreenCanvasSupported=="boolean"?src.isOffscreenCanvasSupported:!isNodeJS,canvasMaxAreaInBytes=Number.isInteger(src.canvasMaxAreaInBytes)?src.canvasMaxAreaInBytes:-1,disableFontFace=typeof src.disableFontFace=="boolean"?src.disableFontFace:isNodeJS,fontExtraProperties=src.fontExtraProperties===!0,enableXfa=src.enableXfa===!0,ownerDocument=src.ownerDocument||globalThis.document,disableRange=src.disableRange===!0,disableStream=src.disableStream===!0,disableAutoFetch=src.disableAutoFetch===!0,pdfBug=src.pdfBug===!0,enableHWA=src.enableHWA===!0,length=rangeTransport?rangeTransport.length:src.length??NaN,useSystemFonts=typeof src.useSystemFonts=="boolean"?src.useSystemFonts:!isNodeJS&&!disableFontFace,useWorkerFetch=typeof src.useWorkerFetch=="boolean"?src.useWorkerFetch:CMapReaderFactory===DOMCMapReaderFactory&&StandardFontDataFactory===DOMStandardFontDataFactory&&cMapUrl&&standardFontDataUrl&&isValidFetchUrl(cMapUrl,document.baseURI)&&isValidFetchUrl(standardFontDataUrl,document.baseURI),canvasFactory=src.canvasFactory||new DefaultCanvasFactory({ownerDocument,enableHWA}),filterFactory=src.filterFactory||new DefaultFilterFactory({docId,ownerDocument}),styleElement=null;setVerbosityLevel(verbosity2);const transportFactory={canvasFactory,filterFactory};if(useWorkerFetch||(transportFactory.cMapReaderFactory=new CMapReaderFactory({baseUrl:cMapUrl,isCompressed:cMapPacked}),transportFactory.standardFontDataFactory=new StandardFontDataFactory({baseUrl:standardFontDataUrl})),!worker){const workerParams={verbosity:verbosity2,port:GlobalWorkerOptions.workerPort};worker=workerParams.port?PDFWorker.fromPort(workerParams):new PDFWorker(workerParams),task._worker=worker}const docParams={docId,apiVersion:"4.5.136",data,password,disableAutoFetch,rangeChunkSize,length,docBaseUrl,enableXfa,evaluatorOptions:{maxImageSize,disableFontFace,ignoreErrors,isEvalSupported:isEvalSupported2,isOffscreenCanvasSupported,canvasMaxAreaInBytes,fontExtraProperties,useSystemFonts,cMapUrl:useWorkerFetch?cMapUrl:null,standardFontDataUrl:useWorkerFetch?standardFontDataUrl:null}},transportParams={disableFontFace,fontExtraProperties,ownerDocument,pdfBug,styleElement,loadingParams:{disableAutoFetch,enableXfa}};return worker.promise.then(function(){if(task.destroyed)throw new Error("Loading aborted");if(worker.destroyed)throw new Error("Worker was destroyed");const workerIdPromise=worker.messageHandler.sendWithPromise("GetDocRequest",docParams,data?[data.buffer]:null);let networkStream;if(rangeTransport)networkStream=new PDFDataTransportStream(rangeTransport,{disableRange,disableStream});else if(!data){if(!url)throw new Error("getDocument - no `url` parameter provided.");networkStream=__name2(params=>isNodeJS?__name2(function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype},"isFetchSupported")()&&isValidFetchUrl(params.url)?new PDFFetchStream(params):new PDFNodeStream(params):isValidFetchUrl(params.url)?new PDFFetchStream(params):new PDFNetworkStream(params),"createPDFNetworkStream")({url,length,httpHeaders,withCredentials,rangeChunkSize,disableRange,disableStream})}return workerIdPromise.then(workerId=>{if(task.destroyed)throw new Error("Loading aborted");if(worker.destroyed)throw new Error("Worker was destroyed");const messageHandler=new MessageHandler(docId,workerId,worker.port),transport=new WorkerTransport(messageHandler,task,networkStream,transportParams,transportFactory);task._transport=transport,messageHandler.send("Ready",null)})}).catch(task._capability.reject),task}__name(getDocument,"getDocument"),__name2(getDocument,"getDocument");function getUrlProp(val){if(val instanceof URL)return val.href;try{return new URL(val,window.location).href}catch{if(isNodeJS&&typeof val=="string")return val}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}__name(getUrlProp,"getUrlProp"),__name2(getUrlProp,"getUrlProp");function getDataProp(val){if(isNodeJS&&typeof Buffer<"u"&&val instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(val instanceof Uint8Array&&val.byteLength===val.buffer.byteLength)return val;if(typeof val=="string")return stringToBytes(val);if(val instanceof ArrayBuffer||ArrayBuffer.isView(val)||typeof val=="object"&&!isNaN(val?.length))return new Uint8Array(val);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}__name(getDataProp,"getDataProp"),__name2(getDataProp,"getDataProp");function isRefProxy(ref){return typeof ref=="object"&&Number.isInteger(ref?.num)&&ref.num>=0&&Number.isInteger(ref?.gen)&&ref.gen>=0}__name(isRefProxy,"isRefProxy"),__name2(isRefProxy,"isRefProxy");const _PDFDocumentLoadingTask=class _PDFDocumentLoadingTask2{static{__name(this,"_PDFDocumentLoadingTask")}constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${__privateWrapper(_PDFDocumentLoadingTask2,_docId2)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var _a2,_b2,_c;this.destroyed=!0;try{(_a2=this._worker)!=null&&_a2.port&&(this._worker._pendingDestroy=!0),await((_b2=this._transport)==null?void 0:_b2.destroy())}catch(ex){throw(_c=this._worker)!=null&&_c.port&&delete this._worker._pendingDestroy,ex}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};_docId2=new WeakMap,__name2(_PDFDocumentLoadingTask,"PDFDocumentLoadingTask"),__privateAdd(_PDFDocumentLoadingTask,_docId2,0);let PDFDocumentLoadingTask=_PDFDocumentLoadingTask;const _PDFDataRangeTransport=class{static{__name(this,"_PDFDataRangeTransport")}constructor(length,initialData,progressiveDone=!1,contentDispositionFilename=null){this.length=length,this.initialData=initialData,this.progressiveDone=progressiveDone,this.contentDispositionFilename=contentDispositionFilename,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(listener){this._rangeListeners.push(listener)}addProgressListener(listener){this._progressListeners.push(listener)}addProgressiveReadListener(listener){this._progressiveReadListeners.push(listener)}addProgressiveDoneListener(listener){this._progressiveDoneListeners.push(listener)}onDataRange(begin,chunk){for(const listener of this._rangeListeners)listener(begin,chunk)}onDataProgress(loaded,total){this._readyCapability.promise.then(()=>{for(const listener of this._progressListeners)listener(loaded,total)})}onDataProgressiveRead(chunk){this._readyCapability.promise.then(()=>{for(const listener of this._progressiveReadListeners)listener(chunk)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const listener of this._progressiveDoneListeners)listener()})}transportReady(){this._readyCapability.resolve()}requestDataRange(begin,end){unreachable("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};__name2(_PDFDataRangeTransport,"PDFDataRangeTransport");let PDFDataRangeTransport=_PDFDataRangeTransport;const _PDFDocumentProxy=class{static{__name(this,"_PDFDocumentProxy")}constructor(pdfInfo,transport){this._pdfInfo=pdfInfo,this._transport=transport}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(pageNumber){return this._transport.getPage(pageNumber)}getPageIndex(ref){return this._transport.getPageIndex(ref)}getDestinations(){return this._transport.getDestinations()}getDestination(id){return this._transport.getDestination(id)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent="display"}={}){const{renderingIntent}=this._transport.getRenderingIntent(intent);return this._transport.getOptionalContentConfig(renderingIntent)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(keepLoadedFonts=!1){return this._transport.startCleanup(keepLoadedFonts||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(ref){return this._transport.cachedPageNumber(ref)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}};__name2(_PDFDocumentProxy,"PDFDocumentProxy");let PDFDocumentProxy=_PDFDocumentProxy;const _PDFPageProxy=class{static{__name(this,"_PDFPageProxy")}constructor(pageIndex,pageInfo,transport,pdfBug=!1){__privateAdd(this,_PDFPageProxy_instances),__privateAdd(this,_delayedCleanupTimeout,null),__privateAdd(this,_pendingCleanup,!1),this._pageIndex=pageIndex,this._pageInfo=pageInfo,this._transport=transport,this._stats=pdfBug?new StatTimer:null,this._pdfBug=pdfBug,this.commonObjs=transport.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale,rotation=this.rotate,offsetX=0,offsetY=0,dontFlip=!1}={}){return new PageViewport({viewBox:this.view,scale,rotation,offsetX,offsetY,dontFlip})}getAnnotations({intent="display"}={}){const{renderingIntent}=this._transport.getRenderingIntent(intent);return this._transport.getAnnotations(this._pageIndex,renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return shadow(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var _a2;return((_a2=this._transport._htmlForXfa)==null?void 0:_a2.children[this._pageIndex])||null}render({canvasContext,viewport,intent="display",annotationMode=AnnotationMode.ENABLE,transform=null,background=null,optionalContentConfigPromise=null,annotationCanvasMap=null,pageColors=null,printAnnotationStorage=null,isEditing=!1}){var _a2,_b2;(_a2=this._stats)==null||_a2.time("Overall");const intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing),{renderingIntent,cacheKey}=intentArgs;__privateSet(this,_pendingCleanup,!1),__privateMethod(this,_PDFPageProxy_instances,abortDelayedCleanup_fn).call(this),optionalContentConfigPromise||(optionalContentConfigPromise=this._transport.getOptionalContentConfig(renderingIntent));let intentState=this._intentStates.get(cacheKey);intentState||(intentState=Object.create(null),this._intentStates.set(cacheKey,intentState)),intentState.streamReaderCancelTimeout&&(clearTimeout(intentState.streamReaderCancelTimeout),intentState.streamReaderCancelTimeout=null);const intentPrint=!!(renderingIntent&RenderingIntentFlag.PRINT);intentState.displayReadyCapability||(intentState.displayReadyCapability=Promise.withResolvers(),intentState.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(_b2=this._stats)==null||_b2.time("Page Request"),this._pumpOperatorList(intentArgs));const complete=__name2(error=>{var _a3;intentState.renderTasks.delete(internalRenderTask),(this._maybeCleanupAfterRender||intentPrint)&&__privateSet(this,_pendingCleanup,!0),__privateMethod(this,_PDFPageProxy_instances,tryCleanup_fn).call(this,!intentPrint),error?(internalRenderTask.capability.reject(error),this._abortOperatorList({intentState,reason:error instanceof Error?error:new Error(error)})):internalRenderTask.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(_a3=globalThis.Stats)!=null&&_a3.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},"complete"),internalRenderTask=new InternalRenderTask({callback:complete,params:{canvasContext,viewport,transform,background},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap,operatorList:intentState.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!intentPrint,pdfBug:this._pdfBug,pageColors});(intentState.renderTasks||(intentState.renderTasks=new Set)).add(internalRenderTask);const renderTask=internalRenderTask.task;return Promise.all([intentState.displayReadyCapability.promise,optionalContentConfigPromise]).then(([transparency,optionalContentConfig])=>{var _a3;if(this.destroyed){complete();return}if((_a3=this._stats)==null||_a3.time("Rendering"),!(optionalContentConfig.renderingIntent&renderingIntent))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");internalRenderTask.initializeGraphics({transparency,optionalContentConfig}),internalRenderTask.operatorListChanged()}).catch(complete),renderTask}getOperatorList({intent="display",annotationMode=AnnotationMode.ENABLE,printAnnotationStorage=null,isEditing=!1}={}){var _a2;function operatorListChanged(){intentState.operatorList.lastChunk&&(intentState.opListReadCapability.resolve(intentState.operatorList),intentState.renderTasks.delete(opListTask))}__name(operatorListChanged,"operatorListChanged"),__name2(operatorListChanged,"operatorListChanged");const intentArgs=this._transport.getRenderingIntent(intent,annotationMode,printAnnotationStorage,isEditing,!0);let intentState=this._intentStates.get(intentArgs.cacheKey);intentState||(intentState=Object.create(null),this._intentStates.set(intentArgs.cacheKey,intentState));let opListTask;return intentState.opListReadCapability||(opListTask=Object.create(null),opListTask.operatorListChanged=operatorListChanged,intentState.opListReadCapability=Promise.withResolvers(),(intentState.renderTasks||(intentState.renderTasks=new Set)).add(opListTask),intentState.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(_a2=this._stats)==null||_a2.time("Page Request"),this._pumpOperatorList(intentArgs)),intentState.opListReadCapability.promise}streamTextContent({includeMarkedContent=!1,disableNormalization=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:includeMarkedContent===!0,disableNormalization:disableNormalization===!0},{highWaterMark:100,size(textContent){return textContent.items.length}})}getTextContent(params={}){if(this._transport._htmlForXfa)return this.getXfa().then(xfa=>XfaText.textContent(xfa));const readableStream=this.streamTextContent(params);return new Promise(function(resolve,reject){function pump(){reader.read().then(function({value,done}){if(done){resolve(textContent);return}textContent.lang??(textContent.lang=value.lang),Object.assign(textContent.styles,value.styles),textContent.items.push(...value.items),pump()},reject)}__name(pump,"pump"),__name2(pump,"pump");const reader=readableStream.getReader(),textContent={items:[],styles:Object.create(null),lang:null};pump()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const waitOn=[];for(const intentState of this._intentStates.values())if(this._abortOperatorList({intentState,reason:new Error("Page was destroyed."),force:!0}),!intentState.opListReadCapability)for(const internalRenderTask of intentState.renderTasks)waitOn.push(internalRenderTask.completed),internalRenderTask.cancel();return this.objs.clear(),__privateSet(this,_pendingCleanup,!1),__privateMethod(this,_PDFPageProxy_instances,abortDelayedCleanup_fn).call(this),Promise.all(waitOn)}cleanup(resetStats=!1){__privateSet(this,_pendingCleanup,!0);const success=__privateMethod(this,_PDFPageProxy_instances,tryCleanup_fn).call(this,!1);return resetStats&&success&&this._stats&&(this._stats=new StatTimer),success}_startRenderPage(transparency,cacheKey){var _a2,_b2;const intentState=this._intentStates.get(cacheKey);intentState&&((_a2=this._stats)==null||_a2.timeEnd("Page Request"),(_b2=intentState.displayReadyCapability)==null||_b2.resolve(transparency))}_renderPageChunk(operatorListChunk,intentState){for(let i=0,ii=operatorListChunk.length;i<ii;i++)intentState.operatorList.fnArray.push(operatorListChunk.fnArray[i]),intentState.operatorList.argsArray.push(operatorListChunk.argsArray[i]);intentState.operatorList.lastChunk=operatorListChunk.lastChunk,intentState.operatorList.separateAnnots=operatorListChunk.separateAnnots;for(const internalRenderTask of intentState.renderTasks)internalRenderTask.operatorListChanged();operatorListChunk.lastChunk&&__privateMethod(this,_PDFPageProxy_instances,tryCleanup_fn).call(this,!0)}_pumpOperatorList({renderingIntent,cacheKey,annotationStorageSerializable,modifiedIds}){const{map,transfer}=annotationStorageSerializable,reader=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:renderingIntent,cacheKey,annotationStorage:map,modifiedIds},transfer).getReader(),intentState=this._intentStates.get(cacheKey);intentState.streamReader=reader;const pump=__name2(()=>{reader.read().then(({value,done})=>{if(done){intentState.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(value,intentState),pump())},reason=>{if(intentState.streamReader=null,!this._transport.destroyed){if(intentState.operatorList){intentState.operatorList.lastChunk=!0;for(const internalRenderTask of intentState.renderTasks)internalRenderTask.operatorListChanged();__privateMethod(this,_PDFPageProxy_instances,tryCleanup_fn).call(this,!0)}if(intentState.displayReadyCapability)intentState.displayReadyCapability.reject(reason);else if(intentState.opListReadCapability)intentState.opListReadCapability.reject(reason);else throw reason}})},"pump");pump()}_abortOperatorList({intentState,reason,force=!1}){if(intentState.streamReader){if(intentState.streamReaderCancelTimeout&&(clearTimeout(intentState.streamReaderCancelTimeout),intentState.streamReaderCancelTimeout=null),!force){if(intentState.renderTasks.size>0)return;if(reason instanceof RenderingCancelledException){let delay=RENDERING_CANCELLED_TIMEOUT;reason.extraDelay>0&&reason.extraDelay<1e3&&(delay+=reason.extraDelay),intentState.streamReaderCancelTimeout=setTimeout(()=>{intentState.streamReaderCancelTimeout=null,this._abortOperatorList({intentState,reason,force:!0})},delay);return}}if(intentState.streamReader.cancel(new AbortException(reason.message)).catch(()=>{}),intentState.streamReader=null,!this._transport.destroyed){for(const[curCacheKey,curIntentState]of this._intentStates)if(curIntentState===intentState){this._intentStates.delete(curCacheKey);break}this.cleanup()}}}get stats(){return this._stats}};_delayedCleanupTimeout=new WeakMap,_pendingCleanup=new WeakMap,_PDFPageProxy_instances=new WeakSet,tryCleanup_fn=__name2(function(delayed=!1){if(__privateMethod(this,_PDFPageProxy_instances,abortDelayedCleanup_fn).call(this),!__privateGet(this,_pendingCleanup)||this.destroyed)return!1;if(delayed)return __privateSet(this,_delayedCleanupTimeout,setTimeout(()=>{__privateSet(this,_delayedCleanupTimeout,null),__privateMethod(this,_PDFPageProxy_instances,tryCleanup_fn).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks,operatorList}of this._intentStates.values())if(renderTasks.size>0||!operatorList.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),__privateSet(this,_pendingCleanup,!1),!0},"#tryCleanup"),abortDelayedCleanup_fn=__name2(function(){__privateGet(this,_delayedCleanupTimeout)&&(clearTimeout(__privateGet(this,_delayedCleanupTimeout)),__privateSet(this,_delayedCleanupTimeout,null))},"#abortDelayedCleanup"),__name2(_PDFPageProxy,"PDFPageProxy");let PDFPageProxy=_PDFPageProxy;const _LoopbackPort=class{static{__name(this,"_LoopbackPort")}constructor(){__privateAdd(this,_listeners,new Set),__privateAdd(this,_deferred,Promise.resolve())}postMessage(obj,transfer){const event={data:structuredClone(obj,transfer?{transfer}:null)};__privateGet(this,_deferred).then(()=>{for(const listener of __privateGet(this,_listeners))listener.call(this,event)})}addEventListener(name,listener){__privateGet(this,_listeners).add(listener)}removeEventListener(name,listener){__privateGet(this,_listeners).delete(listener)}terminate(){__privateGet(this,_listeners).clear()}};_listeners=new WeakMap,_deferred=new WeakMap,__name2(_LoopbackPort,"LoopbackPort");let LoopbackPort=_LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fakeWorkerId:0};isNodeJS&&(PDFWorkerUtil.isWorkerDisabled=!0,GlobalWorkerOptions.workerSrc||(GlobalWorkerOptions.workerSrc="./pdf.worker.mjs")),PDFWorkerUtil.isSameOrigin=function(baseUrl,otherUrl){let base;try{if(base=new URL(baseUrl),!base.origin||base.origin==="null")return!1}catch{return!1}const other=new URL(otherUrl,base);return base.origin===other.origin},PDFWorkerUtil.createCDNWrapper=function(url){const wrapper=`await import("${url}");`;return URL.createObjectURL(new Blob([wrapper],{type:"text/javascript"}))};const _PDFWorker=class _PDFWorker2{static{__name(this,"_PDFWorker")}constructor({name=null,port=null,verbosity:verbosity2=getVerbosityLevel()}={}){__privateAdd(this,_PDFWorker_instances);var _a2;if(this.name=name,this.destroyed=!1,this.verbosity=verbosity2,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,port){if((_a2=__privateGet(_PDFWorker2,_workerPorts))!=null&&_a2.has(port))throw new Error("Cannot use more than one PDFWorker per port.");(__privateGet(_PDFWorker2,_workerPorts)||__privateSet(_PDFWorker2,_workerPorts,new WeakMap)).set(port,this),this._initializeFromPort(port);return}this._initialize()}get promise(){return isNodeJS?Promise.all([NodePackages.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(port){this._port=port,this._messageHandler=new MessageHandler("main","worker",port),this._messageHandler.on("ready",function(){}),__privateMethod(this,_PDFWorker_instances,resolve_fn).call(this)}_initialize(){if(PDFWorkerUtil.isWorkerDisabled||__privateGet(_PDFWorker2,_PDFWorker_static,mainThreadWorkerMessageHandler_get)){this._setupFakeWorker();return}let{workerSrc}=_PDFWorker2;try{PDFWorkerUtil.isSameOrigin(window.location.href,workerSrc)||(workerSrc=PDFWorkerUtil.createCDNWrapper(new URL(workerSrc,window.location).href));const worker=new Worker(workerSrc,{type:"module"}),messageHandler=new MessageHandler("main","worker",worker),terminateEarly=__name2(()=>{ac.abort(),messageHandler.destroy(),worker.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},"terminateEarly"),ac=new AbortController;worker.addEventListener("error",()=>{this._webWorker||terminateEarly()},{signal:ac.signal}),messageHandler.on("test",data=>{if(ac.abort(),this.destroyed||!data){terminateEarly();return}this._messageHandler=messageHandler,this._port=worker,this._webWorker=worker,__privateMethod(this,_PDFWorker_instances,resolve_fn).call(this)}),messageHandler.on("ready",data=>{if(ac.abort(),this.destroyed){terminateEarly();return}try{sendTest()}catch{this._setupFakeWorker()}});const sendTest=__name2(()=>{const testObj=new Uint8Array;messageHandler.send("test",testObj,[testObj.buffer])},"sendTest");sendTest();return}catch{info("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||(warn("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker2._setupFakeWorkerGlobal.then(WorkerMessageHandler=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const port=new LoopbackPort;this._port=port;const id=`fake${PDFWorkerUtil.fakeWorkerId++}`,workerHandler=new MessageHandler(id+"_worker",id,port);WorkerMessageHandler.setup(workerHandler,port),this._messageHandler=new MessageHandler(id,id+"_worker",port),__privateMethod(this,_PDFWorker_instances,resolve_fn).call(this)}).catch(reason=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${reason.message}".`))})}destroy(){var _a2;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(_a2=__privateGet(_PDFWorker2,_workerPorts))==null||_a2.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(params){var _a2;if(!params?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");const cachedPort=(_a2=__privateGet(this,_workerPorts))==null?void 0:_a2.get(params.port);if(cachedPort){if(cachedPort._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return cachedPort}return new _PDFWorker2(params)}static get workerSrc(){if(GlobalWorkerOptions.workerSrc)return GlobalWorkerOptions.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return shadow(this,"_setupFakeWorkerGlobal",__name2(async()=>__privateGet(this,_PDFWorker_static,mainThreadWorkerMessageHandler_get)?__privateGet(this,_PDFWorker_static,mainThreadWorkerMessageHandler_get):(await import(this.workerSrc)).WorkerMessageHandler,"loader")())}};_workerPorts=new WeakMap,_PDFWorker_instances=new WeakSet,resolve_fn=__name2(function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},"#resolve"),_PDFWorker_static=new WeakSet,mainThreadWorkerMessageHandler_get=__name2(function(){var _a2;try{return((_a2=globalThis.pdfjsWorker)==null?void 0:_a2.WorkerMessageHandler)||null}catch{return null}},"#mainThreadWorkerMessageHandler"),__privateAdd(_PDFWorker,_PDFWorker_static),__name2(_PDFWorker,"PDFWorker"),__privateAdd(_PDFWorker,_workerPorts);let PDFWorker=_PDFWorker;const _WorkerTransport=class{static{__name(this,"_WorkerTransport")}constructor(messageHandler,loadingTask,networkStream,params,factory){__privateAdd(this,_WorkerTransport_instances),__privateAdd(this,_methodPromises,new Map),__privateAdd(this,_pageCache,new Map),__privateAdd(this,_pagePromises,new Map),__privateAdd(this,_pageRefCache,new Map),__privateAdd(this,_passwordCapability,null),this.messageHandler=messageHandler,this.loadingTask=loadingTask,this.commonObjs=new PDFObjects,this.fontLoader=new FontLoader({ownerDocument:params.ownerDocument,styleElement:params.styleElement}),this.loadingParams=params.loadingParams,this._params=params,this.canvasFactory=factory.canvasFactory,this.filterFactory=factory.filterFactory,this.cMapReaderFactory=factory.cMapReaderFactory,this.standardFontDataFactory=factory.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=networkStream,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return shadow(this,"annotationStorage",new AnnotationStorage)}getRenderingIntent(intent,annotationMode=AnnotationMode.ENABLE,printAnnotationStorage=null,isEditing=!1,isOpList=!1){let renderingIntent=RenderingIntentFlag.DISPLAY,annotationStorageSerializable=SerializableEmpty;switch(intent){case"any":renderingIntent=RenderingIntentFlag.ANY;break;case"display":break;case"print":renderingIntent=RenderingIntentFlag.PRINT;break;default:warn(`getRenderingIntent - invalid intent: ${intent}`)}const annotationStorage=renderingIntent&RenderingIntentFlag.PRINT&&printAnnotationStorage instanceof PrintAnnotationStorage?printAnnotationStorage:this.annotationStorage;switch(annotationMode){case AnnotationMode.DISABLE:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case AnnotationMode.ENABLE:break;case AnnotationMode.ENABLE_FORMS:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_FORMS;break;case AnnotationMode.ENABLE_STORAGE:renderingIntent+=RenderingIntentFlag.ANNOTATIONS_STORAGE,annotationStorageSerializable=annotationStorage.serializable;break;default:warn(`getRenderingIntent - invalid annotationMode: ${annotationMode}`)}isEditing&&(renderingIntent+=RenderingIntentFlag.IS_EDITING),isOpList&&(renderingIntent+=RenderingIntentFlag.OPLIST);const{ids:modifiedIds,hash:modifiedIdsHash}=annotationStorage.modifiedIds,cacheKeyBuf=[renderingIntent,annotationStorageSerializable.hash,modifiedIdsHash];return{renderingIntent,cacheKey:cacheKeyBuf.join("_"),annotationStorageSerializable,modifiedIds}}destroy(){var _a2;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(_a2=__privateGet(this,_passwordCapability))==null||_a2.reject(new Error("Worker was destroyed during onPassword callback"));const waitOn=[];for(const page of __privateGet(this,_pageCache).values())waitOn.push(page._destroy());__privateGet(this,_pageCache).clear(),__privateGet(this,_pagePromises).clear(),__privateGet(this,_pageRefCache).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const terminated=this.messageHandler.sendWithPromise("Terminate",null);return waitOn.push(terminated),Promise.all(waitOn).then(()=>{var _a3;this.commonObjs.clear(),this.fontLoader.clear(),__privateGet(this,_methodPromises).clear(),this.filterFactory.destroy(),TextLayer.cleanup(),(_a3=this._networkStream)==null||_a3.cancelAllRequests(new AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler,loadingTask}=this;messageHandler.on("GetReader",(data,sink)=>{assert(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=evt=>{this._lastProgress={loaded:evt.loaded,total:evt.total}},sink.onPull=()=>{this._fullReader.read().then(function({value,done}){if(done){sink.close();return}assert(value instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),sink.enqueue(new Uint8Array(value),1,[value])}).catch(reason=>{sink.error(reason)})},sink.onCancel=reason=>{this._fullReader.cancel(reason),sink.ready.catch(readyReason=>{if(!this.destroyed)throw readyReason})}}),messageHandler.on("ReaderHeadersReady",data=>{const headersCapability=Promise.withResolvers(),fullReader=this._fullReader;return fullReader.headersReady.then(()=>{var _a2;(!fullReader.isStreamingSupported||!fullReader.isRangeSupported)&&(this._lastProgress&&((_a2=loadingTask.onProgress)==null||_a2.call(loadingTask,this._lastProgress)),fullReader.onProgress=evt=>{var _a3;(_a3=loadingTask.onProgress)==null||_a3.call(loadingTask,{loaded:evt.loaded,total:evt.total})}),headersCapability.resolve({isStreamingSupported:fullReader.isStreamingSupported,isRangeSupported:fullReader.isRangeSupported,contentLength:fullReader.contentLength})},headersCapability.reject),headersCapability.promise}),messageHandler.on("GetRangeReader",(data,sink)=>{assert(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const rangeReader=this._networkStream.getRangeReader(data.begin,data.end);if(!rangeReader){sink.close();return}sink.onPull=()=>{rangeReader.read().then(function({value,done}){if(done){sink.close();return}assert(value instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),sink.enqueue(new Uint8Array(value),1,[value])}).catch(reason=>{sink.error(reason)})},sink.onCancel=reason=>{rangeReader.cancel(reason),sink.ready.catch(readyReason=>{if(!this.destroyed)throw readyReason})}}),messageHandler.on("GetDoc",({pdfInfo})=>{this._numPages=pdfInfo.numPages,this._htmlForXfa=pdfInfo.htmlForXfa,delete pdfInfo.htmlForXfa,loadingTask._capability.resolve(new PDFDocumentProxy(pdfInfo,this))}),messageHandler.on("DocException",function(ex){let reason;switch(ex.name){case"PasswordException":reason=new PasswordException(ex.message,ex.code);break;case"InvalidPDFException":reason=new InvalidPDFException(ex.message);break;case"MissingPDFException":reason=new MissingPDFException(ex.message);break;case"UnexpectedResponseException":reason=new UnexpectedResponseException(ex.message,ex.status);break;case"UnknownErrorException":reason=new UnknownErrorException(ex.message,ex.details);break;default:unreachable("DocException - expected a valid Error.")}loadingTask._capability.reject(reason)}),messageHandler.on("PasswordRequest",exception=>{if(__privateSet(this,_passwordCapability,Promise.withResolvers()),loadingTask.onPassword){const updatePassword=__name2(password=>{password instanceof Error?__privateGet(this,_passwordCapability).reject(password):__privateGet(this,_passwordCapability).resolve({password})},"updatePassword");try{loadingTask.onPassword(updatePassword,exception.code)}catch(ex){__privateGet(this,_passwordCapability).reject(ex)}}else __privateGet(this,_passwordCapability).reject(new PasswordException(exception.message,exception.code));return __privateGet(this,_passwordCapability).promise}),messageHandler.on("DataLoaded",data=>{var _a2;(_a2=loadingTask.onProgress)==null||_a2.call(loadingTask,{loaded:data.length,total:data.length}),this.downloadInfoCapability.resolve(data)}),messageHandler.on("StartRenderPage",data=>{if(this.destroyed)return;__privateGet(this,_pageCache).get(data.pageIndex)._startRenderPage(data.transparency,data.cacheKey)}),messageHandler.on("commonobj",([id,type,exportedData])=>{var _a2;if(this.destroyed||this.commonObjs.has(id))return null;switch(type){case"Font":const{disableFontFace,fontExtraProperties,pdfBug}=this._params;if("error"in exportedData){const exportedError=exportedData.error;warn(`Error during font loading: ${exportedError}`),this.commonObjs.resolve(id,exportedError);break}const inspectFont=pdfBug&&((_a2=globalThis.FontInspector)!=null&&_a2.enabled)?(font2,url)=>globalThis.FontInspector.fontAdded(font2,url):null,font=new FontFaceObject(exportedData,{disableFontFace,inspectFont});this.fontLoader.bind(font).catch(()=>messageHandler.sendWithPromise("FontFallback",{id})).finally(()=>{!fontExtraProperties&&font.data&&(font.data=null),this.commonObjs.resolve(id,font)});break;case"CopyLocalImage":const{imageRef}=exportedData;assert(imageRef,"The imageRef must be defined.");for(const pageProxy of __privateGet(this,_pageCache).values())for(const[,data]of pageProxy.objs)if(data?.ref===imageRef)return data.dataLen?(this.commonObjs.resolve(id,structuredClone(data)),data.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(id,exportedData);break;default:throw new Error(`Got unknown common object type ${type}`)}return null}),messageHandler.on("obj",([id,pageIndex,type,imageData])=>{var _a2;if(this.destroyed)return;const pageProxy=__privateGet(this,_pageCache).get(pageIndex);if(!pageProxy.objs.has(id)){if(pageProxy._intentStates.size===0){(_a2=imageData?.bitmap)==null||_a2.close();return}switch(type){case"Image":pageProxy.objs.resolve(id,imageData),imageData?.dataLen>MAX_IMAGE_SIZE_TO_CACHE&&(pageProxy._maybeCleanupAfterRender=!0);break;case"Pattern":pageProxy.objs.resolve(id,imageData);break;default:throw new Error(`Got unknown object type ${type}`)}}}),messageHandler.on("DocProgress",data=>{var _a2;this.destroyed||(_a2=loadingTask.onProgress)==null||_a2.call(loadingTask,{loaded:data.loaded,total:data.total})}),messageHandler.on("FetchBuiltInCMap",data=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(data):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),messageHandler.on("FetchStandardFontData",data=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(data):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var _a2;this.annotationStorage.size<=0&&warn("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map,transfer}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:map,filename:((_a2=this._fullReader)==null?void 0:_a2.filename)??null},transfer).finally(()=>{this.annotationStorage.resetModified()})}getPage(pageNumber){if(!Number.isInteger(pageNumber)||pageNumber<=0||pageNumber>this._numPages)return Promise.reject(new Error("Invalid page request."));const pageIndex=pageNumber-1,cachedPromise=__privateGet(this,_pagePromises).get(pageIndex);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise("GetPage",{pageIndex}).then(pageInfo=>{if(this.destroyed)throw new Error("Transport destroyed");pageInfo.refStr&&__privateGet(this,_pageRefCache).set(pageInfo.refStr,pageNumber);const page=new PDFPageProxy(pageIndex,pageInfo,this,this._params.pdfBug);return __privateGet(this,_pageCache).set(pageIndex,page),page});return __privateGet(this,_pagePromises).set(pageIndex,promise),promise}getPageIndex(ref){return isRefProxy(ref)?this.messageHandler.sendWithPromise("GetPageIndex",{num:ref.num,gen:ref.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(pageIndex,intent){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex,intent})}getFieldObjects(){return __privateMethod(this,_WorkerTransport_instances,cacheSimpleMethod_fn).call(this,"GetFieldObjects")}hasJSActions(){return __privateMethod(this,_WorkerTransport_instances,cacheSimpleMethod_fn).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(id){return typeof id!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return __privateMethod(this,_WorkerTransport_instances,cacheSimpleMethod_fn).call(this,"GetDocJSActions")}getPageJSActions(pageIndex){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex})}getStructTree(pageIndex){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(renderingIntent){return __privateMethod(this,_WorkerTransport_instances,cacheSimpleMethod_fn).call(this,"GetOptionalContentConfig").then(data=>new OptionalContentConfig(data,renderingIntent))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const name="GetMetadata",cachedPromise=__privateGet(this,_methodPromises).get(name);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise(name,null).then(results=>{var _a2,_b2;return{info:results[0],metadata:results[1]?new Metadata(results[1]):null,contentDispositionFilename:((_a2=this._fullReader)==null?void 0:_a2.filename)??null,contentLength:((_b2=this._fullReader)==null?void 0:_b2.contentLength)??null}});return __privateGet(this,_methodPromises).set(name,promise),promise}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(keepLoadedFonts=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const page of __privateGet(this,_pageCache).values())if(!page.cleanup())throw new Error(`startCleanup: Page ${page.pageNumber} is currently rendering.`);this.commonObjs.clear(),keepLoadedFonts||this.fontLoader.clear(),__privateGet(this,_methodPromises).clear(),this.filterFactory.destroy(!0),TextLayer.cleanup()}}cachedPageNumber(ref){if(!isRefProxy(ref))return null;const refStr=ref.gen===0?`${ref.num}R`:`${ref.num}R${ref.gen}`;return __privateGet(this,_pageRefCache).get(refStr)??null}};_methodPromises=new WeakMap,_pageCache=new WeakMap,_pagePromises=new WeakMap,_pageRefCache=new WeakMap,_passwordCapability=new WeakMap,_WorkerTransport_instances=new WeakSet,cacheSimpleMethod_fn=__name2(function(name,data=null){const cachedPromise=__privateGet(this,_methodPromises).get(name);if(cachedPromise)return cachedPromise;const promise=this.messageHandler.sendWithPromise(name,data);return __privateGet(this,_methodPromises).set(name,promise),promise},"#cacheSimpleMethod"),__name2(_WorkerTransport,"WorkerTransport");let WorkerTransport=_WorkerTransport;const INITIAL_DATA=Symbol("INITIAL_DATA"),_PDFObjects=class{static{__name(this,"_PDFObjects")}constructor(){__privateAdd(this,_PDFObjects_instances),__privateAdd(this,_objs,Object.create(null))}get(objId,callback=null){if(callback){const obj2=__privateMethod(this,_PDFObjects_instances,ensureObj_fn).call(this,objId);return obj2.promise.then(()=>callback(obj2.data)),null}const obj=__privateGet(this,_objs)[objId];if(!obj||obj.data===INITIAL_DATA)throw new Error(`Requesting object that isn't resolved yet ${objId}.`);return obj.data}has(objId){const obj=__privateGet(this,_objs)[objId];return!!obj&&obj.data!==INITIAL_DATA}resolve(objId,data=null){const obj=__privateMethod(this,_PDFObjects_instances,ensureObj_fn).call(this,objId);obj.data=data,obj.resolve()}clear(){var _a2;for(const objId in __privateGet(this,_objs)){const{data}=__privateGet(this,_objs)[objId];(_a2=data?.bitmap)==null||_a2.close()}__privateSet(this,_objs,Object.create(null))}*[Symbol.iterator](){for(const objId in __privateGet(this,_objs)){const{data}=__privateGet(this,_objs)[objId];data!==INITIAL_DATA&&(yield[objId,data])}}};_objs=new WeakMap,_PDFObjects_instances=new WeakSet,ensureObj_fn=__name2(function(objId){var _a2;return(_a2=__privateGet(this,_objs))[objId]||(_a2[objId]={...Promise.withResolvers(),data:INITIAL_DATA})},"#ensureObj"),__name2(_PDFObjects,"PDFObjects");let PDFObjects=_PDFObjects;const _RenderTask=class{static{__name(this,"_RenderTask")}constructor(internalRenderTask){__privateAdd(this,_internalRenderTask,null),__privateSet(this,_internalRenderTask,internalRenderTask),this.onContinue=null}get promise(){return __privateGet(this,_internalRenderTask).capability.promise}cancel(extraDelay=0){__privateGet(this,_internalRenderTask).cancel(null,extraDelay)}get separateAnnots(){const{separateAnnots}=__privateGet(this,_internalRenderTask).operatorList;if(!separateAnnots)return!1;const{annotationCanvasMap}=__privateGet(this,_internalRenderTask);return separateAnnots.form||separateAnnots.canvas&&annotationCanvasMap?.size>0}};_internalRenderTask=new WeakMap,__name2(_RenderTask,"RenderTask");let RenderTask=_RenderTask;const _InternalRenderTask=class _InternalRenderTask2{static{__name(this,"_InternalRenderTask")}constructor({callback,params,objs,commonObjs,annotationCanvasMap,operatorList,pageIndex,canvasFactory,filterFactory,useRequestAnimationFrame=!1,pdfBug=!1,pageColors=null}){__privateAdd(this,_rAF,null),this.callback=callback,this.params=params,this.objs=objs,this.commonObjs=commonObjs,this.annotationCanvasMap=annotationCanvasMap,this.operatorListIdx=null,this.operatorList=operatorList,this._pageIndex=pageIndex,this.canvasFactory=canvasFactory,this.filterFactory=filterFactory,this._pdfBug=pdfBug,this.pageColors=pageColors,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=useRequestAnimationFrame===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=params.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency=!1,optionalContentConfig}){var _a2,_b2;if(this.cancelled)return;if(this._canvas){if(__privateGet(_InternalRenderTask2,_canvasInUse).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");__privateGet(_InternalRenderTask2,_canvasInUse).add(this._canvas)}this._pdfBug&&((_a2=globalThis.StepperManager)!=null&&_a2.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext,viewport,transform,background}=this.params;this.gfx=new CanvasGraphics(canvasContext,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform,viewport,transparency,background}),this.operatorListIdx=0,this.graphicsReady=!0,(_b2=this.graphicsReadyCallback)==null||_b2.call(this)}cancel(error=null,extraDelay=0){var _a2;this.running=!1,this.cancelled=!0,(_a2=this.gfx)==null||_a2.endDrawing(),__privateGet(this,_rAF)&&(window.cancelAnimationFrame(__privateGet(this,_rAF)),__privateSet(this,_rAF,null)),__privateGet(_InternalRenderTask2,_canvasInUse).delete(this._canvas),this.callback(error||new RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,extraDelay))}operatorListChanged(){var _a2;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(_a2=this.stepper)==null||_a2.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?__privateSet(this,_rAF,window.requestAnimationFrame(()=>{__privateSet(this,_rAF,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),__privateGet(_InternalRenderTask2,_canvasInUse).delete(this._canvas),this.callback())))}};_rAF=new WeakMap,_canvasInUse=new WeakMap,__name2(_InternalRenderTask,"InternalRenderTask"),__privateAdd(_InternalRenderTask,_canvasInUse,new WeakSet);let InternalRenderTask=_InternalRenderTask;const version="4.5.136",build="3a21f03b0";__webpack_require__(670);function makeColorComp(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}__name(makeColorComp,"makeColorComp"),__name2(makeColorComp,"makeColorComp");function scaleAndClamp(x){return Math.max(0,Math.min(255,255*x))}__name(scaleAndClamp,"scaleAndClamp"),__name2(scaleAndClamp,"scaleAndClamp");const _ColorConverters=class{static{__name(this,"_ColorConverters")}static CMYK_G([c,y,m,k]){return["G",1-Math.min(1,.3*c+.59*m+.11*y+k)]}static G_CMYK([g]){return["CMYK",0,0,0,1-g]}static G_RGB([g]){return["RGB",g,g,g]}static G_rgb([g]){return g=scaleAndClamp(g),[g,g,g]}static G_HTML([g]){const G=makeColorComp(g);return`#${G}${G}${G}`}static RGB_G([r,g,b]){return["G",.3*r+.59*g+.11*b]}static RGB_rgb(color){return color.map(scaleAndClamp)}static RGB_HTML(color){return`#${color.map(makeColorComp).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([c,y,m,k]){return["RGB",1-Math.min(1,c+k),1-Math.min(1,m+k),1-Math.min(1,y+k)]}static CMYK_rgb([c,y,m,k]){return[scaleAndClamp(1-Math.min(1,c+k)),scaleAndClamp(1-Math.min(1,m+k)),scaleAndClamp(1-Math.min(1,y+k))]}static CMYK_HTML(components){const rgb=this.CMYK_RGB(components).slice(1);return this.RGB_HTML(rgb)}static RGB_CMYK([r,g,b]){const c=1-r,m=1-g,y=1-b,k=Math.min(c,m,y);return["CMYK",c,m,y,k]}};__name2(_ColorConverters,"ColorConverters");let ColorConverters=_ColorConverters;const _XfaLayer=class{static{__name(this,"_XfaLayer")}static setupStorage(html,id,element,storage,intent){const storedData=storage.getValue(id,{value:null});switch(element.name){case"textarea":if(storedData.value!==null&&(html.textContent=storedData.value),intent==="print")break;html.addEventListener("input",event=>{storage.setValue(id,{value:event.target.value})});break;case"input":if(element.attributes.type==="radio"||element.attributes.type==="checkbox"){if(storedData.value===element.attributes.xfaOn?html.setAttribute("checked",!0):storedData.value===element.attributes.xfaOff&&html.removeAttribute("checked"),intent==="print")break;html.addEventListener("change",event=>{storage.setValue(id,{value:event.target.checked?event.target.getAttribute("xfaOn"):event.target.getAttribute("xfaOff")})})}else{if(storedData.value!==null&&html.setAttribute("value",storedData.value),intent==="print")break;html.addEventListener("input",event=>{storage.setValue(id,{value:event.target.value})})}break;case"select":if(storedData.value!==null){html.setAttribute("value",storedData.value);for(const option of element.children)option.attributes.value===storedData.value?option.attributes.selected=!0:option.attributes.hasOwnProperty("selected")&&delete option.attributes.selected}html.addEventListener("input",event=>{const options=event.target.options,value=options.selectedIndex===-1?"":options[options.selectedIndex].value;storage.setValue(id,{value})});break}}static setAttributes({html,element,storage=null,intent,linkService}){const{attributes}=element,isHTMLAnchorElement=html instanceof HTMLAnchorElement;attributes.type==="radio"&&(attributes.name=`${attributes.name}-${intent}`);for(const[key,value]of Object.entries(attributes))if(value!=null)switch(key){case"class":value.length&&html.setAttribute(key,value.join(" "));break;case"dataId":break;case"id":html.setAttribute("data-element-id",value);break;case"style":Object.assign(html.style,value);break;case"textContent":html.textContent=value;break;default:(!isHTMLAnchorElement||key!=="href"&&key!=="newWindow")&&html.setAttribute(key,value)}isHTMLAnchorElement&&linkService.addLinkAttributes(html,attributes.href,attributes.newWindow),storage&&attributes.dataId&&this.setupStorage(html,attributes.dataId,element,storage)}static render(parameters){var _a2,_b2;const storage=parameters.annotationStorage,linkService=parameters.linkService,root=parameters.xfaHtml,intent=parameters.intent||"display",rootHtml=document.createElement(root.name);root.attributes&&this.setAttributes({html:rootHtml,element:root,intent,linkService});const isNotForRichText=intent!=="richText",rootDiv=parameters.div;if(rootDiv.append(rootHtml),parameters.viewport){const transform=`matrix(${parameters.viewport.transform.join(",")})`;rootDiv.style.transform=transform}isNotForRichText&&rootDiv.setAttribute("class","xfaLayer xfaFont");const textDivs=[];if(root.children.length===0){if(root.value){const node=document.createTextNode(root.value);rootHtml.append(node),isNotForRichText&&XfaText.shouldBuildText(root.name)&&textDivs.push(node)}return{textDivs}}const stack=[[root,-1,rootHtml]];for(;stack.length>0;){const[parent,i,html]=stack.at(-1);if(i+1===parent.children.length){stack.pop();continue}const child=parent.children[++stack.at(-1)[1]];if(child===null)continue;const{name}=child;if(name==="#text"){const node=document.createTextNode(child.value);textDivs.push(node),html.append(node);continue}const childHtml=(_a2=child?.attributes)!=null&&_a2.xmlns?document.createElementNS(child.attributes.xmlns,name):document.createElement(name);if(html.append(childHtml),child.attributes&&this.setAttributes({html:childHtml,element:child,storage,intent,linkService}),((_b2=child.children)==null?void 0:_b2.length)>0)stack.push([child,-1,childHtml]);else if(child.value){const node=document.createTextNode(child.value);isNotForRichText&&XfaText.shouldBuildText(name)&&textDivs.push(node),childHtml.append(node)}}for(const el of rootDiv.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))el.setAttribute("readOnly",!0);return{textDivs}}static update(parameters){const transform=`matrix(${parameters.viewport.transform.join(",")})`;parameters.div.style.transform=transform,parameters.div.hidden=!1}};__name2(_XfaLayer,"XfaLayer");let XfaLayer=_XfaLayer;const DEFAULT_TAB_INDEX=1e3,annotation_layer_DEFAULT_FONT_SIZE=9,GetElementsByNameSet=new WeakSet;function getRectDims(rect){return{width:rect[2]-rect[0],height:rect[3]-rect[1]}}__name(getRectDims,"getRectDims"),__name2(getRectDims,"getRectDims");const _AnnotationElementFactory=class{static{__name(this,"_AnnotationElementFactory")}static create(parameters){switch(parameters.data.annotationType){case AnnotationType.LINK:return new LinkAnnotationElement(parameters);case AnnotationType.TEXT:return new TextAnnotationElement(parameters);case AnnotationType.WIDGET:switch(parameters.data.fieldType){case"Tx":return new TextWidgetAnnotationElement(parameters);case"Btn":return parameters.data.radioButton?new RadioButtonWidgetAnnotationElement(parameters):parameters.data.checkBox?new CheckboxWidgetAnnotationElement(parameters):new PushButtonWidgetAnnotationElement(parameters);case"Ch":return new ChoiceWidgetAnnotationElement(parameters);case"Sig":return new SignatureWidgetAnnotationElement(parameters)}return new WidgetAnnotationElement(parameters);case AnnotationType.POPUP:return new PopupAnnotationElement(parameters);case AnnotationType.FREETEXT:return new FreeTextAnnotationElement(parameters);case AnnotationType.LINE:return new LineAnnotationElement(parameters);case AnnotationType.SQUARE:return new SquareAnnotationElement(parameters);case AnnotationType.CIRCLE:return new CircleAnnotationElement(parameters);case AnnotationType.POLYLINE:return new PolylineAnnotationElement(parameters);case AnnotationType.CARET:return new CaretAnnotationElement(parameters);case AnnotationType.INK:return new InkAnnotationElement(parameters);case AnnotationType.POLYGON:return new PolygonAnnotationElement(parameters);case AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(parameters);case AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(parameters);case AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(parameters);case AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(parameters);case AnnotationType.STAMP:return new StampAnnotationElement(parameters);case AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(parameters);default:return new AnnotationElement(parameters)}}};__name2(_AnnotationElementFactory,"AnnotationElementFactory");let AnnotationElementFactory=_AnnotationElementFactory;const _AnnotationElement=class _AnnotationElement2{static{__name(this,"_AnnotationElement")}constructor(parameters,{isRenderable=!1,ignoreBorder=!1,createQuadrilaterals=!1}={}){__privateAdd(this,_AnnotationElement_instances),__privateAdd(this,_updates,null),__privateAdd(this,_hasBorder,!1),__privateAdd(this,_popupElement,null),this.isRenderable=isRenderable,this.data=parameters.data,this.layer=parameters.layer,this.linkService=parameters.linkService,this.downloadManager=parameters.downloadManager,this.imageResourcesPath=parameters.imageResourcesPath,this.renderForms=parameters.renderForms,this.svgFactory=parameters.svgFactory,this.annotationStorage=parameters.annotationStorage,this.enableScripting=parameters.enableScripting,this.hasJSActions=parameters.hasJSActions,this._fieldObjects=parameters.fieldObjects,this.parent=parameters.parent,isRenderable&&(this.container=this._createContainer(ignoreBorder)),createQuadrilaterals&&this._createQuadrilaterals()}static _hasPopupData({titleObj,contentsObj,richText}){return!!(titleObj?.str||contentsObj?.str||richText?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return _AnnotationElement2._hasPopupData(this.data)}updateEdited(params){var _a2;if(!this.container)return;__privateGet(this,_updates)||__privateSet(this,_updates,{rect:this.data.rect.slice(0)});const{rect}=params;rect&&__privateMethod(this,_AnnotationElement_instances,setRectEdited_fn).call(this,rect),(_a2=__privateGet(this,_popupElement))==null||_a2.popup.updateEdited(params)}resetEdited(){var _a2;__privateGet(this,_updates)&&(__privateMethod(this,_AnnotationElement_instances,setRectEdited_fn).call(this,__privateGet(this,_updates).rect),(_a2=__privateGet(this,_popupElement))==null||_a2.popup.resetEdited(),__privateSet(this,_updates,null))}_createContainer(ignoreBorder){const{data,parent:{page,viewport}}=this,container=document.createElement("section");container.setAttribute("data-annotation-id",data.id),this instanceof WidgetAnnotationElement||(container.tabIndex=DEFAULT_TAB_INDEX);const{style}=container;if(style.zIndex=this.parent.zIndex++,data.popupRef&&container.setAttribute("aria-haspopup","dialog"),data.alternativeText&&(container.title=data.alternativeText),data.noRotate&&container.classList.add("norotate"),!data.rect||this instanceof PopupAnnotationElement){const{rotation:rotation2}=data;return!data.hasOwnCanvas&&rotation2!==0&&this.setRotation(rotation2,container),container}const{width,height}=getRectDims(data.rect);if(!ignoreBorder&&data.borderStyle.width>0){style.borderWidth=`${data.borderStyle.width}px`;const horizontalRadius=data.borderStyle.horizontalCornerRadius,verticalRadius=data.borderStyle.verticalCornerRadius;if(horizontalRadius>0||verticalRadius>0){const radius=`calc(${horizontalRadius}px * var(--scale-factor)) / calc(${verticalRadius}px * var(--scale-factor))`;style.borderRadius=radius}else if(this instanceof RadioButtonWidgetAnnotationElement){const radius=`calc(${width}px * var(--scale-factor)) / calc(${height}px * var(--scale-factor))`;style.borderRadius=radius}switch(data.borderStyle.style){case AnnotationBorderStyleType.SOLID:style.borderStyle="solid";break;case AnnotationBorderStyleType.DASHED:style.borderStyle="dashed";break;case AnnotationBorderStyleType.BEVELED:warn("Unimplemented border style: beveled");break;case AnnotationBorderStyleType.INSET:warn("Unimplemented border style: inset");break;case AnnotationBorderStyleType.UNDERLINE:style.borderBottomStyle="solid";break}const borderColor=data.borderColor||null;borderColor?(__privateSet(this,_hasBorder,!0),style.borderColor=Util.makeHexColor(borderColor[0]|0,borderColor[1]|0,borderColor[2]|0)):style.borderWidth=0}const rect=Util.normalizeRect([data.rect[0],page.view[3]-data.rect[1]+page.view[1],data.rect[2],page.view[3]-data.rect[3]+page.view[1]]),{pageWidth,pageHeight,pageX,pageY}=viewport.rawDims;style.left=`${100*(rect[0]-pageX)/pageWidth}%`,style.top=`${100*(rect[1]-pageY)/pageHeight}%`;const{rotation}=data;return data.hasOwnCanvas||rotation===0?(style.width=`${100*width/pageWidth}%`,style.height=`${100*height/pageHeight}%`):this.setRotation(rotation,container),container}setRotation(angle,container=this.container){if(!this.data.rect)return;const{pageWidth,pageHeight}=this.parent.viewport.rawDims,{width,height}=getRectDims(this.data.rect);let elementWidth,elementHeight;angle%180===0?(elementWidth=100*width/pageWidth,elementHeight=100*height/pageHeight):(elementWidth=100*height/pageWidth,elementHeight=100*width/pageHeight),container.style.width=`${elementWidth}%`,container.style.height=`${elementHeight}%`,container.setAttribute("data-main-rotation",(360-angle)%360)}get _commonActions(){const setColor=__name2((jsName,styleName,event)=>{const color=event.detail[jsName],colorType=color[0],colorArray=color.slice(1);event.target.style[styleName]=ColorConverters[`${colorType}_HTML`](colorArray),this.annotationStorage.setValue(this.data.id,{[styleName]:ColorConverters[`${colorType}_rgb`](colorArray)})},"setColor");return shadow(this,"_commonActions",{display:__name2(event=>{const{display}=event.detail,hidden=display%2===1;this.container.style.visibility=hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:hidden,noPrint:display===1||display===2})},"display"),print:__name2(event=>{this.annotationStorage.setValue(this.data.id,{noPrint:!event.detail.print})},"print"),hidden:__name2(event=>{const{hidden}=event.detail;this.container.style.visibility=hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:hidden,noView:hidden})},"hidden"),focus:__name2(event=>{setTimeout(()=>event.target.focus({preventScroll:!1}),0)},"focus"),userName:__name2(event=>{event.target.title=event.detail.userName},"userName"),readonly:__name2(event=>{event.target.disabled=event.detail.readonly},"readonly"),required:__name2(event=>{this._setRequired(event.target,event.detail.required)},"required"),bgColor:__name2(event=>{setColor("bgColor","backgroundColor",event)},"bgColor"),fillColor:__name2(event=>{setColor("fillColor","backgroundColor",event)},"fillColor"),fgColor:__name2(event=>{setColor("fgColor","color",event)},"fgColor"),textColor:__name2(event=>{setColor("textColor","color",event)},"textColor"),borderColor:__name2(event=>{setColor("borderColor","borderColor",event)},"borderColor"),strokeColor:__name2(event=>{setColor("strokeColor","borderColor",event)},"strokeColor"),rotation:__name2(event=>{const angle=event.detail.rotation;this.setRotation(angle),this.annotationStorage.setValue(this.data.id,{rotation:angle})},"rotation")})}_dispatchEventFromSandbox(actions,jsEvent){const commonActions=this._commonActions;for(const name of Object.keys(jsEvent.detail)){const action=actions[name]||commonActions[name];action?.(jsEvent)}}_setDefaultPropertiesFromJS(element){if(!this.enableScripting)return;const storedData=this.annotationStorage.getRawValue(this.data.id);if(!storedData)return;const commonActions=this._commonActions;for(const[actionName,detail]of Object.entries(storedData)){const action=commonActions[actionName];if(action){const eventProxy={detail:{[actionName]:detail},target:element};action(eventProxy),delete storedData[actionName]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints}=this.data;if(!quadPoints)return;const[rectBlX,rectBlY,rectTrX,rectTrY]=this.data.rect.map(x=>Math.fround(x));if(quadPoints.length===8){const[trX,trY,blX,blY]=quadPoints.subarray(2,6);if(rectTrX===trX&&rectTrY===trY&&rectBlX===blX&&rectBlY===blY)return}const{style}=this.container;let svgBuffer;if(__privateGet(this,_hasBorder)){const{borderColor,borderWidth}=style;style.borderWidth=0,svgBuffer=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${borderColor}" stroke-width="${borderWidth}">`],this.container.classList.add("hasBorder")}const width=rectTrX-rectBlX,height=rectTrY-rectBlY,{svgFactory}=this,svg=svgFactory.createElement("svg");svg.classList.add("quadrilateralsContainer"),svg.setAttribute("width",0),svg.setAttribute("height",0);const defs=svgFactory.createElement("defs");svg.append(defs);const clipPath=svgFactory.createElement("clipPath"),id=`clippath_${this.data.id}`;clipPath.setAttribute("id",id),clipPath.setAttribute("clipPathUnits","objectBoundingBox"),defs.append(clipPath);for(let i=2,ii=quadPoints.length;i<ii;i+=8){const trX=quadPoints[i],trY=quadPoints[i+1],blX=quadPoints[i+2],blY=quadPoints[i+3],rect=svgFactory.createElement("rect"),x=(blX-rectBlX)/width,y=(rectTrY-trY)/height,rectWidth=(trX-blX)/width,rectHeight=(trY-blY)/height;rect.setAttribute("x",x),rect.setAttribute("y",y),rect.setAttribute("width",rectWidth),rect.setAttribute("height",rectHeight),clipPath.append(rect),svgBuffer?.push(`<rect vector-effect="non-scaling-stroke" x="${x}" y="${y}" width="${rectWidth}" height="${rectHeight}"/>`)}__privateGet(this,_hasBorder)&&(svgBuffer.push("</g></svg>')"),style.backgroundImage=svgBuffer.join("")),this.container.append(svg),this.container.style.clipPath=`url(#${id})`}_createPopup(){const{container,data}=this;container.setAttribute("aria-haspopup","dialog");const popup=__privateSet(this,_popupElement,new PopupAnnotationElement({data:{color:data.color,titleObj:data.titleObj,modificationDate:data.modificationDate,contentsObj:data.contentsObj,richText:data.richText,parentRect:data.rect,borderStyle:0,id:`popup_${data.id}`,rotation:data.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(popup.render())}render(){unreachable("Abstract method `AnnotationElement.render` called")}_getElementsByName(name,skipId=null){const fields=[];if(this._fieldObjects){const fieldObj=this._fieldObjects[name];if(fieldObj)for(const{page,id,exportValues}of fieldObj){if(page===-1||id===skipId)continue;const exportValue=typeof exportValues=="string"?exportValues:null,domElement=document.querySelector(`[data-element-id="${id}"]`);if(domElement&&!GetElementsByNameSet.has(domElement)){warn(`_getElementsByName - element not allowed: ${id}`);continue}fields.push({id,exportValue,domElement})}return fields}for(const domElement of document.getElementsByName(name)){const{exportValue}=domElement,id=domElement.getAttribute("data-element-id");id!==skipId&&GetElementsByNameSet.has(domElement)&&fields.push({id,exportValue,domElement})}return fields}show(){var _a2;this.container&&(this.container.hidden=!1),(_a2=this.popup)==null||_a2.maybeShow()}hide(){var _a2;this.container&&(this.container.hidden=!0),(_a2=this.popup)==null||_a2.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const triggers=this.getElementsToTriggerPopup();if(Array.isArray(triggers))for(const element of triggers)element.classList.add("highlightArea");else triggers.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:mode,data:{id:editId}}=this;this.container.addEventListener("dblclick",()=>{var _a2;(_a2=this.linkService.eventBus)==null||_a2.dispatch("switchannotationeditormode",{source:this,mode,editId})})}};_updates=new WeakMap,_hasBorder=new WeakMap,_popupElement=new WeakMap,_AnnotationElement_instances=new WeakSet,setRectEdited_fn=__name2(function(rect){const{container:{style},data:{rect:currentRect,rotation},parent:{viewport:{rawDims:{pageWidth,pageHeight,pageX,pageY}}}}=this;currentRect?.splice(0,4,...rect);const{width,height}=getRectDims(rect);style.left=`${100*(rect[0]-pageX)/pageWidth}%`,style.top=`${100*(pageHeight-rect[3]+pageY)/pageHeight}%`,rotation===0?(style.width=`${100*width/pageWidth}%`,style.height=`${100*height/pageHeight}%`):this.setRotation(rotation)},"#setRectEdited"),__name2(_AnnotationElement,"AnnotationElement");let AnnotationElement=_AnnotationElement;const _LinkAnnotationElement=class extends AnnotationElement{static{__name(this,"_LinkAnnotationElement")}constructor(parameters,options=null){super(parameters,{isRenderable:!0,ignoreBorder:!!options?.ignoreBorder,createQuadrilaterals:!0}),__privateAdd(this,_LinkAnnotationElement_instances),this.isTooltipOnly=parameters.data.isTooltipOnly}render(){const{data,linkService}=this,link=document.createElement("a");link.setAttribute("data-element-id",data.id);let isBound=!1;return data.url?(linkService.addLinkAttributes(link,data.url,data.newWindow),isBound=!0):data.action?(this._bindNamedAction(link,data.action),isBound=!0):data.attachment?(__privateMethod(this,_LinkAnnotationElement_instances,bindAttachment_fn).call(this,link,data.attachment,data.attachmentDest),isBound=!0):data.setOCGState?(__privateMethod(this,_LinkAnnotationElement_instances,bindSetOCGState_fn).call(this,link,data.setOCGState),isBound=!0):data.dest?(this._bindLink(link,data.dest),isBound=!0):(data.actions&&(data.actions.Action||data.actions["Mouse Up"]||data.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(link,data),isBound=!0),data.resetForm?(this._bindResetFormAction(link,data.resetForm),isBound=!0):this.isTooltipOnly&&!isBound&&(this._bindLink(link,""),isBound=!0)),this.container.classList.add("linkAnnotation"),isBound&&this.container.append(link),this.container}_bindLink(link,destination){link.href=this.linkService.getDestinationHash(destination),link.onclick=()=>(destination&&this.linkService.goToDestination(destination),!1),(destination||destination==="")&&__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this)}_bindNamedAction(link,action){link.href=this.linkService.getAnchorUrl(""),link.onclick=()=>(this.linkService.executeNamedAction(action),!1),__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this)}_bindJSAction(link,data){link.href=this.linkService.getAnchorUrl("");const map=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const name of Object.keys(data.actions)){const jsName=map.get(name);jsName&&(link[jsName]=()=>{var _a2;return(_a2=this.linkService.eventBus)==null||_a2.dispatch("dispatcheventinsandbox",{source:this,detail:{id:data.id,name}}),!1})}link.onclick||(link.onclick=()=>!1),__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this)}_bindResetFormAction(link,resetForm){const otherClickAction=link.onclick;if(otherClickAction||(link.href=this.linkService.getAnchorUrl("")),__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this),!this._fieldObjects){warn('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),otherClickAction||(link.onclick=()=>!1);return}link.onclick=()=>{var _a2;otherClickAction?.();const{fields:resetFormFields,refs:resetFormRefs,include}=resetForm,allFields=[];if(resetFormFields.length!==0||resetFormRefs.length!==0){const fieldIds=new Set(resetFormRefs);for(const fieldName of resetFormFields){const fields=this._fieldObjects[fieldName]||[];for(const{id}of fields)fieldIds.add(id)}for(const fields of Object.values(this._fieldObjects))for(const field of fields)fieldIds.has(field.id)===include&&allFields.push(field)}else for(const fields of Object.values(this._fieldObjects))allFields.push(...fields);const storage=this.annotationStorage,allIds=[];for(const field of allFields){const{id}=field;switch(allIds.push(id),field.type){case"text":{const value=field.defaultValue||"";storage.setValue(id,{value});break}case"checkbox":case"radiobutton":{const value=field.defaultValue===field.exportValues;storage.setValue(id,{value});break}case"combobox":case"listbox":{const value=field.defaultValue||"";storage.setValue(id,{value});break}default:continue}const domElement=document.querySelector(`[data-element-id="${id}"]`);if(domElement){if(!GetElementsByNameSet.has(domElement)){warn(`_bindResetFormAction - element not allowed: ${id}`);continue}}else continue;domElement.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((_a2=this.linkService.eventBus)==null||_a2.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:allIds,name:"ResetForm"}})),!1}}};_LinkAnnotationElement_instances=new WeakSet,setInternalLink_fn=__name2(function(){this.container.setAttribute("data-internal-link","")},"#setInternalLink"),bindAttachment_fn=__name2(function(link,attachment,dest=null){link.href=this.linkService.getAnchorUrl(""),attachment.description&&(link.title=attachment.description),link.onclick=()=>{var _a2;return(_a2=this.downloadManager)==null||_a2.openOrDownloadData(attachment.content,attachment.filename,dest),!1},__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this)},"#bindAttachment"),bindSetOCGState_fn=__name2(function(link,action){link.href=this.linkService.getAnchorUrl(""),link.onclick=()=>(this.linkService.executeSetOCGState(action),!1),__privateMethod(this,_LinkAnnotationElement_instances,setInternalLink_fn).call(this)},"#bindSetOCGState"),__name2(_LinkAnnotationElement,"LinkAnnotationElement");let LinkAnnotationElement=_LinkAnnotationElement;const _TextAnnotationElement=class extends AnnotationElement{static{__name(this,"_TextAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const image=document.createElement("img");return image.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",image.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),image.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(image),this.container}};__name2(_TextAnnotationElement,"TextAnnotationElement");let TextAnnotationElement=_TextAnnotationElement;const _WidgetAnnotationElement=class extends AnnotationElement{static{__name(this,"_WidgetAnnotationElement")}render(){return this.container}showElementAndHideCanvas(element){var _a2;this.data.hasOwnCanvas&&(((_a2=element.previousSibling)==null?void 0:_a2.nodeName)==="CANVAS"&&(element.previousSibling.hidden=!0),element.hidden=!1)}_getKeyModifier(event){return util_FeatureTest.platform.isMac?event.metaKey:event.ctrlKey}_setEventListener(element,elementData,baseName,eventName,valueGetter){baseName.includes("mouse")?element.addEventListener(baseName,event=>{var _a2;(_a2=this.linkService.eventBus)==null||_a2.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:eventName,value:valueGetter(event),shift:event.shiftKey,modifier:this._getKeyModifier(event)}})}):element.addEventListener(baseName,event=>{var _a2;if(baseName==="blur"){if(!elementData.focused||!event.relatedTarget)return;elementData.focused=!1}else if(baseName==="focus"){if(elementData.focused)return;elementData.focused=!0}valueGetter&&((_a2=this.linkService.eventBus)==null||_a2.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:eventName,value:valueGetter(event)}}))})}_setEventListeners(element,elementData,names,getter){var _a2,_b2,_c;for(const[baseName,eventName]of names)(eventName==="Action"||(_a2=this.data.actions)!=null&&_a2[eventName])&&((eventName==="Focus"||eventName==="Blur")&&(elementData||(elementData={focused:!1})),this._setEventListener(element,elementData,baseName,eventName,getter),eventName==="Focus"&&!((_b2=this.data.actions)!=null&&_b2.Blur)?this._setEventListener(element,elementData,"blur","Blur",null):eventName==="Blur"&&!((_c=this.data.actions)!=null&&_c.Focus)&&this._setEventListener(element,elementData,"focus","Focus",null))}_setBackgroundColor(element){const color=this.data.backgroundColor||null;element.style.backgroundColor=color===null?"transparent":Util.makeHexColor(color[0],color[1],color[2])}_setTextStyle(element){const TEXT_ALIGNMENT=["left","center","right"],{fontColor}=this.data.defaultAppearanceData,fontSize=this.data.defaultAppearanceData.fontSize||annotation_layer_DEFAULT_FONT_SIZE,style=element.style;let computedFontSize;const BORDER_SIZE=2,roundToOneDecimal=__name2(x=>Math.round(10*x)/10,"roundToOneDecimal");if(this.data.multiLine){const height=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE),numberOfLines=Math.round(height/(LINE_FACTOR*fontSize))||1,lineHeight=height/numberOfLines;computedFontSize=Math.min(fontSize,roundToOneDecimal(lineHeight/LINE_FACTOR))}else{const height=Math.abs(this.data.rect[3]-this.data.rect[1]-BORDER_SIZE);computedFontSize=Math.min(fontSize,roundToOneDecimal(height/LINE_FACTOR))}style.fontSize=`calc(${computedFontSize}px * var(--scale-factor))`,style.color=Util.makeHexColor(fontColor[0],fontColor[1],fontColor[2]),this.data.textAlignment!==null&&(style.textAlign=TEXT_ALIGNMENT[this.data.textAlignment])}_setRequired(element,isRequired){isRequired?element.setAttribute("required",!0):element.removeAttribute("required"),element.setAttribute("aria-required",isRequired)}};__name2(_WidgetAnnotationElement,"WidgetAnnotationElement");let WidgetAnnotationElement=_WidgetAnnotationElement;const _TextWidgetAnnotationElement=class extends WidgetAnnotationElement{static{__name(this,"_TextWidgetAnnotationElement")}constructor(parameters){const isRenderable=parameters.renderForms||parameters.data.hasOwnCanvas||!parameters.data.hasAppearance&&!!parameters.data.fieldValue;super(parameters,{isRenderable})}setPropertyOnSiblings(base,key,value,keyInStorage){const storage=this.annotationStorage;for(const element of this._getElementsByName(base.name,base.id))element.domElement&&(element.domElement[key]=value),storage.setValue(element.id,{[keyInStorage]:value})}render(){var _a2,_b2;const storage=this.annotationStorage,id=this.data.id;this.container.classList.add("textWidgetAnnotation");let element=null;if(this.renderForms){const storedData=storage.getValue(id,{value:this.data.fieldValue});let textContent=storedData.value||"";const maxLen=storage.getValue(id,{charLimit:this.data.maxLen}).charLimit;maxLen&&textContent.length>maxLen&&(textContent=textContent.slice(0,maxLen));let fieldFormattedValues=storedData.formattedValue||((_a2=this.data.textContent)==null?void 0:_a2.join(`
`))||null;fieldFormattedValues&&this.data.comb&&(fieldFormattedValues=fieldFormattedValues.replaceAll(/\s+/g,""));const elementData={userValue:textContent,formattedValue:fieldFormattedValues,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(element=document.createElement("textarea"),element.textContent=fieldFormattedValues??textContent,this.data.doNotScroll&&(element.style.overflowY="hidden")):(element=document.createElement("input"),element.type="text",element.setAttribute("value",fieldFormattedValues??textContent),this.data.doNotScroll&&(element.style.overflowX="hidden")),this.data.hasOwnCanvas&&(element.hidden=!0),GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=this.data.readOnly,element.name=this.data.fieldName,element.tabIndex=DEFAULT_TAB_INDEX,this._setRequired(element,this.data.required),maxLen&&(element.maxLength=maxLen),element.addEventListener("input",event=>{storage.setValue(id,{value:event.target.value}),this.setPropertyOnSiblings(element,"value",event.target.value,"value"),elementData.formattedValue=null}),element.addEventListener("resetform",event=>{const defaultValue=this.data.defaultFieldValue??"";element.value=elementData.userValue=defaultValue,elementData.formattedValue=null});let blurListener=__name2(event=>{const{formattedValue}=elementData;formattedValue!=null&&(event.target.value=formattedValue),event.target.scrollLeft=0},"blurListener");if(this.enableScripting&&this.hasJSActions){element.addEventListener("focus",event=>{var _a3;if(elementData.focused)return;const{target}=event;elementData.userValue&&(target.value=elementData.userValue),elementData.lastCommittedValue=target.value,elementData.commitKey=1,(_a3=this.data.actions)!=null&&_a3.Focus||(elementData.focused=!0)}),element.addEventListener("updatefromsandbox",jsEvent=>{this.showElementAndHideCanvas(jsEvent.target);const actions={value(event){elementData.userValue=event.detail.value??"",storage.setValue(id,{value:elementData.userValue.toString()}),event.target.value=elementData.userValue},formattedValue(event){const{formattedValue}=event.detail;elementData.formattedValue=formattedValue,formattedValue!=null&&event.target!==document.activeElement&&(event.target.value=formattedValue),storage.setValue(id,{formattedValue})},selRange(event){event.target.setSelectionRange(...event.detail.selRange)},charLimit:__name2(event=>{var _a3;const{charLimit}=event.detail,{target}=event;if(charLimit===0){target.removeAttribute("maxLength");return}target.setAttribute("maxLength",charLimit);let value=elementData.userValue;!value||value.length<=charLimit||(value=value.slice(0,charLimit),target.value=elementData.userValue=value,storage.setValue(id,{value}),(_a3=this.linkService.eventBus)==null||_a3.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey:1,selStart:target.selectionStart,selEnd:target.selectionEnd}}))},"charLimit")};this._dispatchEventFromSandbox(actions,jsEvent)}),element.addEventListener("keydown",event=>{var _a3;elementData.commitKey=1;let commitKey=-1;if(event.key==="Escape"?commitKey=0:event.key==="Enter"&&!this.data.multiLine?commitKey=2:event.key==="Tab"&&(elementData.commitKey=3),commitKey===-1)return;const{value}=event.target;elementData.lastCommittedValue!==value&&(elementData.lastCommittedValue=value,elementData.userValue=value,(_a3=this.linkService.eventBus)==null||_a3.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}}))});const _blurListener=blurListener;blurListener=null,element.addEventListener("blur",event=>{var _a3,_b3;if(!elementData.focused||!event.relatedTarget)return;(_a3=this.data.actions)!=null&&_a3.Blur||(elementData.focused=!1);const{value}=event.target;elementData.userValue=value,elementData.lastCommittedValue!==value&&((_b3=this.linkService.eventBus)==null||_b3.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,willCommit:!0,commitKey:elementData.commitKey,selStart:event.target.selectionStart,selEnd:event.target.selectionEnd}})),_blurListener(event)}),(_b2=this.data.actions)!=null&&_b2.Keystroke&&element.addEventListener("beforeinput",event=>{var _a3;elementData.lastCommittedValue=null;const{data,target}=event,{value,selectionStart,selectionEnd}=target;let selStart=selectionStart,selEnd=selectionEnd;switch(event.inputType){case"deleteWordBackward":{const match=value.substring(0,selectionStart).match(/\w*[^\w]*$/);match&&(selStart-=match[0].length);break}case"deleteWordForward":{const match=value.substring(selectionStart).match(/^[^\w]*\w*/);match&&(selEnd+=match[0].length);break}case"deleteContentBackward":selectionStart===selectionEnd&&(selStart-=1);break;case"deleteContentForward":selectionStart===selectionEnd&&(selEnd+=1);break}event.preventDefault(),(_a3=this.linkService.eventBus)==null||_a3.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value,change:data||"",willCommit:!1,selStart,selEnd}})}),this._setEventListeners(element,elementData,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],event=>event.target.value)}if(blurListener&&element.addEventListener("blur",blurListener),this.data.comb){const combWidth=(this.data.rect[2]-this.data.rect[0])/maxLen;element.classList.add("comb"),element.style.letterSpacing=`calc(${combWidth}px * var(--scale-factor) - 1ch)`}}else element=document.createElement("div"),element.textContent=this.data.fieldValue,element.style.verticalAlign="middle",element.style.display="table-cell",this.data.hasOwnCanvas&&(element.hidden=!0);return this._setTextStyle(element),this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}};__name2(_TextWidgetAnnotationElement,"TextWidgetAnnotationElement");let TextWidgetAnnotationElement=_TextWidgetAnnotationElement;const _SignatureWidgetAnnotationElement=class extends WidgetAnnotationElement{static{__name(this,"_SignatureWidgetAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!!parameters.data.hasOwnCanvas})}};__name2(_SignatureWidgetAnnotationElement,"SignatureWidgetAnnotationElement");let SignatureWidgetAnnotationElement=_SignatureWidgetAnnotationElement;const _CheckboxWidgetAnnotationElement=class extends WidgetAnnotationElement{static{__name(this,"_CheckboxWidgetAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){const storage=this.annotationStorage,data=this.data,id=data.id;let value=storage.getValue(id,{value:data.exportValue===data.fieldValue}).value;typeof value=="string"&&(value=value!=="Off",storage.setValue(id,{value})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const element=document.createElement("input");return GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=data.readOnly,this._setRequired(element,this.data.required),element.type="checkbox",element.name=data.fieldName,value&&element.setAttribute("checked",!0),element.setAttribute("exportValue",data.exportValue),element.tabIndex=DEFAULT_TAB_INDEX,element.addEventListener("change",event=>{const{name,checked}=event.target;for(const checkbox of this._getElementsByName(name,id)){const curChecked=checked&&checkbox.exportValue===data.exportValue;checkbox.domElement&&(checkbox.domElement.checked=curChecked),storage.setValue(checkbox.id,{value:curChecked})}storage.setValue(id,{value:checked})}),element.addEventListener("resetform",event=>{const defaultValue=data.defaultFieldValue||"Off";event.target.checked=defaultValue===data.exportValue}),this.enableScripting&&this.hasJSActions&&(element.addEventListener("updatefromsandbox",jsEvent=>{const actions={value(event){event.target.checked=event.detail.value!=="Off",storage.setValue(id,{value:event.target.checked})}};this._dispatchEventFromSandbox(actions,jsEvent)}),this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],event=>event.target.checked)),this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}};__name2(_CheckboxWidgetAnnotationElement,"CheckboxWidgetAnnotationElement");let CheckboxWidgetAnnotationElement=_CheckboxWidgetAnnotationElement;const _RadioButtonWidgetAnnotationElement=class extends WidgetAnnotationElement{static{__name(this,"_RadioButtonWidgetAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const storage=this.annotationStorage,data=this.data,id=data.id;let value=storage.getValue(id,{value:data.fieldValue===data.buttonValue}).value;if(typeof value=="string"&&(value=value!==data.buttonValue,storage.setValue(id,{value})),value)for(const radio of this._getElementsByName(data.fieldName,id))storage.setValue(radio.id,{value:!1});const element=document.createElement("input");if(GetElementsByNameSet.add(element),element.setAttribute("data-element-id",id),element.disabled=data.readOnly,this._setRequired(element,this.data.required),element.type="radio",element.name=data.fieldName,value&&element.setAttribute("checked",!0),element.tabIndex=DEFAULT_TAB_INDEX,element.addEventListener("change",event=>{const{name,checked}=event.target;for(const radio of this._getElementsByName(name,id))storage.setValue(radio.id,{value:!1});storage.setValue(id,{value:checked})}),element.addEventListener("resetform",event=>{const defaultValue=data.defaultFieldValue;event.target.checked=defaultValue!=null&&defaultValue===data.buttonValue}),this.enableScripting&&this.hasJSActions){const pdfButtonValue=data.buttonValue;element.addEventListener("updatefromsandbox",jsEvent=>{const actions={value:__name2(event=>{const checked=pdfButtonValue===event.detail.value;for(const radio of this._getElementsByName(event.target.name)){const curChecked=checked&&radio.id===id;radio.domElement&&(radio.domElement.checked=curChecked),storage.setValue(radio.id,{value:curChecked})}},"value")};this._dispatchEventFromSandbox(actions,jsEvent)}),this._setEventListeners(element,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],event=>event.target.checked)}return this._setBackgroundColor(element),this._setDefaultPropertiesFromJS(element),this.container.append(element),this.container}};__name2(_RadioButtonWidgetAnnotationElement,"RadioButtonWidgetAnnotationElement");let RadioButtonWidgetAnnotationElement=_RadioButtonWidgetAnnotationElement;const _PushButtonWidgetAnnotationElement=class extends LinkAnnotationElement{static{__name(this,"_PushButtonWidgetAnnotationElement")}constructor(parameters){super(parameters,{ignoreBorder:parameters.data.hasAppearance})}render(){const container=super.render();container.classList.add("buttonWidgetAnnotation","pushButton");const linkElement=container.lastChild;return this.enableScripting&&this.hasJSActions&&linkElement&&(this._setDefaultPropertiesFromJS(linkElement),linkElement.addEventListener("updatefromsandbox",jsEvent=>{this._dispatchEventFromSandbox({},jsEvent)})),container}};__name2(_PushButtonWidgetAnnotationElement,"PushButtonWidgetAnnotationElement");let PushButtonWidgetAnnotationElement=_PushButtonWidgetAnnotationElement;const _ChoiceWidgetAnnotationElement=class extends WidgetAnnotationElement{static{__name(this,"_ChoiceWidgetAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:parameters.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const storage=this.annotationStorage,id=this.data.id,storedData=storage.getValue(id,{value:this.data.fieldValue}),selectElement=document.createElement("select");GetElementsByNameSet.add(selectElement),selectElement.setAttribute("data-element-id",id),selectElement.disabled=this.data.readOnly,this._setRequired(selectElement,this.data.required),selectElement.name=this.data.fieldName,selectElement.tabIndex=DEFAULT_TAB_INDEX;let addAnEmptyEntry=this.data.combo&&this.data.options.length>0;this.data.combo||(selectElement.size=this.data.options.length,this.data.multiSelect&&(selectElement.multiple=!0)),selectElement.addEventListener("resetform",event=>{const defaultValue=this.data.defaultFieldValue;for(const option of selectElement.options)option.selected=option.value===defaultValue});for(const option of this.data.options){const optionElement=document.createElement("option");optionElement.textContent=option.displayValue,optionElement.value=option.exportValue,storedData.value.includes(option.exportValue)&&(optionElement.setAttribute("selected",!0),addAnEmptyEntry=!1),selectElement.append(optionElement)}let removeEmptyEntry=null;if(addAnEmptyEntry){const noneOptionElement=document.createElement("option");noneOptionElement.value=" ",noneOptionElement.setAttribute("hidden",!0),noneOptionElement.setAttribute("selected",!0),selectElement.prepend(noneOptionElement),removeEmptyEntry=__name2(()=>{noneOptionElement.remove(),selectElement.removeEventListener("input",removeEmptyEntry),removeEmptyEntry=null},"removeEmptyEntry"),selectElement.addEventListener("input",removeEmptyEntry)}const getValue=__name2(isExport=>{const name=isExport?"value":"textContent",{options,multiple}=selectElement;return multiple?Array.prototype.filter.call(options,option=>option.selected).map(option=>option[name]):options.selectedIndex===-1?null:options[options.selectedIndex][name]},"getValue");let selectedValues=getValue(!1);const getItems=__name2(event=>{const options=event.target.options;return Array.prototype.map.call(options,option=>({displayValue:option.textContent,exportValue:option.value}))},"getItems");return this.enableScripting&&this.hasJSActions?(selectElement.addEventListener("updatefromsandbox",jsEvent=>{const actions={value(event){removeEmptyEntry?.();const value=event.detail.value,values=new Set(Array.isArray(value)?value:[value]);for(const option of selectElement.options)option.selected=values.has(option.value);storage.setValue(id,{value:getValue(!0)}),selectedValues=getValue(!1)},multipleSelection(event){selectElement.multiple=!0},remove(event){const options=selectElement.options,index2=event.detail.remove;options[index2].selected=!1,selectElement.remove(index2),options.length>0&&Array.prototype.findIndex.call(options,option=>option.selected)===-1&&(options[0].selected=!0),storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},clear(event){for(;selectElement.length!==0;)selectElement.remove(0);storage.setValue(id,{value:null,items:[]}),selectedValues=getValue(!1)},insert(event){const{index:index2,displayValue,exportValue}=event.detail.insert,selectChild=selectElement.children[index2],optionElement=document.createElement("option");optionElement.textContent=displayValue,optionElement.value=exportValue,selectChild?selectChild.before(optionElement):selectElement.append(optionElement),storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},items(event){const{items}=event.detail;for(;selectElement.length!==0;)selectElement.remove(0);for(const item of items){const{displayValue,exportValue}=item,optionElement=document.createElement("option");optionElement.textContent=displayValue,optionElement.value=exportValue,selectElement.append(optionElement)}selectElement.options.length>0&&(selectElement.options[0].selected=!0),storage.setValue(id,{value:getValue(!0),items:getItems(event)}),selectedValues=getValue(!1)},indices(event){const indices=new Set(event.detail.indices);for(const option of event.target.options)option.selected=indices.has(option.index);storage.setValue(id,{value:getValue(!0)}),selectedValues=getValue(!1)},editable(event){event.target.disabled=!event.detail.editable}};this._dispatchEventFromSandbox(actions,jsEvent)}),selectElement.addEventListener("input",event=>{var _a2;const exportValue=getValue(!0),change=getValue(!1);storage.setValue(id,{value:exportValue}),event.preventDefault(),(_a2=this.linkService.eventBus)==null||_a2.dispatch("dispatcheventinsandbox",{source:this,detail:{id,name:"Keystroke",value:selectedValues,change,changeEx:exportValue,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(selectElement,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],event=>event.target.value)):selectElement.addEventListener("input",function(event){storage.setValue(id,{value:getValue(!0)})}),this.data.combo&&this._setTextStyle(selectElement),this._setBackgroundColor(selectElement),this._setDefaultPropertiesFromJS(selectElement),this.container.append(selectElement),this.container}};__name2(_ChoiceWidgetAnnotationElement,"ChoiceWidgetAnnotationElement");let ChoiceWidgetAnnotationElement=_ChoiceWidgetAnnotationElement;const _PopupAnnotationElement=class extends AnnotationElement{static{__name(this,"_PopupAnnotationElement")}constructor(parameters){const{data,elements}=parameters;super(parameters,{isRenderable:AnnotationElement._hasPopupData(data)}),this.elements=elements,this.popup=null}render(){this.container.classList.add("popupAnnotation");const popup=this.popup=new PopupElement({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),elementIds=[];for(const element of this.elements)element.popup=popup,elementIds.push(element.data.id),element.addHighlightArea();return this.container.setAttribute("aria-controls",elementIds.map(id=>`${AnnotationPrefix}${id}`).join(",")),this.container}};__name2(_PopupAnnotationElement,"PopupAnnotationElement");let PopupAnnotationElement=_PopupAnnotationElement;const _PopupElement=class{static{__name(this,"_PopupElement")}constructor({container,color,elements,titleObj,modificationDate,contentsObj,richText,parent,rect,parentRect,open}){__privateAdd(this,_PopupElement_instances),__privateAdd(this,_boundKeyDown,__privateMethod(this,_PopupElement_instances,keyDown_fn).bind(this)),__privateAdd(this,_boundHide,__privateMethod(this,_PopupElement_instances,hide_fn).bind(this)),__privateAdd(this,_boundShow,__privateMethod(this,_PopupElement_instances,show_fn).bind(this)),__privateAdd(this,_boundToggle,__privateMethod(this,_PopupElement_instances,toggle_fn).bind(this)),__privateAdd(this,_color,null),__privateAdd(this,_container3,null),__privateAdd(this,_contentsObj,null),__privateAdd(this,_dateObj,null),__privateAdd(this,_elements,null),__privateAdd(this,_parent,null),__privateAdd(this,_parentRect,null),__privateAdd(this,_pinned,!1),__privateAdd(this,_popup,null),__privateAdd(this,_position2,null),__privateAdd(this,_rect,null),__privateAdd(this,_richText,null),__privateAdd(this,_titleObj,null),__privateAdd(this,_updates2,null),__privateAdd(this,_wasVisible,!1);var _a2;__privateSet(this,_container3,container),__privateSet(this,_titleObj,titleObj),__privateSet(this,_contentsObj,contentsObj),__privateSet(this,_richText,richText),__privateSet(this,_parent,parent),__privateSet(this,_color,color),__privateSet(this,_rect,rect),__privateSet(this,_parentRect,parentRect),__privateSet(this,_elements,elements),__privateSet(this,_dateObj,PDFDateString.toDateObject(modificationDate)),this.trigger=elements.flatMap(e=>e.getElementsToTriggerPopup());for(const element of this.trigger)element.addEventListener("click",__privateGet(this,_boundToggle)),element.addEventListener("mouseenter",__privateGet(this,_boundShow)),element.addEventListener("mouseleave",__privateGet(this,_boundHide)),element.classList.add("popupTriggerArea");for(const element of elements)(_a2=element.container)==null||_a2.addEventListener("keydown",__privateGet(this,_boundKeyDown));__privateGet(this,_container3).hidden=!0,open&&__privateMethod(this,_PopupElement_instances,toggle_fn).call(this)}render(){if(__privateGet(this,_popup))return;const popup=__privateSet(this,_popup,document.createElement("div"));if(popup.className="popup",__privateGet(this,_color)){const baseColor=popup.style.outlineColor=Util.makeHexColor(...__privateGet(this,_color));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?popup.style.backgroundColor=`color-mix(in srgb, ${baseColor} 30%, white)`:popup.style.backgroundColor=Util.makeHexColor(...__privateGet(this,_color).map(c=>Math.floor(.7*(255-c)+c)))}const header=document.createElement("span");header.className="header";const title=document.createElement("h1");if(header.append(title),{dir:title.dir,str:title.textContent}=__privateGet(this,_titleObj),popup.append(header),__privateGet(this,_dateObj)){const modificationDate=document.createElement("span");modificationDate.classList.add("popupDate"),modificationDate.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),modificationDate.setAttribute("data-l10n-args",JSON.stringify({date:__privateGet(this,_dateObj).toLocaleDateString(),time:__privateGet(this,_dateObj).toLocaleTimeString()})),header.append(modificationDate)}const html=__privateGet(this,_PopupElement_instances,html_get);if(html)XfaLayer.render({xfaHtml:html,intent:"richText",div:popup}),popup.lastChild.classList.add("richText","popupContent");else{const contents=this._formatContents(__privateGet(this,_contentsObj));popup.append(contents)}__privateGet(this,_container3).append(popup)}_formatContents({str,dir}){const p=document.createElement("p");p.classList.add("popupContent"),p.dir=dir;const lines=str.split(/(?:\r\n?|\n)/);for(let i=0,ii=lines.length;i<ii;++i){const line=lines[i];p.append(document.createTextNode(line)),i<ii-1&&p.append(document.createElement("br"))}return p}updateEdited({rect,popupContent}){var _a2;__privateGet(this,_updates2)||__privateSet(this,_updates2,{contentsObj:__privateGet(this,_contentsObj),richText:__privateGet(this,_richText)}),rect&&__privateSet(this,_position2,null),popupContent&&(__privateSet(this,_richText,__privateMethod(this,_PopupElement_instances,makePopupContent_fn).call(this,popupContent)),__privateSet(this,_contentsObj,null)),(_a2=__privateGet(this,_popup))==null||_a2.remove(),__privateSet(this,_popup,null)}resetEdited(){var _a2;__privateGet(this,_updates2)&&({contentsObj:__privateWrapper(this,_contentsObj)._,richText:__privateWrapper(this,_richText)._}=__privateGet(this,_updates2),__privateSet(this,_updates2,null),(_a2=__privateGet(this,_popup))==null||_a2.remove(),__privateSet(this,_popup,null),__privateSet(this,_position2,null))}forceHide(){__privateSet(this,_wasVisible,this.isVisible),__privateGet(this,_wasVisible)&&(__privateGet(this,_container3).hidden=!0)}maybeShow(){__privateGet(this,_wasVisible)&&(__privateGet(this,_popup)||__privateMethod(this,_PopupElement_instances,show_fn).call(this),__privateSet(this,_wasVisible,!1),__privateGet(this,_container3).hidden=!1)}get isVisible(){return __privateGet(this,_container3).hidden===!1}};_boundKeyDown=new WeakMap,_boundHide=new WeakMap,_boundShow=new WeakMap,_boundToggle=new WeakMap,_color=new WeakMap,_container3=new WeakMap,_contentsObj=new WeakMap,_dateObj=new WeakMap,_elements=new WeakMap,_parent=new WeakMap,_parentRect=new WeakMap,_pinned=new WeakMap,_popup=new WeakMap,_position2=new WeakMap,_rect=new WeakMap,_richText=new WeakMap,_titleObj=new WeakMap,_updates2=new WeakMap,_wasVisible=new WeakMap,_PopupElement_instances=new WeakSet,html_get=__name2(function(){const richText=__privateGet(this,_richText),contentsObj=__privateGet(this,_contentsObj);return richText?.str&&(!contentsObj?.str||contentsObj.str===richText.str)&&__privateGet(this,_richText).html||null},"#html"),fontSize_get=__name2(function(){var _a2,_b2,_c;return((_c=(_b2=(_a2=__privateGet(this,_PopupElement_instances,html_get))==null?void 0:_a2.attributes)==null?void 0:_b2.style)==null?void 0:_c.fontSize)||0},"#fontSize"),fontColor_get=__name2(function(){var _a2,_b2,_c;return((_c=(_b2=(_a2=__privateGet(this,_PopupElement_instances,html_get))==null?void 0:_a2.attributes)==null?void 0:_b2.style)==null?void 0:_c.color)||null},"#fontColor"),makePopupContent_fn=__name2(function(text){const popupLines=[],popupContent={str:text,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:popupLines}]}},lineAttributes={style:{color:__privateGet(this,_PopupElement_instances,fontColor_get),fontSize:__privateGet(this,_PopupElement_instances,fontSize_get)?`calc(${__privateGet(this,_PopupElement_instances,fontSize_get)}px * var(--scale-factor))`:""}};for(const line of text.split(`
`))popupLines.push({name:"span",value:line,attributes:lineAttributes});return popupContent},"#makePopupContent"),keyDown_fn=__name2(function(event){event.altKey||event.shiftKey||event.ctrlKey||event.metaKey||(event.key==="Enter"||event.key==="Escape"&&__privateGet(this,_pinned))&&__privateMethod(this,_PopupElement_instances,toggle_fn).call(this)},"#keyDown"),setPosition_fn=__name2(function(){if(__privateGet(this,_position2)!==null)return;const{page:{view},viewport:{rawDims:{pageWidth,pageHeight,pageX,pageY}}}=__privateGet(this,_parent);let useParentRect=!!__privateGet(this,_parentRect),rect=useParentRect?__privateGet(this,_parentRect):__privateGet(this,_rect);for(const element of __privateGet(this,_elements))if(!rect||Util.intersect(element.data.rect,rect)!==null){rect=element.data.rect,useParentRect=!0;break}const normalizedRect=Util.normalizeRect([rect[0],view[3]-rect[1]+view[1],rect[2],view[3]-rect[3]+view[1]]),parentWidth=useParentRect?rect[2]-rect[0]+5:0,popupLeft=normalizedRect[0]+parentWidth,popupTop=normalizedRect[1];__privateSet(this,_position2,[100*(popupLeft-pageX)/pageWidth,100*(popupTop-pageY)/pageHeight]);const{style}=__privateGet(this,_container3);style.left=`${__privateGet(this,_position2)[0]}%`,style.top=`${__privateGet(this,_position2)[1]}%`},"#setPosition"),toggle_fn=__name2(function(){__privateSet(this,_pinned,!__privateGet(this,_pinned)),__privateGet(this,_pinned)?(__privateMethod(this,_PopupElement_instances,show_fn).call(this),__privateGet(this,_container3).addEventListener("click",__privateGet(this,_boundToggle)),__privateGet(this,_container3).addEventListener("keydown",__privateGet(this,_boundKeyDown))):(__privateMethod(this,_PopupElement_instances,hide_fn).call(this),__privateGet(this,_container3).removeEventListener("click",__privateGet(this,_boundToggle)),__privateGet(this,_container3).removeEventListener("keydown",__privateGet(this,_boundKeyDown)))},"#toggle"),show_fn=__name2(function(){__privateGet(this,_popup)||this.render(),this.isVisible?__privateGet(this,_pinned)&&__privateGet(this,_container3).classList.add("focused"):(__privateMethod(this,_PopupElement_instances,setPosition_fn).call(this),__privateGet(this,_container3).hidden=!1,__privateGet(this,_container3).style.zIndex=parseInt(__privateGet(this,_container3).style.zIndex)+1e3)},"#show"),hide_fn=__name2(function(){__privateGet(this,_container3).classList.remove("focused"),!(__privateGet(this,_pinned)||!this.isVisible)&&(__privateGet(this,_container3).hidden=!0,__privateGet(this,_container3).style.zIndex=parseInt(__privateGet(this,_container3).style.zIndex)-1e3)},"#hide"),__name2(_PopupElement,"PopupElement");let PopupElement=_PopupElement;const _FreeTextAnnotationElement=class extends AnnotationElement{static{__name(this,"_FreeTextAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),this.textContent=parameters.data.textContent,this.textPosition=parameters.data.textPosition,this.annotationEditorType=AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const content=document.createElement("div");content.classList.add("annotationTextContent"),content.setAttribute("role","comment");for(const line of this.textContent){const lineSpan=document.createElement("span");lineSpan.textContent=line,content.append(lineSpan)}this.container.append(content)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}};__name2(_FreeTextAnnotationElement,"FreeTextAnnotationElement");let FreeTextAnnotationElement=_FreeTextAnnotationElement;const _LineAnnotationElement=class extends AnnotationElement{static{__name(this,"_LineAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),__privateAdd(this,_line,null)}render(){this.container.classList.add("lineAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),line=__privateSet(this,_line,this.svgFactory.createElement("svg:line"));return line.setAttribute("x1",data.rect[2]-data.lineCoordinates[0]),line.setAttribute("y1",data.rect[3]-data.lineCoordinates[1]),line.setAttribute("x2",data.rect[2]-data.lineCoordinates[2]),line.setAttribute("y2",data.rect[3]-data.lineCoordinates[3]),line.setAttribute("stroke-width",data.borderStyle.width||1),line.setAttribute("stroke","transparent"),line.setAttribute("fill","transparent"),svg.append(line),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return __privateGet(this,_line)}addHighlightArea(){this.container.classList.add("highlightArea")}};_line=new WeakMap,__name2(_LineAnnotationElement,"LineAnnotationElement");let LineAnnotationElement=_LineAnnotationElement;const _SquareAnnotationElement=class extends AnnotationElement{static{__name(this,"_SquareAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),__privateAdd(this,_square,null)}render(){this.container.classList.add("squareAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),borderWidth=data.borderStyle.width,square=__privateSet(this,_square,this.svgFactory.createElement("svg:rect"));return square.setAttribute("x",borderWidth/2),square.setAttribute("y",borderWidth/2),square.setAttribute("width",width-borderWidth),square.setAttribute("height",height-borderWidth),square.setAttribute("stroke-width",borderWidth||1),square.setAttribute("stroke","transparent"),square.setAttribute("fill","transparent"),svg.append(square),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return __privateGet(this,_square)}addHighlightArea(){this.container.classList.add("highlightArea")}};_square=new WeakMap,__name2(_SquareAnnotationElement,"SquareAnnotationElement");let SquareAnnotationElement=_SquareAnnotationElement;const _CircleAnnotationElement=class extends AnnotationElement{static{__name(this,"_CircleAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),__privateAdd(this,_circle,null)}render(){this.container.classList.add("circleAnnotation");const data=this.data,{width,height}=getRectDims(data.rect),svg=this.svgFactory.create(width,height,!0),borderWidth=data.borderStyle.width,circle=__privateSet(this,_circle,this.svgFactory.createElement("svg:ellipse"));return circle.setAttribute("cx",width/2),circle.setAttribute("cy",height/2),circle.setAttribute("rx",width/2-borderWidth/2),circle.setAttribute("ry",height/2-borderWidth/2),circle.setAttribute("stroke-width",borderWidth||1),circle.setAttribute("stroke","transparent"),circle.setAttribute("fill","transparent"),svg.append(circle),this.container.append(svg),!data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return __privateGet(this,_circle)}addHighlightArea(){this.container.classList.add("highlightArea")}};_circle=new WeakMap,__name2(_CircleAnnotationElement,"CircleAnnotationElement");let CircleAnnotationElement=_CircleAnnotationElement;const _PolylineAnnotationElement=class extends AnnotationElement{static{__name(this,"_PolylineAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),__privateAdd(this,_polyline,null),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect,vertices,borderStyle,popupRef}}=this;if(!vertices)return this.container;const{width,height}=getRectDims(rect),svg=this.svgFactory.create(width,height,!0);let points=[];for(let i=0,ii=vertices.length;i<ii;i+=2){const x=vertices[i]-rect[0],y=rect[3]-vertices[i+1];points.push(`${x},${y}`)}points=points.join(" ");const polyline=__privateSet(this,_polyline,this.svgFactory.createElement(this.svgElementName));return polyline.setAttribute("points",points),polyline.setAttribute("stroke-width",borderStyle.width||1),polyline.setAttribute("stroke","transparent"),polyline.setAttribute("fill","transparent"),svg.append(polyline),this.container.append(svg),!popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return __privateGet(this,_polyline)}addHighlightArea(){this.container.classList.add("highlightArea")}};_polyline=new WeakMap,__name2(_PolylineAnnotationElement,"PolylineAnnotationElement");let PolylineAnnotationElement=_PolylineAnnotationElement;const _PolygonAnnotationElement=class extends PolylineAnnotationElement{static{__name(this,"_PolygonAnnotationElement")}constructor(parameters){super(parameters),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}};__name2(_PolygonAnnotationElement,"PolygonAnnotationElement");let PolygonAnnotationElement=_PolygonAnnotationElement;const _CaretAnnotationElement=class extends AnnotationElement{static{__name(this,"_CaretAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}};__name2(_CaretAnnotationElement,"CaretAnnotationElement");let CaretAnnotationElement=_CaretAnnotationElement;const _InkAnnotationElement=class extends AnnotationElement{static{__name(this,"_InkAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0}),__privateAdd(this,_polylines,[]),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect,inkLists,borderStyle,popupRef}}=this,{width,height}=getRectDims(rect),svg=this.svgFactory.create(width,height,!0);for(const inkList of inkLists){let points=[];for(let i=0,ii=inkList.length;i<ii;i+=2){const x=inkList[i]-rect[0],y=rect[3]-inkList[i+1];points.push(`${x},${y}`)}points=points.join(" ");const polyline=this.svgFactory.createElement(this.svgElementName);__privateGet(this,_polylines).push(polyline),polyline.setAttribute("points",points),polyline.setAttribute("stroke-width",borderStyle.width||1),polyline.setAttribute("stroke","transparent"),polyline.setAttribute("fill","transparent"),!popupRef&&this.hasPopupData&&this._createPopup(),svg.append(polyline)}return this.container.append(svg),this.container}getElementsToTriggerPopup(){return __privateGet(this,_polylines)}addHighlightArea(){this.container.classList.add("highlightArea")}};_polylines=new WeakMap,__name2(_InkAnnotationElement,"InkAnnotationElement");let InkAnnotationElement=_InkAnnotationElement;const _HighlightAnnotationElement=class extends AnnotationElement{static{__name(this,"_HighlightAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}};__name2(_HighlightAnnotationElement,"HighlightAnnotationElement");let HighlightAnnotationElement=_HighlightAnnotationElement;const _UnderlineAnnotationElement=class extends AnnotationElement{static{__name(this,"_UnderlineAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}};__name2(_UnderlineAnnotationElement,"UnderlineAnnotationElement");let UnderlineAnnotationElement=_UnderlineAnnotationElement;const _SquigglyAnnotationElement=class extends AnnotationElement{static{__name(this,"_SquigglyAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}};__name2(_SquigglyAnnotationElement,"SquigglyAnnotationElement");let SquigglyAnnotationElement=_SquigglyAnnotationElement;const _StrikeOutAnnotationElement=class extends AnnotationElement{static{__name(this,"_StrikeOutAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}};__name2(_StrikeOutAnnotationElement,"StrikeOutAnnotationElement");let StrikeOutAnnotationElement=_StrikeOutAnnotationElement;const _StampAnnotationElement=class extends AnnotationElement{static{__name(this,"_StampAnnotationElement")}constructor(parameters){super(parameters,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}};__name2(_StampAnnotationElement,"StampAnnotationElement");let StampAnnotationElement=_StampAnnotationElement;const _FileAttachmentAnnotationElement=class extends AnnotationElement{static{__name(this,"_FileAttachmentAnnotationElement")}constructor(parameters){var _a2;super(parameters,{isRenderable:!0}),__privateAdd(this,_FileAttachmentAnnotationElement_instances),__privateAdd(this,_trigger,null);const{file}=this.data;this.filename=file.filename,this.content=file.content,(_a2=this.linkService.eventBus)==null||_a2.dispatch("fileattachmentannotation",{source:this,...file})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container,data}=this;let trigger;data.hasAppearance||data.fillAlpha===0?trigger=document.createElement("div"):(trigger=document.createElement("img"),trigger.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(data.name)?"paperclip":"pushpin"}.svg`,data.fillAlpha&&data.fillAlpha<1&&(trigger.style=`filter: opacity(${Math.round(data.fillAlpha*100)}%);`)),trigger.addEventListener("dblclick",__privateMethod(this,_FileAttachmentAnnotationElement_instances,download_fn).bind(this)),__privateSet(this,_trigger,trigger);const{isMac}=util_FeatureTest.platform;return container.addEventListener("keydown",evt=>{evt.key==="Enter"&&(isMac?evt.metaKey:evt.ctrlKey)&&__privateMethod(this,_FileAttachmentAnnotationElement_instances,download_fn).call(this)}),!data.popupRef&&this.hasPopupData?this._createPopup():trigger.classList.add("popupTriggerArea"),container.append(trigger),container}getElementsToTriggerPopup(){return __privateGet(this,_trigger)}addHighlightArea(){this.container.classList.add("highlightArea")}};_trigger=new WeakMap,_FileAttachmentAnnotationElement_instances=new WeakSet,download_fn=__name2(function(){var _a2;(_a2=this.downloadManager)==null||_a2.openOrDownloadData(this.content,this.filename)},"#download"),__name2(_FileAttachmentAnnotationElement,"FileAttachmentAnnotationElement");let FileAttachmentAnnotationElement=_FileAttachmentAnnotationElement;const _AnnotationLayer=class{static{__name(this,"_AnnotationLayer")}constructor({div,accessibilityManager,annotationCanvasMap,annotationEditorUIManager,page,viewport}){__privateAdd(this,_AnnotationLayer_instances),__privateAdd(this,_accessibilityManager,null),__privateAdd(this,_annotationCanvasMap,null),__privateAdd(this,_editableAnnotations,new Map),this.div=div,__privateSet(this,_accessibilityManager,accessibilityManager),__privateSet(this,_annotationCanvasMap,annotationCanvasMap),this.page=page,this.viewport=viewport,this.zIndex=0,this._annotationEditorUIManager=annotationEditorUIManager}hasEditableAnnotations(){return __privateGet(this,_editableAnnotations).size>0}async render(params){var _a2;const{annotations}=params,layer=this.div;setLayerDimensions(layer,this.viewport);const popupToElements=new Map,elementParams={data:null,layer,linkService:params.linkService,downloadManager:params.downloadManager,imageResourcesPath:params.imageResourcesPath||"",renderForms:params.renderForms!==!1,svgFactory:new DOMSVGFactory,annotationStorage:params.annotationStorage||new AnnotationStorage,enableScripting:params.enableScripting===!0,hasJSActions:params.hasJSActions,fieldObjects:params.fieldObjects,parent:this,elements:null};for(const data of annotations){if(data.noHTML)continue;const isPopupAnnotation=data.annotationType===AnnotationType.POPUP;if(isPopupAnnotation){const elements=popupToElements.get(data.id);if(!elements)continue;elementParams.elements=elements}else{const{width,height}=getRectDims(data.rect);if(width<=0||height<=0)continue}elementParams.data=data;const element=AnnotationElementFactory.create(elementParams);if(!element.isRenderable)continue;if(!isPopupAnnotation&&data.popupRef){const elements=popupToElements.get(data.popupRef);elements?elements.push(element):popupToElements.set(data.popupRef,[element])}const rendered=element.render();data.hidden&&(rendered.style.visibility="hidden"),__privateMethod(this,_AnnotationLayer_instances,appendElement_fn).call(this,rendered,data.id),element._isEditable&&(__privateGet(this,_editableAnnotations).set(element.data.id,element),(_a2=this._annotationEditorUIManager)==null||_a2.renderAnnotationElement(element))}__privateMethod(this,_AnnotationLayer_instances,setAnnotationCanvasMap_fn).call(this)}update({viewport}){const layer=this.div;this.viewport=viewport,setLayerDimensions(layer,{rotation:viewport.rotation}),__privateMethod(this,_AnnotationLayer_instances,setAnnotationCanvasMap_fn).call(this),layer.hidden=!1}getEditableAnnotations(){return Array.from(__privateGet(this,_editableAnnotations).values())}getEditableAnnotation(id){return __privateGet(this,_editableAnnotations).get(id)}};_accessibilityManager=new WeakMap,_annotationCanvasMap=new WeakMap,_editableAnnotations=new WeakMap,_AnnotationLayer_instances=new WeakSet,appendElement_fn=__name2(function(element,id){var _a2;const contentElement=element.firstChild||element;contentElement.id=`${AnnotationPrefix}${id}`,this.div.append(element),(_a2=__privateGet(this,_accessibilityManager))==null||_a2.moveElementInDOM(this.div,element,contentElement,!1)},"#appendElement"),setAnnotationCanvasMap_fn=__name2(function(){if(!__privateGet(this,_annotationCanvasMap))return;const layer=this.div;for(const[id,canvas]of __privateGet(this,_annotationCanvasMap)){const element=layer.querySelector(`[data-annotation-id="${id}"]`);if(!element)continue;canvas.className="annotationContent";const{firstChild}=element;firstChild?firstChild.nodeName==="CANVAS"?firstChild.replaceWith(canvas):firstChild.classList.contains("annotationContent")?firstChild.after(canvas):firstChild.before(canvas):element.append(canvas)}__privateGet(this,_annotationCanvasMap).clear()},"#setAnnotationCanvasMap"),__name2(_AnnotationLayer,"AnnotationLayer");let AnnotationLayer=_AnnotationLayer;const EOL_PATTERN=/\r\n?|\n/g,_FreeTextEditor=class _FreeTextEditor2 extends AnnotationEditor{static{__name(this,"_FreeTextEditor")}constructor(params){super({...params,name:"freeTextEditor"}),__privateAdd(this,_FreeTextEditor_instances),__privateAdd(this,_boundEditorDivBlur,this.editorDivBlur.bind(this)),__privateAdd(this,_boundEditorDivFocus,this.editorDivFocus.bind(this)),__privateAdd(this,_boundEditorDivInput,this.editorDivInput.bind(this)),__privateAdd(this,_boundEditorDivKeydown,this.editorDivKeydown.bind(this)),__privateAdd(this,_boundEditorDivPaste,this.editorDivPaste.bind(this)),__privateAdd(this,_color2),__privateAdd(this,_content,""),__privateAdd(this,_editorDivId,`${this.id}-editor`),__privateAdd(this,_fontSize),__privateAdd(this,_initialData,null),__privateSet(this,_color2,params.color||_FreeTextEditor2._defaultColor||AnnotationEditor._defaultLineColor),__privateSet(this,_fontSize,params.fontSize||_FreeTextEditor2._defaultFontSize)}static get _keyboardManager(){const proto=_FreeTextEditor2.prototype,arrowChecker=__name2(self2=>self2.isEmpty(),"arrowChecker"),small=AnnotationEditorUIManager.TRANSLATE_SMALL,big=AnnotationEditorUIManager.TRANSLATE_BIG;return shadow(this,"_keyboardManager",new KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],proto.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],proto.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],proto._translateEmpty,{args:[-small,0],checker:arrowChecker}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],proto._translateEmpty,{args:[-big,0],checker:arrowChecker}],[["ArrowRight","mac+ArrowRight"],proto._translateEmpty,{args:[small,0],checker:arrowChecker}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],proto._translateEmpty,{args:[big,0],checker:arrowChecker}],[["ArrowUp","mac+ArrowUp"],proto._translateEmpty,{args:[0,-small],checker:arrowChecker}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],proto._translateEmpty,{args:[0,-big],checker:arrowChecker}],[["ArrowDown","mac+ArrowDown"],proto._translateEmpty,{args:[0,small],checker:arrowChecker}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],proto._translateEmpty,{args:[0,big],checker:arrowChecker}]]))}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager,{strings:["pdfjs-free-text-default-content"]});const style=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(style.getPropertyValue("--freetext-padding"))}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.FREETEXT_SIZE:_FreeTextEditor2._defaultFontSize=value;break;case AnnotationEditorParamsType.FREETEXT_COLOR:_FreeTextEditor2._defaultColor=value;break}}updateParams(type,value){switch(type){case AnnotationEditorParamsType.FREETEXT_SIZE:__privateMethod(this,_FreeTextEditor_instances,updateFontSize_fn).call(this,value);break;case AnnotationEditorParamsType.FREETEXT_COLOR:__privateMethod(this,_FreeTextEditor_instances,updateColor_fn).call(this,value);break}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,_FreeTextEditor2._defaultFontSize],[AnnotationEditorParamsType.FREETEXT_COLOR,_FreeTextEditor2._defaultColor||AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.FREETEXT_SIZE,__privateGet(this,_fontSize)],[AnnotationEditorParamsType.FREETEXT_COLOR,__privateGet(this,_color2)]]}_translateEmpty(x,y){this._uiManager.translateSelectedEditors(x,y,!0)}getInitialTranslation(){const scale=this.parentScale;return[-_FreeTextEditor2._internalPadding*scale,-(_FreeTextEditor2._internalPadding+__privateGet(this,_fontSize))*scale]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant");const signal=this._uiManager._signal;this.editorDiv.addEventListener("keydown",__privateGet(this,_boundEditorDivKeydown),{signal}),this.editorDiv.addEventListener("focus",__privateGet(this,_boundEditorDivFocus),{signal}),this.editorDiv.addEventListener("blur",__privateGet(this,_boundEditorDivBlur),{signal}),this.editorDiv.addEventListener("input",__privateGet(this,_boundEditorDivInput),{signal}),this.editorDiv.addEventListener("paste",__privateGet(this,_boundEditorDivPaste),{signal})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",__privateGet(this,_editorDivId)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",__privateGet(this,_boundEditorDivKeydown)),this.editorDiv.removeEventListener("focus",__privateGet(this,_boundEditorDivFocus)),this.editorDiv.removeEventListener("blur",__privateGet(this,_boundEditorDivBlur)),this.editorDiv.removeEventListener("input",__privateGet(this,_boundEditorDivInput)),this.editorDiv.removeEventListener("paste",__privateGet(this,_boundEditorDivPaste)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(event){this._focusEventsAllowed&&(super.focusin(event),event.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var _a2;this.width||(this.enableEditMode(),this.editorDiv.focus(),(_a2=this._initialOptions)!=null&&_a2.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const savedText=__privateGet(this,_content),newText=__privateSet(this,_content,__privateMethod(this,_FreeTextEditor_instances,extractText_fn).call(this).trimEnd());if(savedText===newText)return;const setText=__name2(text=>{if(__privateSet(this,_content,text),!text){this.remove();return}__privateMethod(this,_FreeTextEditor_instances,setContent_fn).call(this),this._uiManager.rebuild(this),__privateMethod(this,_FreeTextEditor_instances,setEditorDimensions_fn).call(this)},"setText");this.addCommands({cmd:__name2(()=>{setText(newText)},"cmd"),undo:__name2(()=>{setText(savedText)},"undo"),mustExec:!1}),__privateMethod(this,_FreeTextEditor_instances,setEditorDimensions_fn).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(event){this.enterInEditMode()}keydown(event){event.target===this.div&&event.key==="Enter"&&(this.enterInEditMode(),event.preventDefault())}editorDivKeydown(event){_FreeTextEditor2._keyboardManager.exec(this,event)}editorDivFocus(event){this.isEditing=!0}editorDivBlur(event){this.isEditing=!1}editorDivInput(event){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let baseX,baseY;this.width&&(baseX=this.x,baseY=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",__privateGet(this,_editorDivId)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(msg=>{var _a2;return(_a2=this.editorDiv)==null?void 0:_a2.setAttribute("default-content",msg)}),this.editorDiv.contentEditable=!0;const{style}=this.editorDiv;if(style.fontSize=`calc(${__privateGet(this,_fontSize)}px * var(--scale-factor))`,style.color=__privateGet(this,_color2),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),bindEvents(this,this.div,["dblclick","keydown"]),this.width){const[parentWidth,parentHeight]=this.parentDimensions;if(this.annotationElementId){const{position}=__privateGet(this,_initialData);let[tx,ty]=this.getInitialTranslation();[tx,ty]=this.pageTranslationToScreen(tx,ty);const[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation;let posX,posY;switch(this.rotation){case 0:posX=baseX+(position[0]-pageX)/pageWidth,posY=baseY+this.height-(position[1]-pageY)/pageHeight;break;case 90:posX=baseX+(position[0]-pageX)/pageWidth,posY=baseY-(position[1]-pageY)/pageHeight,[tx,ty]=[ty,-tx];break;case 180:posX=baseX-this.width+(position[0]-pageX)/pageWidth,posY=baseY-(position[1]-pageY)/pageHeight,[tx,ty]=[-tx,-ty];break;case 270:posX=baseX+(position[0]-pageX-this.height*pageHeight)/pageWidth,posY=baseY+(position[1]-pageY-this.width*pageWidth)/pageHeight,[tx,ty]=[-ty,tx];break}this.setAt(posX*parentWidth,posY*parentHeight,tx,ty)}else this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight);__privateMethod(this,_FreeTextEditor_instances,setContent_fn).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(event){var _a2,_b2,_c;const clipboardData=event.clipboardData||window.clipboardData,{types}=clipboardData;if(types.length===1&&types[0]==="text/plain")return;event.preventDefault();const paste=__privateMethod(_a2=_FreeTextEditor2,_FreeTextEditor_static,deserializeContent_fn).call(_a2,clipboardData.getData("text")||"").replaceAll(EOL_PATTERN,`
`);if(!paste)return;const selection=window.getSelection();if(!selection.rangeCount)return;this.editorDiv.normalize(),selection.deleteFromDocument();const range=selection.getRangeAt(0);if(!paste.includes(`
`)){range.insertNode(document.createTextNode(paste)),this.editorDiv.normalize(),selection.collapseToStart();return}const{startContainer,startOffset}=range,bufferBefore=[],bufferAfter=[];if(startContainer.nodeType===Node.TEXT_NODE){const parent=startContainer.parentElement;if(bufferAfter.push(startContainer.nodeValue.slice(startOffset).replaceAll(EOL_PATTERN,"")),parent!==this.editorDiv){let buffer=bufferBefore;for(const child of this.editorDiv.childNodes){if(child===parent){buffer=bufferAfter;continue}buffer.push(__privateMethod(_b2=_FreeTextEditor2,_FreeTextEditor_static,getNodeContent_fn).call(_b2,child))}}bufferBefore.push(startContainer.nodeValue.slice(0,startOffset).replaceAll(EOL_PATTERN,""))}else if(startContainer===this.editorDiv){let buffer=bufferBefore,i=0;for(const child of this.editorDiv.childNodes)i++===startOffset&&(buffer=bufferAfter),buffer.push(__privateMethod(_c=_FreeTextEditor2,_FreeTextEditor_static,getNodeContent_fn).call(_c,child))}__privateSet(this,_content,`${bufferBefore.join(`
`)}${paste}${bufferAfter.join(`
`)}`),__privateMethod(this,_FreeTextEditor_instances,setContent_fn).call(this);const newRange=new Range;let beforeLength=bufferBefore.reduce((acc,line)=>acc+line.length,0);for(const{firstChild}of this.editorDiv.childNodes)if(firstChild.nodeType===Node.TEXT_NODE){const length=firstChild.nodeValue.length;if(beforeLength<=length){newRange.setStart(firstChild,beforeLength),newRange.setEnd(firstChild,beforeLength);break}beforeLength-=length}selection.removeAllRanges(),selection.addRange(newRange)}get contentDiv(){return this.editorDiv}static deserialize(data,parent,uiManager){var _a2;let initialData=null;if(data instanceof FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize,fontColor},rect,rotation,id},textContent,textPosition,parent:{page:{pageNumber}}}=data;if(!textContent||textContent.length===0)return null;initialData=data={annotationType:AnnotationEditorType.FREETEXT,color:Array.from(fontColor),fontSize,value:textContent.join(`
`),position:textPosition,pageIndex:pageNumber-1,rect:rect.slice(0),rotation,id,deleted:!1}}const editor=super.deserialize(data,parent,uiManager);return __privateSet(editor,_fontSize,data.fontSize),__privateSet(editor,_color2,Util.makeHexColor(...data.color)),__privateSet(editor,_content,__privateMethod(_a2=_FreeTextEditor2,_FreeTextEditor_static,deserializeContent_fn).call(_a2,data.value)),editor.annotationElementId=data.id||null,__privateSet(editor,_initialData,initialData),editor}serialize(isForCopying=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const padding=_FreeTextEditor2._internalPadding*this.parentScale,rect=this.getRect(padding,padding),color=AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:__privateGet(this,_color2)),serialized={annotationType:AnnotationEditorType.FREETEXT,color,fontSize:__privateGet(this,_fontSize),value:__privateMethod(this,_FreeTextEditor_instances,serializeContent_fn).call(this),pageIndex:this.pageIndex,rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return isForCopying?serialized:this.annotationElementId&&!__privateMethod(this,_FreeTextEditor_instances,hasElementChanged_fn).call(this,serialized)?null:(serialized.id=this.annotationElementId,serialized)}renderAnnotationElement(annotation){const content=super.renderAnnotationElement(annotation);if(this.deleted)return content;const{style}=content;style.fontSize=`calc(${__privateGet(this,_fontSize)}px * var(--scale-factor))`,style.color=__privateGet(this,_color2),content.replaceChildren();for(const line of __privateGet(this,_content).split(`
`)){const div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br")),content.append(div)}const padding=_FreeTextEditor2._internalPadding*this.parentScale;return annotation.updateEdited({rect:this.getRect(padding,padding),popupContent:__privateGet(this,_content)}),content}resetAnnotationElement(annotation){super.resetAnnotationElement(annotation),annotation.resetEdited()}};_boundEditorDivBlur=new WeakMap,_boundEditorDivFocus=new WeakMap,_boundEditorDivInput=new WeakMap,_boundEditorDivKeydown=new WeakMap,_boundEditorDivPaste=new WeakMap,_color2=new WeakMap,_content=new WeakMap,_editorDivId=new WeakMap,_fontSize=new WeakMap,_initialData=new WeakMap,_FreeTextEditor_instances=new WeakSet,updateFontSize_fn=__name2(function(fontSize){const setFontsize=__name2(size=>{this.editorDiv.style.fontSize=`calc(${size}px * var(--scale-factor))`,this.translate(0,-(size-__privateGet(this,_fontSize))*this.parentScale),__privateSet(this,_fontSize,size),__privateMethod(this,_FreeTextEditor_instances,setEditorDimensions_fn).call(this)},"setFontsize"),savedFontsize=__privateGet(this,_fontSize);this.addCommands({cmd:setFontsize.bind(this,fontSize),undo:setFontsize.bind(this,savedFontsize),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},"#updateFontSize"),updateColor_fn=__name2(function(color){const setColor=__name2(col=>{__privateSet(this,_color2,this.editorDiv.style.color=col)},"setColor"),savedColor=__privateGet(this,_color2);this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},"#updateColor"),extractText_fn=__name2(function(){var _a2;const buffer=[];this.editorDiv.normalize();for(const child of this.editorDiv.childNodes)buffer.push(__privateMethod(_a2=_FreeTextEditor,_FreeTextEditor_static,getNodeContent_fn).call(_a2,child));return buffer.join(`
`)},"#extractText"),setEditorDimensions_fn=__name2(function(){const[parentWidth,parentHeight]=this.parentDimensions;let rect;if(this.isAttachedToDOM)rect=this.div.getBoundingClientRect();else{const{currentLayer,div}=this,savedDisplay=div.style.display,savedVisibility=div.classList.contains("hidden");div.classList.remove("hidden"),div.style.display="hidden",currentLayer.div.append(this.div),rect=div.getBoundingClientRect(),div.remove(),div.style.display=savedDisplay,div.classList.toggle("hidden",savedVisibility)}this.rotation%180===this.parentRotation%180?(this.width=rect.width/parentWidth,this.height=rect.height/parentHeight):(this.width=rect.height/parentWidth,this.height=rect.width/parentHeight),this.fixAndSetPosition()},"#setEditorDimensions"),_FreeTextEditor_static=new WeakSet,getNodeContent_fn=__name2(function(node){return(node.nodeType===Node.TEXT_NODE?node.nodeValue:node.innerText).replaceAll(EOL_PATTERN,"")},"#getNodeContent"),setContent_fn=__name2(function(){if(this.editorDiv.replaceChildren(),!!__privateGet(this,_content))for(const line of __privateGet(this,_content).split(`
`)){const div=document.createElement("div");div.append(line?document.createTextNode(line):document.createElement("br")),this.editorDiv.append(div)}},"#setContent"),serializeContent_fn=__name2(function(){return __privateGet(this,_content).replaceAll("\xA0"," ")},"#serializeContent"),deserializeContent_fn=__name2(function(content){return content.replaceAll(" ","\xA0")},"#deserializeContent"),hasElementChanged_fn=__name2(function(serialized){const{value,fontSize,color,pageIndex}=__privateGet(this,_initialData);return this._hasBeenMoved||serialized.value!==value||serialized.fontSize!==fontSize||serialized.color.some((c,i)=>c!==color[i])||serialized.pageIndex!==pageIndex},"#hasElementChanged"),__privateAdd(_FreeTextEditor,_FreeTextEditor_static),__name2(_FreeTextEditor,"FreeTextEditor"),__publicField(_FreeTextEditor,"_freeTextDefaultContent",""),__publicField(_FreeTextEditor,"_internalPadding",0),__publicField(_FreeTextEditor,"_defaultColor",null),__publicField(_FreeTextEditor,"_defaultFontSize",10),__publicField(_FreeTextEditor,"_type","freetext"),__publicField(_FreeTextEditor,"_editorType",AnnotationEditorType.FREETEXT);let FreeTextEditor=_FreeTextEditor;const _Outliner=class{static{__name(this,"_Outliner")}constructor(boxes,borderWidth=0,innerMargin=0,isLTR=!0){__privateAdd(this,_Outliner_instances),__privateAdd(this,_box),__privateAdd(this,_verticalEdges,[]),__privateAdd(this,_intervals,[]);let minX=1/0,maxX=-1/0,minY=1/0,maxY=-1/0;const EPSILON=10**-4;for(const{x,y,width,height}of boxes){const x1=Math.floor((x-borderWidth)/EPSILON)*EPSILON,x2=Math.ceil((x+width+borderWidth)/EPSILON)*EPSILON,y1=Math.floor((y-borderWidth)/EPSILON)*EPSILON,y2=Math.ceil((y+height+borderWidth)/EPSILON)*EPSILON,left=[x1,y1,y2,!0],right=[x2,y1,y2,!1];__privateGet(this,_verticalEdges).push(left,right),minX=Math.min(minX,x1),maxX=Math.max(maxX,x2),minY=Math.min(minY,y1),maxY=Math.max(maxY,y2)}const bboxWidth=maxX-minX+2*innerMargin,bboxHeight=maxY-minY+2*innerMargin,shiftedMinX=minX-innerMargin,shiftedMinY=minY-innerMargin,lastEdge=__privateGet(this,_verticalEdges).at(isLTR?-1:-2),lastPoint=[lastEdge[0],lastEdge[2]];for(const edge of __privateGet(this,_verticalEdges)){const[x,y1,y2]=edge;edge[0]=(x-shiftedMinX)/bboxWidth,edge[1]=(y1-shiftedMinY)/bboxHeight,edge[2]=(y2-shiftedMinY)/bboxHeight}__privateSet(this,_box,{x:shiftedMinX,y:shiftedMinY,width:bboxWidth,height:bboxHeight,lastPoint})}getOutlines(){__privateGet(this,_verticalEdges).sort((a,b)=>a[0]-b[0]||a[1]-b[1]||a[2]-b[2]);const outlineVerticalEdges=[];for(const edge of __privateGet(this,_verticalEdges))edge[3]?(outlineVerticalEdges.push(...__privateMethod(this,_Outliner_instances,breakEdge_fn).call(this,edge)),__privateMethod(this,_Outliner_instances,insert_fn).call(this,edge)):(__privateMethod(this,_Outliner_instances,remove_fn).call(this,edge),outlineVerticalEdges.push(...__privateMethod(this,_Outliner_instances,breakEdge_fn).call(this,edge)));return __privateMethod(this,_Outliner_instances,getOutlines_fn).call(this,outlineVerticalEdges)}};_box=new WeakMap,_verticalEdges=new WeakMap,_intervals=new WeakMap,_Outliner_instances=new WeakSet,getOutlines_fn=__name2(function(outlineVerticalEdges){const edges=[],allEdges=new Set;for(const edge of outlineVerticalEdges){const[x,y1,y2]=edge;edges.push([x,y1,edge],[x,y2,edge])}edges.sort((a,b)=>a[1]-b[1]||a[0]-b[0]);for(let i=0,ii=edges.length;i<ii;i+=2){const edge1=edges[i][2],edge2=edges[i+1][2];edge1.push(edge2),edge2.push(edge1),allEdges.add(edge1),allEdges.add(edge2)}const outlines=[];let outline;for(;allEdges.size>0;){const edge=allEdges.values().next().value;let[x,y1,y2,edge1,edge2]=edge;allEdges.delete(edge);let lastPointX=x,lastPointY=y1;for(outline=[x,y2],outlines.push(outline);;){let e;if(allEdges.has(edge1))e=edge1;else if(allEdges.has(edge2))e=edge2;else break;allEdges.delete(e),[x,y1,y2,edge1,edge2]=e,lastPointX!==x&&(outline.push(lastPointX,lastPointY,x,lastPointY===y1?y1:y2),lastPointX=x),lastPointY=lastPointY===y1?y2:y1}outline.push(lastPointX,lastPointY)}return new HighlightOutline(outlines,__privateGet(this,_box))},"#getOutlines"),binarySearch_fn=__name2(function(y){const array=__privateGet(this,_intervals);let start=0,end=array.length-1;for(;start<=end;){const middle=start+end>>1,y1=array[middle][0];if(y1===y)return middle;y1<y?start=middle+1:end=middle-1}return end+1},"#binarySearch"),insert_fn=__name2(function([,y1,y2]){const index2=__privateMethod(this,_Outliner_instances,binarySearch_fn).call(this,y1);__privateGet(this,_intervals).splice(index2,0,[y1,y2])},"#insert"),remove_fn=__name2(function([,y1,y2]){const index2=__privateMethod(this,_Outliner_instances,binarySearch_fn).call(this,y1);for(let i=index2;i<__privateGet(this,_intervals).length;i++){const[start,end]=__privateGet(this,_intervals)[i];if(start!==y1)break;if(start===y1&&end===y2){__privateGet(this,_intervals).splice(i,1);return}}for(let i=index2-1;i>=0;i--){const[start,end]=__privateGet(this,_intervals)[i];if(start!==y1)break;if(start===y1&&end===y2){__privateGet(this,_intervals).splice(i,1);return}}},"#remove"),breakEdge_fn=__name2(function(edge){const[x,y1,y2]=edge,results=[[x,y1,y2]],index2=__privateMethod(this,_Outliner_instances,binarySearch_fn).call(this,y2);for(let i=0;i<index2;i++){const[start,end]=__privateGet(this,_intervals)[i];for(let j=0,jj=results.length;j<jj;j++){const[,y3,y4]=results[j];if(!(end<=y3||y4<=start)){if(y3>=start){if(y4>end)results[j][1]=end;else{if(jj===1)return[];results.splice(j,1),j--,jj--}continue}results[j][2]=start,y4>end&&results.push([x,end,y4])}}}return results},"#breakEdge"),__name2(_Outliner,"Outliner");let Outliner=_Outliner;const _Outline=class{static{__name(this,"_Outline")}toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(_bbox2,_rotation2){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof FreeHighlightOutline}};__name2(_Outline,"Outline");let Outline=_Outline;const _HighlightOutline=class extends Outline{static{__name(this,"_HighlightOutline")}constructor(outlines,box){super(),__privateAdd(this,_box2),__privateAdd(this,_outlines),__privateSet(this,_outlines,outlines),__privateSet(this,_box2,box)}toSVGPath(){const buffer=[];for(const polygon of __privateGet(this,_outlines)){let[prevX,prevY]=polygon;buffer.push(`M${prevX} ${prevY}`);for(let i=2;i<polygon.length;i+=2){const x=polygon[i],y=polygon[i+1];x===prevX?(buffer.push(`V${y}`),prevY=y):y===prevY&&(buffer.push(`H${x}`),prevX=x)}buffer.push("Z")}return buffer.join(" ")}serialize([blX,blY,trX,trY],_rotation2){const outlines=[],width=trX-blX,height=trY-blY;for(const outline of __privateGet(this,_outlines)){const points=new Array(outline.length);for(let i=0;i<outline.length;i+=2)points[i]=blX+outline[i]*width,points[i+1]=trY-outline[i+1]*height;outlines.push(points)}return outlines}get box(){return __privateGet(this,_box2)}};_box2=new WeakMap,_outlines=new WeakMap,__name2(_HighlightOutline,"HighlightOutline");let HighlightOutline=_HighlightOutline;const _FreeOutliner=class _FreeOutliner2{static{__name(this,"_FreeOutliner")}constructor({x,y},box,scaleFactor,thickness,isLTR,innerMargin=0){__privateAdd(this,_FreeOutliner_instances),__privateAdd(this,_box3),__privateAdd(this,_bottom,[]),__privateAdd(this,_innerMargin),__privateAdd(this,_isLTR),__privateAdd(this,_top,[]),__privateAdd(this,_last,new Float64Array(18)),__privateAdd(this,_lastX),__privateAdd(this,_lastY),__privateAdd(this,_min),__privateAdd(this,_min_dist),__privateAdd(this,_scaleFactor),__privateAdd(this,_thickness),__privateAdd(this,_points,[]),__privateSet(this,_box3,box),__privateSet(this,_thickness,thickness*scaleFactor),__privateSet(this,_isLTR,isLTR),__privateGet(this,_last).set([NaN,NaN,NaN,NaN,x,y],6),__privateSet(this,_innerMargin,innerMargin),__privateSet(this,_min_dist,__privateGet(_FreeOutliner2,_MIN_DIST)*scaleFactor),__privateSet(this,_min,__privateGet(_FreeOutliner2,_MIN)*scaleFactor),__privateSet(this,_scaleFactor,scaleFactor),__privateGet(this,_points).push(x,y)}get free(){return!0}isEmpty(){return isNaN(__privateGet(this,_last)[8])}add({x,y}){var _a2;__privateSet(this,_lastX,x),__privateSet(this,_lastY,y);const[layerX,layerY,layerWidth,layerHeight]=__privateGet(this,_box3);let[x1,y1,x2,y2]=__privateGet(this,_last).subarray(8,12);const diffX=x-x2,diffY=y-y2,d=Math.hypot(diffX,diffY);if(d<__privateGet(this,_min))return!1;const diffD=d-__privateGet(this,_min_dist),K=diffD/d,shiftX=K*diffX,shiftY=K*diffY;let x0=x1,y0=y1;x1=x2,y1=y2,x2+=shiftX,y2+=shiftY,(_a2=__privateGet(this,_points))==null||_a2.push(x,y);const nX=-shiftY/diffD,nY=shiftX/diffD,thX=nX*__privateGet(this,_thickness),thY=nY*__privateGet(this,_thickness);return __privateGet(this,_last).set(__privateGet(this,_last).subarray(2,8),0),__privateGet(this,_last).set([x2+thX,y2+thY],4),__privateGet(this,_last).set(__privateGet(this,_last).subarray(14,18),12),__privateGet(this,_last).set([x2-thX,y2-thY],16),isNaN(__privateGet(this,_last)[6])?(__privateGet(this,_top).length===0&&(__privateGet(this,_last).set([x1+thX,y1+thY],2),__privateGet(this,_top).push(NaN,NaN,NaN,NaN,(x1+thX-layerX)/layerWidth,(y1+thY-layerY)/layerHeight),__privateGet(this,_last).set([x1-thX,y1-thY],14),__privateGet(this,_bottom).push(NaN,NaN,NaN,NaN,(x1-thX-layerX)/layerWidth,(y1-thY-layerY)/layerHeight)),__privateGet(this,_last).set([x0,y0,x1,y1,x2,y2],6),!this.isEmpty()):(__privateGet(this,_last).set([x0,y0,x1,y1,x2,y2],6),Math.abs(Math.atan2(y0-y1,x0-x1)-Math.atan2(shiftY,shiftX))<Math.PI/2?([x1,y1,x2,y2]=__privateGet(this,_last).subarray(2,6),__privateGet(this,_top).push(NaN,NaN,NaN,NaN,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),[x1,y1,x0,y0]=__privateGet(this,_last).subarray(14,18),__privateGet(this,_bottom).push(NaN,NaN,NaN,NaN,((x0+x1)/2-layerX)/layerWidth,((y0+y1)/2-layerY)/layerHeight),!0):([x0,y0,x1,y1,x2,y2]=__privateGet(this,_last).subarray(0,6),__privateGet(this,_top).push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),[x2,y2,x1,y1,x0,y0]=__privateGet(this,_last).subarray(12,18),__privateGet(this,_bottom).push(((x0+5*x1)/6-layerX)/layerWidth,((y0+5*y1)/6-layerY)/layerHeight,((5*x1+x2)/6-layerX)/layerWidth,((5*y1+y2)/6-layerY)/layerHeight,((x1+x2)/2-layerX)/layerWidth,((y1+y2)/2-layerY)/layerHeight),!0))}toSVGPath(){if(this.isEmpty())return"";const top=__privateGet(this,_top),bottom=__privateGet(this,_bottom),lastTop=__privateGet(this,_last).subarray(4,6),lastBottom=__privateGet(this,_last).subarray(16,18),[x,y,width,height]=__privateGet(this,_box3),[lastTopX,lastTopY,lastBottomX,lastBottomY]=__privateMethod(this,_FreeOutliner_instances,getLastCoords_fn).call(this);if(isNaN(__privateGet(this,_last)[6])&&!this.isEmpty())return`M${(__privateGet(this,_last)[2]-x)/width} ${(__privateGet(this,_last)[3]-y)/height} L${(__privateGet(this,_last)[4]-x)/width} ${(__privateGet(this,_last)[5]-y)/height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${(__privateGet(this,_last)[16]-x)/width} ${(__privateGet(this,_last)[17]-y)/height} L${(__privateGet(this,_last)[14]-x)/width} ${(__privateGet(this,_last)[15]-y)/height} Z`;const buffer=[];buffer.push(`M${top[4]} ${top[5]}`);for(let i=6;i<top.length;i+=6)isNaN(top[i])?buffer.push(`L${top[i+4]} ${top[i+5]}`):buffer.push(`C${top[i]} ${top[i+1]} ${top[i+2]} ${top[i+3]} ${top[i+4]} ${top[i+5]}`);buffer.push(`L${(lastTop[0]-x)/width} ${(lastTop[1]-y)/height} L${lastTopX} ${lastTopY} L${lastBottomX} ${lastBottomY} L${(lastBottom[0]-x)/width} ${(lastBottom[1]-y)/height}`);for(let i=bottom.length-6;i>=6;i-=6)isNaN(bottom[i])?buffer.push(`L${bottom[i+4]} ${bottom[i+5]}`):buffer.push(`C${bottom[i]} ${bottom[i+1]} ${bottom[i+2]} ${bottom[i+3]} ${bottom[i+4]} ${bottom[i+5]}`);return buffer.push(`L${bottom[4]} ${bottom[5]} Z`),buffer.join(" ")}getOutlines(){var _a2;const top=__privateGet(this,_top),bottom=__privateGet(this,_bottom),last=__privateGet(this,_last),lastTop=last.subarray(4,6),lastBottom=last.subarray(16,18),[layerX,layerY,layerWidth,layerHeight]=__privateGet(this,_box3),points=new Float64Array((((_a2=__privateGet(this,_points))==null?void 0:_a2.length)??0)+2);for(let i=0,ii=points.length-2;i<ii;i+=2)points[i]=(__privateGet(this,_points)[i]-layerX)/layerWidth,points[i+1]=(__privateGet(this,_points)[i+1]-layerY)/layerHeight;points[points.length-2]=(__privateGet(this,_lastX)-layerX)/layerWidth,points[points.length-1]=(__privateGet(this,_lastY)-layerY)/layerHeight;const[lastTopX,lastTopY,lastBottomX,lastBottomY]=__privateMethod(this,_FreeOutliner_instances,getLastCoords_fn).call(this);if(isNaN(last[6])&&!this.isEmpty()){const outline2=new Float64Array(36);return outline2.set([NaN,NaN,NaN,NaN,(last[2]-layerX)/layerWidth,(last[3]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[4]-layerX)/layerWidth,(last[5]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(last[16]-layerX)/layerWidth,(last[17]-layerY)/layerHeight,NaN,NaN,NaN,NaN,(last[14]-layerX)/layerWidth,(last[15]-layerY)/layerHeight],0),new FreeHighlightOutline(outline2,points,__privateGet(this,_box3),__privateGet(this,_scaleFactor),__privateGet(this,_innerMargin),__privateGet(this,_isLTR))}const outline=new Float64Array(__privateGet(this,_top).length+24+__privateGet(this,_bottom).length);let N=top.length;for(let i=0;i<N;i+=2){if(isNaN(top[i])){outline[i]=outline[i+1]=NaN;continue}outline[i]=top[i],outline[i+1]=top[i+1]}outline.set([NaN,NaN,NaN,NaN,(lastTop[0]-layerX)/layerWidth,(lastTop[1]-layerY)/layerHeight,NaN,NaN,NaN,NaN,lastTopX,lastTopY,NaN,NaN,NaN,NaN,lastBottomX,lastBottomY,NaN,NaN,NaN,NaN,(lastBottom[0]-layerX)/layerWidth,(lastBottom[1]-layerY)/layerHeight],N),N+=24;for(let i=bottom.length-6;i>=6;i-=6)for(let j=0;j<6;j+=2){if(isNaN(bottom[i+j])){outline[N]=outline[N+1]=NaN,N+=2;continue}outline[N]=bottom[i+j],outline[N+1]=bottom[i+j+1],N+=2}return outline.set([NaN,NaN,NaN,NaN,bottom[4],bottom[5]],N),new FreeHighlightOutline(outline,points,__privateGet(this,_box3),__privateGet(this,_scaleFactor),__privateGet(this,_innerMargin),__privateGet(this,_isLTR))}};_box3=new WeakMap,_bottom=new WeakMap,_innerMargin=new WeakMap,_isLTR=new WeakMap,_top=new WeakMap,_last=new WeakMap,_lastX=new WeakMap,_lastY=new WeakMap,_min=new WeakMap,_min_dist=new WeakMap,_scaleFactor=new WeakMap,_thickness=new WeakMap,_points=new WeakMap,_MIN_DIST=new WeakMap,_MIN_DIFF=new WeakMap,_MIN=new WeakMap,_FreeOutliner_instances=new WeakSet,getLastCoords_fn=__name2(function(){const lastTop=__privateGet(this,_last).subarray(4,6),lastBottom=__privateGet(this,_last).subarray(16,18),[x,y,width,height]=__privateGet(this,_box3);return[(__privateGet(this,_lastX)+(lastTop[0]-lastBottom[0])/2-x)/width,(__privateGet(this,_lastY)+(lastTop[1]-lastBottom[1])/2-y)/height,(__privateGet(this,_lastX)+(lastBottom[0]-lastTop[0])/2-x)/width,(__privateGet(this,_lastY)+(lastBottom[1]-lastTop[1])/2-y)/height]},"#getLastCoords"),__name2(_FreeOutliner,"FreeOutliner"),__privateAdd(_FreeOutliner,_MIN_DIST,8),__privateAdd(_FreeOutliner,_MIN_DIFF,2),__privateAdd(_FreeOutliner,_MIN,__privateGet(_FreeOutliner,_MIN_DIST)+__privateGet(_FreeOutliner,_MIN_DIFF));let FreeOutliner=_FreeOutliner;const _FreeHighlightOutline=class extends Outline{static{__name(this,"_FreeHighlightOutline")}constructor(outline,points,box,scaleFactor,innerMargin,isLTR){super(),__privateAdd(this,_FreeHighlightOutline_instances),__privateAdd(this,_box4),__privateAdd(this,_bbox,null),__privateAdd(this,_innerMargin2),__privateAdd(this,_isLTR2),__privateAdd(this,_points2),__privateAdd(this,_scaleFactor2),__privateAdd(this,_outline),__privateSet(this,_outline,outline),__privateSet(this,_points2,points),__privateSet(this,_box4,box),__privateSet(this,_scaleFactor2,scaleFactor),__privateSet(this,_innerMargin2,innerMargin),__privateSet(this,_isLTR2,isLTR),__privateMethod(this,_FreeHighlightOutline_instances,computeMinMax_fn).call(this,isLTR);const{x,y,width,height}=__privateGet(this,_bbox);for(let i=0,ii=outline.length;i<ii;i+=2)outline[i]=(outline[i]-x)/width,outline[i+1]=(outline[i+1]-y)/height;for(let i=0,ii=points.length;i<ii;i+=2)points[i]=(points[i]-x)/width,points[i+1]=(points[i+1]-y)/height}toSVGPath(){const buffer=[`M${__privateGet(this,_outline)[4]} ${__privateGet(this,_outline)[5]}`];for(let i=6,ii=__privateGet(this,_outline).length;i<ii;i+=6){if(isNaN(__privateGet(this,_outline)[i])){buffer.push(`L${__privateGet(this,_outline)[i+4]} ${__privateGet(this,_outline)[i+5]}`);continue}buffer.push(`C${__privateGet(this,_outline)[i]} ${__privateGet(this,_outline)[i+1]} ${__privateGet(this,_outline)[i+2]} ${__privateGet(this,_outline)[i+3]} ${__privateGet(this,_outline)[i+4]} ${__privateGet(this,_outline)[i+5]}`)}return buffer.push("Z"),buffer.join(" ")}serialize([blX,blY,trX,trY],rotation){const width=trX-blX,height=trY-blY;let outline,points;switch(rotation){case 0:outline=__privateMethod(this,_FreeHighlightOutline_instances,rescale_fn).call(this,__privateGet(this,_outline),blX,trY,width,-height),points=__privateMethod(this,_FreeHighlightOutline_instances,rescale_fn).call(this,__privateGet(this,_points2),blX,trY,width,-height);break;case 90:outline=__privateMethod(this,_FreeHighlightOutline_instances,rescaleAndSwap_fn).call(this,__privateGet(this,_outline),blX,blY,width,height),points=__privateMethod(this,_FreeHighlightOutline_instances,rescaleAndSwap_fn).call(this,__privateGet(this,_points2),blX,blY,width,height);break;case 180:outline=__privateMethod(this,_FreeHighlightOutline_instances,rescale_fn).call(this,__privateGet(this,_outline),trX,blY,-width,height),points=__privateMethod(this,_FreeHighlightOutline_instances,rescale_fn).call(this,__privateGet(this,_points2),trX,blY,-width,height);break;case 270:outline=__privateMethod(this,_FreeHighlightOutline_instances,rescaleAndSwap_fn).call(this,__privateGet(this,_outline),trX,trY,-width,-height),points=__privateMethod(this,_FreeHighlightOutline_instances,rescaleAndSwap_fn).call(this,__privateGet(this,_points2),trX,trY,-width,-height);break}return{outline:Array.from(outline),points:[Array.from(points)]}}get box(){return __privateGet(this,_bbox)}getNewOutline(thickness,innerMargin){const{x,y,width,height}=__privateGet(this,_bbox),[layerX,layerY,layerWidth,layerHeight]=__privateGet(this,_box4),sx=width*layerWidth,sy=height*layerHeight,tx=x*layerWidth+layerX,ty=y*layerHeight+layerY,outliner=new FreeOutliner({x:__privateGet(this,_points2)[0]*sx+tx,y:__privateGet(this,_points2)[1]*sy+ty},__privateGet(this,_box4),__privateGet(this,_scaleFactor2),thickness,__privateGet(this,_isLTR2),innerMargin??__privateGet(this,_innerMargin2));for(let i=2;i<__privateGet(this,_points2).length;i+=2)outliner.add({x:__privateGet(this,_points2)[i]*sx+tx,y:__privateGet(this,_points2)[i+1]*sy+ty});return outliner.getOutlines()}};_box4=new WeakMap,_bbox=new WeakMap,_innerMargin2=new WeakMap,_isLTR2=new WeakMap,_points2=new WeakMap,_scaleFactor2=new WeakMap,_outline=new WeakMap,_FreeHighlightOutline_instances=new WeakSet,rescale_fn=__name2(function(src,tx,ty,sx,sy){const dest=new Float64Array(src.length);for(let i=0,ii=src.length;i<ii;i+=2)dest[i]=tx+src[i]*sx,dest[i+1]=ty+src[i+1]*sy;return dest},"#rescale"),rescaleAndSwap_fn=__name2(function(src,tx,ty,sx,sy){const dest=new Float64Array(src.length);for(let i=0,ii=src.length;i<ii;i+=2)dest[i]=tx+src[i+1]*sx,dest[i+1]=ty+src[i]*sy;return dest},"#rescaleAndSwap"),computeMinMax_fn=__name2(function(isLTR){const outline=__privateGet(this,_outline);let lastX=outline[4],lastY=outline[5],minX=lastX,minY=lastY,maxX=lastX,maxY=lastY,lastPointX=lastX,lastPointY=lastY;const ltrCallback=isLTR?Math.max:Math.min;for(let i=6,ii=outline.length;i<ii;i+=6){if(isNaN(outline[i]))minX=Math.min(minX,outline[i+4]),minY=Math.min(minY,outline[i+5]),maxX=Math.max(maxX,outline[i+4]),maxY=Math.max(maxY,outline[i+5]),lastPointY<outline[i+5]?(lastPointX=outline[i+4],lastPointY=outline[i+5]):lastPointY===outline[i+5]&&(lastPointX=ltrCallback(lastPointX,outline[i+4]));else{const bbox=Util.bezierBoundingBox(lastX,lastY,...outline.slice(i,i+6));minX=Math.min(minX,bbox[0]),minY=Math.min(minY,bbox[1]),maxX=Math.max(maxX,bbox[2]),maxY=Math.max(maxY,bbox[3]),lastPointY<bbox[3]?(lastPointX=bbox[2],lastPointY=bbox[3]):lastPointY===bbox[3]&&(lastPointX=ltrCallback(lastPointX,bbox[2]))}lastX=outline[i+4],lastY=outline[i+5]}const x=minX-__privateGet(this,_innerMargin2),y=minY-__privateGet(this,_innerMargin2),width=maxX-minX+2*__privateGet(this,_innerMargin2),height=maxY-minY+2*__privateGet(this,_innerMargin2);__privateSet(this,_bbox,{x,y,width,height,lastPoint:[lastPointX,lastPointY]})},"#computeMinMax"),__name2(_FreeHighlightOutline,"FreeHighlightOutline");let FreeHighlightOutline=_FreeHighlightOutline;const _ColorPicker=class _ColorPicker2{static{__name(this,"_ColorPicker")}constructor({editor=null,uiManager=null}){__privateAdd(this,_ColorPicker_instances),__privateAdd(this,_boundKeyDown2,__privateMethod(this,_ColorPicker_instances,keyDown_fn2).bind(this)),__privateAdd(this,_boundPointerDown,__privateMethod(this,_ColorPicker_instances,pointerDown_fn2).bind(this)),__privateAdd(this,_button,null),__privateAdd(this,_buttonSwatch,null),__privateAdd(this,_defaultColor),__privateAdd(this,_dropdown,null),__privateAdd(this,_dropdownWasFromKeyboard,!1),__privateAdd(this,_isMainColorPicker,!1),__privateAdd(this,_editor3,null),__privateAdd(this,_eventBus),__privateAdd(this,_uiManager2,null),__privateAdd(this,_type);var _a2;editor?(__privateSet(this,_isMainColorPicker,!1),__privateSet(this,_type,AnnotationEditorParamsType.HIGHLIGHT_COLOR),__privateSet(this,_editor3,editor)):(__privateSet(this,_isMainColorPicker,!0),__privateSet(this,_type,AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR)),__privateSet(this,_uiManager2,editor?._uiManager||uiManager),__privateSet(this,_eventBus,__privateGet(this,_uiManager2)._eventBus),__privateSet(this,_defaultColor,editor?.color||((_a2=__privateGet(this,_uiManager2))==null?void 0:_a2.highlightColors.values().next().value)||"#FFFF98")}static get _keyboardManager(){return shadow(this,"_keyboardManager",new KeyboardManager([[["Escape","mac+Escape"],_ColorPicker2.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],_ColorPicker2.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],_ColorPicker2.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],_ColorPicker2.prototype._moveToPrevious],[["Home","mac+Home"],_ColorPicker2.prototype._moveToBeginning],[["End","mac+End"],_ColorPicker2.prototype._moveToEnd]]))}renderButton(){const button=__privateSet(this,_button,document.createElement("button"));button.className="colorPicker",button.tabIndex="0",button.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),button.setAttribute("aria-haspopup",!0);const signal=__privateGet(this,_uiManager2)._signal;button.addEventListener("click",__privateMethod(this,_ColorPicker_instances,openDropdown_fn).bind(this),{signal}),button.addEventListener("keydown",__privateGet(this,_boundKeyDown2),{signal});const swatch=__privateSet(this,_buttonSwatch,document.createElement("span"));return swatch.className="swatch",swatch.setAttribute("aria-hidden",!0),swatch.style.backgroundColor=__privateGet(this,_defaultColor),button.append(swatch),button}renderMainDropdown(){const dropdown=__privateSet(this,_dropdown,__privateMethod(this,_ColorPicker_instances,getDropdownRoot_fn).call(this));return dropdown.setAttribute("aria-orientation","horizontal"),dropdown.setAttribute("aria-labelledby","highlightColorPickerLabel"),dropdown}_colorSelectFromKeyboard(event){if(event.target===__privateGet(this,_button)){__privateMethod(this,_ColorPicker_instances,openDropdown_fn).call(this,event);return}const color=event.target.getAttribute("data-color");color&&__privateMethod(this,_ColorPicker_instances,colorSelect_fn).call(this,color,event)}_moveToNext(event){var _a2,_b2;if(!__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)){__privateMethod(this,_ColorPicker_instances,openDropdown_fn).call(this,event);return}if(event.target===__privateGet(this,_button)){(_a2=__privateGet(this,_dropdown).firstChild)==null||_a2.focus();return}(_b2=event.target.nextSibling)==null||_b2.focus()}_moveToPrevious(event){var _a2,_b2;if(event.target===((_a2=__privateGet(this,_dropdown))==null?void 0:_a2.firstChild)||event.target===__privateGet(this,_button)){__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)&&this._hideDropdownFromKeyboard();return}__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)||__privateMethod(this,_ColorPicker_instances,openDropdown_fn).call(this,event),(_b2=event.target.previousSibling)==null||_b2.focus()}_moveToBeginning(event){var _a2;if(!__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)){__privateMethod(this,_ColorPicker_instances,openDropdown_fn).call(this,event);return}(_a2=__privateGet(this,_dropdown).firstChild)==null||_a2.focus()}_moveToEnd(event){var _a2;if(!__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)){__privateMethod(this,_ColorPicker_instances,openDropdown_fn).call(this,event);return}(_a2=__privateGet(this,_dropdown).lastChild)==null||_a2.focus()}hideDropdown(){var _a2;(_a2=__privateGet(this,_dropdown))==null||_a2.classList.add("hidden"),window.removeEventListener("pointerdown",__privateGet(this,_boundPointerDown))}_hideDropdownFromKeyboard(){var _a2;if(!__privateGet(this,_isMainColorPicker)){if(!__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)){(_a2=__privateGet(this,_editor3))==null||_a2.unselect();return}this.hideDropdown(),__privateGet(this,_button).focus({preventScroll:!0,focusVisible:__privateGet(this,_dropdownWasFromKeyboard)})}}updateColor(color){if(__privateGet(this,_buttonSwatch)&&(__privateGet(this,_buttonSwatch).style.backgroundColor=color),!__privateGet(this,_dropdown))return;const i=__privateGet(this,_uiManager2).highlightColors.values();for(const child of __privateGet(this,_dropdown).children)child.setAttribute("aria-selected",i.next().value===color)}destroy(){var _a2,_b2;(_a2=__privateGet(this,_button))==null||_a2.remove(),__privateSet(this,_button,null),__privateSet(this,_buttonSwatch,null),(_b2=__privateGet(this,_dropdown))==null||_b2.remove(),__privateSet(this,_dropdown,null)}};_boundKeyDown2=new WeakMap,_boundPointerDown=new WeakMap,_button=new WeakMap,_buttonSwatch=new WeakMap,_defaultColor=new WeakMap,_dropdown=new WeakMap,_dropdownWasFromKeyboard=new WeakMap,_isMainColorPicker=new WeakMap,_editor3=new WeakMap,_eventBus=new WeakMap,_uiManager2=new WeakMap,_type=new WeakMap,_ColorPicker_instances=new WeakSet,getDropdownRoot_fn=__name2(function(){const div=document.createElement("div"),signal=__privateGet(this,_uiManager2)._signal;div.addEventListener("contextmenu",noContextMenu,{signal}),div.className="dropdown",div.role="listbox",div.setAttribute("aria-multiselectable",!1),div.setAttribute("aria-orientation","vertical"),div.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[name,color]of __privateGet(this,_uiManager2).highlightColors){const button=document.createElement("button");button.tabIndex="0",button.role="option",button.setAttribute("data-color",color),button.title=name,button.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${name}`);const swatch=document.createElement("span");button.append(swatch),swatch.className="swatch",swatch.style.backgroundColor=color,button.setAttribute("aria-selected",color===__privateGet(this,_defaultColor)),button.addEventListener("click",__privateMethod(this,_ColorPicker_instances,colorSelect_fn).bind(this,color),{signal}),div.append(button)}return div.addEventListener("keydown",__privateGet(this,_boundKeyDown2),{signal}),div},"#getDropdownRoot"),colorSelect_fn=__name2(function(color,event){event.stopPropagation(),__privateGet(this,_eventBus).dispatch("switchannotationeditorparams",{source:this,type:__privateGet(this,_type),value:color})},"#colorSelect"),keyDown_fn2=__name2(function(event){_ColorPicker._keyboardManager.exec(this,event)},"#keyDown"),openDropdown_fn=__name2(function(event){if(__privateGet(this,_ColorPicker_instances,isDropdownVisible_get)){this.hideDropdown();return}if(__privateSet(this,_dropdownWasFromKeyboard,event.detail===0),window.addEventListener("pointerdown",__privateGet(this,_boundPointerDown),{signal:__privateGet(this,_uiManager2)._signal}),__privateGet(this,_dropdown)){__privateGet(this,_dropdown).classList.remove("hidden");return}const root=__privateSet(this,_dropdown,__privateMethod(this,_ColorPicker_instances,getDropdownRoot_fn).call(this));__privateGet(this,_button).append(root)},"#openDropdown"),pointerDown_fn2=__name2(function(event){var _a2;(_a2=__privateGet(this,_dropdown))!=null&&_a2.contains(event.target)||this.hideDropdown()},"#pointerDown"),isDropdownVisible_get=__name2(function(){return __privateGet(this,_dropdown)&&!__privateGet(this,_dropdown).classList.contains("hidden")},"#isDropdownVisible"),__name2(_ColorPicker,"ColorPicker");let ColorPicker=_ColorPicker;const _HighlightEditor=class _HighlightEditor2 extends AnnotationEditor{static{__name(this,"_HighlightEditor")}constructor(params){super({...params,name:"highlightEditor"}),__privateAdd(this,_HighlightEditor_instances),__privateAdd(this,_anchorNode,null),__privateAdd(this,_anchorOffset,0),__privateAdd(this,_boxes),__privateAdd(this,_clipPathId,null),__privateAdd(this,_colorPicker2,null),__privateAdd(this,_focusOutlines,null),__privateAdd(this,_focusNode,null),__privateAdd(this,_focusOffset,0),__privateAdd(this,_highlightDiv,null),__privateAdd(this,_highlightOutlines,null),__privateAdd(this,_id4,null),__privateAdd(this,_isFreeHighlight,!1),__privateAdd(this,_boundKeydown2,__privateMethod(this,_HighlightEditor_instances,keydown_fn).bind(this)),__privateAdd(this,_lastPoint,null),__privateAdd(this,_opacity),__privateAdd(this,_outlineId,null),__privateAdd(this,_text,""),__privateAdd(this,_thickness2),__privateAdd(this,_methodOfCreation,""),this.color=params.color||_HighlightEditor2._defaultColor,__privateSet(this,_thickness2,params.thickness||_HighlightEditor2._defaultThickness),__privateSet(this,_opacity,params.opacity||_HighlightEditor2._defaultOpacity),__privateSet(this,_boxes,params.boxes||null),__privateSet(this,_methodOfCreation,params.methodOfCreation||""),__privateSet(this,_text,params.text||""),this._isDraggable=!1,params.highlightId>-1?(__privateSet(this,_isFreeHighlight,!0),__privateMethod(this,_HighlightEditor_instances,createFreeOutlines_fn).call(this,params),__privateMethod(this,_HighlightEditor_instances,addToDrawLayer_fn).call(this)):(__privateSet(this,_anchorNode,params.anchorNode),__privateSet(this,_anchorOffset,params.anchorOffset),__privateSet(this,_focusNode,params.focusNode),__privateSet(this,_focusOffset,params.focusOffset),__privateMethod(this,_HighlightEditor_instances,createOutlines_fn).call(this),__privateMethod(this,_HighlightEditor_instances,addToDrawLayer_fn).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const proto=_HighlightEditor2.prototype;return shadow(this,"_keyboardManager",new KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],proto._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],proto._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],proto._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],proto._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:__privateGet(this,_isFreeHighlight)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:__privateGet(this,_thickness2),methodOfCreation:__privateGet(this,_methodOfCreation)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(data){return{numberOfColors:data.get("color").size}}static initialize(l10n,uiManager){var _a2;AnnotationEditor.initialize(l10n,uiManager),_HighlightEditor2._defaultColor||(_HighlightEditor2._defaultColor=((_a2=uiManager.highlightColors)==null?void 0:_a2.values().next().value)||"#fff066")}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:_HighlightEditor2._defaultColor=value;break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:_HighlightEditor2._defaultThickness=value;break}}translateInPage(x,y){}get toolbarPosition(){return __privateGet(this,_lastPoint)}updateParams(type,value){switch(type){case AnnotationEditorParamsType.HIGHLIGHT_COLOR:__privateMethod(this,_HighlightEditor_instances,updateColor_fn2).call(this,value);break;case AnnotationEditorParamsType.HIGHLIGHT_THICKNESS:__privateMethod(this,_HighlightEditor_instances,updateThickness_fn).call(this,value);break}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,_HighlightEditor2._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,_HighlightEditor2._defaultThickness]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||_HighlightEditor2._defaultColor],[AnnotationEditorParamsType.HIGHLIGHT_THICKNESS,__privateGet(this,_thickness2)||_HighlightEditor2._defaultThickness],[AnnotationEditorParamsType.HIGHLIGHT_FREE,__privateGet(this,_isFreeHighlight)]]}async addEditToolbar(){const toolbar=await super.addEditToolbar();return toolbar?(this._uiManager.highlightColors&&(__privateSet(this,_colorPicker2,new ColorPicker({editor:this})),toolbar.addColorPicker(__privateGet(this,_colorPicker2))),toolbar):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(__privateMethod(this,_HighlightEditor_instances,getRotation_fn).call(this))}getBaseTranslation(){return[0,0]}getRect(tx,ty){return super.getRect(tx,ty,__privateMethod(this,_HighlightEditor_instances,getRotation_fn).call(this))}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){__privateMethod(this,_HighlightEditor_instances,cleanDrawLayer_fn).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(__privateMethod(this,_HighlightEditor_instances,addToDrawLayer_fn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(parent){var _a2;let mustBeSelected=!1;this.parent&&!parent?__privateMethod(this,_HighlightEditor_instances,cleanDrawLayer_fn).call(this):parent&&(__privateMethod(this,_HighlightEditor_instances,addToDrawLayer_fn).call(this,parent),mustBeSelected=!this.parent&&((_a2=this.div)==null?void 0:_a2.classList.contains("selectedEditor"))),super.setParent(parent),this.show(this._isVisible),mustBeSelected&&this.select()}rotate(angle){var _a2,_b2,_c;const{drawLayer}=this.parent;let box;__privateGet(this,_isFreeHighlight)?(angle=(angle-this.rotation+360)%360,box=__privateMethod(_a2=_HighlightEditor2,_HighlightEditor_static,rotateBbox_fn).call(_a2,__privateGet(this,_highlightOutlines).box,angle)):box=__privateMethod(_b2=_HighlightEditor2,_HighlightEditor_static,rotateBbox_fn).call(_b2,this,angle),drawLayer.rotate(__privateGet(this,_id4),angle),drawLayer.rotate(__privateGet(this,_outlineId),angle),drawLayer.updateBox(__privateGet(this,_id4),box),drawLayer.updateBox(__privateGet(this,_outlineId),__privateMethod(_c=_HighlightEditor2,_HighlightEditor_static,rotateBbox_fn).call(_c,__privateGet(this,_focusOutlines).box,angle))}render(){if(this.div)return this.div;const div=super.render();__privateGet(this,_text)&&(div.setAttribute("aria-label",__privateGet(this,_text)),div.setAttribute("role","mark")),__privateGet(this,_isFreeHighlight)?div.classList.add("free"):this.div.addEventListener("keydown",__privateGet(this,_boundKeydown2),{signal:this._uiManager._signal});const highlightDiv=__privateSet(this,_highlightDiv,document.createElement("div"));div.append(highlightDiv),highlightDiv.setAttribute("aria-hidden","true"),highlightDiv.className="internal",highlightDiv.style.clipPath=__privateGet(this,_clipPathId);const[parentWidth,parentHeight]=this.parentDimensions;return this.setDims(this.width*parentWidth,this.height*parentHeight),bindEvents(this,__privateGet(this,_highlightDiv),["pointerover","pointerleave"]),this.enableEditing(),div}pointerover(){this.parent.drawLayer.addClass(__privateGet(this,_outlineId),"hovered")}pointerleave(){this.parent.drawLayer.removeClass(__privateGet(this,_outlineId),"hovered")}_moveCaret(direction){switch(this.parent.unselect(this),direction){case 0:case 2:__privateMethod(this,_HighlightEditor_instances,setCaret_fn).call(this,!0);break;case 1:case 3:__privateMethod(this,_HighlightEditor_instances,setCaret_fn).call(this,!1);break}}select(){var _a2,_b2;super.select(),__privateGet(this,_outlineId)&&((_a2=this.parent)==null||_a2.drawLayer.removeClass(__privateGet(this,_outlineId),"hovered"),(_b2=this.parent)==null||_b2.drawLayer.addClass(__privateGet(this,_outlineId),"selected"))}unselect(){var _a2;super.unselect(),__privateGet(this,_outlineId)&&((_a2=this.parent)==null||_a2.drawLayer.removeClass(__privateGet(this,_outlineId),"selected"),__privateGet(this,_isFreeHighlight)||__privateMethod(this,_HighlightEditor_instances,setCaret_fn).call(this,!1))}get _mustFixPosition(){return!__privateGet(this,_isFreeHighlight)}show(visible=this._isVisible){super.show(visible),this.parent&&(this.parent.drawLayer.show(__privateGet(this,_id4),visible),this.parent.drawLayer.show(__privateGet(this,_outlineId),visible))}static startHighlighting(parent,isLTR,{target:textLayer,x,y}){const{x:layerX,y:layerY,width:parentWidth,height:parentHeight}=textLayer.getBoundingClientRect(),pointerMove=__name2(e=>{__privateMethod(this,_HighlightEditor_static,highlightMove_fn).call(this,parent,e)},"pointerMove"),signal=parent._signal,pointerDownOptions={capture:!0,passive:!1,signal},pointerDown=__name2(e=>{e.preventDefault(),e.stopPropagation()},"pointerDown"),pointerUpCallback=__name2(e=>{textLayer.removeEventListener("pointermove",pointerMove),window.removeEventListener("blur",pointerUpCallback),window.removeEventListener("pointerup",pointerUpCallback),window.removeEventListener("pointerdown",pointerDown,pointerDownOptions),window.removeEventListener("contextmenu",noContextMenu),__privateMethod(this,_HighlightEditor_static,endHighlight_fn).call(this,parent,e)},"pointerUpCallback");window.addEventListener("blur",pointerUpCallback,{signal}),window.addEventListener("pointerup",pointerUpCallback,{signal}),window.addEventListener("pointerdown",pointerDown,pointerDownOptions),window.addEventListener("contextmenu",noContextMenu,{signal}),textLayer.addEventListener("pointermove",pointerMove,{signal}),this._freeHighlight=new FreeOutliner({x,y},[layerX,layerY,parentWidth,parentHeight],parent.scale,this._defaultThickness/2,isLTR,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=parent.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static deserialize(data,parent,uiManager){var _a2;const editor=super.deserialize(data,parent,uiManager),{rect:[blX,blY,trX,trY],color,quadPoints}=data;editor.color=Util.makeHexColor(...color),__privateSet(editor,_opacity,data.opacity);const[pageWidth,pageHeight]=editor.pageDimensions;editor.width=(trX-blX)/pageWidth,editor.height=(trY-blY)/pageHeight;const boxes=__privateSet(editor,_boxes,[]);for(let i=0;i<quadPoints.length;i+=8)boxes.push({x:(quadPoints[4]-trX)/pageWidth,y:(trY-(1-quadPoints[i+5]))/pageHeight,width:(quadPoints[i+2]-quadPoints[i])/pageWidth,height:(quadPoints[i+5]-quadPoints[i+1])/pageHeight});return __privateMethod(_a2=editor,_HighlightEditor_instances,createOutlines_fn).call(_a2),editor}serialize(isForCopying=!1){if(this.isEmpty()||isForCopying)return null;const rect=this.getRect(0,0),color=AnnotationEditor._colorManager.convert(this.color);return{annotationType:AnnotationEditorType.HIGHLIGHT,color,opacity:__privateGet(this,_opacity),thickness:__privateGet(this,_thickness2),quadPoints:__privateMethod(this,_HighlightEditor_instances,serializeBoxes_fn).call(this),outlines:__privateMethod(this,_HighlightEditor_instances,serializeOutlines_fn).call(this,rect),pageIndex:this.pageIndex,rect,rotation:__privateMethod(this,_HighlightEditor_instances,getRotation_fn).call(this),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}};_anchorNode=new WeakMap,_anchorOffset=new WeakMap,_boxes=new WeakMap,_clipPathId=new WeakMap,_colorPicker2=new WeakMap,_focusOutlines=new WeakMap,_focusNode=new WeakMap,_focusOffset=new WeakMap,_highlightDiv=new WeakMap,_highlightOutlines=new WeakMap,_id4=new WeakMap,_isFreeHighlight=new WeakMap,_boundKeydown2=new WeakMap,_lastPoint=new WeakMap,_opacity=new WeakMap,_outlineId=new WeakMap,_text=new WeakMap,_thickness2=new WeakMap,_methodOfCreation=new WeakMap,_HighlightEditor_instances=new WeakSet,createOutlines_fn=__name2(function(){const outliner=new Outliner(__privateGet(this,_boxes),.001);__privateSet(this,_highlightOutlines,outliner.getOutlines()),{x:this.x,y:this.y,width:this.width,height:this.height}=__privateGet(this,_highlightOutlines).box;const outlinerForOutline=new Outliner(__privateGet(this,_boxes),.0025,.001,this._uiManager.direction==="ltr");__privateSet(this,_focusOutlines,outlinerForOutline.getOutlines());const{lastPoint}=__privateGet(this,_focusOutlines).box;__privateSet(this,_lastPoint,[(lastPoint[0]-this.x)/this.width,(lastPoint[1]-this.y)/this.height])},"#createOutlines"),createFreeOutlines_fn=__name2(function({highlightOutlines,highlightId,clipPathId}){var _a2,_b2;if(__privateSet(this,_highlightOutlines,highlightOutlines),__privateSet(this,_focusOutlines,highlightOutlines.getNewOutline(__privateGet(this,_thickness2)/2+1.5,.0025)),highlightId>=0)__privateSet(this,_id4,highlightId),__privateSet(this,_clipPathId,clipPathId),this.parent.drawLayer.finalizeLine(highlightId,highlightOutlines),__privateSet(this,_outlineId,this.parent.drawLayer.highlightOutline(__privateGet(this,_focusOutlines)));else if(this.parent){const angle=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(__privateGet(this,_id4),highlightOutlines),this.parent.drawLayer.updateBox(__privateGet(this,_id4),__privateMethod(_a2=_HighlightEditor,_HighlightEditor_static,rotateBbox_fn).call(_a2,__privateGet(this,_highlightOutlines).box,(angle-this.rotation+360)%360)),this.parent.drawLayer.updateLine(__privateGet(this,_outlineId),__privateGet(this,_focusOutlines)),this.parent.drawLayer.updateBox(__privateGet(this,_outlineId),__privateMethod(_b2=_HighlightEditor,_HighlightEditor_static,rotateBbox_fn).call(_b2,__privateGet(this,_focusOutlines).box,angle))}const{x,y,width,height}=highlightOutlines.box;switch(this.rotation){case 0:this.x=x,this.y=y,this.width=width,this.height=height;break;case 90:{const[pageWidth,pageHeight]=this.parentDimensions;this.x=y,this.y=1-x,this.width=width*pageHeight/pageWidth,this.height=height*pageWidth/pageHeight;break}case 180:this.x=1-x,this.y=1-y,this.width=width,this.height=height;break;case 270:{const[pageWidth,pageHeight]=this.parentDimensions;this.x=1-y,this.y=x,this.width=width*pageHeight/pageWidth,this.height=height*pageWidth/pageHeight;break}}const{lastPoint}=__privateGet(this,_focusOutlines).box;__privateSet(this,_lastPoint,[(lastPoint[0]-x)/width,(lastPoint[1]-y)/height])},"#createFreeOutlines"),updateColor_fn2=__name2(function(color){const setColor=__name2(col=>{var _a2,_b2;this.color=col,(_a2=this.parent)==null||_a2.drawLayer.changeColor(__privateGet(this,_id4),col),(_b2=__privateGet(this,_colorPicker2))==null||_b2.updateColor(col)},"setColor"),savedColor=this.color;this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(color)},!0)},"#updateColor"),updateThickness_fn=__name2(function(thickness){const savedThickness=__privateGet(this,_thickness2),setThickness=__name2(th=>{__privateSet(this,_thickness2,th),__privateMethod(this,_HighlightEditor_instances,changeThickness_fn).call(this,th)},"setThickness");this.addCommands({cmd:setThickness.bind(this,thickness),undo:setThickness.bind(this,savedThickness),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness},!0)},"#updateThickness"),changeThickness_fn=__name2(function(thickness){if(!__privateGet(this,_isFreeHighlight))return;__privateMethod(this,_HighlightEditor_instances,createFreeOutlines_fn).call(this,{highlightOutlines:__privateGet(this,_highlightOutlines).getNewOutline(thickness/2)}),this.fixAndSetPosition();const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(this.width*parentWidth,this.height*parentHeight)},"#changeThickness"),cleanDrawLayer_fn=__name2(function(){__privateGet(this,_id4)===null||!this.parent||(this.parent.drawLayer.remove(__privateGet(this,_id4)),__privateSet(this,_id4,null),this.parent.drawLayer.remove(__privateGet(this,_outlineId)),__privateSet(this,_outlineId,null))},"#cleanDrawLayer"),addToDrawLayer_fn=__name2(function(parent=this.parent){__privateGet(this,_id4)===null&&({id:__privateWrapper(this,_id4)._,clipPathId:__privateWrapper(this,_clipPathId)._}=parent.drawLayer.highlight(__privateGet(this,_highlightOutlines),this.color,__privateGet(this,_opacity)),__privateSet(this,_outlineId,parent.drawLayer.highlightOutline(__privateGet(this,_focusOutlines))),__privateGet(this,_highlightDiv)&&(__privateGet(this,_highlightDiv).style.clipPath=__privateGet(this,_clipPathId)))},"#addToDrawLayer"),_HighlightEditor_static=new WeakSet,rotateBbox_fn=__name2(function({x,y,width,height},angle){switch(angle){case 90:return{x:1-y-height,y:x,width:height,height:width};case 180:return{x:1-x-width,y:1-y-height,width,height};case 270:return{x:y,y:1-x-width,width:height,height:width}}return{x,y,width,height}},"#rotateBbox"),keydown_fn=__name2(function(event){_HighlightEditor._keyboardManager.exec(this,event)},"#keydown"),setCaret_fn=__name2(function(start){if(!__privateGet(this,_anchorNode))return;const selection=window.getSelection();start?selection.setPosition(__privateGet(this,_anchorNode),__privateGet(this,_anchorOffset)):selection.setPosition(__privateGet(this,_focusNode),__privateGet(this,_focusOffset))},"#setCaret"),getRotation_fn=__name2(function(){return __privateGet(this,_isFreeHighlight)?this.rotation:0},"#getRotation"),serializeBoxes_fn=__name2(function(){if(__privateGet(this,_isFreeHighlight))return null;const[pageWidth,pageHeight]=this.pageDimensions,[pageX,pageY]=this.pageTranslation,boxes=__privateGet(this,_boxes),quadPoints=new Float32Array(boxes.length*8);let i=0;for(const{x,y,width,height}of boxes){const sx=x*pageWidth+pageX,sy=(1-y-height)*pageHeight+pageY;quadPoints[i]=quadPoints[i+4]=sx,quadPoints[i+1]=quadPoints[i+3]=sy,quadPoints[i+2]=quadPoints[i+6]=sx+width*pageWidth,quadPoints[i+5]=quadPoints[i+7]=sy+height*pageHeight,i+=8}return quadPoints},"#serializeBoxes"),serializeOutlines_fn=__name2(function(rect){return __privateGet(this,_highlightOutlines).serialize(rect,__privateMethod(this,_HighlightEditor_instances,getRotation_fn).call(this))},"#serializeOutlines"),highlightMove_fn=__name2(function(parent,event){this._freeHighlight.add(event)&&parent.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)},"#highlightMove"),endHighlight_fn=__name2(function(parent,event){this._freeHighlight.isEmpty()?parent.drawLayer.removeFreeHighlight(this._freeHighlightId):parent.createAndAddNewEditor(event,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},"#endHighlight"),__privateAdd(_HighlightEditor,_HighlightEditor_static),__name2(_HighlightEditor,"HighlightEditor"),__publicField(_HighlightEditor,"_defaultColor",null),__publicField(_HighlightEditor,"_defaultOpacity",1),__publicField(_HighlightEditor,"_defaultThickness",12),__publicField(_HighlightEditor,"_l10nPromise"),__publicField(_HighlightEditor,"_type","highlight"),__publicField(_HighlightEditor,"_editorType",AnnotationEditorType.HIGHLIGHT),__publicField(_HighlightEditor,"_freeHighlightId",-1),__publicField(_HighlightEditor,"_freeHighlight",null),__publicField(_HighlightEditor,"_freeHighlightClipId","");let HighlightEditor=_HighlightEditor;const _InkEditor=class _InkEditor2 extends AnnotationEditor{static{__name(this,"_InkEditor")}constructor(params){super({...params,name:"inkEditor"}),__privateAdd(this,_InkEditor_instances),__privateAdd(this,_baseHeight,0),__privateAdd(this,_baseWidth,0),__privateAdd(this,_boundCanvasPointermove,this.canvasPointermove.bind(this)),__privateAdd(this,_boundCanvasPointerleave,this.canvasPointerleave.bind(this)),__privateAdd(this,_boundCanvasPointerup,this.canvasPointerup.bind(this)),__privateAdd(this,_boundCanvasPointerdown,this.canvasPointerdown.bind(this)),__privateAdd(this,_canvasContextMenuTimeoutId,null),__privateAdd(this,_currentPath2D,new Path2D),__privateAdd(this,_disableEditing,!1),__privateAdd(this,_hasSomethingToDraw,!1),__privateAdd(this,_isCanvasInitialized,!1),__privateAdd(this,_observer,null),__privateAdd(this,_realWidth,0),__privateAdd(this,_realHeight,0),__privateAdd(this,_requestFrameCallback,null),this.color=params.color||null,this.thickness=params.thickness||null,this.opacity=params.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager)}static updateDefaultParams(type,value){switch(type){case AnnotationEditorParamsType.INK_THICKNESS:_InkEditor2._defaultThickness=value;break;case AnnotationEditorParamsType.INK_COLOR:_InkEditor2._defaultColor=value;break;case AnnotationEditorParamsType.INK_OPACITY:_InkEditor2._defaultOpacity=value/100;break}}updateParams(type,value){switch(type){case AnnotationEditorParamsType.INK_THICKNESS:__privateMethod(this,_InkEditor_instances,updateThickness_fn2).call(this,value);break;case AnnotationEditorParamsType.INK_COLOR:__privateMethod(this,_InkEditor_instances,updateColor_fn3).call(this,value);break;case AnnotationEditorParamsType.INK_OPACITY:__privateMethod(this,_InkEditor_instances,updateOpacity_fn).call(this,value);break}}static get defaultPropertiesToUpdate(){return[[AnnotationEditorParamsType.INK_THICKNESS,_InkEditor2._defaultThickness],[AnnotationEditorParamsType.INK_COLOR,_InkEditor2._defaultColor||AnnotationEditor._defaultLineColor],[AnnotationEditorParamsType.INK_OPACITY,Math.round(_InkEditor2._defaultOpacity*100)]]}get propertiesToUpdate(){return[[AnnotationEditorParamsType.INK_THICKNESS,this.thickness||_InkEditor2._defaultThickness],[AnnotationEditorParamsType.INK_COLOR,this.color||_InkEditor2._defaultColor||AnnotationEditor._defaultLineColor],[AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??_InkEditor2._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(__privateMethod(this,_InkEditor_instances,createCanvas_fn).call(this),__privateMethod(this,_InkEditor_instances,createObserver_fn).call(this)),this.isAttachedToDOM||(this.parent.add(this),__privateMethod(this,_InkEditor_instances,setCanvasDims_fn).call(this)),__privateMethod(this,_InkEditor_instances,fitToContent_fn).call(this)))}remove(){var _a2;this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,__privateGet(this,_canvasContextMenuTimeoutId)&&(clearTimeout(__privateGet(this,_canvasContextMenuTimeoutId)),__privateSet(this,_canvasContextMenuTimeoutId,null)),(_a2=__privateGet(this,_observer))==null||_a2.disconnect(),__privateSet(this,_observer,null),super.remove())}setParent(parent){!this.parent&&parent?this._uiManager.removeShouldRescale(this):this.parent&&parent===null&&this._uiManager.addShouldRescale(this),super.setParent(parent)}onScaleChanging(){const[parentWidth,parentHeight]=this.parentDimensions,width=this.width*parentWidth,height=this.height*parentHeight;this.setDimensions(width,height)}enableEditMode(){__privateGet(this,_disableEditing)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",__privateGet(this,_boundCanvasPointerdown),{signal:this._uiManager._signal}))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",__privateGet(this,_boundCanvasPointerdown)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){__privateGet(this,_disableEditing)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),__privateSet(this,_disableEditing,!0),this.div.classList.add("disabled"),__privateMethod(this,_InkEditor_instances,fitToContent_fn).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(event){this._focusEventsAllowed&&(super.focusin(event),this.enableEditMode())}canvasPointerdown(event){event.button!==0||!this.isInEditMode()||__privateGet(this,_disableEditing)||(this.setInForeground(),event.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),__privateMethod(this,_InkEditor_instances,startDrawing_fn).call(this,event.offsetX,event.offsetY))}canvasPointermove(event){event.preventDefault(),__privateMethod(this,_InkEditor_instances,draw_fn).call(this,event.offsetX,event.offsetY)}canvasPointerup(event){event.preventDefault(),__privateMethod(this,_InkEditor_instances,endDrawing_fn).call(this,event)}canvasPointerleave(event){__privateMethod(this,_InkEditor_instances,endDrawing_fn).call(this,event)}get isResizable(){return!this.isEmpty()&&__privateGet(this,_disableEditing)}render(){if(this.div)return this.div;let baseX,baseY;this.width&&(baseX=this.x,baseY=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[x,y,w,h]=__privateMethod(this,_InkEditor_instances,getInitialBBox_fn).call(this);if(this.setAt(x,y,0,0),this.setDims(w,h),__privateMethod(this,_InkEditor_instances,createCanvas_fn).call(this),this.width){const[parentWidth,parentHeight]=this.parentDimensions;this.setAspectRatio(this.width*parentWidth,this.height*parentHeight),this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight),__privateSet(this,_isCanvasInitialized,!0),__privateMethod(this,_InkEditor_instances,setCanvasDims_fn).call(this),this.setDims(this.width*parentWidth,this.height*parentHeight),__privateMethod(this,_InkEditor_instances,redraw_fn).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return __privateMethod(this,_InkEditor_instances,createObserver_fn).call(this),this.div}setDimensions(width,height){const roundedWidth=Math.round(width),roundedHeight=Math.round(height);if(__privateGet(this,_realWidth)===roundedWidth&&__privateGet(this,_realHeight)===roundedHeight)return;__privateSet(this,_realWidth,roundedWidth),__privateSet(this,_realHeight,roundedHeight),this.canvas.style.visibility="hidden";const[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this.fixAndSetPosition(),__privateGet(this,_disableEditing)&&__privateMethod(this,_InkEditor_instances,setScaleFactor_fn).call(this,width,height),__privateMethod(this,_InkEditor_instances,setCanvasDims_fn).call(this),__privateMethod(this,_InkEditor_instances,redraw_fn).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(data,parent,uiManager){var _a2,_b2,_c;if(data instanceof InkAnnotationElement)return null;const editor=super.deserialize(data,parent,uiManager);editor.thickness=data.thickness,editor.color=Util.makeHexColor(...data.color),editor.opacity=data.opacity;const[pageWidth,pageHeight]=editor.pageDimensions,width=editor.width*pageWidth,height=editor.height*pageHeight,scaleFactor=editor.parentScale,padding=data.thickness/2;__privateSet(editor,_disableEditing,!0),__privateSet(editor,_realWidth,Math.round(width)),__privateSet(editor,_realHeight,Math.round(height));const{paths,rect,rotation}=data;for(let{bezier}of paths){bezier=__privateMethod(_a2=_InkEditor2,_InkEditor_static,fromPDFCoordinates_fn).call(_a2,bezier,rect,rotation);const path=[];editor.paths.push(path);let p0=scaleFactor*(bezier[0]-padding),p1=scaleFactor*(bezier[1]-padding);for(let i=2,ii=bezier.length;i<ii;i+=6){const p10=scaleFactor*(bezier[i]-padding),p11=scaleFactor*(bezier[i+1]-padding),p20=scaleFactor*(bezier[i+2]-padding),p21=scaleFactor*(bezier[i+3]-padding),p30=scaleFactor*(bezier[i+4]-padding),p31=scaleFactor*(bezier[i+5]-padding);path.push([[p0,p1],[p10,p11],[p20,p21],[p30,p31]]),p0=p30,p1=p31}const path2D=__privateMethod(this,_InkEditor_static,buildPath2D_fn).call(this,path);editor.bezierPath2D.push(path2D)}const bbox=__privateMethod(_b2=editor,_InkEditor_instances,getBbox_fn).call(_b2);return __privateSet(editor,_baseWidth,Math.max(AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0])),__privateSet(editor,_baseHeight,Math.max(AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1])),__privateMethod(_c=editor,_InkEditor_instances,setScaleFactor_fn).call(_c,width,height),editor}serialize(){if(this.isEmpty())return null;const rect=this.getRect(0,0),color=AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:AnnotationEditorType.INK,color,thickness:this.thickness,opacity:this.opacity,paths:__privateMethod(this,_InkEditor_instances,serializePaths_fn).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,rect),pageIndex:this.pageIndex,rect,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};_baseHeight=new WeakMap,_baseWidth=new WeakMap,_boundCanvasPointermove=new WeakMap,_boundCanvasPointerleave=new WeakMap,_boundCanvasPointerup=new WeakMap,_boundCanvasPointerdown=new WeakMap,_canvasContextMenuTimeoutId=new WeakMap,_currentPath2D=new WeakMap,_disableEditing=new WeakMap,_hasSomethingToDraw=new WeakMap,_isCanvasInitialized=new WeakMap,_observer=new WeakMap,_realWidth=new WeakMap,_realHeight=new WeakMap,_requestFrameCallback=new WeakMap,_InkEditor_instances=new WeakSet,updateThickness_fn2=__name2(function(thickness){const setThickness=__name2(th=>{this.thickness=th,__privateMethod(this,_InkEditor_instances,fitToContent_fn).call(this)},"setThickness"),savedThickness=this.thickness;this.addCommands({cmd:setThickness.bind(this,thickness),undo:setThickness.bind(this,savedThickness),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},"#updateThickness"),updateColor_fn3=__name2(function(color){const setColor=__name2(col=>{this.color=col,__privateMethod(this,_InkEditor_instances,redraw_fn).call(this)},"setColor"),savedColor=this.color;this.addCommands({cmd:setColor.bind(this,color),undo:setColor.bind(this,savedColor),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},"#updateColor"),updateOpacity_fn=__name2(function(opacity){const setOpacity=__name2(op=>{this.opacity=op,__privateMethod(this,_InkEditor_instances,redraw_fn).call(this)},"setOpacity");opacity/=100;const savedOpacity=this.opacity;this.addCommands({cmd:setOpacity.bind(this,opacity),undo:setOpacity.bind(this,savedOpacity),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},"#updateOpacity"),getInitialBBox_fn=__name2(function(){const{parentRotation,parentDimensions:[width,height]}=this;switch(parentRotation){case 90:return[0,height,height,width];case 180:return[width,height,width,height];case 270:return[width,0,height,width];default:return[0,0,width,height]}},"#getInitialBBox"),setStroke_fn=__name2(function(){const{ctx,color,opacity,thickness,parentScale,scaleFactor}=this;ctx.lineWidth=thickness*parentScale/scaleFactor,ctx.lineCap="round",ctx.lineJoin="round",ctx.miterLimit=10,ctx.strokeStyle=`${color}${opacityToHex(opacity)}`},"#setStroke"),startDrawing_fn=__name2(function(x,y){const signal=this._uiManager._signal;this.canvas.addEventListener("contextmenu",noContextMenu,{signal}),this.canvas.addEventListener("pointerleave",__privateGet(this,_boundCanvasPointerleave),{signal}),this.canvas.addEventListener("pointermove",__privateGet(this,_boundCanvasPointermove),{signal}),this.canvas.addEventListener("pointerup",__privateGet(this,_boundCanvasPointerup),{signal}),this.canvas.removeEventListener("pointerdown",__privateGet(this,_boundCanvasPointerdown)),this.isEditing=!0,__privateGet(this,_isCanvasInitialized)||(__privateSet(this,_isCanvasInitialized,!0),__privateMethod(this,_InkEditor_instances,setCanvasDims_fn).call(this),this.thickness||(this.thickness=_InkEditor._defaultThickness),this.color||(this.color=_InkEditor._defaultColor||AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=_InkEditor._defaultOpacity)),this.currentPath.push([x,y]),__privateSet(this,_hasSomethingToDraw,!1),__privateMethod(this,_InkEditor_instances,setStroke_fn).call(this),__privateSet(this,_requestFrameCallback,()=>{__privateMethod(this,_InkEditor_instances,drawPoints_fn).call(this),__privateGet(this,_requestFrameCallback)&&window.requestAnimationFrame(__privateGet(this,_requestFrameCallback))}),window.requestAnimationFrame(__privateGet(this,_requestFrameCallback))},"#startDrawing"),draw_fn=__name2(function(x,y){const[lastX,lastY]=this.currentPath.at(-1);if(this.currentPath.length>1&&x===lastX&&y===lastY)return;const currentPath=this.currentPath;let path2D=__privateGet(this,_currentPath2D);if(currentPath.push([x,y]),__privateSet(this,_hasSomethingToDraw,!0),currentPath.length<=2){path2D.moveTo(...currentPath[0]),path2D.lineTo(x,y);return}currentPath.length===3&&(__privateSet(this,_currentPath2D,path2D=new Path2D),path2D.moveTo(...currentPath[0])),__privateMethod(this,_InkEditor_instances,makeBezierCurve_fn).call(this,path2D,...currentPath.at(-3),...currentPath.at(-2),x,y)},"#draw"),endPath_fn=__name2(function(){if(this.currentPath.length===0)return;const lastPoint=this.currentPath.at(-1);__privateGet(this,_currentPath2D).lineTo(...lastPoint)},"#endPath"),stopDrawing_fn=__name2(function(x,y){__privateSet(this,_requestFrameCallback,null),x=Math.min(Math.max(x,0),this.canvas.width),y=Math.min(Math.max(y,0),this.canvas.height),__privateMethod(this,_InkEditor_instances,draw_fn).call(this,x,y),__privateMethod(this,_InkEditor_instances,endPath_fn).call(this);let bezier;if(this.currentPath.length!==1)bezier=__privateMethod(this,_InkEditor_instances,generateBezierPoints_fn).call(this);else{const xy=[x,y];bezier=[[xy,xy.slice(),xy.slice(),xy]]}const path2D=__privateGet(this,_currentPath2D),currentPath=this.currentPath;this.currentPath=[],__privateSet(this,_currentPath2D,new Path2D);const cmd=__name2(()=>{this.allRawPaths.push(currentPath),this.paths.push(bezier),this.bezierPath2D.push(path2D),this._uiManager.rebuild(this)},"cmd"),undo=__name2(()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(__privateMethod(this,_InkEditor_instances,createCanvas_fn).call(this),__privateMethod(this,_InkEditor_instances,createObserver_fn).call(this)),__privateMethod(this,_InkEditor_instances,fitToContent_fn).call(this))},"undo");this.addCommands({cmd,undo,mustExec:!0})},"#stopDrawing"),drawPoints_fn=__name2(function(){if(!__privateGet(this,_hasSomethingToDraw))return;__privateSet(this,_hasSomethingToDraw,!1);const thickness=Math.ceil(this.thickness*this.parentScale),lastPoints=this.currentPath.slice(-3),x=lastPoints.map(xy=>xy[0]),y=lastPoints.map(xy=>xy[1]);Math.min(...x)-thickness,Math.max(...x)+thickness,Math.min(...y)-thickness,Math.max(...y)+thickness;const{ctx}=this;ctx.save(),ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const path of this.bezierPath2D)ctx.stroke(path);ctx.stroke(__privateGet(this,_currentPath2D)),ctx.restore()},"#drawPoints"),makeBezierCurve_fn=__name2(function(path2D,x0,y0,x1,y1,x2,y2){const prevX=(x0+x1)/2,prevY=(y0+y1)/2,x3=(x1+x2)/2,y3=(y1+y2)/2;path2D.bezierCurveTo(prevX+2*(x1-prevX)/3,prevY+2*(y1-prevY)/3,x3+2*(x1-x3)/3,y3+2*(y1-y3)/3,x3,y3)},"#makeBezierCurve"),generateBezierPoints_fn=__name2(function(){const path=this.currentPath;if(path.length<=2)return[[path[0],path[0],path.at(-1),path.at(-1)]];const bezierPoints=[];let i,[x0,y0]=path[0];for(i=1;i<path.length-2;i++){const[x12,y12]=path[i],[x22,y22]=path[i+1],x3=(x12+x22)/2,y3=(y12+y22)/2,control12=[x0+2*(x12-x0)/3,y0+2*(y12-y0)/3],control22=[x3+2*(x12-x3)/3,y3+2*(y12-y3)/3];bezierPoints.push([[x0,y0],control12,control22,[x3,y3]]),[x0,y0]=[x3,y3]}const[x1,y1]=path[i],[x2,y2]=path[i+1],control1=[x0+2*(x1-x0)/3,y0+2*(y1-y0)/3],control2=[x2+2*(x1-x2)/3,y2+2*(y1-y2)/3];return bezierPoints.push([[x0,y0],control1,control2,[x2,y2]]),bezierPoints},"#generateBezierPoints"),redraw_fn=__name2(function(){if(this.isEmpty()){__privateMethod(this,_InkEditor_instances,updateTransform_fn).call(this);return}__privateMethod(this,_InkEditor_instances,setStroke_fn).call(this);const{canvas,ctx}=this;ctx.setTransform(1,0,0,1,0,0),ctx.clearRect(0,0,canvas.width,canvas.height),__privateMethod(this,_InkEditor_instances,updateTransform_fn).call(this);for(const path of this.bezierPath2D)ctx.stroke(path)},"#redraw"),endDrawing_fn=__name2(function(event){this.canvas.removeEventListener("pointerleave",__privateGet(this,_boundCanvasPointerleave)),this.canvas.removeEventListener("pointermove",__privateGet(this,_boundCanvasPointermove)),this.canvas.removeEventListener("pointerup",__privateGet(this,_boundCanvasPointerup)),this.canvas.addEventListener("pointerdown",__privateGet(this,_boundCanvasPointerdown),{signal:this._uiManager._signal}),__privateGet(this,_canvasContextMenuTimeoutId)&&clearTimeout(__privateGet(this,_canvasContextMenuTimeoutId)),__privateSet(this,_canvasContextMenuTimeoutId,setTimeout(()=>{__privateSet(this,_canvasContextMenuTimeoutId,null),this.canvas.removeEventListener("contextmenu",noContextMenu)},10)),__privateMethod(this,_InkEditor_instances,stopDrawing_fn).call(this,event.offsetX,event.offsetY),this.addToAnnotationStorage(),this.setInBackground()},"#endDrawing"),createCanvas_fn=__name2(function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},"#createCanvas"),createObserver_fn=__name2(function(){__privateSet(this,_observer,new ResizeObserver(entries=>{const rect=entries[0].contentRect;rect.width&&rect.height&&this.setDimensions(rect.width,rect.height)})),__privateGet(this,_observer).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var _a2;(_a2=__privateGet(this,_observer))==null||_a2.disconnect(),__privateSet(this,_observer,null)},{once:!0})},"#createObserver"),setCanvasDims_fn=__name2(function(){if(!__privateGet(this,_isCanvasInitialized))return;const[parentWidth,parentHeight]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*parentWidth),this.canvas.height=Math.ceil(this.height*parentHeight),__privateMethod(this,_InkEditor_instances,updateTransform_fn).call(this)},"#setCanvasDims"),setScaleFactor_fn=__name2(function(width,height){const padding=__privateMethod(this,_InkEditor_instances,getPadding_fn).call(this),scaleFactorW=(width-padding)/__privateGet(this,_baseWidth),scaleFactorH=(height-padding)/__privateGet(this,_baseHeight);this.scaleFactor=Math.min(scaleFactorW,scaleFactorH)},"#setScaleFactor"),updateTransform_fn=__name2(function(){const padding=__privateMethod(this,_InkEditor_instances,getPadding_fn).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+padding,this.translationY*this.scaleFactor+padding)},"#updateTransform"),_InkEditor_static=new WeakSet,buildPath2D_fn=__name2(function(bezier){const path2D=new Path2D;for(let i=0,ii=bezier.length;i<ii;i++){const[first,control1,control2,second]=bezier[i];i===0&&path2D.moveTo(...first),path2D.bezierCurveTo(control1[0],control1[1],control2[0],control2[1],second[0],second[1])}return path2D},"#buildPath2D"),toPDFCoordinates_fn=__name2(function(points,rect,rotation){const[blX,blY,trX,trY]=rect;switch(rotation){case 0:for(let i=0,ii=points.length;i<ii;i+=2)points[i]+=blX,points[i+1]=trY-points[i+1];break;case 90:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=points[i+1]+blX,points[i+1]=x+blY}break;case 180:for(let i=0,ii=points.length;i<ii;i+=2)points[i]=trX-points[i],points[i+1]+=blY;break;case 270:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=trX-points[i+1],points[i+1]=trY-x}break;default:throw new Error("Invalid rotation")}return points},"#toPDFCoordinates"),fromPDFCoordinates_fn=__name2(function(points,rect,rotation){const[blX,blY,trX,trY]=rect;switch(rotation){case 0:for(let i=0,ii=points.length;i<ii;i+=2)points[i]-=blX,points[i+1]=trY-points[i+1];break;case 90:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=points[i+1]-blY,points[i+1]=x-blX}break;case 180:for(let i=0,ii=points.length;i<ii;i+=2)points[i]=trX-points[i],points[i+1]-=blY;break;case 270:for(let i=0,ii=points.length;i<ii;i+=2){const x=points[i];points[i]=trY-points[i+1],points[i+1]=trX-x}break;default:throw new Error("Invalid rotation")}return points},"#fromPDFCoordinates"),serializePaths_fn=__name2(function(s,tx,ty,rect){var _a2,_b2;const paths=[],padding=this.thickness/2,shiftX=s*tx+padding,shiftY=s*ty+padding;for(const bezier of this.paths){const buffer=[],points=[];for(let j=0,jj=bezier.length;j<jj;j++){const[first,control1,control2,second]=bezier[j];if(first[0]===second[0]&&first[1]===second[1]&&jj===1){const p0=s*first[0]+shiftX,p1=s*first[1]+shiftY;buffer.push(p0,p1),points.push(p0,p1);break}const p10=s*first[0]+shiftX,p11=s*first[1]+shiftY,p20=s*control1[0]+shiftX,p21=s*control1[1]+shiftY,p30=s*control2[0]+shiftX,p31=s*control2[1]+shiftY,p40=s*second[0]+shiftX,p41=s*second[1]+shiftY;j===0&&(buffer.push(p10,p11),points.push(p10,p11)),buffer.push(p20,p21,p30,p31,p40,p41),points.push(p20,p21),j===jj-1&&points.push(p40,p41)}paths.push({bezier:__privateMethod(_a2=_InkEditor,_InkEditor_static,toPDFCoordinates_fn).call(_a2,buffer,rect,this.rotation),points:__privateMethod(_b2=_InkEditor,_InkEditor_static,toPDFCoordinates_fn).call(_b2,points,rect,this.rotation)})}return paths},"#serializePaths"),getBbox_fn=__name2(function(){let xMin=1/0,xMax=-1/0,yMin=1/0,yMax=-1/0;for(const path of this.paths)for(const[first,control1,control2,second]of path){const bbox=Util.bezierBoundingBox(...first,...control1,...control2,...second);xMin=Math.min(xMin,bbox[0]),yMin=Math.min(yMin,bbox[1]),xMax=Math.max(xMax,bbox[2]),yMax=Math.max(yMax,bbox[3])}return[xMin,yMin,xMax,yMax]},"#getBbox"),getPadding_fn=__name2(function(){return __privateGet(this,_disableEditing)?Math.ceil(this.thickness*this.parentScale):0},"#getPadding"),fitToContent_fn=__name2(function(firstTime=!1){if(this.isEmpty())return;if(!__privateGet(this,_disableEditing)){__privateMethod(this,_InkEditor_instances,redraw_fn).call(this);return}const bbox=__privateMethod(this,_InkEditor_instances,getBbox_fn).call(this),padding=__privateMethod(this,_InkEditor_instances,getPadding_fn).call(this);__privateSet(this,_baseWidth,Math.max(AnnotationEditor.MIN_SIZE,bbox[2]-bbox[0])),__privateSet(this,_baseHeight,Math.max(AnnotationEditor.MIN_SIZE,bbox[3]-bbox[1]));const width=Math.ceil(padding+__privateGet(this,_baseWidth)*this.scaleFactor),height=Math.ceil(padding+__privateGet(this,_baseHeight)*this.scaleFactor),[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this.setAspectRatio(width,height);const prevTranslationX=this.translationX,prevTranslationY=this.translationY;this.translationX=-bbox[0],this.translationY=-bbox[1],__privateMethod(this,_InkEditor_instances,setCanvasDims_fn).call(this),__privateMethod(this,_InkEditor_instances,redraw_fn).call(this),__privateSet(this,_realWidth,width),__privateSet(this,_realHeight,height),this.setDims(width,height);const unscaledPadding=firstTime?padding/this.scaleFactor/2:0;this.translate(prevTranslationX-this.translationX-unscaledPadding,prevTranslationY-this.translationY-unscaledPadding)},"#fitToContent"),__privateAdd(_InkEditor,_InkEditor_static),__name2(_InkEditor,"InkEditor"),__publicField(_InkEditor,"_defaultColor",null),__publicField(_InkEditor,"_defaultOpacity",1),__publicField(_InkEditor,"_defaultThickness",1),__publicField(_InkEditor,"_type","ink"),__publicField(_InkEditor,"_editorType",AnnotationEditorType.INK);let InkEditor=_InkEditor;const _StampEditor=class extends AnnotationEditor{static{__name(this,"_StampEditor")}constructor(params){super({...params,name:"stampEditor"}),__privateAdd(this,_StampEditor_instances),__privateAdd(this,_bitmap,null),__privateAdd(this,_bitmapId,null),__privateAdd(this,_bitmapPromise,null),__privateAdd(this,_bitmapUrl,null),__privateAdd(this,_bitmapFile,null),__privateAdd(this,_bitmapFileName,""),__privateAdd(this,_canvas,null),__privateAdd(this,_hasMLBeenQueried,!1),__privateAdd(this,_observer2,null),__privateAdd(this,_resizeTimeoutId,null),__privateAdd(this,_isSvg,!1),__privateAdd(this,_hasBeenAddedInUndoStack,!1),__privateSet(this,_bitmapUrl,params.bitmapUrl),__privateSet(this,_bitmapFile,params.bitmapFile)}static initialize(l10n,uiManager){AnnotationEditor.initialize(l10n,uiManager)}static get supportedTypes(){return shadow(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(type=>`image/${type}`))}static get supportedTypesStr(){return shadow(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(mime){return this.supportedTypes.includes(mime)}static paste(item,parent){parent.pasteEditor(AnnotationEditorType.STAMP,{bitmapFile:item.getAsFile()})}remove(){var _a2,_b2;__privateGet(this,_bitmapId)&&(__privateSet(this,_bitmap,null),this._uiManager.imageManager.deleteId(__privateGet(this,_bitmapId)),(_a2=__privateGet(this,_canvas))==null||_a2.remove(),__privateSet(this,_canvas,null),(_b2=__privateGet(this,_observer2))==null||_b2.disconnect(),__privateSet(this,_observer2,null),__privateGet(this,_resizeTimeoutId)&&(clearTimeout(__privateGet(this,_resizeTimeoutId)),__privateSet(this,_resizeTimeoutId,null))),super.remove()}rebuild(){if(!this.parent){__privateGet(this,_bitmapId)&&__privateMethod(this,_StampEditor_instances,getBitmap_fn).call(this);return}super.rebuild(),this.div!==null&&(__privateGet(this,_bitmapId)&&__privateGet(this,_canvas)===null&&__privateMethod(this,_StampEditor_instances,getBitmap_fn).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(__privateGet(this,_bitmapPromise)||__privateGet(this,_bitmap)||__privateGet(this,_bitmapUrl)||__privateGet(this,_bitmapFile)||__privateGet(this,_bitmapId))}get isResizable(){return!0}render(){if(this.div)return this.div;let baseX,baseY;if(this.width&&(baseX=this.x,baseY=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),__privateGet(this,_bitmap)?__privateMethod(this,_StampEditor_instances,createCanvas_fn2).call(this):__privateMethod(this,_StampEditor_instances,getBitmap_fn).call(this),this.width){const[parentWidth,parentHeight]=this.parentDimensions;this.setAt(baseX*parentWidth,baseY*parentHeight,this.width*parentWidth,this.height*parentHeight)}return this.div}getImageForAltText(){return __privateGet(this,_canvas)}static deserialize(data,parent,uiManager){if(data instanceof StampAnnotationElement)return null;const editor=super.deserialize(data,parent,uiManager),{rect,bitmapUrl,bitmapId,isSvg,accessibilityData}=data;bitmapId&&uiManager.imageManager.isValidId(bitmapId)?__privateSet(editor,_bitmapId,bitmapId):__privateSet(editor,_bitmapUrl,bitmapUrl),__privateSet(editor,_isSvg,isSvg);const[parentWidth,parentHeight]=editor.pageDimensions;return editor.width=(rect[2]-rect[0])/parentWidth,editor.height=(rect[3]-rect[1])/parentHeight,accessibilityData&&(editor.altTextData=accessibilityData),editor}serialize(isForCopying=!1,context=null){if(this.isEmpty())return null;const serialized={annotationType:AnnotationEditorType.STAMP,bitmapId:__privateGet(this,_bitmapId),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:__privateGet(this,_isSvg),structTreeParentId:this._structTreeParentId};if(isForCopying)return serialized.bitmapUrl=__privateMethod(this,_StampEditor_instances,serializeBitmap_fn).call(this,!0),serialized.accessibilityData=this.altTextData,serialized;const{decorative,altText}=this.altTextData;if(!decorative&&altText&&(serialized.accessibilityData={type:"Figure",alt:altText}),context===null)return serialized;context.stamps||(context.stamps=new Map);const area=__privateGet(this,_isSvg)?(serialized.rect[2]-serialized.rect[0])*(serialized.rect[3]-serialized.rect[1]):null;if(!context.stamps.has(__privateGet(this,_bitmapId)))context.stamps.set(__privateGet(this,_bitmapId),{area,serialized}),serialized.bitmap=__privateMethod(this,_StampEditor_instances,serializeBitmap_fn).call(this,!1);else if(__privateGet(this,_isSvg)){const prevData=context.stamps.get(__privateGet(this,_bitmapId));area>prevData.area&&(prevData.area=area,prevData.serialized.bitmap.close(),prevData.serialized.bitmap=__privateMethod(this,_StampEditor_instances,serializeBitmap_fn).call(this,!1))}return serialized}};_bitmap=new WeakMap,_bitmapId=new WeakMap,_bitmapPromise=new WeakMap,_bitmapUrl=new WeakMap,_bitmapFile=new WeakMap,_bitmapFileName=new WeakMap,_canvas=new WeakMap,_hasMLBeenQueried=new WeakMap,_observer2=new WeakMap,_resizeTimeoutId=new WeakMap,_isSvg=new WeakMap,_hasBeenAddedInUndoStack=new WeakMap,_StampEditor_instances=new WeakSet,getBitmapFetched_fn=__name2(function(data,fromId=!1){if(!data){this.remove();return}__privateSet(this,_bitmap,data.bitmap),fromId||(__privateSet(this,_bitmapId,data.id),__privateSet(this,_isSvg,data.isSvg)),data.file&&__privateSet(this,_bitmapFileName,data.file.name),__privateMethod(this,_StampEditor_instances,createCanvas_fn2).call(this)},"#getBitmapFetched"),getBitmapDone_fn=__name2(function(){__privateSet(this,_bitmapPromise,null),this._uiManager.enableWaiting(!1),__privateGet(this,_canvas)&&this.div.focus()},"#getBitmapDone"),getBitmap_fn=__name2(function(){if(__privateGet(this,_bitmapId)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(__privateGet(this,_bitmapId)).then(data=>__privateMethod(this,_StampEditor_instances,getBitmapFetched_fn).call(this,data,!0)).finally(()=>__privateMethod(this,_StampEditor_instances,getBitmapDone_fn).call(this));return}if(__privateGet(this,_bitmapUrl)){const url=__privateGet(this,_bitmapUrl);__privateSet(this,_bitmapUrl,null),this._uiManager.enableWaiting(!0),__privateSet(this,_bitmapPromise,this._uiManager.imageManager.getFromUrl(url).then(data=>__privateMethod(this,_StampEditor_instances,getBitmapFetched_fn).call(this,data)).finally(()=>__privateMethod(this,_StampEditor_instances,getBitmapDone_fn).call(this)));return}if(__privateGet(this,_bitmapFile)){const file=__privateGet(this,_bitmapFile);__privateSet(this,_bitmapFile,null),this._uiManager.enableWaiting(!0),__privateSet(this,_bitmapPromise,this._uiManager.imageManager.getFromFile(file).then(data=>__privateMethod(this,_StampEditor_instances,getBitmapFetched_fn).call(this,data)).finally(()=>__privateMethod(this,_StampEditor_instances,getBitmapDone_fn).call(this)));return}const input=document.createElement("input");input.type="file",input.accept=_StampEditor.supportedTypesStr;const signal=this._uiManager._signal;__privateSet(this,_bitmapPromise,new Promise(resolve=>{input.addEventListener("change",async()=>{if(!input.files||input.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const data=await this._uiManager.imageManager.getFromFile(input.files[0]);__privateMethod(this,_StampEditor_instances,getBitmapFetched_fn).call(this,data)}resolve()},{signal}),input.addEventListener("cancel",()=>{this.remove(),resolve()},{signal})}).finally(()=>__privateMethod(this,_StampEditor_instances,getBitmapDone_fn).call(this))),input.click()},"#getBitmap"),createCanvas_fn2=__name2(function(){const{div}=this;let{width,height}=__privateGet(this,_bitmap);const[pageWidth,pageHeight]=this.pageDimensions,MAX_RATIO=.75;if(this.width)width=this.width*pageWidth,height=this.height*pageHeight;else if(width>MAX_RATIO*pageWidth||height>MAX_RATIO*pageHeight){const factor=Math.min(MAX_RATIO*pageWidth/width,MAX_RATIO*pageHeight/height);width*=factor,height*=factor}const[parentWidth,parentHeight]=this.parentDimensions;this.setDims(width*parentWidth/pageWidth,height*parentHeight/pageHeight),this._uiManager.enableWaiting(!1);const canvas=__privateSet(this,_canvas,document.createElement("canvas"));div.append(canvas),div.hidden=!1,__privateMethod(this,_StampEditor_instances,drawBitmap_fn).call(this,width,height),__privateMethod(this,_StampEditor_instances,createObserver_fn2).call(this),__privateGet(this,_hasBeenAddedInUndoStack)||(this.parent.addUndoableEditor(this),__privateSet(this,_hasBeenAddedInUndoStack,!0)),this._reportTelemetry({action:"inserted_image"}),__privateGet(this,_bitmapFileName)&&canvas.setAttribute("aria-label",__privateGet(this,_bitmapFileName))},"#createCanvas"),setDimensions_fn=__name2(function(width,height){var _a2;const[parentWidth,parentHeight]=this.parentDimensions;this.width=width/parentWidth,this.height=height/parentHeight,this.setDims(width,height),(_a2=this._initialOptions)!=null&&_a2.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,__privateGet(this,_resizeTimeoutId)!==null&&clearTimeout(__privateGet(this,_resizeTimeoutId)),__privateSet(this,_resizeTimeoutId,setTimeout(()=>{__privateSet(this,_resizeTimeoutId,null),__privateMethod(this,_StampEditor_instances,drawBitmap_fn).call(this,width,height)},200))},"#setDimensions"),scaleBitmap_fn=__name2(function(width,height){const{width:bitmapWidth,height:bitmapHeight}=__privateGet(this,_bitmap);let newWidth=bitmapWidth,newHeight=bitmapHeight,bitmap=__privateGet(this,_bitmap);for(;newWidth>2*width||newHeight>2*height;){const prevWidth=newWidth,prevHeight=newHeight;newWidth>2*width&&(newWidth=newWidth>=16384?Math.floor(newWidth/2)-1:Math.ceil(newWidth/2)),newHeight>2*height&&(newHeight=newHeight>=16384?Math.floor(newHeight/2)-1:Math.ceil(newHeight/2));const offscreen=new OffscreenCanvas(newWidth,newHeight);offscreen.getContext("2d").drawImage(bitmap,0,0,prevWidth,prevHeight,0,0,newWidth,newHeight),bitmap=offscreen.transferToImageBitmap()}return bitmap},"#scaleBitmap"),mlGuessAltText_fn=__name2(async function(bitmap,width,height){if(__privateGet(this,_hasMLBeenQueried)||(__privateSet(this,_hasMLBeenQueried,!0),!await this._uiManager.isMLEnabledFor("altText")||this.hasAltText()))return;const ctx=new OffscreenCanvas(width,height).getContext("2d",{willReadFrequently:!0});ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,width,height);const response=await this._uiManager.mlGuess({service:"moz-image-to-text",request:{data:ctx.getImageData(0,0,width,height).data,width,height,channels:4}}),altText=response?.output||"";this.parent&&altText&&!this.hasAltText()&&(this.altTextData={altText,decorative:!1})},"#mlGuessAltText"),drawBitmap_fn=__name2(function(width,height){width=Math.ceil(width),height=Math.ceil(height);const canvas=__privateGet(this,_canvas);if(!canvas||canvas.width===width&&canvas.height===height)return;canvas.width=width,canvas.height=height;const bitmap=__privateGet(this,_isSvg)?__privateGet(this,_bitmap):__privateMethod(this,_StampEditor_instances,scaleBitmap_fn).call(this,width,height);__privateMethod(this,_StampEditor_instances,mlGuessAltText_fn).call(this,bitmap,width,height);const ctx=canvas.getContext("2d");ctx.filter=this._uiManager.hcmFilter,ctx.drawImage(bitmap,0,0,bitmap.width,bitmap.height,0,0,width,height)},"#drawBitmap"),serializeBitmap_fn=__name2(function(toUrl){if(toUrl){if(__privateGet(this,_isSvg)){const url=this._uiManager.imageManager.getSvgUrl(__privateGet(this,_bitmapId));if(url)return url}const canvas=document.createElement("canvas");return{width:canvas.width,height:canvas.height}=__privateGet(this,_bitmap),canvas.getContext("2d").drawImage(__privateGet(this,_bitmap),0,0),canvas.toDataURL()}if(__privateGet(this,_isSvg)){const[pageWidth,pageHeight]=this.pageDimensions,width=Math.round(this.width*pageWidth*PixelsPerInch.PDF_TO_CSS_UNITS),height=Math.round(this.height*pageHeight*PixelsPerInch.PDF_TO_CSS_UNITS),offscreen=new OffscreenCanvas(width,height);return offscreen.getContext("2d").drawImage(__privateGet(this,_bitmap),0,0,__privateGet(this,_bitmap).width,__privateGet(this,_bitmap).height,0,0,width,height),offscreen.transferToImageBitmap()}return structuredClone(__privateGet(this,_bitmap))},"#serializeBitmap"),createObserver_fn2=__name2(function(){this._uiManager._signal&&(__privateSet(this,_observer2,new ResizeObserver(entries=>{const rect=entries[0].contentRect;rect.width&&rect.height&&__privateMethod(this,_StampEditor_instances,setDimensions_fn).call(this,rect.width,rect.height)})),__privateGet(this,_observer2).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var _a2;(_a2=__privateGet(this,_observer2))==null||_a2.disconnect(),__privateSet(this,_observer2,null)},{once:!0}))},"#createObserver"),__name2(_StampEditor,"StampEditor"),__publicField(_StampEditor,"_type","stamp"),__publicField(_StampEditor,"_editorType",AnnotationEditorType.STAMP);let StampEditor=_StampEditor;const _AnnotationEditorLayer=class _AnnotationEditorLayer2{static{__name(this,"_AnnotationEditorLayer")}constructor({uiManager,pageIndex,div,accessibilityManager,annotationLayer,drawLayer,textLayer,viewport,l10n}){__privateAdd(this,_AnnotationEditorLayer_instances),__privateAdd(this,_accessibilityManager2),__privateAdd(this,_allowClick,!1),__privateAdd(this,_annotationLayer,null),__privateAdd(this,_boundPointerup,null),__privateAdd(this,_boundPointerdown,null),__privateAdd(this,_boundTextLayerPointerDown,null),__privateAdd(this,_editorFocusTimeoutId,null),__privateAdd(this,_editors,new Map),__privateAdd(this,_hadPointerDown,!1),__privateAdd(this,_isCleaningUp,!1),__privateAdd(this,_isDisabling,!1),__privateAdd(this,_textLayer,null),__privateAdd(this,_uiManager3);const editorTypes=[...__privateGet(_AnnotationEditorLayer2,_editorTypes2).values()];if(!_AnnotationEditorLayer2._initialized){_AnnotationEditorLayer2._initialized=!0;for(const editorType of editorTypes)editorType.initialize(l10n,uiManager)}uiManager.registerEditorTypes(editorTypes),__privateSet(this,_uiManager3,uiManager),this.pageIndex=pageIndex,this.div=div,__privateSet(this,_accessibilityManager2,accessibilityManager),__privateSet(this,_annotationLayer,annotationLayer),this.viewport=viewport,__privateSet(this,_textLayer,textLayer),this.drawLayer=drawLayer,__privateGet(this,_uiManager3).addLayer(this)}get isEmpty(){return __privateGet(this,_editors).size===0}get isInvisible(){return this.isEmpty&&__privateGet(this,_uiManager3).getMode()===AnnotationEditorType.NONE}updateToolbar(mode){__privateGet(this,_uiManager3).updateToolbar(mode)}updateMode(mode=__privateGet(this,_uiManager3).getMode()){switch(__privateMethod(this,_AnnotationEditorLayer_instances,cleanup_fn).call(this),mode){case AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList}=this.div;for(const editorType of __privateGet(_AnnotationEditorLayer2,_editorTypes2).values())classList.toggle(`${editorType._type}Editing`,mode===editorType._editorType);this.div.hidden=!1}hasTextLayer(textLayer){var _a2;return textLayer===((_a2=__privateGet(this,_textLayer))==null?void 0:_a2.div)}addInkEditorIfNeeded(isCommitting){if(__privateGet(this,_uiManager3).getMode()!==AnnotationEditorType.INK)return;if(!isCommitting){for(const editor2 of __privateGet(this,_editors).values())if(editor2.isEmpty()){editor2.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(isEditing){__privateGet(this,_uiManager3).setEditingState(isEditing)}addCommands(params){__privateGet(this,_uiManager3).addCommands(params)}toggleDrawing(enabled=!1){this.div.classList.toggle("drawing",!enabled)}togglePointerEvents(enabled=!1){this.div.classList.toggle("disabled",!enabled)}toggleAnnotationLayerPointerEvents(enabled=!1){var _a2;(_a2=__privateGet(this,_annotationLayer))==null||_a2.div.classList.toggle("disabled",!enabled)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const annotationElementIds=new Set;for(const editor of __privateGet(this,_editors).values())editor.enableEditing(),editor.show(!0),editor.annotationElementId&&(__privateGet(this,_uiManager3).removeChangedExistingAnnotation(editor),annotationElementIds.add(editor.annotationElementId));if(!__privateGet(this,_annotationLayer))return;const editables=__privateGet(this,_annotationLayer).getEditableAnnotations();for(const editable of editables){if(editable.hide(),__privateGet(this,_uiManager3).isDeletedAnnotationElement(editable.data.id)||annotationElementIds.has(editable.data.id))continue;const editor=this.deserialize(editable);editor&&(this.addOrRebuild(editor),editor.enableEditing())}}disable(){var _a2;__privateSet(this,_isDisabling,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const changedAnnotations=new Map,resetAnnotations=new Map;for(const editor of __privateGet(this,_editors).values())if(editor.disableEditing(),!!editor.annotationElementId){if(editor.serialize()!==null){changedAnnotations.set(editor.annotationElementId,editor);continue}else resetAnnotations.set(editor.annotationElementId,editor);(_a2=this.getEditableAnnotation(editor.annotationElementId))==null||_a2.show(),editor.remove()}if(__privateGet(this,_annotationLayer)){const editables=__privateGet(this,_annotationLayer).getEditableAnnotations();for(const editable of editables){const{id}=editable.data;if(__privateGet(this,_uiManager3).isDeletedAnnotationElement(id))continue;let editor=resetAnnotations.get(id);if(editor){editor.resetAnnotationElement(editable),editor.show(!1),editable.show();continue}editor=changedAnnotations.get(id),editor&&(__privateGet(this,_uiManager3).addChangedExistingAnnotation(editor),editor.renderAnnotationElement(editable),editor.show(!1)),editable.show()}}__privateMethod(this,_AnnotationEditorLayer_instances,cleanup_fn).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList}=this.div;for(const editorType of __privateGet(_AnnotationEditorLayer2,_editorTypes2).values())classList.remove(`${editorType._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),__privateSet(this,_isDisabling,!1)}getEditableAnnotation(id){var _a2;return((_a2=__privateGet(this,_annotationLayer))==null?void 0:_a2.getEditableAnnotation(id))||null}setActiveEditor(editor){__privateGet(this,_uiManager3).getActive()!==editor&&__privateGet(this,_uiManager3).setActiveEditor(editor)}enableTextSelection(){var _a2;this.div.tabIndex=-1,(_a2=__privateGet(this,_textLayer))!=null&&_a2.div&&!__privateGet(this,_boundTextLayerPointerDown)&&(__privateSet(this,_boundTextLayerPointerDown,__privateMethod(this,_AnnotationEditorLayer_instances,textLayerPointerDown_fn).bind(this)),__privateGet(this,_textLayer).div.addEventListener("pointerdown",__privateGet(this,_boundTextLayerPointerDown),{signal:__privateGet(this,_uiManager3)._signal}),__privateGet(this,_textLayer).div.classList.add("highlighting"))}disableTextSelection(){var _a2;this.div.tabIndex=0,(_a2=__privateGet(this,_textLayer))!=null&&_a2.div&&__privateGet(this,_boundTextLayerPointerDown)&&(__privateGet(this,_textLayer).div.removeEventListener("pointerdown",__privateGet(this,_boundTextLayerPointerDown)),__privateSet(this,_boundTextLayerPointerDown,null),__privateGet(this,_textLayer).div.classList.remove("highlighting"))}enableClick(){if(__privateGet(this,_boundPointerdown))return;const signal=__privateGet(this,_uiManager3)._signal;__privateSet(this,_boundPointerdown,this.pointerdown.bind(this)),__privateSet(this,_boundPointerup,this.pointerup.bind(this)),this.div.addEventListener("pointerdown",__privateGet(this,_boundPointerdown),{signal}),this.div.addEventListener("pointerup",__privateGet(this,_boundPointerup),{signal})}disableClick(){__privateGet(this,_boundPointerdown)&&(this.div.removeEventListener("pointerdown",__privateGet(this,_boundPointerdown)),this.div.removeEventListener("pointerup",__privateGet(this,_boundPointerup)),__privateSet(this,_boundPointerdown,null),__privateSet(this,_boundPointerup,null))}attach(editor){__privateGet(this,_editors).set(editor.id,editor);const{annotationElementId}=editor;annotationElementId&&__privateGet(this,_uiManager3).isDeletedAnnotationElement(annotationElementId)&&__privateGet(this,_uiManager3).removeDeletedAnnotationElement(editor)}detach(editor){var _a2;__privateGet(this,_editors).delete(editor.id),(_a2=__privateGet(this,_accessibilityManager2))==null||_a2.removePointerInTextLayer(editor.contentDiv),!__privateGet(this,_isDisabling)&&editor.annotationElementId&&__privateGet(this,_uiManager3).addDeletedAnnotationElement(editor)}remove(editor){this.detach(editor),__privateGet(this,_uiManager3).removeEditor(editor),editor.div.remove(),editor.isAttachedToDOM=!1,__privateGet(this,_isCleaningUp)||this.addInkEditorIfNeeded(!1)}changeParent(editor){var _a2;editor.parent!==this&&(editor.parent&&editor.annotationElementId&&(__privateGet(this,_uiManager3).addDeletedAnnotationElement(editor.annotationElementId),AnnotationEditor.deleteAnnotationElement(editor),editor.annotationElementId=null),this.attach(editor),(_a2=editor.parent)==null||_a2.detach(editor),editor.setParent(this),editor.div&&editor.isAttachedToDOM&&(editor.div.remove(),this.div.append(editor.div)))}add(editor){if(!(editor.parent===this&&editor.isAttachedToDOM)){if(this.changeParent(editor),__privateGet(this,_uiManager3).addEditor(editor),this.attach(editor),!editor.isAttachedToDOM){const div=editor.render();this.div.append(div),editor.isAttachedToDOM=!0}editor.fixAndSetPosition(),editor.onceAdded(),__privateGet(this,_uiManager3).addToAnnotationStorage(editor),editor._reportTelemetry(editor.telemetryInitialData)}}moveEditorInDOM(editor){var _a2;if(!editor.isAttachedToDOM)return;const{activeElement}=document;editor.div.contains(activeElement)&&!__privateGet(this,_editorFocusTimeoutId)&&(editor._focusEventsAllowed=!1,__privateSet(this,_editorFocusTimeoutId,setTimeout(()=>{__privateSet(this,_editorFocusTimeoutId,null),editor.div.contains(document.activeElement)?editor._focusEventsAllowed=!0:(editor.div.addEventListener("focusin",()=>{editor._focusEventsAllowed=!0},{once:!0,signal:__privateGet(this,_uiManager3)._signal}),activeElement.focus())},0))),editor._structTreeParentId=(_a2=__privateGet(this,_accessibilityManager2))==null?void 0:_a2.moveElementInDOM(this.div,editor.div,editor.contentDiv,!0)}addOrRebuild(editor){editor.needsToBeRebuilt()?(editor.parent||(editor.parent=this),editor.rebuild(),editor.show()):this.add(editor)}addUndoableEditor(editor){const cmd=__name2(()=>editor._uiManager.rebuild(editor),"cmd"),undo=__name2(()=>{editor.remove()},"undo");this.addCommands({cmd,undo,mustExec:!1})}getNextId(){return __privateGet(this,_uiManager3).getId()}get _signal(){return __privateGet(this,_uiManager3)._signal}canCreateNewEmptyEditor(){var _a2;return(_a2=__privateGet(this,_AnnotationEditorLayer_instances,currentEditorType_get))==null?void 0:_a2.canCreateNewEmptyEditor()}pasteEditor(mode,params){__privateGet(this,_uiManager3).updateToolbar(mode),__privateGet(this,_uiManager3).updateMode(mode);const{offsetX,offsetY}=__privateMethod(this,_AnnotationEditorLayer_instances,getCenterPoint_fn).call(this),id=this.getNextId(),editor=__privateMethod(this,_AnnotationEditorLayer_instances,createNewEditor_fn).call(this,{parent:this,id,x:offsetX,y:offsetY,uiManager:__privateGet(this,_uiManager3),isCentered:!0,...params});editor&&this.add(editor)}deserialize(data){var _a2;return((_a2=__privateGet(_AnnotationEditorLayer2,_editorTypes2).get(data.annotationType??data.annotationEditorType))==null?void 0:_a2.deserialize(data,this,__privateGet(this,_uiManager3)))||null}createAndAddNewEditor(event,isCentered,data={}){const id=this.getNextId(),editor=__privateMethod(this,_AnnotationEditorLayer_instances,createNewEditor_fn).call(this,{parent:this,id,x:event.offsetX,y:event.offsetY,uiManager:__privateGet(this,_uiManager3),isCentered,...data});return editor&&this.add(editor),editor}addNewEditor(){this.createAndAddNewEditor(__privateMethod(this,_AnnotationEditorLayer_instances,getCenterPoint_fn).call(this),!0)}setSelected(editor){__privateGet(this,_uiManager3).setSelected(editor)}toggleSelected(editor){__privateGet(this,_uiManager3).toggleSelected(editor)}isSelected(editor){return __privateGet(this,_uiManager3).isSelected(editor)}unselect(editor){__privateGet(this,_uiManager3).unselect(editor)}pointerup(event){const{isMac}=util_FeatureTest.platform;if(!(event.button!==0||event.ctrlKey&&isMac)&&event.target===this.div&&__privateGet(this,_hadPointerDown)){if(__privateSet(this,_hadPointerDown,!1),!__privateGet(this,_allowClick)){__privateSet(this,_allowClick,!0);return}if(__privateGet(this,_uiManager3).getMode()===AnnotationEditorType.STAMP){__privateGet(this,_uiManager3).unselectAll();return}this.createAndAddNewEditor(event,!1)}}pointerdown(event){if(__privateGet(this,_uiManager3).getMode()===AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),__privateGet(this,_hadPointerDown)){__privateSet(this,_hadPointerDown,!1);return}const{isMac}=util_FeatureTest.platform;if(event.button!==0||event.ctrlKey&&isMac||event.target!==this.div)return;__privateSet(this,_hadPointerDown,!0);const editor=__privateGet(this,_uiManager3).getActive();__privateSet(this,_allowClick,!editor||editor.isEmpty())}findNewParent(editor,x,y){const layer=__privateGet(this,_uiManager3).findParent(x,y);return layer===null||layer===this?!1:(layer.changeParent(editor),!0)}destroy(){var _a2,_b2;((_a2=__privateGet(this,_uiManager3).getActive())==null?void 0:_a2.parent)===this&&(__privateGet(this,_uiManager3).commitOrRemove(),__privateGet(this,_uiManager3).setActiveEditor(null)),__privateGet(this,_editorFocusTimeoutId)&&(clearTimeout(__privateGet(this,_editorFocusTimeoutId)),__privateSet(this,_editorFocusTimeoutId,null));for(const editor of __privateGet(this,_editors).values())(_b2=__privateGet(this,_accessibilityManager2))==null||_b2.removePointerInTextLayer(editor.contentDiv),editor.setParent(null),editor.isAttachedToDOM=!1,editor.div.remove();this.div=null,__privateGet(this,_editors).clear(),__privateGet(this,_uiManager3).removeLayer(this)}render({viewport}){this.viewport=viewport,setLayerDimensions(this.div,viewport);for(const editor of __privateGet(this,_uiManager3).getEditors(this.pageIndex))this.add(editor),editor.rebuild();this.updateMode()}update({viewport}){__privateGet(this,_uiManager3).commitOrRemove(),__privateMethod(this,_AnnotationEditorLayer_instances,cleanup_fn).call(this);const oldRotation=this.viewport.rotation,rotation=viewport.rotation;if(this.viewport=viewport,setLayerDimensions(this.div,{rotation}),oldRotation!==rotation)for(const editor of __privateGet(this,_editors).values())editor.rotate(rotation);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth,pageHeight}=this.viewport.rawDims;return[pageWidth,pageHeight]}get scale(){return __privateGet(this,_uiManager3).viewParameters.realScale}};_accessibilityManager2=new WeakMap,_allowClick=new WeakMap,_annotationLayer=new WeakMap,_boundPointerup=new WeakMap,_boundPointerdown=new WeakMap,_boundTextLayerPointerDown=new WeakMap,_editorFocusTimeoutId=new WeakMap,_editors=new WeakMap,_hadPointerDown=new WeakMap,_isCleaningUp=new WeakMap,_isDisabling=new WeakMap,_textLayer=new WeakMap,_uiManager3=new WeakMap,_editorTypes2=new WeakMap,_AnnotationEditorLayer_instances=new WeakSet,textLayerPointerDown_fn=__name2(function(event){__privateGet(this,_uiManager3).unselectAll();const{target}=event;if(target===__privateGet(this,_textLayer).div||target.classList.contains("endOfContent")&&__privateGet(this,_textLayer).div.contains(target)){const{isMac}=util_FeatureTest.platform;if(event.button!==0||event.ctrlKey&&isMac)return;__privateGet(this,_uiManager3).showAllEditors("highlight",!0,!0),__privateGet(this,_textLayer).div.classList.add("free"),this.toggleDrawing(),HighlightEditor.startHighlighting(this,__privateGet(this,_uiManager3).direction==="ltr",event),__privateGet(this,_textLayer).div.addEventListener("pointerup",()=>{__privateGet(this,_textLayer).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:__privateGet(this,_uiManager3)._signal}),event.preventDefault()}},"#textLayerPointerDown"),currentEditorType_get=__name2(function(){return __privateGet(_AnnotationEditorLayer,_editorTypes2).get(__privateGet(this,_uiManager3).getMode())},"#currentEditorType"),createNewEditor_fn=__name2(function(params){const editorType=__privateGet(this,_AnnotationEditorLayer_instances,currentEditorType_get);return editorType?new editorType.prototype.constructor(params):null},"#createNewEditor"),getCenterPoint_fn=__name2(function(){const{x,y,width,height}=this.div.getBoundingClientRect(),tlX=Math.max(0,x),tlY=Math.max(0,y),brX=Math.min(window.innerWidth,x+width),brY=Math.min(window.innerHeight,y+height),centerX=(tlX+brX)/2-x,centerY=(tlY+brY)/2-y,[offsetX,offsetY]=this.viewport.rotation%180===0?[centerX,centerY]:[centerY,centerX];return{offsetX,offsetY}},"#getCenterPoint"),cleanup_fn=__name2(function(){__privateSet(this,_isCleaningUp,!0);for(const editor of __privateGet(this,_editors).values())editor.isEmpty()&&editor.remove();__privateSet(this,_isCleaningUp,!1)},"#cleanup"),__name2(_AnnotationEditorLayer,"AnnotationEditorLayer"),__publicField(_AnnotationEditorLayer,"_initialized",!1),__privateAdd(_AnnotationEditorLayer,_editorTypes2,new Map([FreeTextEditor,InkEditor,StampEditor,HighlightEditor].map(type=>[type._editorType,type])));let AnnotationEditorLayer=_AnnotationEditorLayer;const _DrawLayer=class _DrawLayer2{static{__name(this,"_DrawLayer")}constructor({pageIndex}){__privateAdd(this,_DrawLayer_instances),__privateAdd(this,_parent2,null),__privateAdd(this,_id5,0),__privateAdd(this,_mapping,new Map),__privateAdd(this,_toUpdate,new Map),this.pageIndex=pageIndex}setParent(parent){if(!__privateGet(this,_parent2)){__privateSet(this,_parent2,parent);return}if(__privateGet(this,_parent2)!==parent){if(__privateGet(this,_mapping).size>0)for(const root of __privateGet(this,_mapping).values())root.remove(),parent.append(root);__privateSet(this,_parent2,parent)}}static get _svgFactory(){return shadow(this,"_svgFactory",new DOMSVGFactory)}highlight(outlines,color,opacity,isPathUpdatable=!1){const id=__privateWrapper(this,_id5)._++,root=__privateMethod(this,_DrawLayer_instances,createSVG_fn).call(this,outlines.box);root.classList.add("highlight"),outlines.free&&root.classList.add("free");const defs=_DrawLayer2._svgFactory.createElement("defs");root.append(defs);const path=_DrawLayer2._svgFactory.createElement("path");defs.append(path);const pathId=`path_p${this.pageIndex}_${id}`;path.setAttribute("id",pathId),path.setAttribute("d",outlines.toSVGPath()),isPathUpdatable&&__privateGet(this,_toUpdate).set(id,path);const clipPathId=__privateMethod(this,_DrawLayer_instances,createClipPath_fn).call(this,defs,pathId),use=_DrawLayer2._svgFactory.createElement("use");return root.append(use),root.setAttribute("fill",color),root.setAttribute("fill-opacity",opacity),use.setAttribute("href",`#${pathId}`),__privateGet(this,_mapping).set(id,root),{id,clipPathId:`url(#${clipPathId})`}}highlightOutline(outlines){const id=__privateWrapper(this,_id5)._++,root=__privateMethod(this,_DrawLayer_instances,createSVG_fn).call(this,outlines.box);root.classList.add("highlightOutline");const defs=_DrawLayer2._svgFactory.createElement("defs");root.append(defs);const path=_DrawLayer2._svgFactory.createElement("path");defs.append(path);const pathId=`path_p${this.pageIndex}_${id}`;path.setAttribute("id",pathId),path.setAttribute("d",outlines.toSVGPath()),path.setAttribute("vector-effect","non-scaling-stroke");let maskId;if(outlines.free){root.classList.add("free");const mask=_DrawLayer2._svgFactory.createElement("mask");defs.append(mask),maskId=`mask_p${this.pageIndex}_${id}`,mask.setAttribute("id",maskId),mask.setAttribute("maskUnits","objectBoundingBox");const rect=_DrawLayer2._svgFactory.createElement("rect");mask.append(rect),rect.setAttribute("width","1"),rect.setAttribute("height","1"),rect.setAttribute("fill","white");const use=_DrawLayer2._svgFactory.createElement("use");mask.append(use),use.setAttribute("href",`#${pathId}`),use.setAttribute("stroke","none"),use.setAttribute("fill","black"),use.setAttribute("fill-rule","nonzero"),use.classList.add("mask")}const use1=_DrawLayer2._svgFactory.createElement("use");root.append(use1),use1.setAttribute("href",`#${pathId}`),maskId&&use1.setAttribute("mask",`url(#${maskId})`);const use2=use1.cloneNode();return root.append(use2),use1.classList.add("mainOutline"),use2.classList.add("secondaryOutline"),__privateGet(this,_mapping).set(id,root),id}finalizeLine(id,line){const path=__privateGet(this,_toUpdate).get(id);__privateGet(this,_toUpdate).delete(id),this.updateBox(id,line.box),path.setAttribute("d",line.toSVGPath())}updateLine(id,line){__privateGet(this,_mapping).get(id).firstChild.firstChild.setAttribute("d",line.toSVGPath())}removeFreeHighlight(id){this.remove(id),__privateGet(this,_toUpdate).delete(id)}updatePath(id,line){__privateGet(this,_toUpdate).get(id).setAttribute("d",line.toSVGPath())}updateBox(id,box){var _a2;__privateMethod(_a2=_DrawLayer2,_DrawLayer_static,setBox_fn).call(_a2,__privateGet(this,_mapping).get(id),box)}show(id,visible){__privateGet(this,_mapping).get(id).classList.toggle("hidden",!visible)}rotate(id,angle){__privateGet(this,_mapping).get(id).setAttribute("data-main-rotation",angle)}changeColor(id,color){__privateGet(this,_mapping).get(id).setAttribute("fill",color)}changeOpacity(id,opacity){__privateGet(this,_mapping).get(id).setAttribute("fill-opacity",opacity)}addClass(id,className){__privateGet(this,_mapping).get(id).classList.add(className)}removeClass(id,className){__privateGet(this,_mapping).get(id).classList.remove(className)}remove(id){__privateGet(this,_parent2)!==null&&(__privateGet(this,_mapping).get(id).remove(),__privateGet(this,_mapping).delete(id))}destroy(){__privateSet(this,_parent2,null);for(const root of __privateGet(this,_mapping).values())root.remove();__privateGet(this,_mapping).clear()}};_parent2=new WeakMap,_id5=new WeakMap,_mapping=new WeakMap,_toUpdate=new WeakMap,_DrawLayer_static=new WeakSet,setBox_fn=__name2(function(element,{x=0,y=0,width=1,height=1}={}){const{style}=element;style.top=`${100*y}%`,style.left=`${100*x}%`,style.width=`${100*width}%`,style.height=`${100*height}%`},"#setBox"),_DrawLayer_instances=new WeakSet,createSVG_fn=__name2(function(box){var _a2;const svg=_DrawLayer._svgFactory.create(1,1,!0);return __privateGet(this,_parent2).append(svg),svg.setAttribute("aria-hidden",!0),__privateMethod(_a2=_DrawLayer,_DrawLayer_static,setBox_fn).call(_a2,svg,box),svg},"#createSVG"),createClipPath_fn=__name2(function(defs,pathId){const clipPath=_DrawLayer._svgFactory.createElement("clipPath");defs.append(clipPath);const clipPathId=`clip_${pathId}`;clipPath.setAttribute("id",clipPathId),clipPath.setAttribute("clipPathUnits","objectBoundingBox");const clipPathUse=_DrawLayer._svgFactory.createElement("use");return clipPath.append(clipPathUse),clipPathUse.setAttribute("href",`#${pathId}`),clipPathUse.classList.add("clip"),clipPathId},"#createClipPath"),__privateAdd(_DrawLayer,_DrawLayer_static),__name2(_DrawLayer,"DrawLayer");let DrawLayer=_DrawLayer;__webpack_exports__.AbortException,__webpack_exports__.AnnotationEditorLayer,__webpack_exports__.AnnotationEditorParamsType,__webpack_exports__.AnnotationEditorType,__webpack_exports__.AnnotationEditorUIManager,__webpack_exports__.AnnotationLayer,__webpack_exports__.AnnotationMode,__webpack_exports__.CMapCompressionType,__webpack_exports__.ColorPicker,__webpack_exports__.DOMSVGFactory,__webpack_exports__.DrawLayer,__webpack_exports__.FeatureTest;var __webpack_exports__GlobalWorkerOptions=__webpack_exports__.GlobalWorkerOptions;__webpack_exports__.ImageKind,__webpack_exports__.InvalidPDFException,__webpack_exports__.MissingPDFException;var __webpack_exports__OPS=__webpack_exports__.OPS;__webpack_exports__.PDFDataRangeTransport,__webpack_exports__.PDFDateString,__webpack_exports__.PDFWorker,__webpack_exports__.PasswordResponses,__webpack_exports__.PermissionFlag,__webpack_exports__.PixelsPerInch,__webpack_exports__.RenderingCancelledException,__webpack_exports__.TextLayer,__webpack_exports__.UnexpectedResponseException,__webpack_exports__.Util,__webpack_exports__.VerbosityLevel,__webpack_exports__.XfaLayer,__webpack_exports__.build,__webpack_exports__.createValidAbsoluteUrl,__webpack_exports__.fetchData;var __webpack_exports__getDocument=__webpack_exports__.getDocument;__webpack_exports__.getFilenameFromUrl,__webpack_exports__.getPdfFilenameFromUrl,__webpack_exports__.getXfaPageViewport,__webpack_exports__.isDataScheme,__webpack_exports__.isPdfFile,__webpack_exports__.noContextMenu,__webpack_exports__.normalizeUnicode,__webpack_exports__.setLayerDimensions,__webpack_exports__.shadow,__webpack_exports__.version;const pdfjsWorker=""+new URL("assets/pdf.worker-cSWBhdGt.js",import.meta.url).href;function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];last==="."?parts.splice(i,1):last===".."?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}__name(normalizeArray,"normalizeArray"),__name2(normalizeArray,"normalizeArray");function normalize(path){var isPathAbsolute=isAbsolute(path),trailingSlash=substr(path,-1)==="/";return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isPathAbsolute).join("/"),!path&&!isPathAbsolute&&(path="."),path&&trailingSlash&&(path+="/"),(isPathAbsolute?"/":"")+path}__name(normalize,"normalize"),__name2(normalize,"normalize");function isAbsolute(path){return path.charAt(0)==="/"}__name(isAbsolute,"isAbsolute"),__name2(isAbsolute,"isAbsolute");function join(){var paths=Array.prototype.slice.call(arguments,0);return normalize(filter(paths,function(p,index2){if(typeof p!="string")throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))}__name(join,"join"),__name2(join,"join");function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}__name(filter,"filter"),__name2(filter,"filter");var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)},ARG_LENGTH={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},SEGMENT_PATTERN=/([astvzqmhlc])([^astvzqmhlc]*)/gi,NUMBER=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;function parseValues(args){const numbers=args.match(NUMBER);return numbers?numbers.map(Number):[]}__name(parseValues,"parseValues"),__name2(parseValues,"parseValues");function parsePath(path){const data=[],p=String(path).trim();return p[0]!=="M"&&p[0]!=="m"||p.replace(SEGMENT_PATTERN,(_,command,args)=>{const theArgs=parseValues(args);let type=command.toLowerCase(),theCommand=command;if(type==="m"&&theArgs.length>2&&(data.push([theCommand,...theArgs.splice(0,2)]),type="l",theCommand=theCommand==="m"?"l":"L"),theArgs.length<ARG_LENGTH[type])return"";for(data.push([theCommand,...theArgs.splice(0,ARG_LENGTH[type])]);theArgs.length>=ARG_LENGTH[type]&&theArgs.length&&ARG_LENGTH[type];)data.push([theCommand,...theArgs.splice(0,ARG_LENGTH[type])]);return""}),data}__name(parsePath,"parsePath"),__name2(parsePath,"parsePath");function rotatePoint(point,angle){const nx=point.x*Math.cos(angle)-point.y*Math.sin(angle),ny=point.y*Math.cos(angle)+point.x*Math.sin(angle);point.x=nx,point.y=ny}__name(rotatePoint,"rotatePoint"),__name2(rotatePoint,"rotatePoint");function translatePoint(point,dx,dy){point.x+=dx,point.y+=dy}__name(translatePoint,"translatePoint"),__name2(translatePoint,"translatePoint");function scalePoint(point,s){point.x*=s,point.y*=s}__name(scalePoint,"scalePoint"),__name2(scalePoint,"scalePoint");var Path2D$1=(_b=class{static{__name(this,"_b")}constructor(path){this.commands=[],path&&path instanceof _b?this.commands.push(...path.commands):path&&(this.commands=parsePath(path))}addPath(path){path&&path instanceof _b&&this.commands.push(...path.commands)}moveTo(x,y){this.commands.push(["M",x,y])}lineTo(x,y){this.commands.push(["L",x,y])}arc(x,y,r,start,end,ccw){this.commands.push(["AC",x,y,r,start,end,!!ccw])}arcTo(x1,y1,x2,y2,r){this.commands.push(["AT",x1,y1,x2,y2,r])}ellipse(x,y,rx,ry,angle,start,end,ccw){this.commands.push(["E",x,y,rx,ry,angle,start,end,!!ccw])}closePath(){this.commands.push(["Z"])}bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y){this.commands.push(["C",cp1x,cp1y,cp2x,cp2y,x,y])}quadraticCurveTo(cpx,cpy,x,y){this.commands.push(["Q",cpx,cpy,x,y])}rect(x,y,width,height){this.commands.push(["R",x,y,width,height])}roundRect(x,y,width,height,radii){typeof radii>"u"?this.commands.push(["RR",x,y,width,height,0]):this.commands.push(["RR",x,y,width,height,radii])}},__name2(_b,"_Path2D"),_b);function buildPath(ctx,commands){let x=0,y=0,endAngle,startAngle,largeArcFlag,sweepFlag,endPoint,midPoint,angle,lambda,t1,t2,x1,y1,r,rx,ry,w,h,pathType,centerPoint,ccw,radii,cpx=null,cpy=null,qcpx=null,qcpy=null,startPoint=null,currentPoint=null;ctx.beginPath();for(let i=0;i<commands.length;++i){pathType=commands[i][0],pathType!=="S"&&pathType!=="s"&&pathType!=="C"&&pathType!=="c"&&(cpx=null,cpy=null),pathType!=="T"&&pathType!=="t"&&pathType!=="Q"&&pathType!=="q"&&(qcpx=null,qcpy=null);let c;switch(pathType){case"m":case"M":c=commands[i],pathType==="m"?(x+=c[1],y+=c[2]):(x=c[1],y=c[2]),(pathType==="M"||!startPoint)&&(startPoint={x,y}),ctx.moveTo(x,y);break;case"l":c=commands[i],x+=c[1],y+=c[2],ctx.lineTo(x,y);break;case"L":c=commands[i],x=c[1],y=c[2],ctx.lineTo(x,y);break;case"H":c=commands[i],x=c[1],ctx.lineTo(x,y);break;case"h":c=commands[i],x+=c[1],ctx.lineTo(x,y);break;case"V":c=commands[i],y=c[1],ctx.lineTo(x,y);break;case"v":c=commands[i],y+=c[1],ctx.lineTo(x,y);break;case"a":case"A":if(c=commands[i],currentPoint===null)throw new Error("This should never happen");pathType==="a"?(x+=c[6],y+=c[7]):(x=c[6],y=c[7]),rx=c[1],ry=c[2],angle=c[3]*Math.PI/180,largeArcFlag=!!c[4],sweepFlag=!!c[5],endPoint={x,y},midPoint={x:(currentPoint.x-endPoint.x)/2,y:(currentPoint.y-endPoint.y)/2},rotatePoint(midPoint,-angle),lambda=midPoint.x*midPoint.x/(rx*rx)+midPoint.y*midPoint.y/(ry*ry),lambda>1&&(lambda=Math.sqrt(lambda),rx*=lambda,ry*=lambda),centerPoint={x:rx*midPoint.y/ry,y:-(ry*midPoint.x)/rx},t1=rx*rx*ry*ry,t2=rx*rx*midPoint.y*midPoint.y+ry*ry*midPoint.x*midPoint.x,sweepFlag!==largeArcFlag?scalePoint(centerPoint,Math.sqrt((t1-t2)/t2)||0):scalePoint(centerPoint,-Math.sqrt((t1-t2)/t2)||0),startAngle=Math.atan2((midPoint.y-centerPoint.y)/ry,(midPoint.x-centerPoint.x)/rx),endAngle=Math.atan2(-(midPoint.y+centerPoint.y)/ry,-(midPoint.x+centerPoint.x)/rx),rotatePoint(centerPoint,angle),translatePoint(centerPoint,(endPoint.x+currentPoint.x)/2,(endPoint.y+currentPoint.y)/2),ctx.save(),ctx.translate(centerPoint.x,centerPoint.y),ctx.rotate(angle),ctx.scale(rx,ry),ctx.arc(0,0,1,startAngle,endAngle,!sweepFlag),ctx.restore();break;case"C":c=commands[i],cpx=c[3],cpy=c[4],x=c[5],y=c[6],ctx.bezierCurveTo(c[1],c[2],cpx,cpy,x,y);break;case"c":c=commands[i],ctx.bezierCurveTo(c[1]+x,c[2]+y,c[3]+x,c[4]+y,c[5]+x,c[6]+y),cpx=c[3]+x,cpy=c[4]+y,x+=c[5],y+=c[6];break;case"S":c=commands[i],(cpx===null||cpy===null)&&(cpx=x,cpy=y),ctx.bezierCurveTo(2*x-cpx,2*y-cpy,c[1],c[2],c[3],c[4]),cpx=c[1],cpy=c[2],x=c[3],y=c[4];break;case"s":c=commands[i],(cpx===null||cpy===null)&&(cpx=x,cpy=y),ctx.bezierCurveTo(2*x-cpx,2*y-cpy,c[1]+x,c[2]+y,c[3]+x,c[4]+y),cpx=c[1]+x,cpy=c[2]+y,x+=c[3],y+=c[4];break;case"Q":c=commands[i],qcpx=c[1],qcpy=c[2],x=c[3],y=c[4],ctx.quadraticCurveTo(qcpx,qcpy,x,y);break;case"q":c=commands[i],qcpx=c[1]+x,qcpy=c[2]+y,x+=c[3],y+=c[4],ctx.quadraticCurveTo(qcpx,qcpy,x,y);break;case"T":c=commands[i],(qcpx===null||qcpy===null)&&(qcpx=x,qcpy=y),qcpx=2*x-qcpx,qcpy=2*y-qcpy,x=c[1],y=c[2],ctx.quadraticCurveTo(qcpx,qcpy,x,y);break;case"t":c=commands[i],(qcpx===null||qcpy===null)&&(qcpx=x,qcpy=y),qcpx=2*x-qcpx,qcpy=2*y-qcpy,x+=c[1],y+=c[2],ctx.quadraticCurveTo(qcpx,qcpy,x,y);break;case"z":case"Z":startPoint&&(x=startPoint.x,y=startPoint.y),startPoint=null,ctx.closePath();break;case"AC":c=commands[i],x=c[1],y=c[2],r=c[3],startAngle=c[4],endAngle=c[5],ccw=c[6],ctx.arc(x,y,r,startAngle,endAngle,ccw);break;case"AT":c=commands[i],x1=c[1],y1=c[2],x=c[3],y=c[4],r=c[5],ctx.arcTo(x1,y1,x,y,r);break;case"E":c=commands[i],x=c[1],y=c[2],rx=c[3],ry=c[4],angle=c[5],startAngle=c[6],endAngle=c[7],ccw=c[8],ctx.save(),ctx.translate(x,y),ctx.rotate(angle),ctx.scale(rx,ry),ctx.arc(0,0,1,startAngle,endAngle,ccw),ctx.restore();break;case"R":c=commands[i],x=c[1],y=c[2],w=c[3],h=c[4],startPoint={x,y},ctx.rect(x,y,w,h);break;case"RR":c=commands[i],x=c[1],y=c[2],w=c[3],h=c[4],radii=c[5],startPoint={x,y},ctx.roundRect(x,y,w,h,radii);break;default:throw new Error(`Invalid path command: ${pathType}`)}currentPoint?(currentPoint.x=x,currentPoint.y=y):currentPoint={x,y}}}__name(buildPath,"buildPath"),__name2(buildPath,"buildPath");function roundRect(x,y,width,height,radii=0){if(typeof radii=="number"&&(radii=[radii]),Array.isArray(radii)){if(radii.length===0||radii.length>4)throw new RangeError(`Failed to execute 'roundRect' on '${this.constructor.name}': ${radii.length} radii provided. Between one and four radii are necessary.`);radii.forEach(v=>{if(v<0)throw new RangeError(`Failed to execute 'roundRect' on '${this.constructor.name}': Radius value ${v} is negative.`)})}else return;if(radii.length===1&&radii[0]===0){this.rect(x,y,width,height);return}const minRadius=Math.min(width,height)/2,tl=Math.min(minRadius,radii[0]);let tr=tl,br=tl,bl=tl;radii.length===2&&(tr=Math.min(minRadius,radii[1]),bl=tr),radii.length===3&&(tr=Math.min(minRadius,radii[1]),bl=tr,br=Math.min(minRadius,radii[2])),radii.length===4&&(tr=Math.min(minRadius,radii[1]),br=Math.min(minRadius,radii[2]),bl=Math.min(minRadius,radii[3])),this.moveTo(x,y+height-bl),this.arcTo(x,y,x+tl,y,tl),this.arcTo(x+width,y,x+width,y+tr,tr),this.arcTo(x+width,y+height,x+width-br,y+height,br),this.arcTo(x,y+height,x,y+height-bl,bl),this.moveTo(x,y)}__name(roundRect,"roundRect"),__name2(roundRect,"roundRect");function applyPath2DToCanvasRenderingContext(CanvasRenderingContext2D){if(!CanvasRenderingContext2D)return;const cClip=CanvasRenderingContext2D.prototype.clip,cFill=CanvasRenderingContext2D.prototype.fill,cStroke=CanvasRenderingContext2D.prototype.stroke,cIsPointInPath=CanvasRenderingContext2D.prototype.isPointInPath;CanvasRenderingContext2D.prototype.clip=__name2(__name(function(...args){if(args[0]instanceof Path2D$1){const path=args[0],fillRule2=args[1]||"nonzero";return buildPath(this,path.commands),cClip.apply(this,[fillRule2])}const fillRule=args[0]||"nonzero";return cClip.apply(this,[fillRule])},"clip"),"clip"),CanvasRenderingContext2D.prototype.fill=__name2(__name(function(...args){if(args[0]instanceof Path2D$1){const path=args[0],fillRule2=args[1]||"nonzero";return buildPath(this,path.commands),cFill.apply(this,[fillRule2])}const fillRule=args[0]||"nonzero";return cFill.apply(this,[fillRule])},"fill"),"fill"),CanvasRenderingContext2D.prototype.stroke=__name2(__name(function(path){path&&buildPath(this,path.commands),cStroke.apply(this)},"stroke"),"stroke"),CanvasRenderingContext2D.prototype.isPointInPath=__name2(__name(function(...args){if(args[0]instanceof Path2D$1){const path=args[0],x=args[1],y=args[2],fillRule=args[3]||"nonzero";return buildPath(this,path.commands),cIsPointInPath.apply(this,[x,y,fillRule])}return cIsPointInPath.apply(this,args)},"isPointInPath"),"isPointInPath")}__name(applyPath2DToCanvasRenderingContext,"applyPath2DToCanvasRenderingContext"),__name2(applyPath2DToCanvasRenderingContext,"applyPath2DToCanvasRenderingContext");function applyRoundRectToCanvasRenderingContext2D(CanvasRenderingContext2D){CanvasRenderingContext2D&&!CanvasRenderingContext2D.prototype.roundRect&&(CanvasRenderingContext2D.prototype.roundRect=roundRect)}__name(applyRoundRectToCanvasRenderingContext2D,"applyRoundRectToCanvasRenderingContext2D"),__name2(applyRoundRectToCanvasRenderingContext2D,"applyRoundRectToCanvasRenderingContext2D");function applyRoundRectToPath2D(P2D){P2D&&!P2D.prototype.roundRect&&(P2D.prototype.roundRect=roundRect)}__name(applyRoundRectToPath2D,"applyRoundRectToPath2D"),__name2(applyRoundRectToPath2D,"applyRoundRectToPath2D");const index=Object.freeze(Object.defineProperty({__proto__:null,Path2D:Path2D$1,applyPath2DToCanvasRenderingContext,applyRoundRectToCanvasRenderingContext2D,applyRoundRectToPath2D,buildPath,parsePath,roundRect},Symbol.toStringTag,{value:"Module"}));export{__webpack_exports__getDocument as _,compare as a,__webpack_exports__OPS as b,createCanvas as c,__webpack_exports__GlobalWorkerOptions as d,join as j,loadImage as l,pdfjsWorker as p};
